
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/imopenlines.livechat/templates/iframe/script.min.js?154412742321429";s:6:"source";s:73:"/bitrix/components/bitrix/imopenlines.livechat/templates/iframe/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
function LiveChatBackend(e){this.init=function(e){this.initParams=e;this.timeout={};this.postMessageDomain=null;this.postMessageOrigin=null;this.postMessageSource=null;this.initFrameParameters();this.initEvent()};this.initFrameParameters=function(){if(!this.isFrame()){return}if(!window.location.hash){return}var e={};try{e=JSON.parse(decodeURIComponent(window.location.hash.substring(1)))}catch(e){}if(e.domain){this.postMessageDomain=e.domain}};this.isFrame=function(){return window!=window.top};this.initEvent=function(){if(!this.isFrame()){return}if(typeof window.postMessage==="function"){BX.bind(window,"message",BX.proxy(function(e){if(e&&e.origin==this.postMessageDomain){var s={};try{s=JSON.parse(e.data)}catch(e){}if(s.action=="init"){this.uniqueLoadId=s.uniqueLoadId;this.postMessageSource=e.source;this.postMessageOrigin=e.origin;this.postMessageStartShowed=s.showed;var t={};t["uniqueLoadId"]=this.uniqueLoadId;t["action"]="init";t["title"]=this.initParams.LINE_NAME;t["connectors"]=this.initParams.CONNECTORS;t["queue"]=this.initParams.QUEUE;t["showedDialog"]=this.showedDialog?"Y":"N";if(this.initParams.ERROR_CODE){t["errorCode"]=this.initParams.ERROR_CODE}this.sendDataToFrameHolder(t);if(typeof BXIM!="undefined"){BXIM.messenger.popupMessengerTextarea.value=s.textarea;BXIM.messenger.textareaCheckText();if(this.postMessageStartShowed){setTimeout(function(){BXIM.messenger.popupMessengerTextarea.focus()},200)}}else{BX.addCustomEvent("onImInit",BX.delegate(function(e){e.messenger.popupMessengerTextarea.value=s.textarea;e.messenger.textareaCheckText();if(this.postMessageStartShowed){setTimeout(function(){e.messenger.popupMessengerTextarea.focus()},200)}},this))}}else if(s.action=="message"){BXIM.messenger.popupMessengerTextarea.value=s.text;BXIM.messenger.sendMessage(BXIM.messenger.currentTab)}else if(s.action=="textareaFocus"){setTimeout(function(){if(typeof BXIM!="undefined"){BXIM.messenger.popupMessengerTextarea.focus()}},200)}}},this))}BX.addCustomEvent("onImTextareaFocus",BX.delegate(function(e){var s={};s["uniqueLoadId"]=this.uniqueLoadId;s["action"]=e?"textareaFocused":"textareaBlured";this.sendDataToFrameHolder(s)},this));BX.addCustomEvent("onImDrawTab",BX.delegate(function(e){if(e.hasMessage){this.showedDialog=true;var s={};s["uniqueLoadId"]=this.uniqueLoadId;s["action"]="showDialog";this.sendDataToFrameHolder(s)}},this));BX.addCustomEvent("onImBeforeMessageSend",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="sendMessage";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImMessageRead",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="readMessage";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImMessageReceive",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="receiveMessage";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImResizeTextarea",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="resizeTextarea";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImOpenFileMenu",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="openFileMenu";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImOpenSmileMenu",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="openSmileMenu";this.sendDataToFrameHolder(e)},this));BX.addCustomEvent("onImOpenFrameDialog",BX.delegate(function(){var e={};e["uniqueLoadId"]=this.uniqueLoadId;e["action"]="openFrameDialog";this.sendDataToFrameHolder(e)},this))};this.sendDataToFrameHolder=function(e){var s=JSON.stringify(e);if(!this.postMessageOrigin){clearTimeout(this.timeout[s]);this.timeout[s]=setTimeout(BX.delegate(function(){this.sendDataToFrameHolder(e)},this),10);return true}if(typeof window.postMessage==="function"){if(this.postMessageSource){this.postMessageSource.postMessage(s,this.postMessageOrigin)}}var t=0;if(t){var i=window.location.hash.substring(1);top.location=i.substring(0,i.indexOf("#"))+"#"+s}};this.init(e)}function ImExtendLinesLivechatFormShow(e,s,t){var i=BX.message("PHONE_BASE_LANG")=="ru"||BX.message("PHONE_BASE_LANG")=="ua";if(this.popupMessengerLiveChatFormStage==e+"-"+s){return true}if(e!="done"){this.popupMessengerDialog.className="bx-messenger-box-dialog bx-messenger-chat-livechat"}this.popupMessengerLiveChatFormType=e;this.popupMessengerLiveChatFormStage=e+"-"+s;this.popupMessengerBodyLiveChatForm.className="bx-messenger-livechat-form";clearTimeout(this.popupMessengerLiveChatActionTimeout);var a=BX.MessengerCommon.livechatGetSession(this.currentTab.toString().substr(4));if(a.showForm=="N"){}else if(e=="offline"){if(typeof this.phones[this.BXIM.userId]!="undefined"||this.BXIM.userEmail){return false}if(!s||s==1){BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-text-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-text"},html:BX.message("IMOL_LIVECHAT_FORM_TITLE_OFFLINE")}),BX.create("input",{attrs:{type:"hidden",name:"form",value:"offline"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-form bx-messenger-livechat-form-input-hidden"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL"),name:"email"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-email"},events:{keydown:BX.delegate(function(e){this.tooltipClose();if(e.keyCode==9||e.keyCode==13){this.linesLivechatFormShow("offline",2)}if(e.ctrlKey||e.metaKey||e.shiftKey){return true}if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.nextSibling.focus();if(!BX.proxy_context.value||!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){setTimeout(BX.proxy(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR"),{offsetTop:10,offsetLeft:12})},this),500)}}clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){this.linesLivechatFormShow("offline",2)},this),500)},this),blur:BX.delegate(function(){if(!BX.proxy_context.value||!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.delegate(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR"),{offsetTop:10,offsetLeft:12})},this),500)}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("span",{props:{className:"bx-messenger-livechat-form-input-flag"}}),BX.create("input",{attrs:{name:i?"":"phone",placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_PHONE")},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-phone",value:BX.message("PHONE_CODE")},events:{keydown:BX.delegate(function(){if(event.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}},this)}}),i?BX.create("input",{attrs:{type:"hidden",name:"phone"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-hidden"}}):null]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_NAME"),name:"name",value:this.BXIM.messenger.users[this.BXIM.userId].name==BX.message("DEFAULT_GUEST_NAME")?"":this.BXIM.messenger.users[this.BXIM.userId].name},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-name"},events:{keydown:BX.delegate(function(){if(event.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-submit-wrap"},children:[BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_SEND")},props:{className:"bx-messenger-livechat-form-submit"},events:{click:BX.delegate(function(e){var s=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");if(!s.value||!s.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){this.tooltip(s,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR"),{offsetTop:10,offsetLeft:12});s.focus()}else{var t={};BX.findChildrenByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input").forEach(function(e){if(!e.name)return false;e.name=e.name.toUpperCase();t[e.name]=e.value;return true});this.linesLivechatFormShow("done",1,{text:BX.message("IMOL_LIVECHAT_FORM_RESULT_OFFLINE"),values:t})}return BX.PreventDefault(e)},this)}})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-offline-1");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active");var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-phone");if(i){new BXMaskedPhone({url:BX.message("PHONE_BASE_PATH"),country:BX.message("PHONE_BASE_LANG"),maskedInput:{input:e,dataInput:e.nextElementSibling},flagNode:e.previousElementSibling,flagSize:24})}else{e.previousElementSibling.style.display="none";e.style.paddingLeft="13px"}},this)()}if(s==2){BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-offline-2");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)()}}else if(e=="welcome"){if(typeof this.phones[this.BXIM.userId]!="undefined"||this.BXIM.userEmail||this.users[this.BXIM.userId].name!=BX.message("DEFAULT_GUEST_NAME")){return false}if(!s||s==1){BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-text-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-text"},html:BX.message("IMOL_LIVECHAT_FORM_TITLE_WELCOME")}),BX.create("input",{attrs:{type:"hidden",name:"form",value:"welcome"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-form bx-messenger-livechat-form-input-hidden"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_NAME"),name:"name"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-name"},events:{keydown:BX.delegate(function(e){if(e.keyCode==9||e.keyCode==13){this.linesLivechatFormShow("welcome",2)}if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}if(e.ctrlKey||e.metaKey||e.shiftKey){return true}clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){this.linesLivechatFormShow("welcome",2)},this),500)},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL"),name:"email"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-email"},events:{keydown:BX.delegate(function(e){if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.nextSibling.focus();if(BX.proxy_context.value&&!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){setTimeout(BX.proxy(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR"),{offsetTop:10,offsetLeft:12})},this),500)}}},this),blur:BX.delegate(function(){if(BX.proxy_context.value&&!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.delegate(function(){var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");this.tooltip(e,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR"),{offsetTop:10,offsetLeft:12})},this),500)}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("span",{props:{className:"bx-messenger-livechat-form-input-flag"}}),BX.create("input",{attrs:{name:i?"":"phone",placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_PHONE")},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-phone",value:BX.message("PHONE_CODE")},events:{keydown:BX.delegate(function(){if(event.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}},this)}}),i?BX.create("input",{attrs:{type:"hidden",name:"phone"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-hidden"}}):null]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-submit-wrap"},children:[BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_SEND")},props:{className:"bx-messenger-livechat-form-submit"},events:{click:BX.delegate(function(e){var s=true;var t=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");if(t.value&&!t.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(!this.tooltipIsOpen()){this.tooltip(t,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR"),{offsetTop:10,offsetLeft:12});s=false}}if(s){this.tooltipClose();var i={};var a=false;BX.findChildrenByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input").forEach(function(e){if(!e.name)return false;e.name=e.name.toUpperCase();i[e.name]=e.value;if(e.value&&e.name!="FORM"){a=true}return true});if(a){this.linesLivechatFormShow("done",1,{text:BX.message("IMOL_LIVECHAT_FORM_RESULT_WELCOME"),values:i})}else{this.linesLivechatFormHide()}}return BX.PreventDefault(e)},this)}})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-welcome-1");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active");var e=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-phone");if(i){new BXMaskedPhone({url:BX.message("PHONE_BASE_PATH"),country:BX.message("PHONE_BASE_LANG"),maskedInput:{input:e,dataInput:e.nextElementSibling},flagNode:e.previousElementSibling,flagSize:24})}else{e.previousElementSibling.style.display="none";e.style.paddingLeft="13px"}},this)()}if(s==2){BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-welcome-2");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)()}}else if(e=="history"){if(a.sessionId<=0)return false;BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-text-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-text"},html:BX.message("IMOL_LIVECHAT_FORM_TITLE_HISTORY")}),BX.create("input",{attrs:{type:"hidden",name:"form",value:"history"},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-form bx-messenger-livechat-form-input-hidden"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-input-wrap"},children:[BX.create("input",{attrs:{placeholder:BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL"),name:"email",value:this.BXIM.userEmail},props:{className:"bx-messenger-livechat-form-input bx-messenger-livechat-form-input-email"},events:{keydown:BX.delegate(function(e){this.tooltipClose();if(e.keyCode==9||e.keyCode==13){if(!BX.proxy_context.value||!BX.proxy_context.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){this.tooltip(BX.proxy_context,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR_2"),{offsetTop:10,offsetLeft:12});BX.proxy_context.parentNode.nextSibling.firstChild.nextSibling.focus();return BX.PreventDefault(e)}else if(e.keyCode==13){BX.proxy_context.parentNode.nextSibling.firstChild.focus()}}},this)}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-submit-wrap"},children:[BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_YES")},props:{className:"bx-messenger-livechat-form-submit"},events:{click:BX.delegate(function(e){var s=true;var t=BX.findChildByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input-email");if(!t.value||!t.value.match(/^(.*)@(.*)\.[a-zA-Z]{2,}$/)){if(!this.tooltipIsOpen()){this.tooltip(t,BX.message("IMOL_LIVECHAT_FORM_INPUT_EMAIL_ERROR"),{offsetTop:10,offsetLeft:12})}t.focus();s=false}if(s){this.tooltipClose();var i={};BX.findChildrenByClassName(this.popupMessengerBodyLiveChatForm,"bx-messenger-livechat-form-input").forEach(function(e){if(!e.name)return false;e.name=e.name.toUpperCase();i[e.name]=e.value;return true});this.linesLivechatFormShow("done",1,{text:BX.message("IMOL_LIVECHAT_FORM_RESULT_HISTORY"),values:i})}return BX.PreventDefault(e)},this)}}),BX.create("input",{attrs:{type:"button",value:BX.message("IMOL_LIVECHAT_FORM_BUTTON_NO")},props:{className:"bx-messenger-livechat-form-cancel"},events:{click:BX.delegate(function(e){this.tooltipClose();this.linesLivechatFormShow();return BX.PreventDefault(e)},this)}})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-history");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)()}else if(e=="done"){var n=t.text.length<=27;BX.cleanNode(this.popupMessengerBodyLiveChatForm);BX.adjust(this.popupMessengerBodyLiveChatForm,{children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-close"},events:{click:BX.delegate(function(){this.linesLivechatFormHide()},this)}}),BX.create("div",{props:{className:"bx-messenger-livechat-form-done-text-block-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-done-text-block"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-done-icon-wrap"},children:[BX.create("div",{props:{className:"bx-messenger-livechat-form-done-icon"}})]}),BX.create("div",{props:{className:"bx-messenger-livechat-form-done-text"+(n?"":" bx-messenger-livechat-form-done-text-small")},html:t.text})]})]})]})]});BX.defer(function(){this.popupMessengerDialog.classList.add(n?"bx-messenger-livechat-form-done-small":"bx-messenger-livechat-form-done");this.popupMessengerBodyLiveChatForm.classList.add("bx-messenger-livechat-form-active")},this)();clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){this.linesLivechatFormHide()},this),(n?3:5)*1e3);if(t.values){this.linesLivechatFormSend(t.values)}this.popupMessengerTextarea.focus()}else{this.popupMessengerDialog.classList.add("bx-messenger-livechat-form-animation");clearTimeout(this.popupMessengerLiveChatActionTimeout);this.popupMessengerLiveChatActionTimeout=setTimeout(BX.proxy(function(){BX.cleanNode(this.popupMessengerBodyLiveChatForm)},this),1e3);this.popupMessengerTextarea.focus()}BX.MessengerCommon.linesBodyScroll();return true}function ImExtendLinesLivechatFormSend(e){var s=this.currentTab.substr(4);if(this.blockJoinChat[s])return false;if(this.chat[s]&&this.chat[s].entity_type!="LIVECHAT")return false;if(!BX.MessengerCommon.userInChat(s))return false;this.blockJoinChat[s]=true;var t=e.FORM?e.FORM.toUpperCase():null;if(!t)return false;delete e.FORM;if(typeof e.NAME!="undefined"){this.users[this.BXIM.userId].name=e.NAME}if(t!="HISTORY"&&typeof e.EMAIL!="undefined"){this.BXIM.userEmail=e.EMAIL}if(typeof e.PHONE!="undefined"){if(!this.phones[this.BXIM.userId]){this.phones[this.BXIM.userId]={}}this.phones[this.BXIM.userId]["PERSONAL_MOBILE"]=e.PHONE}this.popupMessengerLiveChatLastSend=+new Date;BX.ajax({url:this.BXIM.pathToAjax+"?LINES_LIVECHAT_FORM&V="+this.BXIM.revision,method:"POST",dataType:"json",timeout:60,data:{COMMAND:"sendLivechatForm",CHAT_ID:s,FORM:t,FIELDS:e,IM_OPEN_LINES_CLIENT:"Y",IM_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(){this.blockJoinChat[s]=false},this),onfailure:BX.delegate(function(){this.blockJoinChat[s]=false},this)});return true}if(!window.LiveChatBackendInit){window.LiveChatBackendInit=true;BX.addCustomEvent(window,"onImInit",function(e){e.messenger.linesLivechatFormShow=ImExtendLinesLivechatFormShow;e.messenger.linesLivechatFormSend=ImExtendLinesLivechatFormSend})}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/imopenlines.livechat/templates/iframe/masked.min.js?154412742313609";s:6:"source";s:73:"/bitrix/components/bitrix/imopenlines.livechat/templates/iframe/masked.js";s:3:"min";s:77:"/bitrix/components/bitrix/imopenlines.livechat/templates/iframe/masked.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/imopenlines.livechat/templates/iframe/masked.map.js";}"*/
function BXMaskedInput(t){this.defaultDefinitions={cypher:{"char":"9",rule:"[0-9]"},hexrgb:{"char":"h",rule:"[A-Fa-f0-9]"},lang_en:{"char":"a",rule:"[a-zA-Z]"}};this.init(t)}BXMaskedInput.prototype={init:function(t){t.definitions=t.definitions||["cypher","lang_en"];this.initDefinitions(t.definitions);this.placeholder=(t.placeholder||"_").substring(0,1);this.mask=t.mask||"";this.initInput(t);this.setChangeEventFiring(true)},setMask:function(t){if(this.mask==t){return}var e=this.getValueClean();this.mask=t;this.setChangeEventFiring(false);this.setValue(e);this.setChangeEventFiring(true)},getMask:function(){return this.mask},setValue:function(t){if(!this.mask){this.input.val(t);this.fireChangeEvent();return}var e=this.input.getSelectionStart();this.moveCaret(0);this.input.val(this.mask);var n=0;for(var i=0;i<this.mask.length;i++){if(!this.isMaskCharReplaceable(i)){this.replaceChar(i,this.mask.charAt(i));continue}while(true){var s=t.charAt(n);if(!s){s=this.placeholder;break}if(s==this.placeholder){break}if(this.testChar(i,s)){break}n++}this.replaceChar(i,s);n++}this.moveCaret(e);this.fireChangeEvent()},getValue:function(){return this.input.val()},getFirstEmptyPosition:function(){var t=this.getValue();for(var e=0;e<t.length;e++){if(!this.isMaskCharReplaceable(e)){continue}var n=t.charAt(e);if(n==this.placeholder){return e}}return null},getValueClean:function(){var t="";var e=this.getValue();if(!this.mask){return e}for(var n=0;n<e.length;n++){if(!this.isMaskCharReplaceable(n)){continue}var i=e.charAt(n);t+=i==this.placeholder?"":i}return t},checkValue:function(){var t=this.getValue();if(!this.mask){return t}for(var e=0;e<t.length;e++){if(!this.isMaskCharReplaceable(e)){continue}if(t.charAt(e)==this.placeholder){return false}}return true},onInputDelete:function(t){if(this.deleteSelection()){this.fireChangeEvent();return}var e=this.input.getSelectionStart();if(t){if(e===this.mask.length){this.replaceChar(e-1,this.placeholder)}else{this.shift(e,e-1)}this.moveCaret(e-1)}else{if(e===this.mask.length-1){this.replaceChar(e,this.placeholder)}else if(e<this.mask.length-1){this.shift(e+1,e)}this.moveCaret(e)}this.fireChangeEvent()},onInputPaste:function(t){this.deleteSelection();for(var e=0;e<t.length;e++){this.setCharOnCaret(t.charAt(e))}this.fireChangeEvent()},onInputChange:function(t){if(this.input.val()==""&&this.mask){this.input.val(this.getMaskedPlaceholder());this.input.setCaretPosition(0)}this.deleteSelection();this.setCharOnCaret(t);this.fireChangeEvent()},moveCaret:function(t){if(t>this.mask.length){t=this.mask.length}else if(t<0){t=0}else if(t===null){return this.input.getSelectionStart()}this.input.setCaretPosition(t);return t},findClosestAllowPosition:function(t,e,n){if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=null}if(typeof n==="undefined"){n=false}while(true){if(!n&&t>=this.mask.length){return null}else if(n&&t<=0){return 0}if(this.isMaskCharReplaceable(t)){break}if(!n){t++}else{t--}}if(!this.isMaskCharReplaceable(t)){return null}if(e&&!this.testChar(t,e)){return null}return t},setCharOnCaret:function(t){var e=this.input.getSelectionStart();e=this.findClosestAllowPosition(e,t);if(e===null){return}this.shift(e,e+1);e=this.replaceChar(e,t);if(e===null){return}e=this.findClosestAllowPosition(e+1);this.moveCaret(e);if(BX.browser.IsAndroid()){if(this.input.detectAndroidVersion&&this.input.detectAndroidVersion()<7){var n=this;setTimeout(function(){n.moveCaret(e)},50)}}},shift:function(t,e){var n,i=null;var s=[];for(n=t;n<this.mask.length;n++){if(!this.isMaskCharReplaceable(n))continue;var a=this.input.val();s.push(a.charAt(n));this.replaceChar(n,this.placeholder)}s.reverse();for(n=e;n<this.mask.length;n++){if(!this.isMaskCharReplaceable(n))continue;if(s.length>0){i=s.pop()}else{i=this.placeholder}this.replaceChar(n,i)}},deleteSelection:function(){var t=this.input.getSelectionStart();var e=this.input.getSelectionEnd();if(t==e){return false}for(var n=t;n<e;n++){if(!this.isMaskCharReplaceable(n)){continue}this.replaceChar(n,this.placeholder)}this.shift(e,t);this.moveCaret(t);return true},setChangeEventFiring:function(t){this.stopChangeEvent=!t},fireChangeEvent:function(){if(!this.stopChangeEvent){BX.onCustomEvent(this,"change",[this.getValueClean(),this.getValue()])}},replaceChar:function(t,e){if(isNaN(t)){return null}var n=this.input.val();var i=n.substring(0,t)+e;i+=t>=n.length?"":n.substring(t+1);n=i;this.input.val(n);return t},isMaskCharReplaceable:function(t){var e=this.mask.charAt(t);if(!e){return false}return!!this.definitions[e]},getMaskedPlaceholder:function(){var t="";for(var e=0;e<this.mask.length;e++){var n=this.mask[e];if(this.definitions[n]){n=this.placeholder}t+=n}return t},initInput:function(t){if(t.input.tagName=="INPUT"){this.input=new BXMaskedInputElement({node:t.input})}else{this.input=new BXMaskedTextElement({node:t.input})}this.dataInput=t.dataInput||null;this.isDataInputClean=t.isDataInputClean||false;this.isHoldOverInputValueInit=t.isHoldOverInputValueInit||false;this.onDataInputChange=t.onDataInputChange||null;this.onDataInputInitValue=t.onDataInputInitValue||null;this.enableCheckingValue=t.enableCheckingValue||false;BX.addCustomEvent(this.input,"change",BX.proxy(this.onInputChange,this));BX.addCustomEvent(this.input,"paste",BX.proxy(this.onInputPaste,this));BX.addCustomEvent(this.input,"delete",BX.proxy(this.onInputDelete,this));BX.bind(this.input.node,"focus",BX.proxy(function(){if(this.getFirstEmptyPosition()===null){return}setTimeout(BX.proxy(function(){this.moveCaret(this.getFirstEmptyPosition())},this),50)},this));if(!this.isHoldOverInputValueInit&&!this.test(this.input.val())){this.input.val(this.getMaskedPlaceholder())}if(this.dataInput){var e=this.dataInput.value;if(BX.type.isFunction(this.onDataInputInitValue)){e=this.onDataInputInitValue.apply(this,[e])}if(BX.type.isString(e)&&e.length>0){this.setValue(e)}BX.addCustomEvent(this,"change",BX.proxy(function(){var t="";if(BX.type.isFunction(this.onDataInputChange)){t=this.onDataInputChange.apply(this,[this.getValueClean(),this.getValue()])}else if(this.isDataInputClean){t=this.getValueClean()}else{t=this.getValue()}if(!BX.type.isString(t)){t=""}if(this.enableCheckingValue&&!this.checkValue()){t=""}this.dataInput.value=t},this))}},initDefinitions:function(t){this.definitions={};this.charTests=[];t.forEach(function(t){if(BX.type.isString(t)&&this.defaultDefinitions[t]){t=this.defaultDefinitions[t]}if(BX.type.isPlainObject(t)){var e={rule:t.rule,isFunction:false};if(BX.type.isFunction(t.rule)){e.isFunction=true}else{e.regexp=new RegExp(t.rule)}this.definitions[t.char]=e}},this)},test:function(t){for(var e=0;e<t.length;e++){var n=this.testChar(e,t[e]);if(!n){return false}}return true},testChar:function(t,e){var n=this.mask[t];if(!this.definitions[n]){return e===n}var i=true;if(this.definitions[n].isFunction){i=!!this.definitions[n].func.apply(this,[e])}else{i=this.definitions[n].regexp.test(e)}return i}};function BXMaskedInputElement(t){this.node=t.node;BX.bind(this.node,"paste",BX.proxy(this.onChange,this));BX.bind(this.node,"keypress",BX.proxy(this.onChange,this));if(BX.browser.IsAndroid()&&this.detectAndroidVersion()<7){BX.bind(this.node,"textInput",BX.proxy(this.onAndroidInput,this));BX.bind(this.node,"keydown",BX.proxy(this.onAndroidInput,this))}else{BX.bind(this.node,"keydown",BX.proxy(this.onChange,this))}}BXMaskedInputElement.prototype={skipTextInputEvent:false,val:function(t){if(typeof t!="undefined"){this.node.value=t}return this.node.value},detectAndroidVersion:function(){var t=new RegExp("Android ([0-9]+[.0-9]*)");if(t.exec(navigator.userAgent)!=null)return parseFloat(RegExp.$1);else return 0},onAndroidInput:function(t){var e=0;if(t.type=="keydown"){e=typeof t.which=="number"?t.which:t.keyCode;if(e!=8){if(t.key=="Unidentified"){this.skipTextInputEvent=false;BX.PreventDefault(t);return false}else{this.skipTextInputEvent=true}}}else{if(this.skipTextInputEvent){BX.PreventDefault(t);return false}e=t.data.toUpperCase().charCodeAt(0)}var n={keyCode:e,which:e,type:"keydown"};return this.onChange(n,t)},onChange:function(t,e){var n=true;var i=typeof t.which=="number"?t.which:t.keyCode;if(i<=0){return}switch(t.type){case"keydown":n=!t.ctrlKey&&!t.altKey&&!t.metaKey&&(i&&(i>46&&i<=90||i>145||i===13||i===8||i===46||BX.browser.IsIOS()&&i===127));break;case"keypress":break}if(!n){return}BX.PreventDefault(e||t);if(t.type=="paste"){var s=t.clipboardData||window.clipboardData;var a=s.getData("Text");BX.onCustomEvent(this,"paste",[a])}else if(i===8||i===46||BX.browser.IsIOS()&&i===127){var r=i===8;BX.onCustomEvent(this,"delete",[r])}else{var h=String.fromCharCode(i);BX.onCustomEvent(this,"change",[h])}},setCaretPosition:function(t){this.node.setSelectionRange(t,t)},getSelectionStart:function(){if(this.node.selectionStart){return this.node.selectionStart}else if(this.node.createTextRange){var t=this.node.createTextRange().duplicate();t.moveEnd("character",this.node.value.length);if(t.text==""){return this.node.value.length}else{return this.node.value.lastIndexOf(t.text)}}else{return 0}},getSelectionEnd:function(){if(this.node.selectionEnd){return this.node.selectionEnd}else if(this.node.createTextRange){var t=this.node.createTextRange().duplicate();t.moveStart("character",-this.node.value.length);return t.text.length}else{return 0}}};function BXMaskedTextElement(t){this.node=t.node}BXMaskedTextElement.prototype={val:function(t){if(typeof t!="undefined"){this.node.innerText=t}return this.node.innerText},onChange:function(t){},setCaretPosition:function(t){},getSelectionStart:function(){return 0},getSelectionEnd:function(){return 0}};function BXMaskedPhone(t){this.country=t.country||this.getBrowserCountry();this.onChangeMask=t.onChangeMask||null;this.onChangeFlag=t.onChangeFlag||null;this.url=t.url||"/upload/callback/base";this.flagSize=t.flagSize&&BX.util.in_array(parseInt(t.flagSize),[16,24,32])?t.flagSize:16;this.flagNode=t.flagNode&&BX.type.isDomNode(t.flagNode)?t.flagNode:null;if(t.maskedInput instanceof BXMaskedInput){this.maskedInput=t.maskedInput}else if(BX.type.isPlainObject(t.maskedInput)){t.maskedInput.onDataInputChange=t.maskedInput.onDataInputChange||this.onDataInputChange;t.maskedInput.isHoldOverInputValueInit=true;t.maskedInput.enableCheckingValue=true;this.maskedInput=new BXMaskedInput(t.maskedInput)}else{throw Error('Parameter "maskedInput" not found.')}this.current=null;this.wasInited=false;BX.addCustomEvent(this.maskedInput,"change",BX.proxy(this.onChange,this));BX.addCustomEvent(window,"bx-masked-phone-codes-loaded",BX.proxy(this.onCodesLoaded,this));if(this.codes===null){BXMaskedPhone.prototype.codes=[];this.loadJson()}else if(this.codes.length>0){this.onCodesLoaded()}}BXMaskedPhone.prototype={codes:null,loadJson:function(t){var e=(t?"country_"+t:"countries")+".json";var n=this;BX.ajax.load({url:this.url+"/"+e,type:"json",callback:function(e){n.prepareDataCodes(e,t)}})},findCurrent:function(t){t=this.getCyphers(t||"");if(this.codes.length<=0){return}var e=this.country;if(t.length==0&&(!e||e.length==0)){return}var n=null;var i=null;for(var s=0;s<this.codes.length;s++){n=null;i=null;var a=this.codes[s];if(!a||!a.code||!a.data){continue}if(t){if(t.substring(0,a.code.length)!=a.code){continue}}else if(e){for(var r=0;r<a.data.length;r++){if(e==a.data[r].id){i=a.data[r]}}if(!i){continue}}n=a;if(!i){i=a.data[0]}break}this.current=null;if(!n&&!i){return}this.current=i;this.current.code=n.code;if(this.current.codes===true){this.current.codes=[];this.loadJson(this.current.id)}},findMaskByValue:function(t){t=this.getCyphers(t||"");var e=this.current.mask;if(BX.type.isArray(this.current.codes)){filtered=null;for(var n=0;n<this.current.codes.length;n++){var i=this.current.codes[n];if(!i.code){continue}if(t.substring(0,i.code.length)!=i.code){continue}if(!filtered||i.code.length>filtered.code.length){filtered=i}}if(filtered){e=filtered.mask}}return e},getCyphers:function(t){var e="";for(var n=0;n<t.length;n++){var i=t.charAt(n);if(!i){break}if(isNaN(i)){continue}e+=i}return e},changeMask:function(){var t=this.maskedInput.getValueClean();this.findCurrent(t);if(!this.current){this.changeFlag();return}var e=this.findMaskByValue(t);e=e.replace(new RegExp("_","g"),"9");this.maskedInput.setMask(e);if(!this.wasInited){if(!t){this.maskedInput.setChangeEventFiring(false);this.maskedInput.setValue(this.current.code);this.maskedInput.setChangeEventFiring(true)}this.maskedInput.moveCaret(this.maskedInput.getFirstEmptyPosition());this.wasInited=true}if(this.onChangeMask){this.onChangeMask.apply(this,[e])}this.changeFlag()},onCodesLoaded:function(){this.changeMask()},prepareDataCodes:function(t,e){if(!t){return}if(!e&&this.codes.length==0){BXMaskedPhone.prototype.codes=t;BX.onCustomEvent(window,"bx-masked-phone-codes-loaded")}else{if(this.current.id===e){this.current.codes=t}this.onCodesLoaded()}},onDataInputChange:function(t,e){return"+"+t},onChange:function(t,e){this.changeMask()},changeFlag:function(){var t=this.current?this.current.id:"";if(this.onChangeFlag){this.onChangeFlag.apply(this,[t,this.flagSize])}if(!this.flagNode){return}var e=this.flagNode.className.split(" ");if(e){e.forEach(function(t){if(t.length==2){BX.removeClass(this.flagNode,t)}},this)}BX.addClass(this.flagNode,"bx-flag-"+this.flagSize);BX.addClass(this.flagNode,t)},getBrowserCountry:function(){var t=window.navigator.languages?window.navigator.languages[0]:null;t=t||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage;if(t.indexOf("-")!==-1){t=t.split("-")[1]}if(!t&&t.indexOf("_")!==-1){t=t.split("_")[0]}return t?t.toLowerCase():"us"}};
/* End */
;; /* /bitrix/components/bitrix/imopenlines.livechat/templates/iframe/script.min.js?154412742321429*/
; /* /bitrix/components/bitrix/imopenlines.livechat/templates/iframe/masked.min.js?154412742313609*/

//# sourceMappingURL=page_d79c0c33d3bd3495ea80f4f2e1ad8b28.map.js