
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/script.min.js?154412740121993";s:6:"source";s:71:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
function CrmWebForm(e){this.init=function(e){this.id=e.id||"";this.hash=e.hash||"";this.postAjax=e.postAjax||false;this.mess=e.mess||{sentError:"",sentSuccess:""};this.currency=e.currency||null;this.isCallBackForm=e.isCallBackForm||false;this.useReCaptcha=e.useReCaptcha||false;this.linkReCaptcha=e.linkReCaptcha||null;this.phoneFormatDataUrl=e.phoneFormatDataUrl||null;this.phoneCountryCode=e.phoneCountryCode||null;this.canRemoveCopyright=!!e.canRemoveCopyright;this.redirectDelay=null;this.form=BX(e.form);this.disabled=false;this.postMessageDomain=null;this.postMessageOrigin=null;this.postMessageSource=null;var t=e.tracking||{data:{},ga:false,gaPageView:false,ya:null};t.caller=this;this.tracking=new CrmWebFormTracking(t);this.savedFields=new CrmWebFormSavedField({caller:this});if(this.form){this.popup=new CrmWebFormPopup({caller:this});e.onShow=BX.proxy(this.onShow,this);e.onHide=BX.proxy(this.onHide,this);e.onFocus=BX.proxy(this.onFocus,this);e.onBlur=BX.proxy(this.onBlur,this);e.onCheck=BX.proxy(this.onCheck,this);e.onChange=BX.proxy(this.onChange,this);e.onSubmitSuccess=BX.proxy(this.onSubmitSuccess,this);this.webForm=new FormChecker(e);this.webForm.fireChangeEvent();this.submitButtonNodes=BX.convert.nodeListToArray(document.querySelectorAll("[data-bx-webform-submit-btn]"));this.submitButtonNodes.forEach(function(e){BX.bind(e,"click",BX.proxy(this.webForm.submit,this.webForm))},this);this.savedFields.fillForm()}this.addHiddenInputToForm("from",window.location.href);this.initFrameParameters();if(this.form){this.initDateControls();this.initPhoneControls();this.initFileInputs(document.querySelectorAll('input[type="file"]'));this.initReCaptcha()}this.listenResizeEvent();this.captureKeyBoard();this.licence=new CrmWebFormLicence({caller:this});BX.bind(window,"resize",BX.debounce(this.fireResizeEvent,300,this))};this.initReCaptcha=function(){if(!this.useReCaptcha||!this.linkReCaptcha){return}if(!window.onReCaptchaLoadCallback&&!window.grecaptcha){window.onReCaptchaLoadCallback=BX.proxy(this.initReCaptcha,this);BX.loadScript(this.linkReCaptcha);return}if(window.grecaptcha&&window.grecaptcha.render){var e=BX("recaptcha-cont");window.grecaptcha.render(e,{sitekey:e.getAttribute("data-sitekey"),size:BX.browser.IsMobile()?"compact":"normal"})}BX.addCustomEvent(this.webForm,"onSubmit",function(e,t){if(window.grecaptcha&&window.grecaptcha.getResponse){t.isSuccess=window.grecaptcha.getResponse().length>0;if(!t.isSuccess){var i="crm-webform-captcha-error-animate";var s=BX("recaptcha-error");BX.addClass(s,i);setTimeout(function(){BX.removeClass(s,i)},700)}}})};this.initDateControls=function(){var e=BX.convert.nodeListToArray(this.form.querySelectorAll(".crm-webform-input-desktop.crm-webform-input-date"));e.forEach(function(e){this.initDateControl(e,false)},this);var t=BX.convert.nodeListToArray(this.form.querySelectorAll(".crm-webform-input-desktop.crm-webform-input-datetime"));t.forEach(function(e){this.initDateControl(e,true)},this)};this.initDateControl=function(e,t){t=t||false;if(!e){return}if(BX.browser.IsMobile()&&e.nextElementSibling&&e.nextElementSibling.tagName=="INPUT"){var i=e.nextElementSibling;BX.bind(i,"blur",function(){try{var s=new Date(i.value);s=new Date(s.valueOf()+s.getTimezoneOffset()*6e4);e.value=BX.formatDate(s,t?BX.message("FORMAT_DATETIME"):BX.message("FORMAT_DATE"))}catch(e){}});this.initDisplayedToDataControlEvents(i,e)}else{BX.bind(e,"click",function(){BX.calendar({node:e,field:e,bTime:t})})}};this.initPhoneControls=function(){var e=BX.convert.nodeListToArray(this.form.querySelectorAll(".crm-webform-input-phone"));e.forEach(function(e){this.initPhoneControl(e,false)},this)};this.initPhoneControlByDataInput=function(e){if(!e){return}if(!e.previousElementSibling||e.previousElementSibling.tagName!="INPUT"){return}this.initPhoneControl(e.previousElementSibling)};this.initPhoneControl=function(e){if(!e){return}if(!e.nextElementSibling||e.nextElementSibling.tagName!="INPUT"){return}var t=e.previousElementSibling;var i=e.nextElementSibling;var s=new BXMaskedPhone({url:this.phoneFormatDataUrl,country:this.phoneCountryCode,maskedInput:{input:e,dataInput:i},flagNode:t,flagSize:24});this.initDisplayedToDataControlEvents(e,i)};this.initDisplayedToDataControlEvents=function(e,t){BX.bind(e,"blur",function(){BX.fireEvent(t,"blur")});BX.bind(e,"focus",function(){BX.fireEvent(t,"focus")})};this.initFrameParameters=function(){if(!this.isFrame()){return}if(!window.location.hash){return}var e={};try{e=JSON.parse(decodeURIComponent(window.location.hash.substring(1)))}catch(e){}if(e.domain){this.postMessageDomain=e.domain}if(e.from){this.addHiddenInputToForm("from",e.from)}if(e.presets){var t="";for(var i in e.presets){if(!e.presets.hasOwnProperty(i)){continue}t+=encodeURIComponent(i)+"="+encodeURIComponent(e.presets[i])+"&"}this.addHiddenInputToForm("presets",t)}if(e.options){if(BX.type.isNumber(e.options["redirectDelay"])){this.redirectDelay=parseInt(e.options["redirectDelay"])}if(e.options["borders"]===false){BX.addClass(document.body,"crm-webform-no-borders")}if(e.options["logo"]===false&&this.canRemoveCopyright){BX.addClass(document.body,"crm-webform-no-logo")}if(e.options["css"]){this.addCss(e.options["css"])}}if(!e.fields||!e.fields.values){return}for(var s in e.fields.values){if(!e.fields.values.hasOwnProperty(s)){continue}var n=this.webForm.getField(s);if(!n){continue}var r=e.fields.values[s];r=BX.type.isArray(r)?r:[r];n.setValues(r)}};this.initFileInputs=function(e){e=BX.convert.nodeListToArray(e);e.forEach(function(e){BX.bind(e,"change",function(){var e=this.previousElementSibling;var t=e.querySelector("span:first-child");var i=e.querySelector("span:last-child");var s=false;if(this.value){var n=[];n=this.value.replace(/\\/g,"/").split("/");i.innerText=n[n.length-1];s=true}t.style.display=!s?"block":"none";i.style.display=s?"block":"none"})})};this.addHiddenInputToForm=function(e,t){e=e||"from";if(!this.webForm){return}var i=this.webForm.form.querySelector('input[name="'+e+'"]');if(!i){i=document.createElement("INPUT");i.type="hidden";i.name=e;this.webForm.form.appendChild(i)}i.value=t};this.addCss=function(e){if(e["content"]){this.addCssContent(e["content"])}if(e["file"]){if(Array.isArray(e["file"])){e["file"].forEach(function(e){BX.loadCSS(e)})}else{BX.loadCSS(e["file"])}}};this.addCssContent=function(e){var t=document.createElement("STYLE");t.setAttribute("type","text/css");if(t.styleSheet){t.styleSheet.cssText=resource.content}else{t.appendChild(document.createTextNode(e))}document.head.appendChild(t)};this.isFrame=function(){return window!=window.top};this.isFrame=function(){return window!=window.top};this.captureKeyBoard=function(){if(!this.isFrame()){return}var e=this;BX.bind(document,"keyup",function(t){t=t||window.e;var i=typeof t.which=="number"?t.which:t.keyCode;if(i==27){e.fireKeyBoardEvent(i)}})};this.listenResizeEvent=function(){if(!this.isFrame()){this.tracking.onFormView();return}if(typeof window.postMessage==="function"){this.postMessageInit=false;BX.bind(window,"message",this.initPostMessage.bind(this))}else{var e=this;setTimeout(function(){e.tracking.onFormView()},1e3)}this.fireResizeEvent()};this.initPostMessage=function(e){if(this.postMessageInit){return}if(!e||e.origin!==this.postMessageDomain){return}var t={};try{t=JSON.parse(e.data)}catch(e){return}if(!t.uniqueLoadId){return}this.postMessageInit=true;this.uniqueLoadId=t.uniqueLoadId;this.resultSuccessText=t.resultSuccessText||null;this.visitedPages=BX.type.isArray(t.visitedPages)?t.visitedPages:[];this.stopCallBack=t.stopCallBack||false;this.postMessageSource=e.source;this.postMessageOrigin=e.origin;if(t.options&&t.options.css){this.addCss(t.options.css)}this.fireResizeEvent();setTimeout(this.fireResizeEvent.bind(this),150);setTimeout(this.fireResizeEvent.bind(this),2e3);this.tracking.onFormView()};this.sendDataToFrameHolder=function(e){var t=JSON.stringify(e);if(typeof window.postMessage==="function"){if(this.postMessageSource){this.postMessageSource.postMessage(t,this.postMessageOrigin)}}var i=0;if(i){var s=window.location.hash.substring(1);top.location=s.substring(0,s.indexOf("#"))+"#"+t}};this.fireRedirectEvent=function(e){if(this.isFrame()){this.sendDataToFrameHolder({action:"redirect",value:e})}else{window.location=e}};this.fireResizeEvent=function(){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"change_height",value:this.getHeight()})};this.firePopupShowedEvent=function(){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"popup_showed",value:"middle"})};this.fireKeyBoardEvent=function(e){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"keyboard",value:e})};this.fireFrameEvent=function(e,t){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"event",eventName:e,value:t})};this.fireAnalyticsEvent=function(e){if(!this.isFrame()){return}this.sendDataToFrameHolder({uniqueLoadId:this.uniqueLoadId,action:"analytics",value:e})};this.getHeight=function(){return Math.max(Math.ceil(BX.pos(document.querySelector(".crm-webform-popup-container")).height),Math.ceil(BX.pos(document.querySelector(".content").parentNode).height))};this.getCurrentItems=function(e){var t=[];var i=e.getValues();for(var s in e.params.items){var n=e.params.items[s];if(BX.util.in_array(n.value,i)){t.push(n)}}return t};this.createFormField=function(e,t){var i=BX.create({tag:"div"});i.innerHTML=this.getTemplate(t);i=BX.findChild(i);var s=BX("field_"+e+"_CONT");s.appendChild(i);var n=i.querySelector("[name]");var r=this.webForm.getField(e);r.addElement(n);switch(r.type){case"file":this.initFileInputs([n]);break;case"date":this.initDateControl(n,false);break;case"datetime":this.initDateControl(n,true);break;case"phone":this.initPhoneControlByDataInput(n);break}this.fireResizeEvent()};this.getTemplate=function(e,t){var i=BX(e).innerHTML;if(!i){return}if(t){for(var s in t){i=i.replace(s,t[s])}}return i};this.appendNodeByTemplate=function(e,t,i,s){s=s||false;var n=BX.create({tag:"div"});n.innerHTML=this.getTemplate(t,i);n=BX.findChild(n);if(e){if(!s)e.appendChild(n);else e.insertBefore(n,e.firstChild)}return n};this.processAjaxSubmitResult=function(e){this.disabled=false;var t={error:e.error,text:e.text};if(!e.error&&this.resultSuccessText){t.text=this.resultSuccessText}if(e.redirect){t.redirect={delay:(this.redirectDelay===null?e.redirectDelay:this.redirectDelay)+1,url:e.redirect}}this.popup.show(t);if(e.error){this.webForm.onSubmitAjaxError();return}var i=BX.ajax.prepareForm(this.webForm.form).data;i.resultId=e.resultId;i.gid=e.gid;for(var s in i){if(!s||s=="sessid"){delete i[s]}}this.fireFrameEvent("send",[i])};this.onAjaxSubmitSuccess=function(e){this.tracking.onFormSent();this.processAjaxSubmitResult(e)};this.onAjaxSubmitFailure=function(e){e=BX.type.isPlainObject(e)?e:{};e.error=true;this.processAjaxSubmitResult(e)};this.onSubmitSuccess=function(e){var t=this.webForm.form.querySelector('input[name="sessid"]');if(!t){t=document.createElement("input");t.type="hidden";t.name="sessid";this.webForm.form.appendChild(t)}t.value=BX.bitrix_sessid();if(this.stopCallBack){var i=this.webForm.form.querySelector('input[name="stopCallback"]');if(!i){i=document.createElement("input");i.type="hidden";i.name="stopCallback";i.value="Y";this.webForm.form.appendChild(i)}}if(BX.type.isArray(this.visitedPages)&&this.visitedPages.length>0){var s=this.webForm.form.querySelector("#crm-visited-pages");if(!s){s=document.createElement("div");this.visitedPages.forEach(function(e,t){e.forEach(function(e,i){var n=null;switch(i){case 0:n="HREF";break;case 1:n="DATE";break;case 2:n="TITLE";break}if(!n||!e){return}var r=document.createElement("input");r.type="hidden";r.name="visited_pages["+t+"]["+n+"]";r.value=e;s.appendChild(r)})},this);this.webForm.form.appendChild(s)}}if(!this.licence.isAccepted()){BX.PreventDefault(e);return false}if(!this.postAjax){return true}BX.PreventDefault(e);if(this.disabled){return false}else{this.popup.show({wait:true});this.disabled=true}var n=BX.ajax.prepareForm(this.webForm.form);if(n.filesCount>0){BX.ajax.submitAjax(this.webForm.form,{dataType:"json",method:"POST",onsuccess:BX.proxy(this.onAjaxSubmitSuccess,this),onfailure:BX.proxy(this.onAjaxSubmitFailure,this)})}else{BX.ajax({start:true,url:this.webForm.form.getAttribute("action"),method:"POST",data:n.data,dataType:"json",processData:true,onsuccess:BX.proxy(this.onAjaxSubmitSuccess,this),onfailure:BX.proxy(this.onAjaxSubmitFailure,this)})}};this.onShow=function(e){var t=BX("field_"+e);BX.removeClass(t,"crm-webform-hide");this.fireResizeEvent()};this.onHide=function(e){var t=BX("field_"+e);BX.addClass(t,"crm-webform-hide");this.fireResizeEvent()};this.onFocus=function(e){var t=BX("field_"+e);BX.addClass(t,"crm-webform-active");this.tracking.onFieldFocus()};this.onBlur=function(e,t){var i=BX("field_"+e);BX.removeClass(i,"crm-webform-active");this.tracking.onFieldBlur(e,t);var s=t.getValues();if(s.length>0){this.savedFields.set(t.name,s[0])}this.fireFrameEvent("fill",[e,s])};this.onCheck=function(e,t,i,s){var n=BX("field_"+e);if(i){BX.removeClass(n,"crm-webform-error");if(i==1){BX.addClass(n,"crm-webform-success")}else{BX.removeClass(n,"crm-webform-success")}}else{BX.removeClass(n,"crm-webform-success");BX.addClass(n,"crm-webform-error")}};this.onChange=function(e,t){if(t.params["items"]&&t.params.items.length>0&&typeof t.params.items[0]["price"]!="undefined"){this.updateCarts()}};this.updateCarts=function(){if(!this.currency){return}if(!this.carts){this.carts=[];var e="data-bx-webform-cart";var t=document.querySelectorAll("["+e+"]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){var i=t.getAttribute(e)=="mini";var s=t.querySelector("[data-bx-webform-cart-items]");var n=t.querySelector("[data-bx-webform-cart-total]");if(!s||!n){return}this.carts.push({itemsNode:s,totalNode:n,isMini:i})},this)}var i=[];this.webForm.getFields().forEach(function(e){if(!e.isVisible())return;var t=this.getCurrentItems(e);if(t.length==0)return;if(typeof t[0]["price"]=="undefined")return;i=BX.util.array_merge(i,t)},this);var s=0;var n=[];var r=[];i.forEach(function(e){var t=e.price?e.price:0;s=s+parseFloat(t);var i=e.price_formatted?e.price_formatted:t;var a={"%name%":e.title,"%price%":i};n.push(this.getTemplate("product_price_item",a));r.push(this.getTemplate("product_price_mini_item",a))},this);this.carts.forEach(function(e){var t=BX.util.number_format(s,this.currency.DECIMALS,this.currency.DEC_POINT,this.currency.THOUSANDS_SEP);e.totalNode.innerHTML=this.currency.FORMAT_STRING.replace("#",t);e.itemsNode.innerHTML=e.isMini?r.join(" "):n.join(" ")},this);this.fireResizeEvent()};this.disableButton=function(e){e=e||false;this.submitButtonNodes.forEach(function(t){if(e){BX.addClass(t,"crm-webform-submit-button-loader");BX.addClass(t,"crm-webform-submit-button-loader-customize")}else{BX.removeClass(t,"crm-webform-submit-button-loader");BX.removeClass(t,"crm-webform-submit-button-loader-customize")}})};this.init(e)}function CrmWebFormTracking(e){this.init=function(e){this.caller=e.caller;this.yaId=e.ya||null;this.gaId=e.ga||null;this.gaPageView=!!e.gaPageView;this.data=e.data;this.isStartFillTracked=false;this.filledFields=[];this.processedCounters=[]};this.trackByData=function(e){if(!this.data[e]){return}this.track(this.data[e].name,this.data[e].code)};this.track=function(e,t){e=e||"";t=t||"";var i=this.data.category;var s=this.data.template.name.replace("%name%",e);var n=this.data.template.code.replace("%code%",t);if(this.gaId&&window.ga){window.ga("send","event",i,s);if(this.gaPageView&&t){window.ga("send","pageview",n)}}this.caller.fireAnalyticsEvent([{type:"ga",gaId:this.gaId,params:["event",i,s]},this.gaPageView&&t?{type:"ga",gaId:this.gaId,params:["pageview",n]}:null]);this.trackYa(e,t)};this.trackYa=function(e,t){var i=this.data.eventTemplate.code.replace("%code%",t).replace("%form_id%",this.caller.id);if(this.yaId){if(!window["yaCounter"+this.yaId]){var s=this;setTimeout(function(){s.trackYa(e,t)},100);return}window["yaCounter"+this.yaId].reachGoal(i)}this.caller.fireAnalyticsEvent([{type:"ya",yaId:this.yaId,params:[i]}])};this.onFieldBlur=function(e,t){if(BX.util.in_array(e,this.filledFields)){return}if(t.isEmpty()){return}this.filledFields.push(e);this.track(this.data.field.name.replace("%name%",t.caption),this.data.field.code.replace("%code%",e))};this.onFieldFocus=function(){if(!this.isStartFillTracked){this.trackByData("start");this.isStartFillTracked=true}this.incBxCounter("start")};this.onFormSent=function(){this.trackByData("end")};this.onFormView=function(){this.trackByData("view");this.incBxCounter("view")};this.incBxCounter=function(e){if(BX.util.in_array(e,this.processedCounters)||!this.caller.form){return}this.processedCounters.push(e);var t=this;BX.ajax({url:this.caller.form.action,method:"POST",data:{hash:this.caller.hash,sessid:BX.bitrix_sessid(),action:"inc_counter",counter:e},processData:false,onfailure:function(){var i=BX.util.array_search(e,t.processedCounters);if(i<0)return;BX.util.deleteFromArray(t.processedCounters,i)}})};this.init(e)}function CrmWebFormLicence(e){this.init=function(e){this.caller=e.caller;this.required=false;this.submitAfterAccept=false;this.licenceAcceptNode=BX("licence_accept");this.licenceShowButton=BX("licence_show_button");this.licencePopupBtnAccept=BX("RESULT_BUTTON_BNT_ACCEPT");this.licencePopupBtnCancel=BX("RESULT_BUTTON_BNT_CANCEL");if(!this.licenceAcceptNode||!this.licenceShowButton){return}this.required=true;BX.bind(this.licenceShowButton,"click",BX.proxy(this.showPopup,this));BX.bind(this.licencePopupBtnAccept,"click",BX.proxy(function(){this.closePopup(true)},this));BX.bind(this.licencePopupBtnCancel,"click",BX.proxy(function(){this.closePopup(false)},this))};this.showPopup=function(){this.caller.popup.show({error:false,text:this.caller.mess.licencePre,licence:true})};this.closePopup=function(e){this.licenceAcceptNode.checked=e;this.caller.popup.hide();if(e&&this.submitAfterAccept){this.caller.webForm.submit()}this.submitAfterAccept=false};this.isAccepted=function(){if(!this.required||this.licenceAcceptNode.checked){return true}this.submitAfterAccept=true;this.showPopup();return false};this.init(e)}function CrmWebFormSavedField(e){this.init=function(e){this.caller=e.caller;this.lsKeyName="b24_crm_form_saved_field";this.entityTypes=["CONTACT","LEAD","COMPANY"];this.entityFieldNames=["EMAIL","PHONE","NAME","LAST_NAME"]};this.fillForm=function(){if(!this.caller.webForm){return}this.caller.webForm.getFields().forEach(function(e){var t=this.get(e.name);if(!t){return}e.setValues([t])},this)};this.set=function(e,t){if(!t||!e){return}var i=this.convertName(e);if(!i){return null}var s=false;var n=this.get().map(function(e){if(e.name==i){e.value=t;s=true}return e});if(!s){n.push({name:i,value:t})}BX.localStorage.set(this.lsKeyName,n,3600*24*365*10)};this.get=function(e){e=e||null;var t=BX.localStorage.get(this.lsKeyName);if(!BX.type.isArray(t)){t=[]}if(!e){return t}var i=this.convertName(e);if(!i){return null}var s=t.filter(function(e){return e.name==i});return s.length>0?s[0].value:null};this.convertName=function(e){var t=e.split("_");var i=t.shift();var s=t.join("_");var n=BX.util.in_array(i,this.entityTypes);if(n){n=BX.util.in_array(s,this.entityFieldNames)}return n?s:null};this.init(e)}function CrmWebFormPopup(e){this.init=function(e){this.caller=e.caller;this.initNode()};this.initNode=function(){if(this.node){return}this.caller.appendNodeByTemplate(document.body,"tmpl_result_message",null,true);this.node=BX("RESULT_MESSAGE_CONTAINER");this.btnContainer=BX("RESULT_BUTTON_CONTAINER");this.messageContent=BX("RESULT_MESSAGE_CONTENT");this.messageContentLoader=BX("RESULT_MESSAGE_CONTENT_LOADER");this.messageContentLoader=BX("RESULT_MESSAGE_CONTENT_LOADER");this.nodeSuccess=this.messageContent.querySelector(".crm-webform-popup-success");this.nodeWarning=this.messageContent.querySelector(".crm-webform-popup-warning");this.nodeLicence=this.messageContent.querySelector(".crm-webform-popup-licence");this.nodeText=this.messageContent.querySelector(".crm-webform-popup-text");this.btnRedirectContainer=BX("RESULT_BUTTON_REDIRECT_CONTAINER");this.btnRedirectNode=BX("RESULT_BUTTON_REDIRECT_BNT");this.btnLicenceContainer=BX("RESULT_BUTTON_LICENCE_CONTAINER");this.btnResult=BX("RESULT_BUTTON_BNT");BX.bind(this.btnResult,"click",BX.proxy(this.hide,this))};this.showLoader=function(){};this.animateRedirect=function(e){e.delay--;BX("RESULT_BUTTON_REDIRECT_COUNTER").innerText=e.delay;if(e.delay>0){var t=this;setTimeout(function(){t.animateRedirect(e)},1e3);return}this.caller.fireRedirectEvent(e.url)};this.show=function(e){var t=e.error||false;var i=e.wait||false;this.caller.disableButton(i);this.btnContainer.style.display=i?"none":"block";this.messageContent.style.display=i?"none":"block";this.messageContentLoader.style.display=!i?"none":"block";this.nodeLicence.style.display="none";this.btnLicenceContainer.style.display="none";if(this.nodeSuccess){this.nodeSuccess.style.display=t?"none":"block"}this.nodeWarning.style.display=!t?"none":"block";if(!i){if(e.licence){this.btnContainer.style.display="none";this.btnRedirectContainer.style.display="none";this.btnLicenceContainer.style.display="block";this.nodeLicence.style.display="block"}else if(e.redirect){this.btnContainer.style.display="none";this.btnRedirectContainer.style.display="block";var s=this;BX.bind(this.btnRedirectNode,"click",function(){s.caller.fireRedirectEvent(e.redirect.url)})}else{this.btnContainer.style.display="block";this.btnLicenceContainer.style.display="none";this.btnResult.focus()}var n=e.text;if(!n){n=t?this.caller.mess.sentError:this.caller.mess.sentSuccess}this.nodeText.innerText=n}this.node.style.display="block";if(e.redirect){this.animateRedirect(e.redirect)}this.caller.firePopupShowedEvent();this.caller.fireResizeEvent()};this.hide=function(){this.node.style.display="none";this.caller.fireResizeEvent()};this.init(e)}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/form_checker.min.js?15441274018334";s:6:"source";s:77:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/form_checker.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
function FormField(e){this.params=e;this.element=null;this.caller=e.caller;this.caption=e.caption;this.name=e.name;this.type=e.type;this.section=e.section;this.formatter=e.formatter||null;this.validator=e.validator||null;this.callbackGetValues=e.callbackGetValues||null;this.multiple=e.multiple||false;this.required=e.required||false;this.hidden=e.hidden||false;this.dependences=e.dependences||[];this.callbackSetValues=null;this.listenChanges=true;this.elements=this.findElements();if(this.elements.length>0){this.element=this.elements[0];this.elements.forEach(function(e){this.bindElement(e)},this)}if(this.dependences.length>0){BX.addCustomEvent(this.caller,"onDependenceAction",BX.delegate(this.onDependenceAction,this))}}FormField.prototype={isDependenceSelfCall:false,countDependenceSelfCall:0,findElements:function(){return BX.convert.nodeListToArray(document.getElementsByName(this.name+(this.multiple?"[]":"")))},disable:function(e){e=e||false;this.findElements().forEach(function(t){t.disabled=!e})},addElement:function(e){this.bindElement(e);this.elements=this.findElements()},bindElement:function(e){BX.bind(e,"blur",BX.delegate(this.onBlur,this));BX.bind(e,"focus",BX.delegate(this.onFocus,this));BX.bind(e,"bxchange",BX.delegate(this.onChange,this))},show:function(){this.hidden=false;BX.onCustomEvent(this,"onShow",[this.name,this.elements]);BX.onCustomEvent(this.caller,"onShow",[this.name,this.elements]);this.fireDependenceActionEvent("show");this.fireDependenceActionEvent("change")},hide:function(){this.hidden=true;BX.onCustomEvent(this,"onHide",[this.name,this.elements]);BX.onCustomEvent(this.caller,"onHide",[this.name,this.elements]);this.fireDependenceActionEvent("hide");this.fireDependenceActionEvent("change")},runDependence:function(e){switch(e["do"].action){case"show":this.show();break;case"hide":this.hide();break;case"change":this.setValues(BX.type.isArray(e["do"].value)?e["do"].value:[e["do"].value]);break}},fireDependenceActionEvent:function(e){BX.onCustomEvent(this.caller,"onDependenceAction",[e,this])},filterDependence:function(e,t,i){if(i["if"].fieldname!=t.name){return false}if(i["if"].action!=e){return false}if(e=="change"){var n=false;var s=i["if"].value;var a=i["if"].operation?i["if"].operation:"=";var l;if(t.isVisible()){l=t.getValues();if(l.length==0){l.push("")}}else{l=[""]}l.forEach(function(e){switch(a){case"!=":case"<>":n=s!=e;break;case"=":n=s==e;break;case">":n=s>e;break;case"<":n=s<e;break;case"<=":n=s<=e;break;case">=":n=s>=e;break}},this);return n}else{return true}},checkSelfCall:function(e){if(this===e){this.isDependenceSelfCall=true;this.countDependenceSelfCall++}else{this.isDependenceSelfCall=false;this.countDependenceSelfCall=0}if(this.countDependenceSelfCall<3){return true}setTimeout(BX.proxy(function(){this.countDependenceSelfCall=0},this),100);return false},onDependenceAction:function(e,t){if(!this.checkSelfCall(t)){return}var i=function(i){return this.filterDependence(e,t,i)};this.dependences.filter(i,this).forEach(this.runDependence,this)},onChange:function(){if(!this.element)return;if(!this.listenChanges)return;this.listenChanges=false;this.format();this.fireDependenceActionEvent("change");BX.onCustomEvent(this,"onChange",[this.name,this]);BX.onCustomEvent(this.caller,"onChange",[this.name,this]);this.listenChanges=true},onBlur:function(){if(!this.element)return;BX.onCustomEvent(this,"onBlur",[this.name,this]);BX.onCustomEvent(this.caller,"onBlur",[this.name,this]);this.check()},onFocus:function(){if(!this.element)return;BX.onCustomEvent(this,"onFocus",[this.name,this.elements]);BX.onCustomEvent(this.caller,"onFocus",[this.name,this.elements])},getValues:function(){if(this.callbackGetValues){return this.callbackGetValues.apply(this,[this.name,this.elements])}var e=[];for(var t in this.elements){if(!this.elements.hasOwnProperty(t)){continue}var i=this.elements[t];switch(i.type){case"radio":case"checkbox":if(i.checked){e.push(i.value?i.value:"on")}break;case"select-multiple":for(var n=0;n<i.options.length;n++){var s=i.options[n];if(s&&s.selected){e.push(s.value)}}break;case"select-one":default:if(i.value.length!==0&&i.value.trim()!=""){e.push(i.value)}break}}return e},setValues:function(e){if(this.callbackSetValues){return this.callbackGetValues.apply(this,[this.name,this.elements])}for(var t in this.elements){var i=this.elements[t];switch(i.type){case"radio":case"checkbox":i.checked=BX.util.in_array(i.value,e);break;case"select-one":case"select-multiple":for(var t in i.options){if(i.options[t]&&i.options[t].selected){i.options[t].selected=0}}e.forEach(function(e){var t=i.querySelector('option[value="'+e+'"]');if(t){t.selected=1}},this);break;default:i.value=e[0];break}BX.fireEvent(i,"change")}return e},isEmpty:function(){var e=this.getValues();return e.length===0},format:function(){var e=this.getValues();if(this.formatter&&e.length>0){var t=e.map(function(e){if(e&&BX.type.isString(e)){e=this.formatter.apply(this,[e])}return e},this);if(JSON.stringify(t)!=JSON.stringify(e)){this.setValues(t)}}},isVisible:function(){return!this.hidden&&(!this.section||!this.section.hidden)},validate:function(){var e=this.getValues();if(this.validator&&e.length>0&&this.isVisible()){return e.every(function(e){if(!e||!BX.type.isString(e)){return true}return this.validator.apply(this,[e])},this)}return true},check:function(){if(!this.element)return true;var e=1;var t=0;if(this.isEmpty()){e=2;if(this.required&&this.isVisible()){e=0;t=1}}else{if(!this.validate()){e=0;t=2}}BX.onCustomEvent(this,"onCheck",[this.name,this.elements,e,t]);BX.onCustomEvent(this.caller,"onCheck",[this.name,this.elements,e,t]);return e}};function FormChecker(e){this.params=e;this.form=BX(e.form);this.showOnlyFirstError=!!(e.showOnlyFirstError||false);this.fields=[];this.validators={url:this.validateUrl,integer:this.validateInteger,double:this.validateDouble,email:this.validateEmail,phone:this.validatePhone,date:this.validateDate};this.formatters={};if(e.onCheck){BX.addCustomEvent(this,"onCheck",e.onCheck)}if(e.onFocus){BX.addCustomEvent(this,"onFocus",e.onFocus)}if(e.onBlur){BX.addCustomEvent(this,"onBlur",e.onBlur)}if(e.onShow){BX.addCustomEvent(this,"onShow",e.onShow)}if(e.onHide){BX.addCustomEvent(this,"onHide",e.onHide)}if(e.onChange){BX.addCustomEvent(this,"onChange",e.onChange)}if(e.onSubmit){BX.addCustomEvent(this,"onSubmit",e.onSubmit)}if(e.onSubmitSuccess){BX.addCustomEvent(this,"onSubmitSuccess",e.onSubmitSuccess)}var t=e.fields||[];this.addFields(t);if(this.form){BX.bind(this.form,"submit",BX.proxy(this.onSubmit,this))}}FormChecker.prototype={onSubmit:function(e){var t={isSuccess:true};BX.onCustomEvent(this,"onSubmit",[e,t]);var i=this.check();i=i&&t.isSuccess;if(!i){BX.PreventDefault(e)}else{this.disableHiddenFields();BX.onCustomEvent(this,"onSubmitSuccess",[e])}return i},onSubmitAjaxError:function(){this.disableHiddenFields(true)},submit:function(){BX.submit(this.form)},check:function(){var e=true;for(var t in this.fields){if(this.fields[t]&&!this.fields[t].check()){e=false;if(this.showOnlyFirstError){break}}}return e},disableHiddenFields:function(e){e=e||false;this.fields.forEach(function(t){if(t.isVisible())return;t.disable(e)})},fireChangeEvent:function(){this.fields.forEach(function(e){e.onChange()})},registerTypeValidator:function(e,t){this.validators[e]=t},addField:function(e){if(!e.formatter&&this.formatters[e.type]){e.formatter=this.formatters[e.type]}if(!e.validator&&this.validators[e.type]){e.validator=this.validators[e.type]}e.caller=this;var t=new FormField(e);if(t.type=="phone"){}this.fields.push(t);return t},getField:function(e){var t=this.fields.filter(function(t){return t.name&&t.name==e});return!t?t:t[0]},getFields:function(){return this.fields},addFields:function(e){var t=null;for(var i in e){if(!e[i]){break}e[i].section=t;var n=this.addField(e[i]);if(n.type=="section"){t=n}}},validateRegexp:function(e,t){return null!==e.match(t)},validateEmail:function(e){return null!==e.match(/^[\w\.\d-_]+@[\w\.\d-_]+\.\w{2,15}$/i)},validateDate:function(e){return true},validateDouble:function(e){e=e||"";e=e.replace(/,/g,".");var t=e.indexOf(".");if(t===0){e="0"+e}else if(t<0){e+=".0"}return e.match(/^\d+\.\d+$/)},validateInteger:function(e){return e&&e.match(/^\d+$/)},validateUrl:function(e){return true},validatePhone:function(e){return true},formatPhone:function(e){return e}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/masked.min.js?154412740113664";s:6:"source";s:71:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/masked.js";s:3:"min";s:75:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/masked.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/crm.webform.fill/templates/.default/masked.map.js";}"*/
function BXMaskedInput(t){this.defaultDefinitions={cypher:{"char":"9",rule:"[0-9]"},hexrgb:{"char":"h",rule:"[A-Fa-f0-9]"},lang_en:{"char":"a",rule:"[a-zA-Z]"}};this.init(t)}BXMaskedInput.prototype={init:function(t){t.definitions=t.definitions||["cypher","lang_en"];this.initDefinitions(t.definitions);this.placeholder=(t.placeholder||"_").substring(0,1);this.mask=t.mask||"";this.initInput(t);this.setChangeEventFiring(true)},setMask:function(t){if(this.mask==t){return}var e=this.getValueClean();this.mask=t;this.setChangeEventFiring(false);this.setValue(e);this.setChangeEventFiring(true)},getMask:function(){return this.mask},setValue:function(t){if(!this.mask){this.input.val(t);this.fireChangeEvent();return}var e=this.input.getSelectionStart();this.moveCaret(0);this.input.val(this.mask);var i=0;for(var n=0;n<this.mask.length;n++){if(!this.isMaskCharReplaceable(n)){this.replaceChar(n,this.mask.charAt(n));continue}while(true){var s=t.charAt(i);if(!s){s=this.placeholder;break}if(s==this.placeholder){break}if(this.testChar(n,s)){break}i++}this.replaceChar(n,s);i++}this.moveCaret(e);this.fireChangeEvent()},getValue:function(){return this.input.val()},getFirstEmptyPosition:function(){var t=this.getValue();for(var e=0;e<t.length;e++){if(!this.isMaskCharReplaceable(e)){continue}var i=t.charAt(e);if(i==this.placeholder){return e}}return null},getValueClean:function(){var t="";var e=this.getValue();if(!this.mask){return e}for(var i=0;i<e.length;i++){if(!this.isMaskCharReplaceable(i)){continue}var n=e.charAt(i);t+=n==this.placeholder?"":n}return t},checkValue:function(){var t=this.getValue();if(!this.mask){return t}for(var e=0;e<t.length;e++){if(!this.isMaskCharReplaceable(e)){continue}if(t.charAt(e)==this.placeholder){return false}}return true},onInputDelete:function(t){if(this.deleteSelection()){this.fireChangeEvent();return}var e=this.input.getSelectionStart();if(t){if(e===this.mask.length){this.replaceChar(e-1,this.placeholder)}else{this.shift(e,e-1)}this.moveCaret(e-1)}else{if(e===this.mask.length-1){this.replaceChar(e,this.placeholder)}else if(e<this.mask.length-1){this.shift(e+1,e)}this.moveCaret(e)}this.fireChangeEvent()},onInputPaste:function(t){this.deleteSelection();for(var e=0;e<t.length;e++){this.setCharOnCaret(t.charAt(e))}this.fireChangeEvent()},onInputChange:function(t){if(this.input.val()==""&&this.mask){this.input.val(this.getMaskedPlaceholder());this.input.setCaretPosition(0)}this.deleteSelection();this.setCharOnCaret(t);this.fireChangeEvent()},moveCaret:function(t){if(t>this.mask.length){t=this.mask.length}else if(t<0){t=0}else if(t===null){return this.input.getSelectionStart()}this.input.setCaretPosition(t);return t},findClosestAllowPosition:function(t,e,i){if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=null}if(typeof i==="undefined"){i=false}while(true){if(!i&&t>=this.mask.length){return null}else if(i&&t<=0){return 0}if(this.isMaskCharReplaceable(t)){break}if(!i){t++}else{t--}}if(!this.isMaskCharReplaceable(t)){return null}if(e&&!this.testChar(t,e)){return null}return t},setCharOnCaret:function(t){var e=this.input.getSelectionStart();e=this.findClosestAllowPosition(e,t);if(e===null){return}this.shift(e,e+1);e=this.replaceChar(e,t);if(e===null){return}e=this.findClosestAllowPosition(e+1);this.moveCaret(e);if(BX.browser.IsAndroid()){if(this.input.detectAndroidVersion&&this.input.detectAndroidVersion()<7){var i=this;setTimeout(function(){i.moveCaret(e)},50)}}},shift:function(t,e){var i,n=null;var s=[];for(i=t;i<this.mask.length;i++){if(!this.isMaskCharReplaceable(i))continue;var a=this.input.val();s.push(a.charAt(i));this.replaceChar(i,this.placeholder)}s.reverse();for(i=e;i<this.mask.length;i++){if(!this.isMaskCharReplaceable(i))continue;if(s.length>0){n=s.pop()}else{n=this.placeholder}this.replaceChar(i,n)}},deleteSelection:function(){var t=this.input.getSelectionStart();var e=this.input.getSelectionEnd();if(t==e){return false}for(var i=t;i<e;i++){if(!this.isMaskCharReplaceable(i)){continue}this.replaceChar(i,this.placeholder)}this.shift(e,t);this.moveCaret(t);return true},setChangeEventFiring:function(t){this.stopChangeEvent=!t},fireChangeEvent:function(){if(!this.stopChangeEvent){BX.onCustomEvent(this,"change",[this.getValueClean(),this.getValue()])}},replaceChar:function(t,e){if(isNaN(t)){return null}var i=this.input.val();var n=i.substring(0,t)+e;n+=t>=i.length?"":i.substring(t+1);i=n;this.input.val(i);return t},isMaskCharReplaceable:function(t){var e=this.mask.charAt(t);if(!e){return false}return!!this.definitions[e]},getMaskedPlaceholder:function(){var t="";for(var e=0;e<this.mask.length;e++){var i=this.mask[e];if(this.definitions[i]){i=this.placeholder}t+=i}return t},initInput:function(t){if(t.input.tagName=="INPUT"){this.input=new BXMaskedInputElement({node:t.input})}else{this.input=new BXMaskedTextElement({node:t.input})}this.dataInput=t.dataInput||null;this.isDataInputClean=t.isDataInputClean||false;this.isHoldOverInputValueInit=t.isHoldOverInputValueInit||false;this.onDataInputChange=t.onDataInputChange||null;this.onDataInputInitValue=t.onDataInputInitValue||null;this.enableCheckingValue=t.enableCheckingValue||false;BX.addCustomEvent(this.input,"change",BX.proxy(this.onInputChange,this));BX.addCustomEvent(this.input,"paste",BX.proxy(this.onInputPaste,this));BX.addCustomEvent(this.input,"delete",BX.proxy(this.onInputDelete,this));BX.bind(this.input.node,"focus",BX.proxy(function(){if(this.getFirstEmptyPosition()===null){return}setTimeout(BX.proxy(function(){this.moveCaret(this.getFirstEmptyPosition())},this),50)},this));if(!this.isHoldOverInputValueInit&&!this.test(this.input.val())){this.input.val(this.getMaskedPlaceholder())}if(this.dataInput){var e=this.dataInput.value;if(BX.type.isFunction(this.onDataInputInitValue)){e=this.onDataInputInitValue.apply(this,[e])}if(BX.type.isString(e)&&e.length>0){this.setValue(e)}BX.addCustomEvent(this,"change",BX.proxy(function(){var t="";if(BX.type.isFunction(this.onDataInputChange)){t=this.onDataInputChange.apply(this,[this.getValueClean(),this.getValue()])}else if(this.isDataInputClean){t=this.getValueClean()}else{t=this.getValue()}if(!BX.type.isString(t)){t=""}if(this.enableCheckingValue&&!this.checkValue()){t=""}this.dataInput.value=t},this))}},initDefinitions:function(t){this.definitions={};this.charTests=[];t.forEach(function(t){if(BX.type.isString(t)&&this.defaultDefinitions[t]){t=this.defaultDefinitions[t]}if(BX.type.isPlainObject(t)){var e={rule:t.rule,isFunction:false};if(BX.type.isFunction(t.rule)){e.isFunction=true}else{e.regexp=new RegExp(t.rule)}this.definitions[t.char]=e}},this)},test:function(t){for(var e=0;e<t.length;e++){var i=this.testChar(e,t[e]);if(!i){return false}}return true},testChar:function(t,e){var i=this.mask[t];if(!this.definitions[i]){return e===i}var n=true;if(this.definitions[i].isFunction){n=!!this.definitions[i].func.apply(this,[e])}else{n=this.definitions[i].regexp.test(e)}return n}};function BXMaskedInputElement(t){this.node=t.node;BX.bind(this.node,"paste",BX.proxy(this.onChange,this));BX.bind(this.node,"keypress",BX.proxy(this.onChange,this));if(BX.browser.IsAndroid()&&this.detectAndroidVersion()<7){BX.bind(this.node,"textInput",BX.proxy(this.onAndroidInput,this));BX.bind(this.node,"keydown",BX.proxy(this.onAndroidInput,this))}else{BX.bind(this.node,"keydown",BX.proxy(this.onChange,this))}}BXMaskedInputElement.prototype={skipTextInputEvent:false,val:function(t){if(typeof t!="undefined"){this.node.value=t}return this.node.value},detectAndroidVersion:function(){var t=new RegExp("Android ([0-9]+[.0-9]*)");if(t.exec(navigator.userAgent)!=null)return parseFloat(RegExp.$1);else return 0},onAndroidInput:function(t){var e=0;if(t.type=="keydown"){e=typeof t.which=="number"?t.which:t.keyCode;if(e!=8){if(t.key=="Unidentified"){this.skipTextInputEvent=false;BX.PreventDefault(t);return false}else{this.skipTextInputEvent=true}}}else{if(this.skipTextInputEvent){BX.PreventDefault(t);return false}e=t.data.toUpperCase().charCodeAt(0)}var i={keyCode:e,which:e,type:"keydown"};return this.onChange(i,t)},onChange:function(t,e){var i=true;var n=typeof t.which=="number"?t.which:t.keyCode;if(n<=0){return}switch(t.type){case"keydown":i=!t.ctrlKey&&!t.altKey&&!t.metaKey&&(n&&(n>46&&n<=90||n>145||n===13||n===8||n===46||BX.browser.IsIOS()&&n===127));break;case"keypress":break}if(!i){return}BX.PreventDefault(e||t);if(t.type=="paste"){var s=t.clipboardData||window.clipboardData;var a=s.getData("Text");BX.onCustomEvent(this,"paste",[a])}else if(n===8||n===46||BX.browser.IsIOS()&&n===127){var r=n===8;BX.onCustomEvent(this,"delete",[r])}else{var h=String.fromCharCode(n);BX.onCustomEvent(this,"change",[h])}},setCaretPosition:function(t){this.node.setSelectionRange(t,t)},getSelectionStart:function(){if(this.node.selectionStart){return this.node.selectionStart}else if(this.node.createTextRange){var t=this.node.createTextRange().duplicate();t.moveEnd("character",this.node.value.length);if(t.text==""){return this.node.value.length}else{return this.node.value.lastIndexOf(t.text)}}else{return 0}},getSelectionEnd:function(){if(this.node.selectionEnd){return this.node.selectionEnd}else if(this.node.createTextRange){var t=this.node.createTextRange().duplicate();t.moveStart("character",-this.node.value.length);return t.text.length}else{return 0}}};function BXMaskedTextElement(t){this.node=t.node}BXMaskedTextElement.prototype={val:function(t){if(typeof t!="undefined"){this.node.innerText=t}return this.node.innerText},onChange:function(t){},setCaretPosition:function(t){},getSelectionStart:function(){return 0},getSelectionEnd:function(){return 0}};function BXMaskedPhone(t){this.country=t.country||this.getBrowserCountry();this.onChangeMask=t.onChangeMask||null;this.onChangeFlag=t.onChangeFlag||null;this.url=t.url||"/upload/callback/base";this.flagSize=t.flagSize&&BX.util.in_array(parseInt(t.flagSize),[16,24,32])?t.flagSize:16;this.flagNode=t.flagNode&&BX.type.isDomNode(t.flagNode)?t.flagNode:null;if(t.maskedInput instanceof BXMaskedInput){this.maskedInput=t.maskedInput}else if(BX.type.isPlainObject(t.maskedInput)){t.maskedInput.onDataInputChange=t.maskedInput.onDataInputChange||this.onDataInputChange;t.maskedInput.isHoldOverInputValueInit=true;t.maskedInput.enableCheckingValue=true;this.maskedInput=new BXMaskedInput(t.maskedInput)}else{throw Error('Parameter "maskedInput" not found.')}this.current=null;this.wasInited=false;BX.addCustomEvent(this.maskedInput,"change",BX.proxy(this.onChange,this));BX.addCustomEvent(window,"bx-masked-phone-codes-loaded",BX.proxy(this.onCodesLoaded,this));if(this.codes===null){BXMaskedPhone.prototype.codes=[];this.loadJson()}else if(this.codes.length>0){this.onCodesLoaded()}}BXMaskedPhone.prototype={codes:null,loadJson:function(t){var e=(t?"country_"+t:"countries")+".json";var i=this;BX.ajax.load({url:this.url+"/"+e,type:"json",callback:function(e){i.prepareDataCodes(e,t)}})},findCurrent:function(t){t=this.getCyphers(t||"");if(this.codes.length<=0){return}var e=this.country;if(t.length==0&&(!e||e.length==0)){return}var i=null;var n=null;for(var s=0;s<this.codes.length;s++){i=null;n=null;var a=this.codes[s];if(!a||!a.code||!a.data){continue}if(t){if(t.substring(0,a.code.length)!=a.code){continue}}else if(e){for(var r=0;r<a.data.length;r++){if(e==a.data[r].id){n=a.data[r]}}if(!n){continue}}i=a;if(!n){n=a.data[0]}break}this.current=null;if(!i&&!n){return}this.current=n;this.current.code=i.code;if(this.current.codes===true){this.current.codes=[];this.loadJson(this.current.id)}},findMaskByValue:function(t){t=this.getCyphers(t||"");var e=this.current.mask;if(BX.type.isArray(this.current.codes)){filtered=null;for(var i=0;i<this.current.codes.length;i++){var n=this.current.codes[i];if(!n.code){continue}if(t.substring(0,n.code.length)!=n.code){continue}if(!filtered||n.code.length>filtered.code.length){filtered=n}}if(filtered){e=filtered.mask}}return e},getCyphers:function(t){var e="";for(var i=0;i<t.length;i++){var n=t.charAt(i);if(!n){break}if(isNaN(n)){continue}e+=n}return e},changeMask:function(){var t=this.maskedInput.getValueClean();this.findCurrent(t);if(!this.current){if(!this.wasInited){this.maskedInput.setValue("")}else{this.changeFlag()}return}var e=this.findMaskByValue(t);e=e.replace(new RegExp("_","g"),"9");this.maskedInput.setMask(e);if(!this.wasInited){if(!t){this.maskedInput.setChangeEventFiring(false);this.maskedInput.setValue(this.current.code);this.maskedInput.setChangeEventFiring(true)}this.maskedInput.moveCaret(this.maskedInput.getFirstEmptyPosition());this.wasInited=true}if(this.onChangeMask){this.onChangeMask.apply(this,[e])}this.changeFlag()},onCodesLoaded:function(){this.changeMask()},prepareDataCodes:function(t,e){if(!t){return}if(!e&&this.codes.length==0){BXMaskedPhone.prototype.codes=t;BX.onCustomEvent(window,"bx-masked-phone-codes-loaded")}else{if(this.current.id===e){this.current.codes=t}this.onCodesLoaded()}},onDataInputChange:function(t,e){return"+"+t},onChange:function(t,e){this.changeMask()},changeFlag:function(){var t=this.current?this.current.id:"";if(this.onChangeFlag){this.onChangeFlag.apply(this,[t,this.flagSize])}if(!this.flagNode){return}var e=this.flagNode.className.split(" ");if(e){e.forEach(function(t){if(t.length==2){BX.removeClass(this.flagNode,t)}},this)}BX.addClass(this.flagNode,"bx-flag-"+this.flagSize);BX.addClass(this.flagNode,t)},getBrowserCountry:function(){var t=window.navigator.languages?window.navigator.languages[0]:null;t=t||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage;if(t.indexOf("-")!==-1){t=t.split("-")[1]}if(!t&&t.indexOf("_")!==-1){t=t.split("_")[0]}return t?t.toLowerCase():"us"}};
/* End */
;; /* /bitrix/components/bitrix/crm.webform.fill/templates/.default/script.min.js?154412740121993*/
; /* /bitrix/components/bitrix/crm.webform.fill/templates/.default/form_checker.min.js?15441274018334*/
; /* /bitrix/components/bitrix/crm.webform.fill/templates/.default/masked.min.js?154412740113664*/

//# sourceMappingURL=page_a2905505130e1904f860e88dcb8a54ea.map.js