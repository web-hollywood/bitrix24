
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?154412745438362";s:6:"source";s:75:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.CLBlock=function(e){this.arData=[];this.arData["Subscription"]=[];this.UTPopup=null;this.createTaskPopup=null;this.entity_type=null;this.entity_id=null;this.event_id=null;this.event_id_fullset=false;this.cb_id=null;this.t_val=null;this.ind=null;this.type=null};BX.CLBlock.prototype.DataParser=function(str){str=str.replace(/^\s+|\s+$/g,"");while(str.length>0&&str.charCodeAt(0)==65279)str=str.substring(1);if(str.length<=0)return false;if(str.substring(0,1)!="{"&&str.substring(0,1)!="["&&str.substring(0,1)!="*")str='"*"';eval("arData = "+str);return arData};function __logFilterShow(){if(BX("bx_sl_filter").style.display=="none"){BX("bx_sl_filter").style.display="block";BX("bx_sl_filter_hidden").style.display="none"}else{BX("bx_sl_filter").style.display="none";BX("bx_sl_filter_hidden").style.display="block"}}if(!window.XMLHttpRequest){var XMLHttpRequest=function(){try{return new ActiveXObject("MSXML3.XMLHTTP")}catch(e){}try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}var LBlock=new BX.CLBlock;function __logOnAjaxInsertToNode(e){var t=false,n=null,o=null;if(BX("sonet_log_more_container")){n=BX.findChild(BX("sonet_log_more_container"),{tag:"span",className:"feed-new-message-inf-text"},false);if(n){o=BX.findChild(n,{tag:"span",className:"feed-new-message-icon"},false);if(o){BX.addClass(o,"new-message-balloon-icon-rotating")}}t=BX.pos(BX("sonet_log_more_container"));oLF.nodeTmp1Cap=document.body.appendChild(BX.create("div",{style:{position:"absolute",width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:1e3}}))}if(BX("sonet_log_counter_2_container")){n=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text"},false);if(n){o=BX.findChild(n,{tag:"span",className:"feed-new-message-icon"},false);if(o){BX.addClass(o,"new-message-balloon-icon-rotating")}}t=BX.pos(BX("sonet_log_more_container"));oLF.nodeTmp2Cap=document.body.appendChild(BX.create("div",{style:{position:"absolute",width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:1e3}}))}BX.unbind(BX("sonet_log_counter_2_container"),"click",__logOnAjaxInsertToNode)}function __logChangeCounter(e){var t=parseInt(e)<=0;oCounter={iCommentsRead:0};BX.onCustomEvent(window,"onSonetLogChangeCounter",[oCounter]);e-=oCounter.iCommentsRead;__logChangeCounterAnimate(parseInt(e)>0,e,t)}function __logDecrementCounter(e){if(BX("sonet_log_counter_2")){e=parseInt(e);var t=parseInt(BX("sonet_log_counter_2").innerHTML);var n=t-e;if(n>0)BX("sonet_log_counter_2").innerHTML=n;else __logChangeCounterAnimate(false,0)}}function __logChangeCounterAnimate(e,t,n){var o=null,i=null;if(BX("sonet_log_counter_2_container")){o=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text"},false);i=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text-reload"},false)}n=!!n;if(oLF.bLockCounterAnimate){setTimeout(function(){__logChangeCounterAnimate(e,t)},200);return false}e=!!e;if(e){if(BX("sonet_log_counter_2")){BX("sonet_log_counter_2").innerHTML=t}if(BX("sonet_log_counter_2_wrap")){BX("sonet_log_counter_2_wrap").style.visibility="visible";BX.addClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim")}if(BX("sonet_log_counter_2_plus")&&i&&i.style.display!="none"&&o){i.style.display="none";o.style.display="inline-block";BX.removeClass(BX("sonet_log_counter_2_plus"),"feed-new-message-informer-counter-plus-hidden")}}else if(BX("sonet_log_counter_2_wrap")){if(n&&BX.hasClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim")){if(o&&i){o.style.display="none";i.style.display="inline-block";var s=BX.findChild(o,{tag:"span",className:"feed-new-message-icon"},false);if(s){BX.removeClass(s,"new-message-balloon-icon-rotating")}}}else setTimeout(function(){BX.removeClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim");BX("sonet_log_counter_2_wrap").style.visibility="hidden"},400)}}function __logChangeCounterArray(e){if(typeof e[BX.message("sonetLCounterType")]!="undefined")__logChangeCounter(e[BX.message("sonetLCounterType")])}function __logShowPostMenu(e,t,n,o,i,s,a,r,l,d){BX.PopupMenu.destroy("post-menu-"+t);var f=null;if(BX.message("sonetLbUseFavorites")!="N"){f={text:l?BX.message("sonetLMenuFavoritesTitleY"):BX.message("sonetLMenuFavoritesTitleN"),className:"menu-popup-no-icon",onclick:function(e){__logChangeFavorites(r,"log_entry_favorites_"+r,l?"N":"Y",true);return BX.PreventDefault(e)}}}var c=[e.getAttribute("data-log-entry-url").length>0?{text:'<span id="post-menu-'+t+'-href-text">'+BX.message("sonetLMenuHref")+"</span>",className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-href",href:e.getAttribute("data-log-entry-url")}:null,e.getAttribute("data-log-entry-url").length>0?{text:'<span id="post-menu-'+t+'-link-text">'+BX.message("sonetLMenuLink")+"</span>"+'<span id="post-menu-'+t+'-link-icon-animate" class="post-menu-link-icon-wrap">'+'<span class="post-menu-link-icon" id="post-menu-'+t+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-link",onclick:function(){var n="post-menu-"+t+"-link",o=BX(n+"-text"),i=BX(n+"-icon-done");if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(e.getAttribute("data-log-entry-url"));if(o&&i){i.style.display="inline-block";BX.removeClass(BX(n+"-icon-animate"),"post-menu-link-icon-animate");BX.adjust(BX(n+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(n+"-icon-animate"),"post-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(BX(n+"-text"),{attrs:{"data-block-click":"N"}})},500)}return}var s=BX.proxy_context,a=parseInt(!!s.getAttribute("bx-height")?s.getAttribute("bx-height"):s.offsetHeight);if(s.getAttribute("bx-status")!="shown"){s.setAttribute("bx-status","shown");if(!BX(n)&&!!BX(n+"-text")){var r=BX(n+"-text"),l=BX.pos(r),d=BX.pos(r.parentNode);pos3=BX.pos(BX.findParent(r,{className:"menu-popup-item"},true));l["height"]=d["height"]-1;BX.adjust(s,{attrs:{"bx-height":s.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:n},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:n+"-input",type:"text",value:e.getAttribute("data-log-entry-url")},style:{height:l["height"]+"px",width:pos3["width"]-21+"px"},events:{click:function(e){this.select();BX.PreventDefault(e)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:a,finish:a*2,callback:BX.delegate(function(e){this.style.height=e+"px"},s)}).start();BX.fx.show(BX(n),.2);BX(n+"-input").select()}else{s.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:s.offsetHeight,finish:a,callback:BX.delegate(function(e){this.style.height=e+"px"},s)}).start();BX.fx.hide(BX(n),.2)}}}:null,f,BX.message("sonetLCanDelete")=="Y"?{text:BX.message("sonetLMenuDelete"),className:"menu-popup-no-icon",onclick:function(e){if(confirm(BX.message("sonetLMenuDeleteConfirm"))){__logDelete(r,"log-entry-"+r,t)}return BX.PreventDefault(e)}}:null,e.getAttribute("data-log-entry-createtask")=="Y"?{text:BX.message("sonetLMenuCreateTask"),className:"menu-popup-no-icon",onclick:function(t){oLF.createTask({entryEntityType:e.getAttribute("data-log-entry-entity-type"),entityType:e.getAttribute("data-log-entry-entity-type"),entityId:e.getAttribute("data-log-entry-entity-id")});this.popupWindow.close();return t.preventDefault()}}:null];if(!!d&&BX.type.isArray(d)){for(var p=0;p<d.length;p++)if(typeof d[p].className=="undefined")d[p].className="menu-popup-no-icon";c=BX.util.array_merge(c,d)}var u={offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupShow:function(e){if(BX("log_entry_favorites_"+r)){var n=BX.findChildren(e.contentContainer,{className:"menu-popup-item-text"},true);if(n!=null){for(var o=0;o<n.length;o++){if(n[o].innerHTML==BX.message("sonetLMenuFavoritesTitleY")||n[o].innerHTML==BX.message("sonetLMenuFavoritesTitleN")){var i=n[o];break}}}if(i!=undefined){if(BX.hasClass(BX("log_entry_favorites_"+r),"feed-post-important-switch-active"))BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleY");else BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleN")}}if(BX("post-menu-"+t+"-link")){var s=BX.findChild(e.popupContainer,{className:"feed-entry-popup-menu-link"},true,false);if(s){var a=parseInt(!!s.getAttribute("bx-height")?s.getAttribute("bx-height"):0);if(a>0){BX("post-menu-"+t+"-link").style.display="none";s.setAttribute("bx-status","hidden");s.style.height=a+"px"}}}}}};BX.PopupMenu.show("post-menu-"+t,e,c,u)}function __logGetNextPageLinkEntities(e,t){if(!!window.__logGetNextPageFormName&&!!e&&!!t&&!!window["UC"]&&!!window["UC"][window.__logGetNextPageFormName]&&!!window["UC"][window.__logGetNextPageFormName].linkEntity){window["UC"][window.__logGetNextPageFormName].linkEntity(e);for(var n in t){if(!!n&&!!t[n])window["UC"][window.__logGetNextPageFormName]["entitiesCorrespondence"][n]=t[n]}}}function __logChangeFavorites(e,t,n,o){if(!e||!BX(t)){return}if(!!o){var i=BX.proxy_context;if(!BX.hasClass(BX(i),"menu-popup-item-text")){i=BX.findChild(BX(i),{className:"menu-popup-item-text"},true)}}var s=BX.hasClass(BX(t),"feed-post-important-switch")?BX(t):BX.findChild(BX(t),{className:"feed-post-important-switch"});if(n!=undefined){if(n=="Y"){BX.addClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleY");if(typeof i!="undefined"){BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleY")}}else{BX.removeClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleN");if(typeof i!="undefined"){BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleN")}}}var a=new XMLHttpRequest;a.open("POST",BX.message("sonetLESetPath"),true);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){var e=LBlock.DataParser(a.responseText);if(typeof e=="object"){if(e[0]=="*"){if(sonetLErrorDiv!=null){sonetLErrorDiv.style.display="block";sonetLErrorDiv.innerHTML=a.responseText}return}a.abort();var t="";if(e["bResult"]!=undefined&&(e["bResult"]=="Y"||e["bResult"]=="N")){if(e["bResult"]=="Y"){BX.addClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleY");if(i!=undefined)BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleY")}else{BX.removeClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleN");if(i!=undefined)BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleN")}}}}else{}}};a.send("r="+Math.floor(Math.random()*1e3)+"&"+BX.message("sonetLSessid")+"&site="+BX.util.urlencode(BX.message("sonetLSiteId"))+"&log_id="+encodeURIComponent(e)+"&action=change_favorites")}function __logDelete(e,t,n){if(!e){return}if(!BX(t)){return}BX.ajax({url:BX.message("sonetLESetPath"),method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),site:BX.message("sonetLSiteId"),log_id:e,action:"delete"},onsuccess:function(e){if(e.bResult!=undefined&&e.bResult=="Y"){if(typeof n!="undefined"){BX.PopupMenu.destroy("post-menu-"+n)}__logDeleteSuccess(BX(t))}else{__logDeleteFailure(BX(t))}},onfailure:function(e){__logDeleteFailure(BX(t))}})}function __logDeleteSuccess(e){if(typeof e=="undefined"||!e||!BX(e)){return}new BX.fx({time:.5,step:.05,type:"linear",start:BX(e).offsetHeight,finish:56,callback:BX.delegate(function(e){this.style.height=e+"px"},BX(e)),callback_start:BX.delegate(function(){this.style.overflow="hidden";this.style.minHeight=0},BX(e)),callback_complete:BX.delegate(function(){this.style.marginBottom=0;BX.cleanNode(this);BX.addClass(this,"feed-post-block-deleted");this.appendChild(BX.create("DIV",{props:{className:"feed-add-successfully"},children:[BX.create("span",{props:{className:"feed-add-info-text"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{html:BX.message("sonetLMenuDeleteSuccess")})]})]}))},BX(e))}).start()}function __logDeleteFailure(e){if(typeof e=="undefined"||!e||!BX(e)){return}e.insertBefore(BX.create("DIV",{props:{className:"feed-add-error"},style:{marginLeft:"84px",marginRight:"37px",marginTop:"18px",marginBottom:"4px"},children:[BX.create("span",{props:{className:"feed-add-info-text"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{html:BX.message("sonetLMenuDeleteFailure")})]})]}),e.firstChild)}window.__socOnUCFormClear=function(e){LHEPostForm.reinitDataBefore(e.editorId)};window.__socOnUCFormAfterShow=function(e,t,n){n=!!n?n:{};var o=e.entitiesCorrespondence[e.id.join("-")][0],i=e.entitiesCorrespondence[e.id.join("-")][1];BX.show(BX("feed_comments_block_"+o));BX.onCustomEvent(window,"OnBeforeSocialnetworkCommentShowedUp",["socialnetwork"]);e.form.action=e.url.replace(/\#eId\#/,o).replace(/\#id\#/,i);var s={ENTITY_XML_ID:e.id[0],ENTITY_TYPE:e.entitiesId[e.id[0]][0],ENTITY_ID:e.entitiesId[e.id[0]][1],parentId:e.id[1],comment_post_id:e.entitiesId[e.id[0]][1],edit_id:e.id[1],act:e.id[1]>0?"edit":"add",logId:e.entitiesId[e.id[0]][2]};for(var a in s){if(!e.form[a]){e.form.appendChild(BX.create("INPUT",{attrs:{name:a,type:"hidden"}}))}e.form[a].value=s[a]}__socOnLightEditorShow(t,n)};window.__socOnUCFormSubmit=function(e,t){t["r"]=Math.floor(Math.random()*1e3);t["sessid"]=BX.bitrix_sessid();t["log_id"]=e.entitiesCorrespondence[e.id.join("-")][0];t["p_smile"]=BX.message("sonetLPathToSmile");t["p_ubp"]=BX.message("sonetLPathToUserBlogPost");t["p_gbp"]=BX.message("sonetLPathToGroupBlogPost");t["p_umbp"]=BX.message("sonetLPathToUserMicroblogPost");t["p_gmbp"]=BX.message("sonetLPathToGroupMicroblogPost");t["p_user"]=BX.message("sonetLPathToUser");t["p_le"]=BX.message("sonetLEPath");t["f_id"]=BX.message("sonetLForumID");t["bapc"]=BX.message("sonetLBlogAllowPostCode");t["site"]=BX.message("sonetLSiteId");t["lang"]=BX.message("sonetLLangId");t["nt"]=BX.message("sonetLNameTemplate");t["sl"]=BX.message("sonetLShowLogin");t["as"]=BX.message("sonetLAvatarSizeComment");t["dtf"]=BX.message("sonetLDateTimeFormat");t["message"]=t["REVIEW_TEXT"];t["action"]="add_comment";t["RATING_TYPE"]=BX.message("sonetRatingType");t["pull"]="Y";t["crm"]=BX.message("sonetLIsCRM");e.form["bx-action"]=e.form.action;e.form.action=BX.message("sonetLESetPath")};window.__socOnUCFormResponse=function(e,t){e.form.action=e.form["bx-action"];var n={errorMessage:t},o=e.entitiesCorrespondence[e.id.join("-")][0],i={};if(!(!!t&&typeof t=="object")){}else if(t[0]=="*"){n={errorMessage:BX.message("sonetLErrorSessid")}}else if(t["status"]=="error")n["errorMessage"]=t["message"];else{if(!(t["commentID"]>0)||!!t["strMessage"]){n["errorMessage"]=t["strMessage"]}else if(t["return_data"]){n=t["return_data"]}else{var s=t["arCommentFormatted"],a=t["arComment"],r=!!window["__logBuildRating"]?window["__logBuildRating"](t["arComment"],t["arCommentFormatted"]):null,l=!!a["SOURCE_ID"]?a["SOURCE_ID"]:a["ID"];i={ID:l,ENTITY_XML_ID:e.id[0],FULL_ID:[e.id[0],l],NEW:"N",APPROVED:"Y",POST_TIMESTAMP:t["timestamp"]-BX.message("USER_TZ_OFFSET"),POST_TIME:s["LOG_TIME_FORMAT"],POST_DATE:s["LOG_TIME_FORMAT"],"~POST_MESSAGE_TEXT":s["MESSAGE"],POST_MESSAGE_TEXT:s["MESSAGE_FORMAT"],PANELS:{MODERATE:false},URL:{LINK:typeof a["URL"]!="undefined"&&a["URL"]!=null&&a["URL"].length>0?a["URL"]:BX.message("sonetLEPath").replace("#log_id#",a["LOG_ID"])+"?commentId="+a["ID"]+"#com"+(parseInt(a["SOURCE_ID"])>0?a["SOURCE_ID"]:a["ID"])},AUTHOR:{ID:s["USER_ID"],NAME:s["CREATED_BY"]["FORMATTED"],URL:s["CREATED_BY"]["URL"],AVATAR:s["AVATAR_SRC"]},BEFORE_ACTIONS:!!r?r:"",AFTER:s["UF"]};if(typeof t["hasEditCallback"]!="undefined"&&t["hasEditCallback"]=="Y"){i["PANELS"]["EDIT"]="Y";i["URL"]["EDIT"]="__logEditComment('"+e.id[0]+"', '"+a["ID"]+"', '"+a["LOG_ID"]+"');"}if(typeof t["hasDeleteCallback"]!="undefined"&&t["hasDeleteCallback"]=="Y"){i["PANELS"]["DELETE"]="Y";i["URL"]["DELETE"]=BX.message("sonetLESetPath")+"?lang="+BX.message("sonetLLangId")+"&action=delete_comment&delete_comment_id="+a["ID"]+"&post_id="+a["LOG_ID"]+"&site="+BX.message("sonetLSiteId")}n={errorMessage:"",okMessage:"",status:true,message:"",messageCode:s["MESSAGE"],messageId:[e.id[0],l],"~message":"",messageFields:i}}var d=BX("log_entry_follow_"+o,true),f=!!d?d.getAttribute("data-follow")=="Y"?"Y":"N":false;if(f=="N"){BX.findChild(d,{tagName:"a"}).innerHTML=BX.message("sonetLFollowY");d.setAttribute("data-follow","Y")}d=BX("feed-comments-all-cnt-"+o,true),val=!!d?d.innerHTML.length>0?parseInt(d.innerHTML):0:false;if(val!==false)d.innerHTML=val+1}e.OnUCFormResponseData=n};window.__socOnLightEditorShow=function(e,t){var n={};if(t["arFiles"]){var o={},i,s;for(var a=0;a<t["arFiles"].length;a++){i=BX.findChild(BX("wdif-doc-"+t["arFiles"][a]),{className:"feed-com-file-name"},true);s=BX.findChild(BX("wdif-doc-"+t["arFiles"][a]),{className:"feed-con-file-size"},true);o["F"+a]={FILE_ID:t["arFiles"][a],FILE_NAME:i?i.innerHTML:"noname",FILE_SIZE:s?s.innerHTML:"unknown",CONTENT_TYPE:"notimage/xyz"}}n["UF_SONET_COM_DOC"]={USER_TYPE_ID:"file",FIELD_NAME:"UF_SONET_COM_FILE[]",VALUE:o}}if(t["arDocs"])n["UF_SONET_COM_FILE"]={USER_TYPE_ID:"webdav_element",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:BX.clone(t["arDocs"])};if(t["arDFiles"])n["UF_SONET_COM_FILE"]={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:BX.clone(t["arDFiles"])};LHEPostForm.reinitData(SLEC.editorId,e,n)};BitrixLF=function(){this.bLoadStarted=null;this.nextURL=null;this.scrollInitialized=null;this.bStopTrackNextPage=null;this.bLockCounterAnimate=null;this.arMoreButtonID=null;this.logAjaxMode=null;this.nodeTmp1Cap=null;this.nodeTmp2Cap=null;this.cmdPressed=null;this.nextPageFirst=null;this.firstPageLastTS=0;this.firstPageLastId=0;this.filterId=null;this.filterApi=null;this.tagEntryIdList=[];this.inlineTagNodeList=[]};BitrixLF.prototype.initOnce=function(e){var t=BX("feed-loader-container");if(t){BX.bind(t,"animationend",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"webkitAnimationEnd",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"oanimationend",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"MSAnimationEnd",BX.proxy(this._onAnimationEnd,this))}BX.addCustomEvent("BX.Livefeed.Filter:beforeApply",BX.delegate(function(e,t){this.showRefreshFade()},this));BX.addCustomEvent("BX.Livefeed.Filter:apply",BX.delegate(function(e,t,n){if(typeof n!="undefined"){n.autoResolve=false}this.refresh({useBXMainFilter:"Y"},t)},this));BX.addCustomEvent("BX.Livefeed.Filter:searchInput",BX.delegate(function(e){if(typeof e!="undefined"&&BX.util.trim(e).length>0){this.showRefreshFade()}else{this.hideRefreshFade()}},this));BX.addCustomEvent(window,"OnUCCommentWasPulled",function(e,t){setTimeout(function(){var t=BX("record-"+e[0]+"-"+ +e[1]);if(t){bodyBlock=BX.findChild(t,{className:"feed-com-text-inner-inner"},true);if(bodyBlock){oLF.recalcMoreButtonComment({bodyBlock:bodyBlock,moreButtonBlock:BX.findChild(t,{className:"feed-post-text-more"},true)})}}},1e3)});BX.addCustomEvent(window,"OnUCListWasBuilt",function(e,t,n){oLF.recalcMoreButtonCommentsList()});if(typeof e!="undefined"&&typeof e.crmEntityTypeName!="undefined"&&e.crmEntityTypeName.length>0&&typeof e.crmEntityId!="undefined"&&parseInt(e.crmEntityId)>0){BX.addCustomEvent("onAfterActivitySave",BX.delegate(function(){this.refresh({sessid:BX.bitrix_sessid(),PARAMS:{ENTITY_TYPE_NAME:e.crmEntityTypeName,ENTITY_ID:parseInt(e.crmEntityId)}})},this))}if(typeof e!="undefined"&&typeof e.filterId!="undefined"&&typeof BX.Main!="undefined"&&typeof BX.Main.filterManager!="undefined"){var n=BX.Main.filterManager.getById(e.filterId);this.filterId=e.filterId;if(n){this.filterApi=n.getApi()}}BX.UserContentView.init();BX("log_internal_container").addEventListener("click",BX.delegate(function(e){var t=BX.getEventTarget(e).getAttribute("bx-tag-value");if(BX.type.isNotEmptyString(t)){if(this.clickTag(t)){e.preventDefault()}}},this),true)};BitrixLF.prototype.init=function(e){this.bLoadStarted=false;this.nextURL=false;this.scrollInitialized=false;this.bStopTrackNextPage=false;this.bLockCounterAnimate=false;this.arMoreButtonID=[];this.logAjaxMode=false;this.nodeTmp1Cap=false;this.nodeTmp2Cap=false;this.cmdPressed=false;this.nextPageFirst=true;if(typeof e!="undefined"){this.firstPageLastTS=typeof e.firstPageLastTS!="undefined"?e.firstPageLastTS:0;this.firstPageLastId=typeof e.firstPageLastId!="undefined"?e.firstPageLastId:0;this.refreshUrl=typeof e.refreshUrl!="undefined"?e.refreshUrl:top.location.href}};BitrixLF.prototype.initScroll=function(){if(this.scrollInitialized){return}this.scrollInitialized=true;BX.bind(window,"scroll",BX.throttle(BX.delegate(this.onFeedScroll,this),100))};BitrixLF.prototype.onFeedScroll=function(){var e=BX.GetWindowSize();if(this.bStopTrackNextPage==false){var t=e.scrollHeight-e.innerHeight-500;if(e.scrollTop>=t&&oLF.nextURL){this.bStopTrackNextPage=true;this.getNextPage()}}var n=BX("sonet_log_counter_2_wrap",true);var o=BX("sonet_log_counter_2_container");if(n&&o){var i=n.parentNode.getBoundingClientRect().top;var s=o.getBoundingClientRect();if(i<=0){if(!BX.hasClass(n,"feed-new-message-informer-fixed")){o.style.left=s.left+s.width/2+"px"}BX.addClass(n,"feed-new-message-informer-fixed feed-new-message-informer-fix-anim")}else{BX.removeClass(n,"feed-new-message-informer-fixed feed-new-message-informer-fix-anim");o.style.left="auto"}}};BitrixLF.prototype.onFeedKeyDown=function(e){if(e==null){e=window.event}if(BX.util.in_array(e.keyCode,[224,91,93])){this.cmdPressed=true}};BitrixLF.prototype.onFeedKeyUp=function(e){if(e==null){e=window.event}if(BX.util.in_array(e.keyCode,[224,91,93])){this.cmdPressed=false}else if(e.keyCode==35||this.cmdPressed&&e.keyCode==39){this.bStopTrackNextPage=true;this.getNextPage()}};BitrixLF.prototype.getNextPage=function(){var e=BX("feed-new-message-inf-wrap");if(this.bLoadStarted){return false}this.bLoadStarted=true;this.bLockCounterAnimate=true;arCommentsMoreButtonID=[];this.arMoreButtonID=[];if(!this.nextPageFirst&&e){e.style.display="block"}var t={method:"GET",url:this.nextURL};BX.onCustomEvent("SonetLogBeforeGetNextPage",[t]);if(BX.type.isNotEmptyString(t.url)){more_url=t.url}BX.ajax({url:more_url,method:"GET",dataType:"json",data:{},onsuccess:function(t){oLF.bLoadStarted=false;if(e){BX.cleanNode(e,true)}oLF.bLockCounterAnimate=false;if(t&&typeof t.PROPS!="undefined"&&typeof t.PROPS.CONTENT!="undefined"&&t.PROPS.CONTENT.length>0&&(typeof t.LAST_TS=="undefined"||parseInt(t.LAST_TS)<=0||parseInt(oLF.firstPageLastTS)<=0||parseInt(t.LAST_TS)<parseInt(oLF.firstPageLastTS)||parseInt(t.LAST_TS)==parseInt(oLF.firstPageLastTS)&&typeof t.LAST_ID!="undefined"&&parseInt(t.LAST_ID)<parseInt(oLF.firstPageLastId))){var n="content_block_"+Math.floor(Math.random()*1e3);oLF.processAjaxBlock(t.PROPS,n,oLF.nextPageFirst);oLF.clearContainerExternal(false);if(oLF.nextPageFirst){BX("feed-new-message-inf-wrap-first").style.display="block";var o=function(){oLF.bStopTrackNextPage=false;if(BX(n)){BX(n).style.display="block"}BX.unbind(BX("sonet_log_more_container_first"),"click",o);BX("feed-new-message-inf-wrap-first").style.display="none";oLF.recalcMoreButton();oLF.registerViewAreaList()};BX.bind(BX("sonet_log_more_container_first"),"click",o)}else{if(BX(n)){BX(n).style.display="block"}setTimeout(function(){oLF.bStopTrackNextPage=false},300);setTimeout(function(){oLF.recalcMoreButton();oLF.registerViewAreaList()},1e3)}oLF.nextPageFirst=false}},onfailure:function(t){oLF.bLoadStarted=false;oLF.bStopTrackNextPage=false;if(e){e.style.display="none"}oLF.bLockCounterAnimate=false;oLF.clearContainerExternal(false)}});return false};BitrixLF.prototype.refresh=function(e,t){if(this.bLoadStarted){return}var n=BX("sonet_log_counter_2_wrap",true);var o=this.refreshUrl;this.bLoadStarted=true;this.showRefreshFade();arCommentsMoreButtonID=[];this.arMoreButtonID=[];if(typeof e=="undefined"||typeof e.useBXMainFilter=="undefined"||e.useBXMainFilter!="Y"){BX.onCustomEvent(window,"BX.Livefeed:refresh",[])}if(typeof e!="undefined"){e=BX.ajax.prepareData(e);if(e){o+=(o.indexOf("?")!==-1?"&":"?")+e}}if(n){var i=BX.findChild(n,{tag:"span",className:"feed-new-message-inf-text-reload"},true);if(i){i.style.display="none"}}this.bLockCounterAnimate=true;oLF.bLoadStarted=false;BX.ajax({url:o,method:"GET",dataType:"json",onsuccess:function(e){oLF.bLoadStarted=false;oLF.hideRefreshFade();if(e&&typeof e.PROPS!="undefined"){if(t){t.fulfill()}var o=null;if(typeof e.PROPS.EMPTY!="undefined"&&e.PROPS.EMPTY=="Y"&&BX("feed-empty-wrap")){o=BX("feed-empty-wrap")}var i=null;if(BX("feed-loader-container")){i=BX("feed-loader-container")}oLF.bLockCounterAnimate=false;BX.cleanNode("log_internal_container",false);if(o){BX("log_internal_container").appendChild(BX.create("DIV",{props:{className:"feed-wrap"},children:[o]}));o.style.display="block";var s=BX.findChild(o,{className:"feed-wrap-empty"});if(s){s.innerHTML=BX.message("SONET_C30_T_EMPTY_SEARCH")}}if(i){BX("log_internal_container").appendChild(i)}if(typeof e.PROPS.CONTENT!="undefined"&&e.PROPS.CONTENT.length>0){oLF.clearContainerExternal(false);oLF.processAjaxBlock(e.PROPS);setTimeout(BX.proxy(oLF.recalcMoreButton,oLF),1);oLF.registerViewAreaList();oLF.bStopTrackNextPage=false;if(typeof arCommentsMoreButtonID!="undefined"){arCommentsMoreButtonID=[]}if(n&&BX.hasClass(n,"feed-new-message-informer-fixed")){var a=BX("feed-up-btn-wrap",true);if(a){a.style.display="none";BX.removeClass(a,"feed-up-btn-wrap-anim")}var r=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:r.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){if(a)a.style.display="block";BX.onCustomEvent(window,"onGoUp")}}).animate()}}}else{if(t){t.reject()}oLF.showRefreshError()}},onfailure:function(e){oLF.bLoadStarted=false;if(t){t.reject()}oLF.hideRefreshFade();oLF.showRefreshError()}});return false};BitrixLF.prototype.showRefreshFade=function(){if(!BX.hasClass(BX("log_internal_container"),"log-internal-mask")){BX.addClass(BX("log_internal_container"),"log-internal-mask");BX.removeClass(BX("log_internal_container"),"log-internal-nomask");var e=BX("feed-loader-container");if(e){BX.style(e,"display","block");BX.removeClass(e,"livefeed-hide-loader");setTimeout(function(){BX.addClass(e,"livefeed-show-loader")},0)}}};BitrixLF.prototype.hideRefreshFade=function(){BX.removeClass(BX("log_internal_container"),"log-internal-mask");BX.addClass(BX("log_internal_container"),"log-internal-nomask");var e=BX("feed-loader-container");if(e){BX.removeClass(e,"livefeed-show-loader");BX.addClass(e,"livefeed-hide-loader")}};BitrixLF.prototype._onAnimationEnd=function(e){if("animationName"in e&&e.animationName&&e.animationName==="hideLoader"){var t=BX("feed-loader-container");BX.removeClass(t,"livefeed-show-loader");BX.removeClass(t,"livefeed-hide-loader");BX.style(t,"display","")}};BitrixLF.prototype.recalcMoreButton=function(){var e=null,t=null;if(typeof this.arMoreButtonID!="undefined"&&this.arMoreButtonID.length>0){var n=false;var o=false;var i=false;for(e=0;e<this.arMoreButtonID.length;e++){t=BX.pos(BX(this.arMoreButtonID[e].bodyBlockID));if(typeof this.arMoreButtonID[e].outerBlockID!="undefined"){o=BX(this.arMoreButtonID[e].outerBlockID);if(o){n=BX.pos(o);if(n.width<t.width){i=BX.findChild(o,{tag:"div",className:"feed-post-text-block-inner"},false);i.style.overflowX="scroll"}}}this.recalcMoreButtonPost({arPos:t,moreButtonBlock:BX(this.arMoreButtonID[e].moreButtonBlockID),informerBlock:typeof this.arMoreButtonID[e].informerBlockID!="undefined"?BX(this.arMoreButtonID[e].informerBlockID):null});delete this.arMoreButtonID[e]}}this.recalcMoreButtonCommentsList();if(BX("log_internal_container")){var s=BX.findChildren(BX("log_internal_container"),{attr:{"data-bx-onload":"Y"}},true);if(s!=null){for(e=0;e<s.length;e++){s[e].addEventListener("load",BX.proxy(function(e){var t=null,n=BX.findParent(e.currentTarget,{className:"feed-com-text"},BX("log_internal_container"));if(n){t=BX.findChild(n,{className:"feed-com-text-inner-inner"},true);if(t){this.recalcMoreButtonComment({bodyBlock:t,moreButtonBlock:BX.findChild(n,{className:"feed-post-text-more"},true)})}}else{n=BX.findParent(e.currentTarget,{className:"feed-post-block"},BX("log_internal_container"));if(n){t=BX.findChild(n,{className:"feed-post-text-block-inner-inner"},true);if(t){this.recalcMoreButtonPost({bodyBlock:t,moreButtonBlock:BX.findChild(n,{className:"feed-post-text-more"},true),informerBlock:BX.findChild(n,{className:"feed-post-text-more"},true)})}}}e.currentTarget.setAttribute("data-bx-onload","N")},this))}}}};BitrixLF.prototype.recalcMoreButtonPost=function(e){var t=typeof e.arPos!="undefined"?e.arPos:BX.pos(e.bodyBlock);var n=BX.findParent(BX(e.informerBlock),{className:"feed-post-block"},BX("log_internal_container"));if(!n){return}if(t.height<=284){BX.addClass(n,"feed-post-block-short");BX.addClass(n,"feed-post-block-separator")}};BitrixLF.prototype.recalcMoreButtonCommentsList=function(){if(typeof arCommentsMoreButtonID!="undefined"){for(i in arCommentsMoreButtonID){arPos=BX.pos(BX(arCommentsMoreButtonID[i].bodyBlockID));this.recalcMoreButtonComment({arPos:arPos,moreButtonBlock:typeof arCommentsMoreButtonID[i].moreButtonBlockID!="undefined"?BX(arCommentsMoreButtonID[i].moreButtonBlockID):null});delete arCommentsMoreButtonID[i]}}};BitrixLF.prototype.recalcMoreButtonComment=function(e){var t=typeof e.arPos!="undefined"?e.arPos:BX.pos(e.bodyBlock);if(t.height<200){if(e.moreButtonBlock){e.moreButtonBlock.style.display="none"}}else{if(e.moreButtonBlock&&e.moreButtonBlock.style.display=="none"){e.moreButtonBlock.style.display="block"}}};BitrixLF.prototype.showRefreshError=function(){this.bLockCounterAnimate=false;this.clearContainerExternal(false)};BitrixLF.prototype.LazyLoadCheckVisibility=function(e){var t=e.node;var n="comment";var o=BX.findParent(t,{className:"feed-com-text"});if(!o){n="post";o=BX.findParent(t,{className:"feed-post-text-block"})}if(o){var i=BX.findChild(o,{tag:"div",className:"feed-post-text-more"},false);if(i&&i.style.display!="none"){return t.parentNode.parentNode.offsetTop<(n=="comment"?220:270)}}return true};BitrixLF.prototype.processAjaxBlock=function(e,t,n){if(!e){return}if(!t){t="content_block_"+Math.floor(Math.random()*1e3)}n=!!n;var o=false;var i=false;s(a);r(l);function s(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function a(){BX("log_internal_container").appendChild(BX.create("DIV",{props:{id:t,className:"feed-wrap"},style:{display:n?"none":"block"},html:e.CONTENT}));o=true;if(i){l()}}function r(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function l(){i=true;if(o){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML"})}}};BitrixLF.prototype.clearContainerExternal=function(e){var t=null,n=null,o=null;if(BX("sonet_log_more_container")){t=BX.findChild(BX("sonet_log_more_container"),{tag:"span",className:"feed-new-message-inf-text"},false);if(t){t.style.display="inline-block";n=BX.findChild(t,{tag:"span",className:"feed-new-message-icon"},false);if(n){BX.removeClass(n,"new-message-balloon-icon-rotating")}}}if(BX("sonet_log_counter_2_wrap")){BX.removeClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim");BX("sonet_log_counter_2_wrap").style.visibility="hidden"}if(BX("sonet_log_counter_2_container")){t=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text"},false);o=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text-reload"},false);if(t&&o){t.style.display="inline-block";o.style.display="none";n=BX.findChild(t,{tag:"span",className:"feed-new-message-icon"},false);if(n){BX.removeClass(n,"new-message-balloon-icon-rotating")}if(BX("sonet_log_counter_2_plus")){BX.addClass(BX("sonet_log_counter_2_plus"),"feed-new-message-informer-counter-plus-hidden")}}}if(this.nodeTmp1Cap&&this.nodeTmp1Cap.parentNode){this.nodeTmp1Cap.parentNode.removeChild(this.nodeTmp1Cap)}if(this.nodeTmp2Cap&&this.nodeTmp2Cap.parentNode){this.nodeTmp2Cap.parentNode.removeChild(this.nodeTmp2Cap)}if(BX("sonet_log_counter_preset")&&this.logAjaxMode=="new"){BX("sonet_log_counter_preset").style.display="none"}};BitrixLF.prototype.clearContainerExternalNew=function(){this.logAjaxMode="new"};BitrixLF.prototype.clearContainerExternalMore=function(){this.logAjaxMode="more"};BitrixLF.prototype.createTask=function(e){this.createTaskPopup=new BX.PopupWindow("BXCTP",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:false,lightShadow:true,closeIcon:{right:"12px",top:"10px"},draggable:{restrict:true},closeByEsc:false,contentColor:"white",contentNoPaddings:true,buttons:[],content:BX.create("DIV",{attrs:{id:"BXCTP_content"},props:{className:"feed-create-task-popup-content"}}),events:{onAfterPopupShow:BX.proxy(function(){oLF.createTaskSetContent(BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_WAIT")}));BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.log.ex/ajax.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),ENTITY_TYPE:e.entityType,ENTITY_ID:e.entityId,action:"get_raw_data",params:{getSonetGroupAvailableList:true,getLivefeedUrl:true,checkParams:{feature:"tasks",operation:"create_tasks"}}},onsuccess:BX.proxy(function(t){if(t&&typeof t.TITLE!="undefined"&&typeof t.DESCRIPTION!="undefined"&&typeof t.DISK_OBJECTS!="undefined"&&typeof t.LIVEFEED_URL!="undefined"&&(BX.type.isNotEmptyString(t.TITLE)||BX.type.isNotEmptyString(t.DESCRIPTION))&&BX.type.isNotEmptyString(t.LIVEFEED_URL)){var n=oLF.formatTaskDescription(t.DESCRIPTION,t.LIVEFEED_URL,e.entityType,BX.type.isNotEmptyString(t.SUFFIX)?t.SUFFIX:"");var o={TITLE:t.TITLE,DESCRIPTION:n,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:t.DISK_OBJECTS};var i=[];if(typeof t.GROUPS_AVAILABLE!="undefined"){for(var s in t.GROUPS_AVAILABLE){if(t.GROUPS_AVAILABLE.hasOwnProperty(s)){i.push(t.GROUPS_AVAILABLE[s])}}}if(i.length==1){o.GROUP_ID=parseInt(i[0])}BX.Tasks.Util.Query.runOnce("task.add",{data:o}).then(BX.proxy(function(t){var n=t.getData();if(typeof n!="undefined"&&typeof n.DATA!="undefined"&&typeof n.DATA.ID!="undefined"&&parseInt(n.DATA.ID)>0){oLF.createTaskSetContentSuccess(n.DATA.ID);BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.log.ex/ajax.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),POST_ENTITY_TYPE:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,ENTITY_TYPE:e.entityType,ENTITY_ID:e.entityId,TASK_ID:n.DATA.ID,action:"create_task_comment",site:BX.message("SITE_ID")}})}else{oLF.createTaskSetContentFailure(t.getErrors().getMessages())}},this))}else{oLF.createTaskSetContentFailure([BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_ERROR_GET_DATA")])}},this),onfailure:function(e){oLF.createTaskSetContentFailure([BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_ERROR_GET_DATA")])}})},this),onPopupClose:BX.proxy(function(){this.createTaskPopup.destroy()},this)}});this.createTaskPopup.params.zIndex=BX.WindowManager?BX.WindowManager.GetZIndex():0;this.createTaskPopup.show()};BitrixLF.prototype.createTaskSetContentSuccess=function(e){var t=this;var n=BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_PATH").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",e);this.createTaskPopup.destroy();window.top.BX.UI.Notification.Center.notify({content:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_SUCCESS_TITLE"),actions:[{title:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_VIEW"),events:{click:function(e,t,o){t.close();window.top.BX.SidePanel.Instance.open(n)}}}]})};BitrixLF.prototype.createTaskSetContentFailure=function(e){oLF.createTaskSetContent(BX.create("DIV",{children:[BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_FAILURE_TITLE")}),BX.create("DIV",{props:{className:"feed-create-task-popup-description"},html:e.join("<br>")})]}))};BitrixLF.prototype.createTaskSetContent=function(e){if(BX("BXCTP_content")){var t=BX("BXCTP_content");BX.cleanNode(t);t.appendChild(e)}};BitrixLF.prototype.formatTaskDescription=function(e,t,n,o){var i=e;o=BX.type.isNotEmptyString(o)?"_"+o:"";if(!!t&&!!n&&t.length>0){i+="\n\n"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+n+o).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return i};BitrixLF.prototype.registerViewAreaList=function(){var e=BX("log_internal_container"),t=null;if(e){var n=BX.findChildren(e,{tag:"div",className:"feed-post-contentview"},true);for(var o=0,i=n.length;o<i;o++){if(n[o].id.length>0){t=BX.findChild(n[o],{tag:"div",className:"feed-post-text-block-inner-inner"});BX.UserContentView.registerViewArea(n[o].id,t?t:null)}}}};BitrixLF.prototype.clickTag=function(e){var t=false;if(BX.type.isNotEmptyString(e)&&this.filterApi){this.filterApi.setFields({TAG:e});this.filterApi.apply();if(this.filterId&&typeof BX.Main!="undefined"&&typeof BX.Main.filterManager!="undefined"&&BX.Main.filterManager.getById(this.filterId)&&(BX.Main.filterManager.getById(this.filterId).getSearch().getSquares().length>0||BX.Main.filterManager.getById(this.filterId).getSearch().getSearchString().length>0)){var n=BX.findParent(BX(this.filterId+"_filter_container"),{className:"pagetitle-wrap"});if(n){BX.addClass(n,"pagetitle-wrap-filter-opened")}}var o=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:o.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){}}).animate();t=true}return t};BitrixLF.prototype.expandPost=function(e){if(BX(e)){var t=BX.findParent(BX(e),{className:"feed-post-block"},BX("log_internal_container"));if(t){BX.addClass(t,"feed-post-block-short");BX.addClass(t,"feed-post-block-separator")}}};if(typeof oLF=="undefined"){oLF=new BitrixLF;window.oLF=oLF}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.min.js?15441273847363";s:6:"source";s:85:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.js";s:3:"min";s:89:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.min.js";s:3:"map";s:89:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.map.js";}"*/
(function(){function t(t){this.caller=t.caller;this.formNode=t.formNode;this.controlNode=t.controlNode;this.inputNode=t.inputNode;this.config=t.config}t.prototype={};BX.UserConsent={msg:{title:"MAIN_USER_CONSENT_REQUEST_TITLE",btnAccept:"MAIN_USER_CONSENT_REQUEST_BTN_ACCEPT",btnReject:"MAIN_USER_CONSENT_REQUEST_BTN_REJECT",loading:"MAIN_USER_CONSENT_REQUEST_LOADING",errTextLoad:"MAIN_USER_CONSENT_REQUEST_ERR_TEXT_LOAD"},events:{save:"main-user-consent-request-save",refused:"main-user-consent-request-refused",accepted:"main-user-consent-request-accepted"},current:null,autoSave:false,isFormSubmitted:false,isConsentSaved:false,attributeControl:"data-bx-user-consent",load:function(t){var e=this.find(t)[0];if(!e){return null}this.bind(e);return e},loadAll:function(t,e){this.find(t,e).forEach(this.bind,this)},loadFromForms:function(){var t=document.getElementsByTagName("FORM");t=BX.convert.nodeListToArray(t);t.forEach(this.loadAll,this)},find:function(t){if(!t){return[]}var e=t.querySelectorAll("["+this.attributeControl+"]");e=BX.convert.nodeListToArray(e);return e.map(this.createItem.bind(this,t)).filter(function(t){return!!t})},bind:function(t){if(t.config.submitEventName){BX.addCustomEvent(t.config.submitEventName,this.onSubmit.bind(this,t))}else if(t.formNode){BX.bind(t.formNode,"submit",this.onSubmit.bind(this,t))}BX.bind(t.controlNode,"click",this.onClick.bind(this,t))},createItem:function(e,n){var i=n.querySelector('input[type="checkbox"]');if(!i){return}try{var s=JSON.parse(n.getAttribute(this.attributeControl));var o={formNode:null,controlNode:n,inputNode:i,config:s};if(e.tagName=="FORM"){o.formNode=e}else{o.formNode=BX.findParent(i,{tagName:"FORM"})}o.caller=this;return new t(o)}catch(r){return null}},onClick:function(t,e){this.requestForItem(t);e.preventDefault()},onSubmit:function(t,e){this.isFormSubmitted=true;if(this.check(t)){return true}else{if(e){e.preventDefault()}return false}},check:function(t){if(t.inputNode.checked){this.saveConsent(t);return true}this.requestForItem(t);return false},requestForItem:function(t){this.setCurrent(t);this.requestConsent(t.config.id,{sec:t.config.sec,replace:t.config.replace},this.onAccepted,this.onRefused)},setCurrent:function(t){this.current=t;this.autoSave=t.config.autoSave;this.actionRequestUrl=t.config.actionUrl},onAccepted:function(){if(!this.current){return}var t=this.current;this.saveConsent(this.current,function(){BX.onCustomEvent(t,this.events.accepted,[]);BX.onCustomEvent(this,this.events.accepted,[t]);this.isConsentSaved=true;if(this.isFormSubmitted&&t.formNode&&!t.config.submitEventName){BX.submit(t.formNode)}});this.current.inputNode.checked=true;this.current=null},onRefused:function(){BX.onCustomEvent(this.current,this.events.refused,[]);BX.onCustomEvent(this,this.events.refused,[this.current]);this.current.inputNode.checked=false;this.current=null;this.isFormSubmitted=false},initPopup:function(){if(this.popup){return}this.popup={}},popup:{isInit:false,caller:null,nodes:{container:null,shadow:null,head:null,loader:null,content:null,textarea:null,buttonAccept:null,buttonReject:null},onAccept:function(){this.hide();BX.onCustomEvent(this,"accept",[])},onReject:function(){this.hide();BX.onCustomEvent(this,"reject",[])},init:function(){if(this.isInit){return true}var t=document.querySelector("script[data-bx-template]");if(!t){return false}var e=document.createElement("DIV");e.innerHTML=t.innerHTML;e=e.children[0];if(!e){return false}document.body.insertBefore(e,document.body.children[0]);this.isInit=true;this.nodes.container=e;this.nodes.shadow=this.nodes.container.querySelector("[data-bx-shadow]");this.nodes.head=this.nodes.container.querySelector("[data-bx-head]");this.nodes.loader=this.nodes.container.querySelector("[data-bx-loader]");this.nodes.content=this.nodes.container.querySelector("[data-bx-content]");this.nodes.textarea=this.nodes.container.querySelector("[data-bx-textarea]");this.nodes.buttonAccept=this.nodes.container.querySelector("[data-bx-btn-accept]");this.nodes.buttonReject=this.nodes.container.querySelector("[data-bx-btn-reject]");this.nodes.buttonAccept.textContent=BX.message(this.caller.msg.btnAccept);this.nodes.buttonReject.textContent=BX.message(this.caller.msg.btnReject);BX.bind(this.nodes.buttonAccept,"click",this.onAccept.bind(this));BX.bind(this.nodes.buttonReject,"click",this.onReject.bind(this));return true},setTitle:function(t){if(!this.nodes.head){return}this.nodes.head.textContent=t},setContent:function(t){if(!this.nodes.textarea){return}this.nodes.textarea.textContent=t},show:function(t){if(typeof t=="boolean"){this.nodes.loader.style.display=!t?"":"none";this.nodes.content.style.display=t?"":"none"}this.nodes.container.style.display=""},hide:function(){this.nodes.container.style.display="none"}},cache:{list:[],stringifyKey:function(t){return BX.type.isString(t)?t:JSON.stringify({key:t})},set:function(t,e){var n=this.get(t);if(n){n.data=e}else{this.list.push({key:this.stringifyKey(t),data:e})}},getData:function(t){var e=this.get(t);return e?e.data:null},get:function(t){t=this.stringifyKey(t);var e=this.list.filter(function(e){return e.key==t});return e.length>0?e[0]:null},has:function(t){return!!this.get(t)}},requestConsent:function(t,e,n,i){e=e||{};e.id=t;var s=this.cache.stringifyKey(e);if(!this.popup.isInit){this.popup.caller=this;if(!this.popup.init()){return}BX.addCustomEvent(this.popup,"accept",n.bind(this));BX.addCustomEvent(this.popup,"reject",i.bind(this))}if(this.current&&this.current.config.text){this.cache.set(s,this.current.config.text)}if(this.cache.has(s)){this.setTextToPopup(this.cache.getData(s))}else{this.popup.setTitle(BX.message(this.msg.loading));this.popup.show(false);this.sendActionRequest("getText",e,function(t){this.cache.set(s,t.text||"");this.setTextToPopup(this.cache.getData(s))},function(){this.popup.hide();alert(BX.message(this.msg.errTextLoad))})}},setTextToPopup:function(t){var e="";var n=t.indexOf("\n");var i=t.indexOf(".");n=n<i?n:i;if(n>=0&&n<=100){e=t.substr(0,n).trim();e=e.split(".").map(Function.prototype.call,String.prototype.trim).filter(String)[0]}this.popup.setTitle(e?e:BX.message(this.msg.title));this.popup.setContent(t);this.popup.show(true)},saveConsent:function(t,e){this.setCurrent(t);var n={id:t.config.id,sec:t.config.sec,url:window.location.href};if(t.config.originId){var i=t.config.originId;if(t.formNode&&i.indexOf("%")>=0){var s=t.formNode.querySelectorAll('input[type="text"], input[type="hidden"]');s=BX.convert.nodeListToArray(s);s.forEach(function(t){if(!t.name){return}i=i.replace("%"+t.name+"%",t.value?t.value:"")})}n.originId=i}if(t.config.originatorId){n.originatorId=t.config.originatorId}BX.onCustomEvent(t,this.events.save,[n]);BX.onCustomEvent(this,this.events.save,[t,n]);if(this.isConsentSaved||!t.config.autoSave){if(e){e.apply(this,[])}}else{this.sendActionRequest("saveConsent",n,e,e)}},sendActionRequest:function(t,e,n,i){n=n||null;i=i||null;e.action=t;e.sessid=BX.bitrix_sessid();e.action=t;BX.ajax({url:this.actionRequestUrl,method:"POST",data:e,timeout:10,dataType:"json",processData:true,onsuccess:BX.proxy(function(t){t=t||{};if(t.error){i.apply(this,[t])}else if(n){n.apply(this,[t])}},this),onfailure:BX.proxy(function(){var t={error:true,text:""};if(i){i.apply(this,[t])}},this)})}};BX.ready(function(){BX.UserConsent.loadFromForms()})})();
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527*/
; /* /bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?154412745438362*/
; /* /bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.min.js?15441273847363*/

//# sourceMappingURL=page_9e67575cdcf733edb71434053d2621bb.map.js