
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(i);var r={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};s=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a,o={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"]};a=this.getListItems(t,s);if(a.length){o.items=a}i.push(o);delete t[s]}}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var i;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){i=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",i,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{var s="settings";BX.userOptions.save("ui",this.listContainer.id,s,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/crm.button.edit/templates/.default/script.min.js?154412740034209";s:6:"source";s:70:"/bitrix/components/bitrix/crm.button.edit/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var CrmButtonEditor=function(t){this.init=function(t){this.id=t.id;this.isFrame=t.isFrame;this.isSaved=t.isSaved;this.reloadList=t.reloadList;this.pathToButtonList=t.pathToButtonList;this.defaultWorkTime=t.defaultWorkTime;this.dictionaryTypes=t.dictionaryTypes;this.mess=t.mess;this.canRemoveCopyright=t.canRemoveCopyright||false;this.canUseMultiLines=t.canUseMultiLines||false;this.actionRequestUrl=t.actionRequestUrl;this.colorEditor=new CrmButtonEditColors({caller:this,context:BX("BUTTON_COLOR_CONTAINER")});this.widgetManager=new CrmButtonEditWidgetManager({caller:this,context:BX("WIDGET_CONTAINER"),dictionaryPathEdit:t.dictionaryPathEdit,linesData:t.linesData});this.locationManager=new CrmButtonEditLocation({caller:this,context:BX("LOCATION_CONTAINER")});this.locationManager=new CrmButtonEditButton({caller:this,context:BX("BUTTON_VIEW_CONTAINER")});this.hello=new CrmButtonEditHello({caller:this,context:BX("HELLO_CONTAINER")});this.initCopy();this.mainForm=BX("crm_button_main_form");this.subForm=BX("crm_button_sub_form");BX.bind(this.mainForm,"submit",BX.proxy(this.copySubFormDataToMainForm,this));this.initButtons();this.initToolTips();this.initLanguages();if(!this.canRemoveCopyright){BX.bind(BX("COPYRIGHT_REMOVED_CONT"),"click",BX.proxy(function(t){if(!B24||!B24["licenseInfoPopup"]){return}t.preventDefault();B24.licenseInfoPopup.show("crm_sitebutton_copyright",this.mess.dlgRemoveCopyrightTitle,"<span>"+this.mess.dlgRemoveCopyrightText+"</span>")},this))}if(!this.canUseMultiLines){BX.bind(BX("USE_MULTI_LINES"),"click",BX.proxy(function(t){if(!B24||!B24["licenseInfoPopup"]){return}t.preventDefault();B24.licenseInfoPopup.show("crm_sitebutton_ol_multi",this.mess.dlgRemoveCopyrightTitle,"<span>"+this.mess.dlgMultiLinesText+"</span>")},this))}};this.initButtons=function(){var t=this;var e=BX("BUTTON_COLOR_CONTAINER");this.loadedButtonCount=e.querySelectorAll("[data-b24-crm-button-widget]").length;this.blockNode=e.querySelector("[data-b24-crm-button-block]");this.blockInnerNode=e.querySelector("[data-b24-crm-button-block-inner]");BX.bind(this.blockNode,"mouseover",function(e){t.showButtons()});BX.bind(this.blockNode,"mouseout",function(e){t.hideButtons()});var i=BX("CRM_BUTTON_SAVE");var n=BX("CRM_BUTTON_APPLY");BX.bind(i,"click",this.onSubmitButtonClick.bind(this,i));BX.bind(n,"click",this.onSubmitButtonClick.bind(this,n))};this.onSubmitButtonClick=function(t){setTimeout(function(){t.disabled=true},50);BX.addClass(t,"ui-btn-wait")};this.initLanguages=function(){this.languageContext=BX("CRM_BUTTON_LANGUAGES");if(!this.languageContext){return}BX.bind(this.languageContext,"click",BX.proxy(this.openLanguagePopup,this))};this.openLanguagePopup=function(){var t=JSON.parse(this.languageContext.getAttribute("data-langs"));var e=[];var i=this;for(var n in t){(function(n){e.push({text:t[n],className:"language-icon "+n,onclick:function(e,o){this.close();i.changeLanguage(n,t[n])}})})(n)}BX.PopupMenu.show("crm-button-language-popup",this.languageContext,e,{offsetTop:10,offsetLeft:0})};this.changeLanguage=function(t,e){var i=this.languageContext.querySelector("[data-langs-input]");var n=this.languageContext.querySelector("[data-langs-text]");BX.removeClass(this.languageContext,i.value);BX.addClass(this.languageContext,t);i.value=t;n.innerText=e;n.title=e};this.showButtons=function(){BX.addClass(this.blockNode,"b24-crm-button-block-active");BX.addClass(this.blockNode,"b24-crm-button-block-active-"+this.loadedButtonCount);BX.removeClass(this.blockInnerNode,"b24-crm-button-animate-"+this.loadedButtonCount)};this.hideButtons=function(){BX.removeClass(this.blockNode,"b24-crm-button-block-active");BX.removeClass(this.blockNode,"b24-crm-button-block-active-"+this.loadedButtonCount);BX.addClass(this.blockInnerNode,"b24-crm-button-animate-"+this.loadedButtonCount)};this.copySubFormDataToMainForm=function(t){BX.convert.nodeListToArray(this.subForm.elements).forEach(function(t){var e=t.name;var i="";var n=this.mainForm.querySelector('[name="'+e+'"]');if(!n){n=document.createElement("INPUT");n.type="hidden";n.name=e;this.mainForm.appendChild(n)}switch(t.type){case"radio":case"checkbox":var o=this.subForm.querySelector('[name="'+e+'"]:checked');if(o){i=o.value}break;default:i=t.value}n.value=i},this);return true};this.initToolTips=function(t){t=t||document.body;BX.UI.Hint.init(t)};this.initCopy=function(){var t=BX("SCRIPT_CONTAINER");if(!t){return}var e="data-bx-webform-script-copy-btn";var i=t.querySelector("["+e+"]");var n=t.querySelector("[data-bx-webform-script-copy-text]");if(!i||!n){return}BX.clipboard.bindCopyClick(i,{text:n,offsetLeft:30})};this.appendTemplateNode=function(t,e,i){return CrmButtonEditTemplate.appendNode(t,e,i)};this.getTemplateNode=function(t,e){return CrmButtonEditTemplate.getNode(t,e)};this.sendActionRequest=function(t,e,i,n){i=i||null;n=n||BX.proxy(this.showErrorPopup,this);e=e||{};var o=true;if(e instanceof FormData){e.append("action",t);e.append("button_id",this.id);e.append("sessid",BX.bitrix_sessid());o=false}else{e.action=t;e.button_id=this.id;e.sessid=BX.bitrix_sessid()}BX.ajax({url:this.actionRequestUrl,method:"POST",data:e,timeout:30,dataType:"json",processData:true,preparePost:o,onsuccess:BX.proxy(function(t){t=t||{};if(t.error){n.apply(this,[t])}else if(i){i.apply(this,[t])}},this),onfailure:BX.proxy(function(){var t={error:true,text:""};n.apply(this,[t])},this)})};this.showErrorPopup=function(t){t=t||{};var e=t.text||this.mess.errorAction;var i=BX.PopupWindowManager.create("crm_button_edit_error",null,{autoHide:true,lightShadow:true,closeByEsc:true,overlay:{backgroundColor:"black",opacity:500}});i.setButtons([new BX.PopupWindowButton({text:this.mess.dlgBtnClose,events:{click:function(){this.popupWindow.close()}}})]);i.setContent('<span class="crm-button-edit-warning-popup-alert">'+e+"</span>");i.show()};this.init(t)};var CrmButtonEditTemplate={appendNode:function(t,e,i){var n=CrmButtonEditTemplate.getNode(t,i);if(!n){return null}e.appendChild(n);return n},getNode:function(t,e){var i=BX("template-crm-button-"+t);if(!i){return null}var n=document.createElement("div");var o=i.innerHTML;if(e){for(var a in e){o=o.replace(new RegExp("%"+a+"%","g"),e[a])}}n.innerHTML=o;n=n.children[0];return n}};function CrmButtonEditActivationManager(t){this.attributeItem="data-bx-crm-button-item";this.attributeActive="data-bx-crm-button-item-active";this.attributeActiveValue="data-bx-crm-button-item-active-val";this.context=t.context;this.init()}CrmButtonEditActivationManager.prototype={init:function(){var t=this.context.querySelectorAll("["+this.attributeActive+"]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){BX.bind(t,"click",BX.delegate(function(){this.toggleActive(t)},this))},this)},toggleActive:function(t){var e="crm-button-edit-channel-lines-container-active";var i="crm-button-edit-channel-lines-title-on";var n="crm-button-edit-channel-lines-title-off";var o=t.getAttribute(this.attributeActive);var a=this.context.querySelector("["+this.attributeItem+'="'+o+'"]');var r=this.context.querySelector("["+this.attributeActiveValue+'="'+o+'"]');var s=BX.hasClass(t,i);if(s){BX.addClass(t,n);BX.removeClass(t,i);BX.removeClass(a,e);r.value="N"}else{BX.addClass(t,i);BX.removeClass(t,n);BX.addClass(a,e);r.value="Y"}}};function CrmButtonEditPageManager(t){this.attributePages="data-crm-button-pages";this.attributePagesList="data-crm-button-pages-list";this.attributePagesPage="data-crm-button-pages-page";this.attributePagesAdd="data-crm-button-pages-btn-add";this.attributePagesDel="data-crm-button-pages-btn-del";this.mainObject=t.mainObject;this.pageChangeHandler=t.pageChangeHandler}CrmButtonEditPageManager.prototype={initPages:function(t,e){var i=t.querySelectorAll("["+this.attributePagesList+"]");i=BX.convert.nodeListToArray(i);i.forEach(function(t){this.initPageButtons(t,e)},this)},initPageButtons:function(t,e){var i=t.querySelectorAll("["+this.attributePagesAdd+"]");i=BX.convert.nodeListToArray(i);i.forEach(function(t){BX.bind(t,"click",BX.delegate(function(){this.onClickPageButton(t,true,e)},this))},this);var n=t.querySelectorAll("["+this.attributePagesDel+"]");n=BX.convert.nodeListToArray(n);n.forEach(function(t){BX.bind(t,"click",BX.delegate(function(){this.onClickPageButton(t,false,e)},this))},this);var o=t.querySelectorAll("input");o=BX.convert.nodeListToArray(o);o.forEach(function(t){BX.bind(t,"blur",BX.delegate(function(){this.onPageChange()},this))},this)},onPageChange:function(){if(!this.pageChangeHandler){return}setTimeout(this.pageChangeHandler,400)},onClickPageButton:function(t,e,i){if(e){var n;var o=BX.findParent(t,{attribute:this.attributePages});var a=o.querySelector("script");if(a){n=document.createElement("div");n.innerHTML=a.innerHTML;n=n.children[0]}else{n=this.mainObject.getTemplateNode("page",i)}this.initPageButtons(n,i);var r=BX.findParent(t,{attribute:this.attributePagesList});r.appendChild(n)}else{var s=BX.findParent(t,{attribute:this.attributePagesPage});BX.remove(s)}this.onPageChange()}};function CrmButtonEditLocation(t){this.caller=t.caller;this.context=t.context;this.attributeItem="data-bx-crm-button-loc";this.attributeVal="data-bx-crm-button-loc-val";this.className="crm-button-edit-sidebar-button-position-block-active-";this.init()}CrmButtonEditLocation.prototype={init:function(){this.list=this.context.querySelectorAll("["+this.attributeItem+"]");this.list=BX.convert.nodeListToArray(this.list);this.list.forEach(function(t){BX.bind(t,"click",BX.delegate(function(){this.list.forEach(this.deactivate,this);this.activate(t)},this))},this)},deactivate:function(t){this.activate(t,true)},activate:function(t,e){e=e||false;var i=t.querySelector("["+this.attributeVal+"]");var n=i.value;if(e){BX.removeClass(t,this.className+n)}else{BX.addClass(t,this.className+n)}}};function CrmButtonEditColors(t){this.caller=t.caller;this.context=t.context;this.attributeBlock="data-b24-crm-button-block-button";this.attributeBlockBorder="data-b24-crm-button-block-border";this.attributePulse="data-b24-crm-button-pulse";this.attributeCont="data-b24-crm-button-block-inner";this.attributeIconItem="data-b24-crm-button-icon";this.classNameActive="b24-crm-button-inner-item-active";this.colorIconNode=BX("ICON_COLOR");this.colorBgNode=BX("BACKGROUND_COLOR");this.node=this.context.querySelector("["+this.attributeBlock+"]");this.previewNode=this.node.querySelector("["+this.attributeCont+"]");this.borderNode=this.context.querySelector("["+this.attributeBlockBorder+"]");this.pulseNode=this.context.querySelector("["+this.attributePulse+"]");var e=this.node.querySelectorAll("["+this.attributeIconItem+"]");e=BX.convert.nodeListToArray(e);this.previewItems=e.map(function(t){return{type:t.getAttribute(this.attributeIconItem),node:t,iconNode:t.querySelector("path")}},this);this.init()}CrmButtonEditColors.prototype={init:function(){this.initColorPicker()},changeActiveState:function(t,e){this.previewItems.forEach(function(i){if(i.type!=t){return}if(e){BX.addClass(i.node,this.classNameActive)}else{BX.removeClass(i.node,this.classNameActive)}},this);this.previewNode.style.background=this.colorBgNode.value;this.previewItems.forEach(function(t){t.iconNode.setAttribute("fill",this.colorIconNode.value)},this)},updateButtonColors:function(){var t=this.colorBgNode.value?this.colorBgNode.value:"#00AEEF";this.previewNode.style.background=t;this.borderNode.style.background=t;this.pulseNode.style.border="1px solid "+t;this.previewItems.forEach(function(t){t.iconNode.setAttribute("fill",this.colorIconNode.value?this.colorIconNode.value:"#FFFFFF")},this)},showColorPicker:function(t,e){e=e||t;this.picker.close();this.picker.open({defaultColor:"",allowCustomColor:true,bindElement:e,onColorSelected:this.onColorPicked.bind(this,t)})},onColorPicked:function(t,e){if(!e){e=""}t.value=e;var i=BX.nextSibling(t);if(i){i.style.background=e}BX.fireEvent(t,"change")},onColorInputChange:function(t){var e=BX.nextSibling(t);if(e){e.style.background=t.value;this.updateButtonColors()}},initColorPicker:function(){this.picker=new BX.ColorPicker({popupOptions:{offsetLeft:15,offsetTop:5}});var t=this.context.querySelectorAll("[data-web-form-color-picker]");t=BX.convert.nodeListToArray(t);for(var e in t){var i=t[e];var n=BX.nextSibling(i);var o=this.showColorPicker.bind(this,i,n);BX.bind(n,"click",o);BX.bind(i,"click",o);BX.bind(i,"focus",o);BX.bind(i,"bxchange",this.onColorInputChange.bind(this,i));BX.fireEvent(i,"change")}}};function CrmButtonEditWidgetManager(t){this.caller=t.caller;this.context=t.context;this.dictionaryPathEdit=t.dictionaryPathEdit;this.linesData=t.linesData;this.attributeSelect="data-bx-crm-button-widget-select";this.attributeButtonEdit="data-bx-crm-button-widget-btn-edit";this.attributeSettingsButton="data-crm-button-item-settings-btn";this.attributeSettings="data-crm-button-item-settings";this.attributeSettingsWTButton="data-crm-button-item-settings-wt-btn";this.attributeSettingsWTText="data-crm-button-item-settings-wt-txt";this.attributeSettingsWTDefText="data-crm-wt-def";this.attributeSettingsWT="data-crm-button-item-settings-wt";this.attributeWorkTime="data-crm-button-item-worktime";this.attributeWorkTimeButton="data-crm-button-item-worktime-btn";this.attributeWorkTimeActionRule="data-crm-button-item-worktime-action-rule";this.attributeWorkTimeActionText="data-crm-button-item-worktime-action-text";this.init()}CrmButtonEditWidgetManager.prototype={init:function(){this.pageManager=new CrmButtonEditPageManager({mainObject:this.caller});this.pageManager.initPages(this.context);this.initSelect();var t=BX("items_openline_container");if(t){var e=new CrmButtonEditLineManager({caller:this,context:t,linesData:this.linesData})}this.activationManager=new CrmButtonEditActivationManager({context:this.context});var i=this.context.querySelectorAll("["+this.attributeSettingsButton+"]");i=BX.convert.nodeListToArray(i);i.forEach(function(t){BX.bind(t,"click",BX.proxy(function(){var e=t.getAttribute(this.attributeSettingsButton);var i=this.context.querySelector("["+this.attributeSettings+'="'+e+'"]');BX.toggleClass(i,"crm-button-edit-channel-lines-display-options-open")},this))},this);var n=this.context.querySelectorAll("["+this.attributeSettingsWTButton+"]");n=BX.convert.nodeListToArray(n);n.forEach(function(t){var e=t.getAttribute(this.attributeSettingsWTButton);var i=this.context.querySelector("["+this.attributeSettingsWT+'="'+e+'"]');BX.bind(t,"click",BX.proxy(function(){BX.toggleClass(i,"crm-button-edit-channel-lines-display-options-open")},this))},this);this.initWorkTime()},listenWorkTimeChanges:function(t,e){BX.bind(e,"change",BX.proxy(function(){this.changeWorkTimeLabel(t)},this))},changeWorkTimeLabel:function(t){var e=this.context.querySelector("["+this.attributeSettingsWT+'="'+t+'"]');var i=this.context.querySelector("["+this.attributeSettingsWTText+'="'+t+'"]');var n=i.getAttribute(this.attributeSettingsWTDefText);var o=e.querySelector("[data-crm-wt-enabled]");if(!o.checked){i.innerText=n}else{var a=e.querySelector("[data-crm-wt-time-from]");var r=e.querySelector("[data-crm-wt-time-to]");var s=e.querySelector("[data-crm-wt-days-caption]");var l=e.querySelectorAll("[data-crm-wt-days]:checked");l=BX.convert.nodeListToArray(l);var c=a.selectedOptions[0].textContent.trim();c+=" - "+r.selectedOptions[0].textContent.trim();if(l.length>0){c+=", "+s.textContent.toLowerCase()+": ";c+=l.map(function(t){return t.getAttribute("data-crm-wt-day-label")}).join(", ")}i.innerText=c}},initSelect:function(){var t=this.context.querySelectorAll("["+this.attributeSelect+"]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){BX.bind(t,"change",BX.proxy(function(){this.onChangeSelect(t)},this));this.onChangeSelect(t)},this)},onChangeSelect:function(t){var e=t.getAttribute(this.attributeSelect);var i=!!t.value;this.caller.colorEditor.changeActiveState(e,i);var n=this.context.querySelector("["+this.attributeButtonEdit+'="'+e+'"'+"]");if(i){var o=this.dictionaryPathEdit[e];n.href=o.path.replace(o.id,t.value)}n.style.display=i?"inline-block":"none";var a=null,r=null,s=null,l=null;if(this.caller.dictionaryTypes[e]){this.caller.dictionaryTypes[e].LIST.forEach(function(e){if(t.value==e.ID){a=e.WORK_TIME;r=e.CONNECTORS;s=e.PHONE_NAME;l=e.FORM_FIELDS}},this)}this.changeWorkTime(e,a);if(e=="openline"){var c=BX("openline_channels");c.innerHTML="";r.forEach(function(t){var e=document.createElement("span"),i=document.createElement("i");e.title=t.name;BX.addClass(e,"crm-button-edit-channel-lines-social-item");BX.addClass(e,"ui-icon");BX.addClass(e,"ui-icon-service-"+t.code.replace(".","-"));e.appendChild(i);c.appendChild(e)},this)}else if(e=="callback"){var u=BX("callback_phone_number");u.innerText=s}else if(e=="crmform"){var h=BX("crmform_fields");h.innerText=l.map(function(t){return t.CAPTION}).join(", ")}},initWorkTime:function(){var t=this.context.querySelectorAll("["+this.attributeWorkTimeButton+"]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){var e=t.getAttribute(this.attributeWorkTimeButton);var i=this.context.querySelector("["+this.attributeWorkTime+'="'+e+'"]');BX.bind(t,"change",BX.proxy(function(){var e=i.querySelector("[data-crm-wt-shadow]");e.style.display=t.checked?"none":""},this));var n=i.querySelector("[data-crm-wt-time-from]");var o=i.querySelector("[data-crm-wt-time-to]");var a=i.querySelectorAll("[data-crm-wt-days]");a=BX.convert.nodeListToArray(a);this.listenWorkTimeChanges(e,t);this.listenWorkTimeChanges(e,n);this.listenWorkTimeChanges(e,o);a.forEach(function(t){this.listenWorkTimeChanges(e,t)},this);this.changeWorkTimeLabel(e);var r=this.context.querySelector("["+this.attributeWorkTimeActionRule+'="'+e+'"]');BX.bind(r,"change",BX.proxy(function(){var t=this.context.querySelector("["+this.attributeWorkTimeActionText+'="'+e+'"]');t.style.display=r.value=="text"?"":"none"},this));BX.fireEvent(r,"change")},this)},changeWorkTime:function(t,e){var i="ITEMS["+t+"][WORK_TIME]";var n="ITEMS_"+t+"_WORK_TIME";var o=BX(n+"_"+"ENABLED");if(!o||o.checked){return}if(!e){e=this.caller.defaultWorkTime}BX(n+"_"+"TIME_ZONE").value=e.TIME_ZONE;BX(n+"_"+"TIME_FROM").value=e.TIME_FROM;BX(n+"_"+"TIME_TO").value=e.TIME_TO;BX(n+"_"+"HOLIDAYS").value=e.HOLIDAYS.join(",");var a=document.getElementsByName(i+"[DAY_OFF][]");a=BX.convert.nodeListToArray(a);a.forEach(function(t){t.checked=BX.util.in_array(t.value,e.DAY_OFF)})}};function CrmButtonEditAvatarEditor(t){this.caller=t.caller;this.context=t.context;this.init()}CrmButtonEditAvatarEditor.prototype={init:function(){this.editButtonNode=this.context.querySelector("[data-crm-button-edit-avatar-edit]");BX.bind(this.editButtonNode,"click",BX.delegate(this.show,this));this.avatarContainer=this.context.querySelector("[data-crm-button-edit-avatars]");this.attributeCarouselNext="data-crm-button-edit-avatar-next";this.attributeCarouselPrev="data-crm-button-edit-avatar-prev";this.attributeAvatar="data-crm-button-edit-avatar-edit";this.attributeAvatar="data-crm-button-edit-avatar-item";this.attributeAvatarRemove="data-remove";this.attributeFileId="data-file-id";this.attributePath="data-path";this.attributeView="data-view";this.getAllAvatarNodes().forEach(this.initAvatar,this);this.initCarousel()},createAvatarNode:function(t,e){var i=BX("crm_button_edit_template_avatar");i=i.innerHTML;t=BX.util.htmlspecialchars(t);e=BX.util.htmlspecialchars(e);i=i.replace("%file_id%",t).replace("%path%",e).replace("%path%",e);var n=BX.create("DIV");n.innerHTML=i;n=n.children[0];return n},initAvatar:function(t){var e=t.querySelector("["+this.attributeView+"]");e=e||t;BX.bind(e,"click",BX.delegate(function(){this.selectAvatar(t)},this));var i=t.getAttribute(this.attributeFileId);if(i){var n=t.querySelector("["+this.attributeAvatarRemove+"]");BX.bind(n,"click",BX.delegate(function(){this.removeFile(i,t)},this))}},selectAvatar:function(t){var e=t.getAttribute(this.attributePath);BX.onCustomEvent(this,"onSelect",[e])},initCarousel:function(){if(!this.carouselNextNode){this.carouselNextNode=this.context.querySelector("["+this.attributeCarouselNext+"]");this.carouselPrevNode=this.context.querySelector("["+this.attributeCarouselPrev+"]");BX.bind(this.carouselNextNode,"click",BX.delegate(function(){this.turnCarousel("next")},this));BX.bind(this.carouselPrevNode,"click",BX.delegate(function(){this.turnCarousel("prev")},this))}var t=this.getUserAvatarNodes();var e=Math.round(100/t.length);t.forEach(function(t){t.style.width=e+"%"},this);this.avatarContainer.style.width="calc(66px * "+t.length+")";this.turnCarousel("start")},turnCarousel:function(t){var e=this.getUserAvatarNodes();var i;var n=66;var o=-n*(e.length-3);var a=this.avatarContainer.style.left.toString();a=parseInt(a.replace("px",""));if(isNaN(a))a=0;switch(t){case"prev":i=a+n;break;case"start":i=0;break;case"end":i=1e5;break;case"next":default:i=a-n;break}if(i>=0){i=0}else if(i<o){i=o}this.carouselPrevNode.style.display=i==0||e.length<=3?"none":"";this.carouselNextNode.style.display=i==o||e.length<=3?"none":"";this.avatarContainer.style.left=i+(i==0?"":"px")},markCurrentAvatar:function(t){var e="selected";this.getAllAvatarNodes().forEach(function(i){var n=i.getAttribute(this.attributePath);if(n==t){BX.addClass(i,e)}else{BX.removeClass(i,e)}},this);this.getUserAvatarNodes().forEach(function(t,i){if(i>2&&BX.hasClass(t,e)){this.avatarContainer.insertBefore(t,this.avatarContainer.children[0])}},this)},getUserAvatarNodeByFileId:function(t){return this.avatarContainer.querySelector("["+this.attributeFileId+'="'+t+'"]')},getUserAvatarNodes:function(){return BX.convert.nodeListToArray(this.avatarContainer.querySelectorAll("["+this.attributeAvatar+"]"))},getAllAvatarNodes:function(){return BX.convert.nodeListToArray(this.context.querySelectorAll("["+this.attributeAvatar+"]"))},showLoader:function(){BX.addClass(this.editButtonNode,"loader")},hideLoader:function(){BX.removeClass(this.editButtonNode,"loader")},onFileAdded:function(t){var e=this.createAvatarNode(t.fileId,t.filePath);if(this.avatarContainer.children.length>0){this.avatarContainer.insertBefore(e,this.avatarContainer.children[0])}else{this.avatarContainer.appendChild(e)}this.initAvatar(e);this.initCarousel();this.selectAvatar(e);this.hideLoader()},onFileRemoved:function(t){if(t.fileId&&t.fileId>0){var e=this.getUserAvatarNodeByFileId(t.fileId)}if(t.error){this.caller.showErrorPopup(t);if(e){e.style.display=""}}else{BX.remove(e)}this.initCarousel();this.hideLoader()},addFile:function(t){if(!t||t.size<=0){return}this.showLoader();var e=new FormData;e.append("avatar_file",t);this.caller.sendActionRequest("addAvatarFile",e,BX.proxy(this.onFileAdded,this),BX.proxy(function(t){t=t||{error:true};this.onFileAdded(t)},this))},removeFile:function(t,e){this.showLoader();e.style.display="none";this.caller.sendActionRequest("removeAvatarFile",{fileId:t},BX.proxy(this.onFileRemoved,this))},show:function(){if(!this.editor){this.initEditor()}this.editor.show();BX.addCustomEvent(this.editor.popup,"onPopupClose",BX.proxy(this.onEditorPopupClose,this))},onEditorPopupClose:function(){BX.onCustomEvent(this,"onClose",[]);BX.removeCustomEvent(this.editor.popup,"onPopupClose",BX.proxy(this.onEditorPopupClose,this))},initEditor:function(){this.editor=new BX.AvatarEditor;BX.addCustomEvent(this.editor,"onApply",BX.delegate(function(t){if(!t){return}this.addFile(t)},this))}};function CrmButtonEditHello(t){this.caller=t.caller;this.context=t.context;this.blockCounter=1e3;this.init()}CrmButtonEditHello.prototype={init:function(){this.pageManager=new CrmButtonEditPageManager({mainObject:this.caller,pageChangeHandler:BX.proxy(this.onPagesChange,this)});this.activationManager=new CrmButtonEditActivationManager({context:this.context});this.customHelloContainer=BX("HELLO_MY_CONTAINER");this.defaultHelloContainer=BX("HELLO_ALL_CONTAINER");BX.bind(this.context.querySelector("[data-b24-crm-hello-add]"),"click",BX.proxy(this.addBlock,this));this.blockAttribute="data-b24-crm-hello-block";var t=this.customHelloContainer.querySelectorAll("["+this.blockAttribute+"]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){this.initBlock(t,true,false)},this);var e=this.defaultHelloContainer.querySelector("[data-b24-crm-hello-block]");this.initBlock(e,true,true);this.onPagesChange();this.modeSelector=this.context.querySelector("[data-b24-crm-hello-mode]");BX.bind(this.modeSelector,"click",BX.proxy(this.changeMode,this))},changeMode:function(){var t=this.modeSelector.value=="INCLUDE";BX("HELLO_ALL_CONTAINER").style.display=t?"none":""},addBlock:function(){var t={id:this.blockCounter++,target:"HELLO[CONDITIONS]",mode:"INCLUDE"};var e=this.caller.appendTemplateNode("hello",this.customHelloContainer,t);this.initBlock(e)},initBlock:function(t,e,i){e=e||false;i=i||false;if(!e){this.caller.initToolTips(t)}var n={target:"HELLO[CONDITIONS]",type:t.getAttribute(this.blockAttribute),mode:i?"EXCLUDE":"INCLUDE"};this.pageManager.initPageButtons(t,n);BX.bind(t.querySelector("[data-b24-hello-btn-remove]"),"click",BX.delegate(function(){this.removeBlock(t);this.onPagesChange()},this));var o="crm-button-edit-name-state";var a=t.querySelector("[data-b24-hello-name-text]");var r=t.querySelector("[data-b24-hello-name-input]");BX.bind(t.querySelector("[data-b24-hello-name-btn-edit]"),"click",BX.delegate(function(){BX.addClass(t,o)},this));BX.bind(t.querySelector("[data-b24-hello-name-btn-apply]"),"click",BX.delegate(function(){a.innerText=r.value.trim();BX.removeClass(t,o)},this));var s="crm-button-edit-description-state";var l=t.querySelector("[data-b24-hello-text-text]");var c=t.querySelector("[data-b24-hello-text-input]");BX.bind(t.querySelector("[data-b24-hello-text-btn-edit]"),"click",BX.delegate(function(){BX.addClass(t,s)},this));BX.bind(t.querySelector("[data-b24-hello-text-btn-apply]"),"click",BX.delegate(function(){l.innerText=c.value.trim();BX.removeClass(t,s)},this));var u=t.querySelector("[data-b24-hello-icon]");var h=t.querySelector("[data-b24-hello-icon-btn]");var d=t.querySelector("[data-b24-hello-icon-input]");var v=function(){this.currentIconNode=u;this.currentIconInputNode=d;this.showAvatarPopup()};BX.bind(u,"click",BX.delegate(v,this));BX.bind(h,"click",BX.delegate(v,this))},onSelectAvatar:function(t){if(t){this.currentIconNode.style["background-image"]="url("+t+")";this.currentIconInputNode.value=t}this.avatarPopup.close()},showAvatarPopup:function(){if(!this.avatarPopup){var t=BX("crm_button_edit_avatar_upload");this.avatarEditor=new CrmButtonEditAvatarEditor({caller:this.caller,context:t});BX.addCustomEvent(this.avatarEditor,"onClose",BX.delegate(this.showAvatarPopup,this));BX.addCustomEvent(this.avatarEditor,"onSelect",BX.delegate(this.onSelectAvatar,this));this.avatarPopup=BX.PopupWindowManager.create("crm_button_edit_avatar",null,{autoHide:true,lightShadow:true,overlay:true,closeIcon:true,closeByEsc:true,angle:true,content:t})}this.avatarEditor.markCurrentAvatar(this.currentIconInputNode.value);this.avatarPopup.setBindElement(this.currentIconNode);this.avatarPopup.show()},removeBlock:function(t){BX.remove(t)},onPagesChange:function(){var t=this.defaultHelloContainer.querySelector("[data-b24-hello-excluded-pages]");if(!t){return}var e=this.customHelloContainer.querySelectorAll("[data-crm-button-pages-list] input");e=BX.convert.nodeListToArray(e);var i=e.map(function(t){return t.value},this);t.innerText=i.filter(function(t){return!!t}).join("\n")}};function CrmButtonEditButton(t){this.caller=t.caller;this.context=t.context;this.container=this.context.querySelector("[data-b24-crm-button-cont]");this.attributeItem="data-bx-crm-button-item";this.init()}CrmButtonEditButton.prototype={init:function(){BX.addClass(this.context.querySelector("[data-b24-crm-button-pulse]"),"b24-widget-button-pulse-animate");this.animatedNodes=BX.convert.nodeListToArray(this.context.querySelectorAll("[data-b24-crm-button-icon]"));this.animate()},toggle:function(){var t="b24-widget-button-top";if(BX.hasClass(this.container,t)){BX.removeClass(this.container,t);this.shadow.hide()}else{BX.addClass(this.container,t);this.shadow.show()}},animate:function(){var t="b24-widget-button-icon-animation";var e=0;this.animatedNodes.forEach(function(i,n){if(BX.hasClass(i,t))e=n;BX.removeClass(i,t)},this);e++;e=e<this.animatedNodes.length?e:0;BX.addClass(this.animatedNodes[e],t);if(this.animatedNodes.length>1){var i=this;setTimeout(function(){i.animate()},1500)}},shadow:{init:function(t){this.c=t.caller;this.shadowNode=t.shadowNode;var e=this;BX.bind(this.shadowNode,"click",function(t){e.hide()});BX.bind(document,"keyup",function(t){t=t||window.e;if(t.keyCode==27){e.hide()}})},show:function(){BX.addClass(this.shadowNode,"b24-widget-button-shadow-show")},hide:function(){BX.removeClass(this.shadowNode,"b24-widget-button-shadow-show")}}};function CrmButtonEditLineManager(t){this.caller=t.caller;this.context=t.context;this.linesData=t.linesData;this.lines=[];if(this.linesData&&this.linesData.LIST.length>0){this.init()}}CrmButtonEditLineManager.prototype={init:function(){this.linesData.LIST.forEach(function(t){this.prepareLineData(t)},this);this.attributeLine="data-line";this.externalIdNode=this.context.querySelector("[data-bx-external-id]");this.buttonAddNode=this.context.querySelector("[data-bx-add]");this.addHintNode=this.context.querySelector("[data-bx-add-desc]");this.listNode=this.context.querySelector("[data-bx-list-ext]");this.defListNode=this.context.querySelector("[data-bx-list-def]");if(this.buttonAddNode){BX.bind(this.buttonAddNode,"click",BX.proxy(this.createLine,this))}this.initLinesFromContainer(this.defListNode);this.initLinesFromContainer(this.listNode);this.actualizeButtonAddDisplay()},saveToHiddenFields:function(){var t=[];this.lines.forEach(function(e){t.push(e.getId())},this);this.externalIdNode.value=t.join(",")},initLinesFromContainer:function(t){if(!t){return}var e=t.querySelectorAll("["+this.attributeLine+"]");e=BX.convert.nodeListToArray(e);e.forEach(function(t){var e=t.getAttribute(this.attributeLine);var i=this.getLineDataById(e);this.initLine(t,i)},this)},initLine:function(t,e){var i=new CrmButtonEditLine({caller:this,node:t,data:e});this.lines.push(i);BX.addCustomEvent(i,"load",BX.proxy(this.onLineLoad,this));BX.addCustomEvent(i,"change",BX.proxy(this.onLineChange,this));BX.addCustomEvent(i,"remove",BX.proxy(this.onLineRemove,this));i.load(e);return i},createLine:function(){var t=this.getUnusedLinesData();if(t.length==0){return null}var e=t[0];var i=CrmButtonEditTemplate.getNode("line",{});this.initLine(i,e);this.listNode.appendChild(i);this.actualizeButtonAddDisplay();this.saveToHiddenFields()},actualizeButtonAddDisplay:function(){if(this.addHintNode){this.addHintNode.style.display=this.lines.length>1?"none":""}if(!this.buttonAddNode){return}var t=this.getUnusedLinesData();this.buttonAddNode.style.display=t.length>0?"":"none"},getUnusedLinesData:function(){var t=this.lines.map(function(t){return t.getId()});return this.linesData.LIST.filter(function(e){return!BX.util.in_array(e.ID,t)})},prepareLineData:function(t){var e=this.linesData.PATH_EDIT;t.PATH_EDIT=e.path.replace(e.id,t.ID)},getLineDataById:function(t){var e=this.linesData.LIST.filter(function(e){return e.ID==t},this);return e.length>0?e[0]:null},updateLineSelects:function(){var t=this.getUnusedLinesData();this.lines.forEach(function(e){var i=this.getLineDataById(e.getId());if(!i){return}var n=BX.util.array_merge([i],t);e.fillSelect(n)},this)},onLineLoad:function(t){this.updateLineSelects()},onLineChange:function(t,e){var i=this.getLineDataById(e);if(!i){return}t.load(i);this.saveToHiddenFields()},onLineRemove:function(t){this.lines=BX.util.deleteFromArray(this.lines,this.lines.indexOf(t));this.actualizeButtonAddDisplay();this.updateLineSelects();this.saveToHiddenFields()}};function CrmButtonEditLine(t){this.caller=t.caller;this.node=t.node;this.data={};this.config={};this.channels=[];this.init(t)}CrmButtonEditLine.prototype={getId:function(){return this.data.ID},initConfig:function(t){t=t||"{}";try{t=JSON.parse(t)}catch(t){}if(!BX.type.isPlainObject(t)){t={}}this.config.excluded=t.excluded||[]},init:function(t){this.selectNode=this.node.querySelector("[data-line-list]");this.editButtonNode=this.node.querySelector("[data-line-edit]");this.removeButtonNode=this.node.querySelector("[data-line-remove]");this.channelsNode=this.node.querySelector("[data-line-channels]");this.initConfig(this.node.getAttribute("data-line-config"));this.fillDropDownControl(this.selectNode,[this.data]);BX.bind(this.selectNode,"change",BX.proxy(this.onChangeLineSelect,this));BX.bind(this.removeButtonNode,"click",BX.proxy(this.remove,this))},onChangeLineSelect:function(t){this.initConfig();BX.onCustomEvent(this,"change",[this,t.target.value])},fillSelect:function(t){var e=t.map(function(t){return{value:t.ID,caption:t.NAME,selected:t.ID==this.selectNode.value}},this);this.fillDropDownControl(this.selectNode,e)},load:function(t){if(!t){return}this.data=t;this.editButtonNode.href=this.data.PATH_EDIT;this.channelsNode.innerHTML="";this.data.CONNECTORS.forEach(this.addConnector,this);BX.onCustomEvent(this,"load",[this])},addConnector:function(t){var e="checked";if(BX.util.in_array(t.id,this.config.excluded)){e=""}var i=CrmButtonEditTemplate.getNode("connector",{lineid:this.getId(),connector:t.id,icon:t.icon,checked:e});this.channelsNode.appendChild(i);this.initTooltip(i,t)},initTooltip:function(t,e){t=t.querySelector("[data-crm-tooltip]");if(!t){return}var i=e.title;if(i!=e.desc){i+=": "+e.desc}BX.bind(t,"mouseover",function(){BX.UI.Hint.show(this,i)});BX.bind(t,"mouseout",function(){BX.UI.Hint.hide()})},showTooltip:function(t,e){if(!this.tooltipPopup){var i=new BX.PopupWindow("bx-crm-site-button-openline-tooltip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:25,offsetTop:2,bindOptions:{position:"top"},zIndex:200});i.setAngle({offset:13,position:"bottom"});this.__proto__.tooltipPopup=i}this.tooltipPopup.setBindElement(t);this.tooltipPopup.setContent(e);this.tooltipPopup.show()},remove:function(){BX.unbindAll(this);BX.unbindAll(this.node);BX.remove(this.node);BX.onCustomEvent(this,"remove",[this])},fillDropDownControl:function(t,e){e=e||[];t.innerHTML="";e.forEach(function(e){if(!e||!e.caption){return}var i=document.createElement("option");i.value=e.value;i.selected=!!e.selected;i.innerText=e.caption;t.appendChild(i)})}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?1544127465770";s:6:"source";s:70:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.UI");var t=function(){};t.prototype={init:function(t){t=t||{};this.context=BX("ui-button-panel");this.isFrame=t.isFrame||false;this.hasHints=t.hasHints||false;this.pinner=new BX.UI.Pinner(this.context,{fixBottom:this.isFrame,fullWidth:this.isFrame});if(this.hasHints){BX.UI.Hint.init(this.context)}t.buttons.forEach(this.initButton,this)},initButton:function(t){if(!t.ID){return}t.node=BX(t.ID);if(!t.node){return}BX.bind(t.node,"click",this.onButtonClick.bind(this,t))},onButtonClick:function(t,i){BX.onCustomEvent(this,"button-click",[t]);if(t.WAIT){BX.addClass(BX(t.ID),"ui-btn-wait")}if(this.isFrame&&(t.TYPE==="close"||t.TYPE==="cancel")){i.preventDefault();top.BX.SidePanel.Instance.close()}}};BX.UI.ButtonPanel=new t})();
/* End */
;; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575*/
; /* /bitrix/components/bitrix/crm.button.edit/templates/.default/script.min.js?154412740034209*/
; /* /bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?1544127465770*/

//# sourceMappingURL=page_5de78ee0b72f9c22213798e483437ca2.map.js