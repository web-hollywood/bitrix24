
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/crm.config.status/templates/.default/script.min.js?154412740127114";s:6:"source";s:72:"/bitrix/components/bitrix/crm.config.status/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.CrmConfigStatusClass=function(){var t=function(t){this.randomString=t.randomString;this.tabs=t.tabs;this.ajaxUrl=t.ajaxUrl;this.data=t.data;this.oldData=BX.clone(this.data);this.max_sort={};this.requestIsRunning=false;this.totalNumberFields=t.totalNumberFields;this.checkSubmit=false;this.defaultColor="#ACE9FB";this.defaultFinalSuccessColor="#DBF199";this.defaultFinalUnSuccessColor="#FFBEBD";this.defaultLineColor="#D3EEF9";this.textColorLight="#FFF";this.textColorDark="#545C69";this.entityId=t.entityId;this.hasSemantics=!!t.hasSemantics;this.jsClass="CrmConfigStatusClass_"+t.randomString;this.contentIdPrefix="content_";this.contentClass="crm-status-content";this.contentActiveClass="crm-status-content active";this.fieldNameIdPrefix="field-name-";this.fieldEditNameIdPrefix="field-edit-name-";this.fieldHiddenNameIdPrefix="field-hidden-name-";this.spanStoringNameIdPrefix="field-title-inner-";this.mainDivStorageFieldIdPrefix="field-phase-";this.fieldSortHiddenIdPrefix="field-sort-";this.fieldHiddenNumberIdPrefix="field-number-";this.extraStorageFieldIdPrefix="extra-storage-";this.finalSuccessStorageFieldIdPrefix="final-success-storage-";this.finalStorageFieldIdPrefix="final-storage-";this.previouslyScaleIdPrefix="previously-scale-";this.previouslyScaleNumberIdPrefix="previously-scale-number-";this.previouslyScaleFinalSuccessIdPrefix="previously-scale-final-success-";this.previouslyScaleNumberFinalSuccessIdPrefix="previously-scale-number-final-success-";this.previouslyScaleFinalUnSuccessIdPrefix="previously-scale-final-un-success-";this.previouslyScaleNumberFinalUnSuccessIdPrefix="previously-scale-number-final-un-success-";this.previouslyScaleFinalCellIdPrefix="previously-scale-final-cell-";this.previouslyScaleNumberFinalCellIdPrefix="previously-scale-number-final-cell-";this.funnelSuccessIdPrefix="config-funnel-success-";this.funnelUnSuccessIdPrefix="config-funnel-unsuccess-";this.successFields=t.successFields;this.unSuccessFields=t.unSuccessFields;this.initialFields=t.initialFields;this.extraFields=t.extraFields;this.finalFields=t.finalFields;this.extraFinalFields=t.extraFinalFields;this.dataFunnel=[];this.colorFunnel=[];this.initAmChart=false;this.footer=BX("crm-configs-footer");this.windowSize={};this.scrollPosition={};this.contentPosition={};this.footerPosition={};this.limit=0;this.footerFixed=true;this.blockFixed=!!t.blockFixed;this.dragStartParentElement=null;this.initAmCharts();this.showError();this.init()};t.prototype.selectTab=function(e){var i=BX(this.contentIdPrefix+e);if(i.className==this.contentActiveClass)return;for(var s=0,a=this.tabs.length;s<a;s++){var n=BX(this.contentIdPrefix+this.tabs[s]);if(n.className==this.contentActiveClass){this.showTab(this.tabs[s],false);n.className=this.contentClass;break}}this.showTab(e,true);i.className=this.contentActiveClass;BX("ACTIVE_TAB").value="status_tab_"+e;this.entityId=e;this.hasSemantics=t.hasSemantics(this.entityId);this.processingFooter();if(this.hasSemantics){AmCharts.handleLoad()}};t.prototype.showTab=function(t,e){var i=e?"status_tab_active":"";BX("status_tab_"+t).className="status_tab "+i};t.prototype.statusReset=function(){BX("ACTION").value="reset";document.forms["crmStatusForm"].submit()};t.prototype.recoveryName=function(t,e){var i=this.searchElement("input",this.fieldHiddenNumberIdPrefix+t),s=this.searchElement("span",this.fieldNameIdPrefix+t),a=this.searchElement("input",this.fieldHiddenNameIdPrefix+t);s.innerHTML=BX.util.htmlspecialchars(i.value+". "+e);a.value=e;this.data[this.entityId][t].NAME=e;if(this.initAmChart){this.recalculateSort()}};t.prototype.editField=function(t){var e,i=this.searchElement("div",this.mainDivStorageFieldIdPrefix+t),s=this.searchElement("span",this.spanStoringNameIdPrefix+t),a=this.searchElement("span",this.fieldNameIdPrefix+t),n=this.searchElement("input",this.fieldHiddenNameIdPrefix+t);if(!n){return}e=BX.create("span",{props:{className:"transaction-stage-phase-title-input-container"},children:[BX.create("input",{props:{id:this.fieldEditNameIdPrefix+t},attrs:{type:"text",value:n.value,onkeydown:'if (event.keyCode==13) {BX["'+this.jsClass+"\"].saveFieldValue('"+t+"', this);}",onblur:'BX["'+this.jsClass+"\"].saveFieldValue('"+t+"', this);","data-onblur":"1"}})]});s.style.width="100%";i.setAttribute("ondblclick","");a.innerHTML="";a.appendChild(e);var r=this.searchElement("input",this.fieldEditNameIdPrefix+t);r.focus();r.selectionStart=BX(this.fieldEditNameIdPrefix+t+"").value.length};t.prototype.openPopupBeforeDeleteField=function(t){if(isNaN(parseInt(t))){this.deleteField(t);return}var e="";if(this.hasSemantics){e=BX.message("CRM_STATUS_DELETE_FIELD_QUESTION")}if(!BX.type.isNotEmptyString(e)){e=BX.message("CRM_STATUS_DELETE_FIELD_QUESTION")}var i=BX.create("p",{props:{className:"bx-crm-popup-paragraph"},html:e});this.modalWindow({modalId:"bx-crm-popup",title:BX.message("CRM_STATUS_CONFIRMATION_DELETE_TITLE"),overlay:false,content:[i],events:{onPopupClose:function(){this.destroy()},onAfterPopupShow:function(t){var e=BX.findChild(t.contentContainer,{className:"bx-crm-popup-title"},true);if(e){e.style.cursor="move";BX.bind(e,"mousedown",BX.proxy(t._startDrag,t))}}},buttons:[BX.create("a",{text:BX.message("CRM_STATUS_CONFIRMATION_DELETE_CANCEL_BUTTON"),props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().close()},this)}}),BX.create("a",{text:BX.message("CRM_STATUS_CONFIRMATION_DELETE_SAVE_BUTTON"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(e){this.deleteField(t);BX.PopupWindowManager.getCurrentPopup().close()},this)}})]})};t.prototype.deleteField=function(t){var e=this.searchElement("div",this.mainDivStorageFieldIdPrefix+t),i=e.parentNode;var s=BX.create("input",{attrs:{type:"hidden",value:t,name:"LIST["+this.entityId+"][REMOVE]["+t+"][FIELD_ID]"}});BX(this.contentIdPrefix+this.entityId).appendChild(s);i.removeChild(e);this.recalculateSort()};t.prototype.modalWindow=function(t){t=t||{};t.title=t.title||false;t.bindElement=t.bindElement||null;t.overlay=typeof t.overlay=="undefined"?true:t.overlay;t.autoHide=t.autoHide||false;t.closeIcon=typeof t.closeIcon=="undefined"?{right:"20px",top:"10px"}:t.closeIcon;t.modalId=t.modalId||"crm"+(Math.random()*(2e5-100)+100);t.withoutContentWrap=typeof t.withoutContentWrap=="undefined"?false:t.withoutContentWrap;t.contentClassName=t.contentClassName||"";t.contentStyle=t.contentStyle||{};t.content=t.content||[];t.buttons=t.buttons||false;t.events=t.events||{};t.withoutWindowManager=!!t.withoutWindowManager||false;var e=[];if(t.title){e.push(BX.create("div",{props:{className:"bx-crm-popup-title"},text:t.title}))}if(t.withoutContentWrap){e=e.concat(t.content)}else{e.push(BX.create("div",{props:{className:"bx-crm-popup-content "+t.contentClassName},style:t.contentStyle,children:t.content}))}var i=[];if(t.buttons){for(var s in t.buttons){if(!t.buttons.hasOwnProperty(s)){continue}if(s>0){i.push(BX.create("SPAN",{html:"&nbsp;"}))}i.push(t.buttons[s])}e.push(BX.create("div",{props:{className:"bx-crm-popup-buttons"},children:i}))}var a=BX.create("div",{props:{className:"bx-crm-popup-container"},children:e});t.events.onPopupShow=BX.delegate(function(){if(i.length){firstButtonInModalWindow=i[0];BX.bind(document,"keydown",BX.proxy(this._keyPress,this))}if(t.events.onPopupShow)BX.delegate(t.events.onPopupShow,BX.proxy_context)},this);var n=t.events.onPopupClose;t.events.onPopupClose=BX.delegate(function(){firstButtonInModalWindow=null;try{BX.unbind(document,"keydown",BX.proxy(this._keypress,this))}catch(t){}if(n){BX.delegate(n,BX.proxy_context)()}if(t.withoutWindowManager){delete windowsWithoutManager[t.modalId]}BX.proxy_context.destroy()},this);var r;if(t.withoutWindowManager){if(!!windowsWithoutManager[t.modalId]){return windowsWithoutManager[t.modalId]}r=new BX.PopupWindow(t.modalId,t.bindElement,{content:a,closeByEsc:true,closeIcon:t.closeIcon,autoHide:t.autoHide,overlay:t.overlay,events:t.events,buttons:[],zIndex:isNaN(t["zIndex"])?0:t.zIndex});windowsWithoutManager[t.modalId]=r}else{r=BX.PopupWindowManager.create(t.modalId,t.bindElement,{content:a,closeByEsc:true,closeIcon:t.closeIcon,autoHide:t.autoHide,overlay:t.overlay,events:t.events,buttons:[],zIndex:isNaN(t["zIndex"])?0:t.zIndex})}r.show();return r};t.prototype.saveFieldValue=function(t,e){var i="",s=e.value,a=this.searchElement("input",this.fieldHiddenNumberIdPrefix+t),n=this.searchElement("span",this.fieldNameIdPrefix+t),r=this.searchElement("div",this.mainDivStorageFieldIdPrefix+t),l=this.searchElement("span",this.spanStoringNameIdPrefix+t),o=this.searchElement("input",this.fieldHiddenNameIdPrefix+t);i+=a.value+". "+s;e.onblur="";if(s==""){if(a.value==1){s=this.data[this.entityId][t].NAME_INIT}else{var d=BX.message("CRM_STATUS_NEW");if(this.hasSemantics){d=BX.message("CRM_STATUS_NEW_"+this.entityId)}s=d}}n.innerHTML=BX.util.htmlspecialchars(i);r.setAttribute("ondblclick",'BX["'+this.jsClass+"\"].editField('"+t+"');");l.style.width="";o.value=s;this.data[this.entityId][t].NAME=s;if(this.initAmChart){this.recalculateSort()}};t.prototype.searchElement=function(t,e){var i=BX.findChildren(BX(this.contentIdPrefix+this.entityId),{tag:t,attribute:{id:e}},true);if(i[0]){return i[0]}return null};t.prototype.addField=function(t){var e=t.parentNode,i=1,s=this.defaultColor,a=BX.message("CRM_STATUS_NEW");if(e.id=="final-storage-"+this.entityId){s=this.defaultFinalUnSuccessColor;this.addCellFinalScale()}else{this.addCellMainScale()}for(var n in this.data[this.entityId]){i++}if(this.hasSemantics){a=BX.message("CRM_STATUS_NEW_"+this.entityId)}else{s=this.defaultLineColor}var r="n"+i;this.data[this.entityId][r]={ID:r,SORT:10,NAME:a,ENTITY_ID:this.entityId,COLOR:s};e.insertBefore(this.createStructureHtml(r),t);this.recalculateSort();this.editField(r)};t.prototype.recalculateSort=function(){var t,e;var i=BX.findChildren(BX(this.contentIdPrefix+this.entityId),{tag:"div",attribute:{"data-calculate":"1"}},true);if(!i){return}for(var s=0;s<i.length;s++){e=i[s].parentNode.id;if(e==this.extraStorageFieldIdPrefix+this.entityId){i[s].setAttribute("data-success","1")}else if(e==this.finalStorageFieldIdPrefix+this.entityId){i[s].setAttribute("data-success","0")}var a=s+1;var n=a*10;t=i[s].getAttribute("id").replace(this.mainDivStorageFieldIdPrefix,"");var r=BX.findChildren(i[s],{tag:"input",attribute:{"data-onblur":"1"}},true);if(r.length){this.saveFieldValue(t,r[0])}i[s].setAttribute("data-sort",""+n+"");var l=this.searchElement("span",this.fieldNameIdPrefix+t),o=this.searchElement("input",this.fieldHiddenNameIdPrefix+t),d=this.searchElement("input",this.fieldHiddenNumberIdPrefix+t),h=this.searchElement("input",this.fieldSortHiddenIdPrefix+t);l.innerHTML=BX.util.htmlspecialchars(a+". "+o.value);d.value=a;h.value=n;this.data[this.entityId][t].SORT=n}if(this.initAmChart&&this.hasSemantics){var c=BX.findChildren(BX(this.contentIdPrefix+this.entityId),{tag:"div",attribute:{"data-success":"1"}},true);if(c){this.successFields[this.entityId]=[];for(var u=0;u<c.length;u++){t=c[u].getAttribute("id").replace(this.mainDivStorageFieldIdPrefix,"");this.successFields[this.entityId][u]=this.data[this.entityId][t]}}var f=BX.findChildren(BX(this.contentIdPrefix+this.entityId),{tag:"div",attribute:{"data-success":"0"}},true);if(c){this.unSuccessFields[this.entityId]=[];for(var p=0;p<f.length;p++){t=f[p].getAttribute("id").replace(this.mainDivStorageFieldIdPrefix,"");this.unSuccessFields[this.entityId][p]=this.data[this.entityId][t]}}AmCharts.handleLoad()}this.changeCellScale()};t.prototype.changeCellScale=function(){if(!this.hasSemantics){return}if(!this.successFields[this.entityId]||!this.unSuccessFields[this.entityId]){return}var t=BX.findChildren(BX(this.previouslyScaleIdPrefix+this.entityId),{tag:"td",attribute:{"data-scale-type":"main"}},true),e=BX.findChildren(BX(this.previouslyScaleNumberIdPrefix+this.entityId),{tag:"td",attribute:{"data-scale-type":"main"}},true),i=BX.findChildren(BX(this.previouslyScaleFinalSuccessIdPrefix+this.entityId),{tag:"td"},true),s=BX.findChildren(BX(this.previouslyScaleNumberFinalSuccessIdPrefix+this.entityId),{tag:"td"},true);var a=this.successFields[this.entityId].length-1,n=t.length;if(a>n){for(var r=n;r<a;r++){this.addCellMainScale()}this.changeCellScale();return}else if(a<n){this.deleteCellMainScale(n-a);this.changeCellScale();return}var l,o;for(var d=0;d<a;d++){if(t[d]&&e[d]){if(this.successFields[this.entityId][d].COLOR){o=this.successFields[this.entityId][d].COLOR}else{o=this.defaultColor}t[d].style.background=o;l=d+1;e[d].getElementsByTagName("span")[0].innerHTML=l}}if(i[0]&&s[0]){if(this.successFields[this.entityId][a].COLOR){o=this.successFields[this.entityId][a].COLOR}else{o=this.defaultFinalSuccessColor}l++;i[0].style.background=o;s[0].getElementsByTagName("span")[0].innerHTML=l}var h=BX.findChildren(BX(this.previouslyScaleFinalUnSuccessIdPrefix+this.entityId),{tag:"td"},true),c=BX.findChildren(BX(this.previouslyScaleNumberFinalUnSuccessIdPrefix+this.entityId),{tag:"td"},true);var u=this.unSuccessFields[this.entityId].length,f=h.length;if(u>f){for(var p=f;p<u;p++){this.addCellFinalScale()}this.changeCellScale();return}else if(u<f){this.deleteCellFinalScale(f-u);this.changeCellScale();return}for(var m=0;m<u;m++){if(h[m]&&c[m]){if(this.unSuccessFields[this.entityId][m].COLOR){o=this.unSuccessFields[this.entityId][m].COLOR}else{o=this.defaultFinalUnSuccessColor}h[m].style.background=o;l++;c[m].getElementsByTagName("span")[0].innerHTML=l}}};t.prototype.addCellMainScale=function(){if(!this.hasSemantics){return}var t=BX.findChildren(BX(this.previouslyScaleNumberIdPrefix+this.entityId),{tag:"td",attribute:{"data-scale-type":"main"}},true),e=BX.create("td",{attrs:{"data-scale-type":"main"},html:"&nbsp;"}),i=BX.create("td",{attrs:{"data-scale-type":"main"},children:[BX.create("span",{props:{className:"stage-name"},html:t.length})]});BX(this.previouslyScaleIdPrefix+this.entityId).insertBefore(e,BX(this.previouslyScaleFinalCellIdPrefix+this.entityId));BX(this.previouslyScaleNumberIdPrefix+this.entityId).insertBefore(i,BX(this.previouslyScaleNumberFinalCellIdPrefix+this.entityId))};t.prototype.addCellFinalScale=function(){if(!this.hasSemantics){return}var t=BX.findChildren(BX(this.previouslyScaleNumberFinalUnSuccessIdPrefix+this.entityId),{tag:"td"},true),e=BX.create("td",{html:"&nbsp;"}),i=BX.create("td",{children:[BX.create("span",{props:{className:"stage-name"},html:t.length})]});BX(this.previouslyScaleFinalUnSuccessIdPrefix+this.entityId).appendChild(e);BX(this.previouslyScaleNumberFinalUnSuccessIdPrefix+this.entityId).appendChild(i)};t.prototype.deleteCellMainScale=function(t){if(!this.hasSemantics){return}var e=BX.findChildren(BX(this.previouslyScaleIdPrefix+this.entityId),{tag:"td",attribute:{"data-scale-type":"main"}},true),i=BX.findChildren(BX(this.previouslyScaleNumberIdPrefix+this.entityId),{tag:"td",attribute:{"data-scale-type":"main"}},true);for(var s=0;s<t;s++){BX(this.previouslyScaleIdPrefix+this.entityId).removeChild(e[s]);BX(this.previouslyScaleNumberIdPrefix+this.entityId).removeChild(i[s])}};t.prototype.deleteCellFinalScale=function(t){if(!this.hasSemantics){return}var e=BX.findChildren(BX(this.previouslyScaleFinalUnSuccessIdPrefix+this.entityId),{tag:"td"},true),i=BX.findChildren(BX(this.previouslyScaleNumberFinalUnSuccessIdPrefix+this.entityId),{tag:"td"},true);for(var s=0;s<t;s++){BX(this.previouslyScaleFinalUnSuccessIdPrefix+this.entityId).removeChild(e[s]);BX(this.previouslyScaleNumberFinalUnSuccessIdPrefix+this.entityId).removeChild(i[s])}};t.prototype.createStructureHtml=function(t){var e,i=this.data[this.entityId][t];var s="",a=this.textColorDark,n="",r;if(this.hasSemantics){s="light-icon";a=this.textColorLight;n="transaction-stage-phase-dark";r=BX.create("div",{props:{className:"transaction-stage-phase-panel-button"},attrs:{onclick:'BX["'+this.jsClass+"\"].correctionColorPicker(event, '"+i.ID+"');"}})}e=BX.create("div",{props:{id:this.mainDivStorageFieldIdPrefix+i.ID,className:"transaction-stage-phase draghandle"},attrs:{ondblclick:'BX["'+this.jsClass+"\"].editField('"+i.ID+"');","data-sort":i.SORT,"data-calculate":1,"data-space":i.ID,style:"background: "+i.COLOR+"; color:"+a+";"},children:[BX.create("div",{props:{id:"phase-panel",className:n+" transaction-stage-phase-panel"},attrs:{"data-class":"transaction-stage-phase-panel"},children:[r,BX.create("div",{props:{className:"transaction-stage-phase-panel-button "+"transaction-stage-phase-panel-button-close"},attrs:{onclick:'BX["'+this.jsClass+"\"].openPopupBeforeDeleteField('"+i.ID+"');"}})]}),BX.create("span",{props:{id:"transaction-stage-phase-icon",className:s+" transaction-stage-phase-icon transaction-stage-phase-icon-move draggable"},attrs:{"data-class":"transaction-stage-phase-icon transaction-stage-phase-icon-move draggable"},children:[BX.create("span",{props:{className:"transaction-stage-phase-icon-burger"}})]}),BX.create("span",{props:{id:"phase-panel",className:n+" transaction-stage-phase-title"},attrs:{"data-class":"transaction-stage-phase-title"},children:[BX.create("span",{props:{id:this.spanStoringNameIdPrefix+i.ID,className:"transaction-stage-phase-title-inner"},children:[BX.create("span",{props:{id:this.fieldNameIdPrefix+i.ID,className:"transaction-stage-phase-name"},html:i.ID+". "+BX.util.htmlspecialchars(i.NAME)}),BX.create("span",{props:{className:"transaction-stage-phase-icon-edit"},attrs:{onclick:'BX["'+this.jsClass+"\"].editField('"+i.ID+"')"}})]})]}),BX.create("input",{props:{id:this.fieldHiddenNumberIdPrefix+i.ID},attrs:{type:"hidden",value:i.ID}}),BX.create("input",{props:{id:this.fieldSortHiddenIdPrefix+i.ID},attrs:{type:"hidden",name:"LIST["+this.entityId+"]["+i.ID+"][SORT]",value:i.SORT}}),BX.create("input",{props:{id:this.fieldHiddenNameIdPrefix+i.ID},attrs:{type:"hidden",name:"LIST["+this.entityId+"]["+i.ID+"][VALUE]",value:BX.util.htmlspecialchars(i.NAME)}}),BX.create("input",{props:{id:"stage-color-"+i.ID},attrs:{type:"hidden",name:"LIST["+this.entityId+"]["+i.ID+"][COLOR]",value:i.COLOR}}),BX.create("input",{props:{id:"stage-status-id-"+i.ID},attrs:{type:"hidden",name:"LIST["+this.entityId+"]["+i.ID+"][STATUS_ID]","data-status-id":"1",value:this.getNewStatusId()}})]});return e};t.prototype.getNewStatusId=function(){var t=0;var e=BX.findChildren(BX(this.contentIdPrefix+this.entityId),{tag:"input",attribute:{"data-status-id":"1"}},true);if(!e)return t;for(var i=0;i<e.length;i++){var s=+e[i].value;if(!isNaN(s)){if(s>t){t=s}}}t=t+1;return t};t.prototype.showPlaceToInsert=function(t,e){if(t.className=="space-to-insert draghandle"){return}var i=t.parentNode,s=t.getAttribute("data-space");var a=this.getDragStartParentElement(),n=null;if(a){n=a.id.replace(this.entityId,"")}if(n){switch(n){case"final-storage-":if(i.id.indexOf("extra-storage-")!==-1){return}break;case"extra-storage-":if(i.id.indexOf("final-storage-")!==-1){return}break}}var r=BX.create("div",{props:{id:"space-to-insert-"+s,className:"space-to-insert draghandle"},attrs:{"data-place":"1"}});var l=getCoords(t);var o=e.pageY-l.top;var d=t.offsetHeight/2;if(o>d){if(t.className=="transaction-stage-addphase draghandle"){return}this.deleteSpaceToInsert();this.insertAfter(r,t)}else{this.deleteSpaceToInsert();i.insertBefore(r,t)}};t.prototype.setDragStartParentElement=function(t){this.dragStartParentElement=t};t.prototype.getDragStartParentElement=function(){return this.dragStartParentElement};t.prototype.putDomElement=function(t,e,i){if(!t||!e||!i){return false}var s=e.id.replace(this.entityId,""),a=this.getDragStartParentElement();switch(s){case"final-storage-":if(a&&a.id.indexOf("extra-storage-")!==-1){return false}break;case"extra-storage-":if(a&&a.id.indexOf("final-storage-")!==-1){return false}break}e.insertBefore(t,i);return true};t.prototype.deleteSpaceToInsert=function(){var t=BX.findChildren(BX("crm-container"),{tag:"div",attribute:{"data-place":"1"}},true);if(t){for(var e=0;e<t.length;e++){var i=t[e].parentNode;i.removeChild(t[e])}}};t.prototype.insertAfter=function(t,e){if(!t||!e)return;var i=e.parentNode,s=e.nextSibling;if(s&&i){i.insertBefore(t,e.nextSibling)}else if(i){i.appendChild(t)}};t.prototype.checkChanges=function(){if(this.checkSubmit){return}var t=0,e=false;for(var i in this.data){for(var s in this.data[i]){t++;var a=parseInt(this.data[i][s].SORT),n=parseInt(this.oldData[i][s].SORT),r=this.data[i][s].NAME.toLowerCase(),l=this.oldData[i][s].NAME.toLowerCase(),o=this.data[i][s].COLOR.toLowerCase(),d=this.oldData[i][s].COLOR.toLowerCase();if(a!==n||r!==l||o!==d){e=true;break}}}if(this.totalNumberFields!==t||e){return BX.message("CRM_STATUS_CHECK_CHANGES")}};t.prototype.confirmSubmit=function(){this.checkSubmit=true};t.prototype.fixStatuses=function(){if(this.requestIsRunning){return}this.requestIsRunning=true;if(this.ajaxUrl===""){throw"Error: Service URL is not defined."}BX.ajax({url:this.ajaxUrl,method:"POST",dataType:"json",data:{ACTION:"FIX_STATUSES"},onsuccess:BX.delegate(function(){this.requestIsRunning=false;window.location.reload(true)},this),onfailure:BX.delegate(function(){this.requestIsRunning=false},this)})};t.prototype.correctionColorPicker=function(t,e){if(!e){return}var i=BX("block-color-picker");i.style.left=t.pageX+"px";i.style.top=t.pageY+"px";var s=BX.findChildren(BX("block-color-picker"),{tag:"IMG"},true)[0];s.setAttribute("data-img",e);s.onclick()};t.prototype.paintElement=function(t,e){if(!e){return}var i=e.pWnd.getAttribute("data-img");var s=BX.findChildren(BX(this.contentIdPrefix+this.entityId),{tag:"div",attribute:{id:this.mainDivStorageFieldIdPrefix+i}},true);if(s.length){if(!t&&s[0].parentNode.id==this.finalStorageFieldIdPrefix+this.entityId){t=this.defaultFinalUnSuccessColor}else if(!t&&s[0].parentNode.id==this.finalSuccessStorageFieldIdPrefix+this.entityId){t=this.defaultFinalSuccessColor}else if(!t){t=this.defaultColor}if(!this.hasSemantics){t=this.defaultLineColor}s[0].style.background=t;var a=BX.findChildren(s[0],{tag:"span",attribute:{id:"transaction-stage-phase-icon"}},true);var n=BX.findChildren(s[0],{attribute:{id:"phase-panel"}},true);if(a.length&&n.length){BX.ajax({url:this.ajaxUrl,method:"POST",dataType:"json",data:{ACTION:"GET_COLOR",COLOR:t},onsuccess:BX.delegate(function(t){s[0].style.color=t.COLOR;a[0].className=t.ICON_CLASS+" "+a[0].getAttribute("data-class");for(var e in n){n[e].className=t.BLOCK_CLASS+" "+n[e].getAttribute("data-class")}},this)})}}else{return}var r=BX.findChildren(BX(this.contentIdPrefix+this.entityId),{tag:"input",attribute:{id:"stage-color-"+i}},true);if(r[0]){r[0].value=t}this.data[this.entityId][i].COLOR=t;this.recalculateSort()};t.prototype.initAmCharts=function(){this.initAmChart=true;if(AmCharts.isReady){this.renderAmCharts()}else{AmCharts.ready(BX.delegate(this.renderAmCharts,this))}if(this.hasSemantics){AmCharts.handleLoad()}};t.prototype.renderAmCharts=function(){var t=[];for(var e in this.initialFields){t.push(BX(this.funnelSuccessIdPrefix+e));t.push(BX(this.funnelUnSuccessIdPrefix+e))}if(!t.length){return}for(var i=0;i<t.length;i++){if(!t[i].id)continue;this.getDataForAmCharts(t[i].id);var s=AmCharts.makeChart(t[i].id,{type:"funnel",theme:"none",titleField:"title",valueField:"value",dataProvider:this.dataFunnel,colors:this.colorFunnel,labelsEnabled:false,marginRight:35,marginLeft:35,labelPosition:"center",funnelAlpha:.9,startX:200,neckWidth:"40%",startAlpha:0,depth3D:100,angle:10,outlineAlpha:1,outlineColor:"#FFFFFF",outlineThickness:1,neckHeight:"30%",balloonText:"[[title]]",export:{enabled:true}})}};t.prototype.getDataForAmCharts=function(t){var e=[],i="",s=false;if(t==this.funnelSuccessIdPrefix+this.entityId){e=this.successFields[this.entityId];i=this.defaultColor;s=true}else if(t==this.funnelUnSuccessIdPrefix+this.entityId){e=this.unSuccessFields[this.entityId];i=this.defaultFinalUnSuccessColor}this.dataFunnel=[];this.colorFunnel=[];for(var a=0;a<e.length;a++){if(a==e.length-1&&s){i=this.defaultFinalSuccessColor}this.dataFunnel[a]={title:BX.util.htmlspecialchars(e[a].NAME),value:1};if(e[a].COLOR){this.colorFunnel[a]=e[a].COLOR}else{this.colorFunnel[a]=i}}};t.prototype.showError=function(){var t=this.getParameterByName("ERROR");if(t){var e=BX.create("p",{props:{className:"bx-crm-popup-paragraph"},html:BX.util.htmlspecialchars(t)});this.modalWindow({modalId:"bx-crm-popup",title:BX.message("CRM_STATUS_REMOVE_ERROR"),overlay:false,content:[e],events:{onPopupClose:function(){this.destroy()},onAfterPopupShow:function(t){var e=BX.findChild(t.contentContainer,{className:"bx-crm-popup-title"},true);if(e){e.style.cursor="move";BX.bind(e,"mousedown",BX.proxy(t._startDrag,t))}}},buttons:[BX.create("a",{text:BX.message("CRM_STATUS_CLOSE_POPUP_REMOVE_ERROR"),props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().close()},this)}})]})}};t.prototype.getParameterByName=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return i===null?"":decodeURIComponent(i[1].replace(/\+/g," "))};t.prototype.init=function(){var t=BX("crm-configs-footer");if(!t){return}BX.addCustomEvent(t,"onFooterChangeState",BX.delegate(function(e){if(e){BX.removeClass(t,"crm-configs-footer");BX.addClass(t,"webform-buttons-fixed")}else{BX.addClass(t,"crm-configs-footer");BX.removeClass(t,"webform-buttons-fixed")}},this));BX.bind(window,"scroll",BX.proxy(this.processingFooter,this));this.processingFooter();if(!this.blockFixed){BX.onCustomEvent(this.footer,"onFooterChangeState",[false])}};t.prototype.processingFooter=function(){if(!this.footer||!this.blockFixed){return}this.windowSize=BX.GetWindowInnerSize();this.scrollPosition=BX.GetWindowScrollPos();this.contentPosition=BX.pos(BX(this.contentIdPrefix+this.entityId));this.footerPosition=BX.pos(this.footer);this.limit=this.contentPosition.top;var t=this.scrollPosition.scrollTop+this.windowSize.innerHeight;var e=this.contentPosition.bottom+this.footerPosition.height;if(this.limit>0&&t<this.limit){this.footerFixed=false}else if(!this.footerFixed&&t<e){this.footerFixed=true}else if(this.footerFixed&&t>=e){this.footerFixed=false}BX.onCustomEvent(this.footer,"onFooterChangeState",[this.footerFixed]);var i=parseInt(BX.style(this.footer,"paddingLeft"));this.footer.style.left=this.contentPosition.left+"px";this.footer.style.width=this.contentPosition.width-i*2+"px"};t.prototype.fixFooter=function(t){this.blockFixed=!this.blockFixed;if(this.blockFixed){BX.userOptions.save("crm","crm_config_status","fix_footer","on");BX.addClass(t,"crm-fixedbtn-pin");t.setAttribute("title",BX.message("CRM_STATUS_FOOTER_PIN_OFF"));this.processingFooter()}else{BX.userOptions.save("crm","crm_config_status","fix_footer","off");BX.removeClass(t,"crm-fixedbtn-pin");t.setAttribute("title",BX.message("CRM_STATUS_FOOTER_PIN_ON"));BX.onCustomEvent(this.footer,"onFooterChangeState",[false])}};t.semanticEntityTypes=[];t.hasSemantics=function(t){var e=this.semanticEntityTypes;if(!BX.type.isArray(e)){return false}for(var i=0,s=e.length;i<s;i++){if(e[i]===t){return true}}return false};return t}();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/crm.config.status/templates/.default/drag_and_drop.min.js?15441274012278";s:6:"source";s:79:"/bitrix/components/bitrix/crm.config.status/templates/.default/drag_and_drop.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var DragManager=new function(){var t={};var e=this;function n(t){if(t==null)return null;if(!t.closest){t.closest=function(t){var e=this;while(e){if(!e.matches){e.matches=e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector}if(e.matches(t))return e;else e=e.parentElement}return null}}return t}function a(e){if(e.which!=1)return;var a=n(e.target);if(!a)return;var r=a.closest(".draggable");if(!r)return;if(!r.parentNode.className.match(/\bdraghandle\b/))return;t.elem=r;t.downX=e.pageX;t.downY=e.pageY;return false}function r(n){if(!t.elem)return;if(!t.avatar){var a=n.pageX-t.downX;var r=n.pageY-t.downY;if(Math.abs(a)<3&&Math.abs(r)<3){return}t.avatar=l(n);if(!t.avatar){t={};return}var o=getCoords(t.avatar);t.shiftX=t.downX-o.left;t.shiftY=t.downY-o.top;s(n)}t.avatar.style.left=n.pageX-t.shiftX+"px";t.avatar.style.top=n.pageY-t.shiftY+"px";var i=u(n);if(!i)return false;e.onDragMove(t,i,n);return false}function o(e){if(t.avatar){i(e)}t={}}function i(n){var a=f(n),r=u(n);if(!a){e.onDragCancel(t)}else{e.onDragEnd(t,a,r)}}function l(e){var n=t.elem.parentNode;var a={parent:n.parentNode,nextSibling:n.nextSibling,position:n.position||"",left:n.left||"",top:n.top||"",zIndex:n.zIndex||""};n.rollback=function(){a.parent.insertBefore(n,a.nextSibling);n.style.position=a.position;n.style.left=a.left;n.style.top=a.top;n.style.zIndex=a.zIndex};n.styleback=function(){n.style.position=a.position;n.style.left=a.left;n.style.top=a.top;n.style.zIndex=a.zIndex};return n}function s(n){e.onDragStart(t);var a=t.avatar;document.body.appendChild(a);a.style.zIndex=9999;a.style.position="absolute"}function f(e){t.avatar.hidden=true;var a=document.elementFromPoint(e.clientX,e.clientY);t.avatar.hidden=false;a=n(a);if(a==null){return null}return a.closest(".droppable")}function u(e){t.avatar.hidden=true;var a=document.elementFromPoint(e.clientX,e.clientY);t.avatar.hidden=false;a=n(a);if(a==null)return null;return a.closest(".draghandle")}document.onmousemove=r;document.onmouseup=o;document.onmousedown=a;this.onDragStart=function(t,e,n){};this.onDragEnd=function(t,e,n){};this.onDragCancel=function(t){};this.onDragMove=function(t,e,n){}};function getCoords(t){var e=t.getBoundingClientRect();return{top:e.top+pageYOffset,left:e.left+pageXOffset}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(i);var r={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};s=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a,o={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"]};a=this.getListItems(t,s);if(a.length){o.items=a}i.push(o);delete t[s]}}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var i;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){i=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",i,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{var s="settings";BX.userOptions.save("ui",this.listContainer.id,s,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.min.js?15441273845080";s:6:"source";s:71:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.map.js";}"*/
function BXColorPicker(o){if(!o.name)o.name=o.id;if(!o.title)o.title=o.name;this.disabled=false;this.bCreated=false;this.bOpened=false;this.zIndex=o.zIndex?o.zIndex:1e3;this.fid=o.id.toLowerCase();this.oPar=o;this.oneGifSrc="/bitrix/images/1.gif";this.BeforeCreate()}BXColorPicker.prototype.BeforeCreate=function(){var o=this;this.pWnd=BX.create("IMG",{props:{src:this.oneGifSrc,title:this.oPar.title,className:"bx-colpic-button bx-colpic-button-normal",id:"bx_btn_"+this.oPar.id.toLowerCase()}});this.pWnd.onmouseover=function(e){o.OnMouseOver(e,this)};this.pWnd.onmouseout=function(e){o.OnMouseOut(e,this)};this.pWnd.onclick=function(e){o.OnClick(e,this)};this.pCont=BX.create("DIV",{props:{className:"bx-colpic-button-cont"}});this.pCont.appendChild(this.pWnd)};BXColorPicker.prototype.Create=function(){var o=this;window["bx_colpic_keypress_"+this.fid]=function(e){o.OnKeyPress(e)};window["bx_colpic_click_"+this.fid]=function(e){o.OnDocumentClick(e)};this.pColCont=document.body.appendChild(BX.create("DIV",{props:{className:"bx-colpic-cont"},style:{zIndex:this.zIndex}}));var e=["#ACE9FB","#BEEDF1","#9AE1DD","#E3F19E","#FFED9A","#FFDD99","#DFD3B7","#E2C6BC","#FEAD99","#FFBDBC","#FFCBD8","#FEC5E4","#C5BBEC","#DBDDE0","#DBF199","#FFBEBD","#3AD0FF","#A6DC00","#FF5C5A","#B47153","#2FC7F7","#04B4AB","#FFA801","#5CD1DF","#6E54D1","#29AD49","#FE5957","#DAA187","#78D4F1","#43DAD2","#EECE8F","#AEE5EC","#FF0000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF","#FFFFFF","#EBEBEB","#E1E1E1","#D7D7D7","#CCCCCC","#C2C2C2","#B7B7B7","#ACACAC","#A0A0A0","#959595","#EE1D24","#FFF100","#00A650","#00AEEF","#2F3192","#ED008C","#898989","#7D7D7D","#707070","#626262","#555555","#464646","#363636","#262626","#111111","#000000","#F7977A","#FBAD82","#FDC68C","#FFF799","#C6DF9C","#A4D49D","#81CA9D","#7BCDC9","#6CCFF7","#7CA6D8","#8293CA","#8881BE","#A286BD","#BC8CBF","#F49BC1","#F5999D","#F16C4D","#F68E54","#FBAF5A","#FFF467","#ACD372","#7DC473","#39B778","#16BCB4","#00BFF3","#438CCB","#5573B7","#5E5CA7","#855FA8","#A763A9","#EF6EA8","#F16D7E","#EE1D24","#F16522","#F7941D","#FFF100","#8FC63D","#37B44A","#00A650","#00A99E","#00AEEF","#0072BC","#0054A5","#2F3192","#652C91","#91278F","#ED008C","#EE105A","#9D0A0F","#A1410D","#A36209","#ABA000","#588528","#197B30","#007236","#00736A","#0076A4","#004A80","#003370","#1D1363","#450E61","#62055F","#9E005C","#9D0039","#790000","#7B3000","#7C4900","#827A00","#3E6617","#045F20","#005824","#005951","#005B7E","#003562","#002056","#0C004B","#30004A","#4B0048","#7A0045","#7A0026"];var t,i,n,s=BX.create("TABLE",{props:{className:"bx-colpic-tbl"}}),c,l=e.length;t=s.insertRow(-1);i=t.insertCell(-1);i.colSpan=8;var r=i.appendChild(BX.create("SPAN",{props:{className:"bx-colpic-def-but"}}));r.innerHTML=window.jsColorPickerMess.DefaultColor;r.onmouseover=function(){this.className="bx-colpic-def-but bx-colpic-def-but-over";n.style.backgroundColor="transparent"};r.onmouseout=function(){this.className="bx-colpic-def-but"};r.onclick=function(e){o.Select(false)};n=t.insertCell(-1);n.colSpan=8;n.className="bx-color-inp-cell";n.style.backgroundColor=e[38];for(c=0;c<l;c++){if(Math.round(c/16)==c/16)t=s.insertRow(-1);i=t.insertCell(-1);i.innerHTML="&nbsp;";i.className="bx-colpic-col-cell";i.style.backgroundColor=e[c];i.id="bx_color_id__"+c;i.onmouseover=function(o){this.className="bx-colpic-col-cell bx-colpic-col-cell-over";n.style.backgroundColor=e[this.id.substring("bx_color_id__".length)]};i.onmouseout=function(o){this.className="bx-colpic-col-cell"};i.onclick=function(t){var i=this.id.substring("bx_color_id__".length);o.Select(e[i])}}this.pColCont.appendChild(s);this.bCreated=true};BXColorPicker.prototype.OnClick=function(o,e){if(this.disabled)return false;if(!this.bCreated)this.Create();if(this.bOpened)return this.Close();this.Open()};BXColorPicker.prototype.Open=function(){var o=BX.align(this.pWnd,240,130),e=this;BX.bind(window,"keypress",window["bx_colpic_keypress_"+this.fid]);BX.defer(function(){BX.bind(window,"click",window["bx_colpic_click_"+e.fid])})();this.pColCont.style.display="block";this.pColCont.style.top=o.top+"px";this.pColCont.style.left=o.left+"px";this.bOpened=true};BXColorPicker.prototype.Close=function(){this.pColCont.style.display="none";BX.unbind(window,"keypress",window["bx_colpic_keypress_"+this.fid]);BX.unbind(window,"click",window["bx_colpic_click_"+this.fid]);this.bOpened=false};BXColorPicker.prototype.OnMouseOver=function(o,e){if(this.disabled)return;e.className="bx-colpic-button bx-colpic-button-over"};BXColorPicker.prototype.OnMouseOut=function(o,e){if(this.disabled)return;e.className="bx-colpic-button bx-colpic-button-normal"};BXColorPicker.prototype.OnKeyPress=function(o){if(!o)o=window.event;if(o.keyCode==27)this.Close()};BXColorPicker.prototype.OnDocumentClick=function(o){if(!o)o=window.event;var e=o.target||o.srcElement;if(e&&!BX.findParent(e,{className:"bx-colpic-cont"}))this.Close()};BXColorPicker.prototype.Select=function(o){if(this.oPar.OnSelect&&typeof this.oPar.OnSelect=="function")this.oPar.OnSelect(o,this);this.Close()};
/* End */
;; /* /bitrix/components/bitrix/crm.config.status/templates/.default/script.min.js?154412740127114*/
; /* /bitrix/components/bitrix/crm.config.status/templates/.default/drag_and_drop.min.js?15441274012278*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575*/
; /* /bitrix/components/bitrix/main.colorpicker/templates/.default/script.min.js?15441273845080*/

//# sourceMappingURL=page_2464276dc1b9507621d14c2584937847.map.js