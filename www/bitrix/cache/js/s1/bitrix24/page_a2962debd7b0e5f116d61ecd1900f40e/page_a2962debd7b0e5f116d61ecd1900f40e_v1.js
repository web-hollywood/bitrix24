
; /* Start:"a:4:{s:4:"full";s:107:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.group_menu/.default/script.min.js?15441276453524";s:6:"source";s:88:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.group_menu/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){if(!!BX.BXSGM24){return}BX.BXSGM24={currentUserId:null,groupdId:null,userIsMember:null,userIsAutoMember:null,userRole:null,isProject:null,favoritesValue:null,canInitiate:null,canModify:null,editFeaturesAllowed:true};BX.BXSGM24.init=function(e){this.currentUserId=parseInt(e.currentUserId);this.groupId=parseInt(e.groupId);this.userIsMember=!!e.userIsMember;this.userIsAutoMember=!!e.userIsAutoMember;this.userRole=e.userRole;this.isProject=!!e.isProject;this.isOpened=!!e.isOpened;this.favoritesValue=!!e.favoritesValue;this.canInitiate=!!e.canInitiate;this.canModify=!!e.canModify;if(typeof e.urls!="undefined"){this.urls=e.urls}this.editFeaturesAllowed=typeof e.editFeaturesAllowed!="undefined"?!!e.editFeaturesAllowed:true;var t=BX.delegate(function(e){if(BX.type.isNotEmptyString(e.code)){if(BX.util.in_array(e.code,["afterJoinRequestSend","afterEdit"])){if(BX("bx-group-menu-join-cont")){BX("bx-group-menu-join-cont").style.display="none"}BX.SocialnetworkUICommon.reload()}else if(BX.util.in_array(e.code,["afterSetFavorites"])){var t=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();var s=t.favoritesValue;t.setItemTitle(!s);t.favoritesValue=!s}}},this);BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var s=e.getData();t(s)}},this));BX.addCustomEvent("sonetGroupEvent",t);if(BX("bx-group-menu-join")){BX.bind(BX("bx-group-menu-join"),"click",BX.delegate(this.sendJoinRequest,this))}if(BX("bx-group-menu-settings")){var s=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();s.favoritesValue=this.favoritesValue;BX.bind(BX("bx-group-menu-settings"),"click",BX.delegate(function(e){BX.SocialnetworkUICommon.showGroupMenuPopup({bindElement:BX.getEventTarget(e),groupId:this.groupId,userIsMember:this.userIsMember,userIsAutoMember:this.userIsAutoMember,userRole:this.userRole,isProject:this.isProject,isOpened:this.isOpened,editFeaturesAllowed:this.editFeaturesAllowed,perms:{canInitiate:this.canInitiate,canProcessRequestsIn:this.canProcessRequestsIn,canModify:this.canModify},urls:{requestUser:BX.message("SGMPathToRequestUser"),edit:BX.message("SGMPathToEdit"),delete:BX.message("SGMPathToDelete"),features:BX.message("SGMPathToFeatures"),members:BX.message("SGMPathToMembers"),requests:BX.message("SGMPathToRequests"),requestsOut:BX.message("SGMPathToRequestsOut"),userRequestGroup:BX.message("SGMPathToUserRequestGroup"),userLeaveGroup:BX.message("SGMPathToUserLeaveGroup")}});e.preventDefault()},this))}BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var t=e.getData();if(BX.type.isNotEmptyString(t.code)&&typeof t.data!="undefined"&&BX.util.in_array(t.code,["afterDelete","afterLeave"])&&typeof t.data.groupId!="undefined"&&parseInt(t.data.groupId)==this.groupId){top.location.href=this.urls.groupsList}}},this))};BX.BXSGM24.sendJoinRequest=function(e){var t=e.currentTarget;BX.SocialnetworkUICommon.showButtonWait(t);BX.ajax({url:t.getAttribute("bx-request-url"),method:"POST",dataType:"json",data:{groupID:this.groupId,MESSAGE:"",ajax_request:"Y",save:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.SocialnetworkUICommon.hideButtonWait(t);if(typeof e.MESSAGE!="undefined"&&e.MESSAGE=="SUCCESS"&&typeof e.URL!="undefined"){BX.onCustomEvent(window.top,"sonetGroupEvent",[{code:"afterJoinRequestSend",data:{groupId:this.groupId}}]);top.location.href=e.URL}},this),onfailure:BX.delegate(function(){BX.SocialnetworkUICommon.hideButtonWait(t)},this)})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(i);var r={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};s=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a,o={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"]};a=this.getListItems(t,s);if(a.length){o.items=a}i.push(o);delete t[s]}}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var i;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){i=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",i,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{var s="settings";BX.userOptions.save("ui",this.listContainer.id,s,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/disk.folder.list/templates/.default/script.min.js?1544127404101493";s:6:"source";s:71:"/bitrix/components/bitrix/disk.folder.list/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Disk");BX.Disk.FolderListClass=function(){var FolderListClass=function(e){this.layout=e.layout||{};this.errors=e.errors||[];this.showSearchNotice=e.showSearchNotice;this.information=e.information||"";this.currentFolder=e.currentFolder||{};this.gridId=e.gridId;this.isTrashMode=e.isTrashMode;this.filterValueToSkipSearchUnderLinks=e.filterValueToSkipSearchUnderLinks||{};this.filterId=e.filterId;if(BX.Main.gridManager){this.commonGrid=new BX.Disk.Model.FolderList.CommonGrid({instance:BX.Main.gridManager.getById(this.gridId).instance})}else{this.commonGrid=new BX.Disk.Model.FolderList.CommonGrid({instance:BX.Main.tileGridManager.getById(this.gridId).instance})}this.filter=BX.Main.filterManager.getById(this.filterId);this.relativePath=e.relativePath;this.gridShowTreeButton=BX(e.gridShowTreeButton);this.rootObject=e.rootObject||{};this.storage=e.storage||{};this.storage.manage=this.storage.manage||{};this.enabledModZip=e.enabledModZip||false;this.enabledExternalLink=e.enabledExternalLink;this.enabledObjectLock=e.enabledObjectLock;this.getFilesCountAndSize=e.getFilesCountAndSize||{};this.cacheExternalLinks={};this.createBlankFileUrl=e.createBlankFileUrl;this.renameBlankFileUrl=e.renameBlankFileUrl;this.defaultService=e.defaultService;this.defaultServiceLabel=e.defaultServiceLabel;this.sortFields=e.sortFields;this.sort=e.sort;this.actionGroupButton=e.actionGroupButton||"move";this.isBitrix24=e.isBitrix24||false;this.destFormName=e.destFormName||"folder-list-destFormName";this.ajaxUrl="/bitrix/components/bitrix/disk.folder.list/ajax.php";BX.Disk.Page.changeFolder({id:this.currentFolder.id,name:this.currentFolder.name});BX.Disk.Page.changeStorage(this.storage);this.setEvents();window.history.replaceState({disk:true,folder:{id:this.currentFolder.id}},null,document.location.toString());this.workWithLocationHash();this.processCommand();if(this.errors.length)this.showErrors();if(this.information.length)this.showInformation();if(!this.currentFolder.canAdd){this.blockCreateItemsButton()}if(this.needRunFilterUnderLinks()){this.rerunFilter()}};FolderListClass.prototype.rerunFilter=function(){var e=new BX.Promise;this.onFilterApply(this.filter.getParam("FILTER_ID"),{},this.filter,e);e.fulfill()};FolderListClass.prototype.showInformation=function(){BX.Disk.showModalWithStatusAction({status:"success",message:this.information})};FolderListClass.prototype.showErrors=function(){BX.Disk.showModalWithStatusAction({status:"error",errors:this.errors})};FolderListClass.prototype.onHashChange=function(){if(this.commonGrid.isTile()){return}var e=document.location.hash.match(/hl-([0-9]+)/g);if(e){var t=(document.location.hash.match(/!([a-zA-Z]+)/g)||[]).pop();for(var i in e){if(!e.hasOwnProperty(i)){continue}var s=e[i];var o=s.match(/hl-([0-9]+)/);if(o&&o[1]){var n=this.getRow(o[1]);if(n){this.scrollToRow(n);this.runCommandOnObjectId(t,o[1])}else if(t){if(window.BXIM&&BXIM.isOpenNotify()){document.location.reload();BXIM.closeMessenger()}}}}if(window.BXIM&&BXIM.isOpenNotify()){BXIM.closeMessenger()}}};FolderListClass.prototype.processCommand=function(){if(BX.Disk.getUrlParameter("cmd")==="openSliderBp"){if(this.storage.bpListLink){this.openSlider(this.storage.bpListLink)}}};FolderListClass.prototype.workWithLocationHash=function(){setTimeout(BX.delegate(function(){this.onHashChange()},this),350)};FolderListClass.prototype.setEvents=function(){BX.bind(this.getFilesCountAndSize.button,"click",BX.proxy(this.onClickGetFilesCountAndSizeButtonButton,this));BX.bind(BX(this.storage.manage.connectButtonId),"click",BX.proxy(this.onClickManageConnectButton,this));BX.bind(window,"hashchange",BX.proxy(this.onHashChange,this));BX.bindDelegate(this.commonGrid.getContainer(),"click",{className:"js-disk-grid-open-folder"},this.openGridFolder.bind(this));BX.bind(this.sort.layout.label,"click",this.showGridSortingMenu.bind(this));for(var e=0;e<this.layout.changeViewButtons.length;++e){BX.bind(BX(this.layout.changeViewButtons[e]),"click",this.changeView.bind(this))}BX.SidePanel.Instance.bindAnchors({rules:[{condition:[this.storage.link,this.storage.trashLink],handler:function(e,t){if(BX.hasClass(t.anchor,"main-ui-pagination-page")||BX.hasClass(t.anchor,"main-ui-pagination-arrow")){return}if(this.onOpenFolderByAnchor(t.anchor)){e.preventDefault()}}.bind(this)},{condition:[this.storage.fileLinkPrefix,this.storage.trashFileLinkPrefix],handler:function(e,t){if(!t.anchor.dataset.bxViewer){BX.SidePanel.Instance.open(t.url);e.preventDefault()}},options:{width:372}}]});BX.addCustomEvent("SidePanel.Slider:onMessage",this.onSliderMessage.bind(this));BX.bind(window,"popstate",this.onPopState.bind(this));BX.addCustomEvent("onIframeElementLoadDataToView",BX.proxy(this.onIframeElementLoadDataToView,this));BX.addCustomEvent("onBeforeElementShow",BX.proxy(this.onBeforeElementShow,this));BX.addCustomEvent("onCreateExtendedFolder",BX.proxy(this.onCreateExtendedFolder,this));BX.addCustomEvent("Grid::beforeRequest",this.onBeforeGridRequest.bind(this));BX.addCustomEvent("BX.TileGrid.Grid:beforeReload",this.onBeforeGridRequest.bind(this));if(this.commonGrid.isGrid()){BX.addCustomEvent(this.commonGrid.getContainer(),"Grid::optionsChanged",this.onGridOptionsChanged.bind(this))}BX.addCustomEvent("Grid::updated",this.onGridUpdated.bind(this));BX.addCustomEvent("BX.Main.Filter:beforeApply",this.onBeforeFilterApply.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",this.onFilterApply.bind(this));BX.addCustomEvent("onPopupFileUploadClose",this.onPopupFileUploadClose.bind(this));if(this.isTrashMode){BX.addCustomEvent("onStepperProgress",this.onStepperHasBeenFinished.bind(this));BX.addCustomEvent("onStepperHasBeenFinished",this.onStepperHasBeenFinished.bind(this))}BX.addCustomEvent("Disk.Page:onChangeFolder",this.onChangeFolder.bind(this));BX.addCustomEvent("Disk.TileItem.Item:onItemDblClick",this.onItemDblClick.bind(this));BX.addCustomEvent("Disk.TileItem.Item:onItemEnter",this.onItemDblClick.bind(this));BX.addCustomEvent(this.commonGrid.instance,"TileGrid.Grid:onItemRemove",this.onItemRemove.bind(this));BX.addCustomEvent(this.commonGrid.instance,"TileGrid.Grid:onItemMove",this.onItemMove.bind(this))};FolderListClass.prototype.onPullDiskEvent=function(e,t){t=t||{};switch(t.action){case"commit":if(!t.objectId){break}if(parseInt(t.contentVersion,10)<2){break}var i=BX.delegate(getObjectDataId,this)(t.objectId);var s=i.title;if(!s){break}BX.Disk.showModalWithStatusAction({message:BX.message("DISK_FOLDER_LIST_LABEL_LIVE_UPDATE_FILE").replace("#NAME#",s.text),dontCloseCurrentPopupWindow:true});break}};FolderListClass.prototype.onBeforeFilterApply=function(e,t,i,s){if(e!==this.filterId){return}this.isFiltetedFolderList=true;s.then(function(){if(i.getSearch().getSearchString()||i.getSearch().getSquares().length){this.blockSorting()}else{this.unblockSorting()}}.bind(this))};FolderListClass.prototype.blockSorting=function(){if(this.commonGrid.isGrid()){this.commonGrid.instance.blockSorting()}this.sort.layout.label.style.pointerEvents="none"};FolderListClass.prototype.unblockSorting=function(){if(this.commonGrid.isGrid()){this.commonGrid.instance.unblockSorting()}this.sort.layout.label.style.pointerEvents=null};var _getSymlinksUnderObjectId=[];FolderListClass.prototype.getSymlinksUnderObjectId=function(e){var t=e.id;if(_getSymlinksUnderObjectId[t]!==undefined){var i=new BX.Promise;i.fulfill(_getSymlinksUnderObjectId[t]);return i}var s=new BX.Promise;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSymlinks"),data:e,onsuccess:function(e){if(!e||!e.status||e.status!=="success"){return}_getSymlinksUnderObjectId[t]=e.items;s.fulfill(_getSymlinksUnderObjectId[t])}.bind(this)});return s};FolderListClass.prototype.needRunFilterUnderLinks=function(){if(!this.filter.getSearch().getSearchString()&&!this.filter.getSearch().getSquares().length){return false}for(var e in this.filterValueToSkipSearchUnderLinks){if(!this.filterValueToSkipSearchUnderLinks.hasOwnProperty(e)){continue}var t=this.filterValueToSkipSearchUnderLinks[e];var i=this.filter.getFilterFieldsValues();if(i[e]==t){return false}}return true};FolderListClass.prototype.showPopupWindowInfo=function(e){this.popupWindowInfo=new BX.PopupWindow("disk-folder-list-popup-info",e,{className:"disk-folder-list-popup-info",autoHide:true,zIndex:200,closeByEsc:true,offsetTop:5,width:e.offsetWidth-20,content:'<span class="disk-folder-list-popup-info-content">'+BX.message("DISK_FOLDER_LIST_SEARCH_INDEX_NOTICE_1")+"</span>"});this.popupWindowInfo.show()};FolderListClass.prototype.onFilterApply=function(e,t,i,s,o){if(this.showSearchNotice&&i.getSearch().getSearchString()){setTimeout(function(){this.showPopupWindowInfo(i.search.container)}.bind(this),200)}if(e!==this.filterId){return}if(this.commonGrid.isTile()){s=s.then(function(){return this.commonGrid.reload()}.bind(this))}if(!this.needRunFilterUnderLinks()){return}this.layout.fileListContainer.classList.add("disk-running-filter");this.runAfterFilterOpenFolder=this.resetFilter.bind(this);var n=BX.Disk.Page.getFolder();n.link=window.location.pathname.toString();var a=function(){var e=BX.Disk.Page.getFolder();return e&&e.id!=n.id};s.then(function(){if(!this.commonGrid.countItems()){if(this.commonGrid.isTile()){this.commonGrid.instance.removeEmptyBlock();this.commonGrid.instance.setMinHeightContainer()}this.commonGrid.fade()}this.getSymlinksUnderObjectId(n).then(function(e){var t=new BX.Promise;var i=t;e.forEach(function(i,s){t=t.then(function(){if(a()){return}var t=new BX.Promise;var o=this.commonGrid.instance;var n={viewGridStorageId:BX.Disk.Page.getStorage().id};if(e.length===s+1){this.removeSearchProcessInConnectedFolders()}else if(this.commonGrid.countItems()>0){this.showSearchProcessInConnectedFolders()}if(this.commonGrid.isGrid()){o.getData().request(i.link,"POST",n,null,function(){if(a()){return}var e=BX.Grid.Utils.getByClass(this.getResponse(),o.settings.get("classBodyRow"));if(BX.type.isArray(e)&&e.length===1&&BX.hasClass(e[0],o.settings.get("classEmptyRows"))){}else if(BX.type.isArray(e)&&e.length===0||!BX.type.isArray(e)){}else{BX.remove(BX.Grid.Utils.getByClass(o.getContainer(),o.settings.get("classEmptyRows"),true));o.adjustEmptyTable(e);o.getUpdater().appendBodyRows(e);o.getRows().reset();o.bindOnRowEvents();o.updateCounterDisplayed();o.updateCounterSelected();o.tableUnfade()}t.fulfill()})}else{var r=BX.ajax.promise({url:BX.util.add_url_param(i.link,{grid_id:this.commonGrid.getId(),internal:true}),method:"POST",dataType:"json",data:n});r.then(function(e){if(this.commonGrid.countItems()){this.commonGrid.unFade()}if(a()){return}e.data.tileGrid.items.forEach(function(e){this.commonGrid.instance.appendItem(e)},this);t.fulfill()}.bind(this))}return t}.bind(this))},this);t.then(function(){this.layout.fileListContainer.classList.remove("disk-running-filter");this.commonGrid.unFade();if(!this.commonGrid.countItems()&&this.commonGrid.isTile()){this.commonGrid.instance.setMinHeightContainer();this.commonGrid.instance.appendEmptyBlock()}}.bind(this));i.fulfill()}.bind(this))}.bind(this))};FolderListClass.prototype.resetFilter=function(){this.isFiltetedFolderList=false;this.filter.getApi().setFields({});this.filter.getSearch().clearForm();this.filter.getSearch().adjustPlaceholder()};FolderListClass.prototype.onItemMove=function(e,t){if(this.isTrashMode){}else{BX.ajax.runAction("disk.api.commonActions.move",{analyticsLabel:"folder.list.dd",data:{objectId:e.getId(),toFolderId:t.getId()}})}};FolderListClass.prototype.onItemRemove=function(e){if(this.isTrashMode){}else{BX.ajax.runAction("disk.api.commonActions.markDeleted",{analyticsLabel:"folder.list.dd",data:{objectId:e.getId()}}).then(function(e){BX.addClass(this.layout.trashCanButton,"pashaPleaseUseSomeClassHere")}.bind(this))}};FolderListClass.prototype.onItemDblClick=function(e){if(e.isFolder){this.onOpenFolder({id:e.getId(),name:e.name,link:e.item.titleLink.href})}else{BX.fireEvent(e.item.titleLink,"click")}};FolderListClass.prototype.onChangeFolder=function(e,t){if(BX.type.isFunction(this.runAfterFilterOpenFolder)){this.runAfterFilterOpenFolder();this.runAfterFilterOpenFolder=null;var i=history.state.folder;i.link=window.location.pathname.toString();BX.onCustomEvent("Disk.FolderListClass:openFolderAfterFilter",[i])}};FolderListClass.prototype.onGridUpdated=function(){};FolderListClass.prototype.onGridOptionsChanged=function(e){var t=e.getUserOptions().getCurrentOptions();this.sort.sortBy=t.last_sort_by;this.sort.direction=t.last_sort_order;var i=this.sortFields.find(function(e){return e.field===this.sort.sortBy},this);if(i){BX.adjust(this.sort.layout.label,{text:i.label})}};FolderListClass.prototype.onBeforeGridRequest=function(e,t){if(this.gridId!==t.gridId){return}if(!t.url){t.url=window.location.pathname+window.location.search}if(t.data.controls){var i={};t.data.rows.forEach(function(e){i[e]={ID:e}});t.data.rows=i}if(t.data.FIELDS||t.data.ID){if(t.data.FIELDS){t.data.rows=t.data.FIELDS}else if(t.data.ID){var s={};t.data.ID.forEach(function(e){s[e]={ID:e}});t.data.rows=s}t.data.FIELDS=null;t.data.ID=null;t.data.controls=t.data.controls||{};if(this.commonGrid.isGrid()){t.data.controls=BX.mergeEx(t.data.controls,BX.clone(t.data))}}};FolderListClass.prototype.runCommandOnObjectId=function(command,objectId){if(!command){return}var objectData=BX.delegate(getObjectDataId,this)(objectId);var row=objectData.row;var title=objectData.title;var icon=objectData.icon;switch(command.toLowerCase()){case"!disconnect":case"!detach":case"!share":var menuItem=row.getActionsMenu().getMenuItem(command.toLowerCase().substr(1));if(!menuItem||!menuItem.onclick){return}eval(menuItem.onclick);break;case"!show":var linkWithObject=BX("disk_obj_"+objectId);if(!!linkWithObject){BX.fireEvent(linkWithObject,"click")}break;default:break}};function getObjectDataId(e){var t=this.getRow(e);return{row:this.getRow(e),title:BX.findChild(t.node,{tagName:"a",className:"bx-disk-folder-title"},true),icon:BX.findChild(t.node,function(e){return BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))},true)}}function getIconElementByObjectId(e){var t=this.getRow(e);return BX.findChild(t.node,function(e){return BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))},true)}FolderListClass.prototype.scrollToObject=function(e){var t=this.getRow(e);this.scrollToRow(t)};FolderListClass.prototype.scrollToRow=function(e){var t=e.node;new BX.easing({duration:500,start:{scroll:window.pageYOffset||document.documentElement.scrollTop},finish:{scroll:BX.pos(t).top},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)}}).animate()};FolderListClass.prototype.createFile=function(){BX.Disk.modalWindow({modalId:"bx-disk-create-file",title:BX.message("DISK_FOLDER_MW_CREATE_FILE_TITLE"),contentClassName:"tac bx-disk-create-file-big",contentStyle:{paddingTop:"30px",paddingBottom:"70px"},events:{onPopupClose:function(){BX.PopupMenu.destroy("disk_open_menu_with_services")}},content:[BX.create("div",{props:{className:"bx-disk-create-file-section"},children:[BX.message("DISK_FOLDER_MW_CREATE_FILE_TEXT")+" ",BX.create("span",{style:{cursor:"pointer"},children:[BX.create("span",{text:this.defaultServiceLabel,props:{className:"bx-disk-create-file-bdbdotted",id:"bx-disk-default-service-label"}}),BX.create("SPAN",{html:"&nbsp;"}),BX.create("span",{props:{className:"bx-disk-create-file-big-icon"}})],events:{click:BX.delegate(function(e){this.openMenuWithServices(BX("bx-disk-default-service-label"));BX.PreventDefault(e)},this)}})]}),BX.create("div",{props:{className:"bx-disk-create-file-section"},children:[BX.create("a",{text:BX.message("DISK_FOLDER_MW_CREATE_TYPE_DOC"),props:{className:"bx-disk-create-file-big-icon bx-disk-create-file-big-doc"},style:{cursor:"pointer"},events:{click:BX.delegate(function(e){this.runCreatingFile("docx");BX.PreventDefault(e)},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_MW_CREATE_TYPE_XLS"),props:{className:"bx-disk-create-file-big-icon bx-disk-create-file-big-table"},style:{cursor:"pointer"},events:{click:BX.delegate(function(e){this.runCreatingFile("xlsx");BX.PreventDefault(e)},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_MW_CREATE_TYPE_PPT"),props:{className:"bx-disk-create-file-big-icon bx-disk-create-file-big-pres"},style:{cursor:"pointer"},events:{click:BX.delegate(function(e){this.runCreatingFile("pptx");BX.PreventDefault(e)},this)}})]})]})};FolderListClass.prototype.openMenuWithServices=function(e){var t=new BX.CViewer({});BX.PopupMenu.show("disk_open_menu_with_services",BX(e),[{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",href:"#",onclick:BX.delegate(function(e){if(BX.CViewer.isEnableLocalEditInDesktop()){this.setEditService("l");BX.adjust(BX("bx-disk-default-service-label"),{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")});BX.PopupMenu.destroy("disk_open_menu_with_services")}else{this.helpDiskDialog()}return BX.PreventDefault(e)},t)},{text:t.getNameEditService("google"),className:"bx-viewer-popup-item item-gdocs",href:"#",onclick:BX.delegate(function(e){this.setEditService("google");BX.adjust(BX("bx-disk-default-service-label"),{text:this.getNameEditService("google")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(e)},t)},{text:t.getNameEditService("office365"),className:"bx-viewer-popup-item item-office365",href:"#",onclick:BX.delegate(function(e){this.setEditService("office365");BX.adjust(BX("bx-disk-default-service-label"),{text:this.getNameEditService("office365")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(e)},t)},{text:t.getNameEditService("skydrive"),className:"bx-viewer-popup-item item-office",href:"#",onclick:BX.delegate(function(e){this.setEditService("skydrive");BX.adjust(BX("bx-disk-default-service-label"),{text:this.getNameEditService("skydrive")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(e)},t)}],{angle:{position:"top",offset:45},autoHide:true,overlay:{opacity:.01}})};FolderListClass.prototype.blockFeatures=function(){BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose:function(){this.destroy()},autoHide:true,zIndex:11e3}).show()};FolderListClass.prototype.runCreatingFile=function(e,t){if(BX.message("disk_restriction")){this.blockFeatures();return}var i=new BX.CViewer({createDoc:true});if(BX.CViewer.isLocalEditService(t)){if(BX.CViewer.isEnableLocalEditInDesktop()){i.setEditService("l")}else{i.helpDiskDialog()}}else{i.setEditService(t)}var s=i.createBlankElementByParams({targetFolderId:BX.Disk.Page.getFolder().id,docType:e,editUrl:this.createBlankFileUrl,renameUrl:this.renameBlankFileUrl});i.setCurrent(s);s.afterSuccessCreate=function(e){if(e&&e.status=="success"){if(!BX.CViewer.isLocalEditService(i.initEditService())){window.document.location=BX.Disk.getUrlToShowObjectInGrid(e.objectId)}else{window.onbeforeunload=function(){if(!window.diskUnloadCreateDoc){window.diskUnloadCreateDoc=true;setTimeout(function(){window.document.location=BX.Disk.getUrlToShowObjectInGrid(e.objectId)},250)}}}}};i.runActionByCurrentElement("create",{obElementViewer:i});try{BX.PreventDefault()}catch(e){}return false};FolderListClass.prototype.changeView=function(e){var t=BX.getEventTarget(e);if(t&&this.commonGrid.isTile()){e.preventDefault();this.commonGrid.instance.changeTileSize(t.dataset.viewTileSize);for(var i=0;i<this.layout.changeViewButtons.length;++i){this.layout.changeViewButtons[i].classList.remove("disk-folder-list-view-item-active")}t.classList.toggle("disk-folder-list-view-item-active");window.history.replaceState(null,null,BX.util.remove_url_param(document.location.toString(),"viewSize"));BX.ajax.runComponentAction("bitrix:disk.folder.list","saveViewOptions",{analyticsLabel:"tile."+t.dataset.viewTileSize,mode:"class",data:{storageId:BX.Disk.Page.getStorage().id,viewMode:"tile",viewSize:t.dataset.viewTileSize}})}};FolderListClass.prototype.createFolder=function(){var e=this;var t=BX.Disk.modalWindow({modalId:"bx-disk-create-folder",title:BX.message("DISK_FOLDER_TITLE_CREATE_FOLDER"),contentClassName:"",contentStyle:{paddingTop:"30px",paddingBottom:"70px"},events:{onAfterPopupShow:function(){BX.focus(BX("disk-new-create-filename"))},onPopupClose:function(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-new-create-filename"},children:[BX.create("span",{props:{className:"req"},text:"*"}),BX.message("DISK_FOLDER_LABEL_NAME_CREATE_FOLDER")]}),BX.create("input",{props:{id:"disk-new-create-filename",className:"bx-disk-popup-input",type:"text",value:""},style:{fontSize:"16px",marginTop:"10px"}})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_BTN_CREATE_FOLDER"),className:"ui-btn ui-btn-success",events:{click:function(){var i=BX("disk-new-create-filename");var s=i.value;if(!s||!s.replace(/\s+/g,"")){BX.addClass(i,"disk-animated disk-animate-shake");i.addEventListener("animationend",function(){BX.removeClass(i,"disk-animated disk-animate-shake")});BX.focus(i);return}this.addClassName("ui-btn-clock");var o=this;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(e.ajaxUrl,"action","addFolder"),data:{targetFolderId:BX.Disk.Page.getFolder().id,name:s},onsuccess:function(e){if(!e){return}if(e.status&&e.status=="success"){t.close();this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(e.folder.id,{resetFilter:1}),{}).then(function(){this.resetFilter();this.commonGrid.selectItemById(e.folder.id);if(this.commonGrid.isGrid()){var t=this.getRow(e.folder.id);this.scrollToRow(t)}}.bind(this))}else{BX.Disk.showModalWithStatusAction(e);o.removeClassName("ui-btn-clock")}}.bind(e)})}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})};FolderListClass.prototype.onClickManageConnectButton=function(e){var t=BX.proxy_context;if(!BX.type.isDomNode(BX.proxy_context))return;var i=this.storage.rootObject.id;if(BX.hasClass(t,"connect")){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","connectToUserStorage"),data:{objectId:this.storage.rootObject.id},onsuccess:BX.delegate(function(e){BX.Disk.showModalWithStatusAction(e);if(e.status!="success"){return}var i=BX.findChild(t,{className:"popup-current-icon"},true);if(!!i){BX.removeClass(i,"webform-small-button-disk connect");BX.addClass(i,"webform-small-button-check-round disconnect")}var s=BX("bx-disk-disconnect-connect-disk-text");if(!!s){BX.adjust(s,{text:BX.message("DISK_FOLDER_LIST_LABEL_ALREADY_CONNECT_DISK")})}BX.removeClass(t,"webform-small-button-disk connect");BX.addClass(t,"webform-small-button-check-round disconnect");if(!!e.manage.link){this.storage.manage.link=BX.clone(e.manage.link,true)}},this)});BX.PreventDefault(e)}else if(BX.hasClass(t,"disconnect")){this.openConfirmDetach({object:{id:this.storage.manage.link.object.id,name:this.storage.name,isFolder:true},onSuccess:function(e){if(e&&e.status=="success"){e.message=BX.message("DISK_FOLDER_LIST_LABEL_DISCONNECTED_DISK")}BX.Disk.showModalWithStatusAction(e);var i=BX.findChild(t,{className:"popup-current-icon"},true);if(!!i){BX.removeClass(i,"webform-small-button-check-round disconnect");BX.addClass(i,"webform-small-button-disk connect")}var s=BX("bx-disk-disconnect-connect-disk-text");if(!!s){BX.adjust(s,{text:BX.message("DISK_FOLDER_LIST_LABEL_CONNECT_DISK")})}BX.removeClass(t,"webform-small-button-check-round disconnect");BX.addClass(t,"webform-small-button-disk connect")}});BX.PreventDefault(e)}};FolderListClass.prototype.showTree=function(e){var t=e.bindElement||null;var i=e.textElement||null;var s=e.valueElement||null;var o=e.onSelect||null;var n=null;var a=null;var r=new BX.Disk.Tree.Modal(this.rootObject,{enableKeyboardNavigation:false,events:{onSelectFolder:function(e,t){if(!e.getAttribute("data-can-add")){BX.removeClass(e,"selected");return}n=t;if(a){BX.removeClass(a,"selected")}a=e;if(n&&s){s.value=n}if(n&&BX.type.isFunction(o)){o(n)}},onUnSelectFolder:function(e){n=null;a=null;var t=BX("grid_group_action_target_object");t&&BX.remove(t)}},modalParameters:{bindElement:t,title:e.title,buttons:e.buttons}});r.show()};FolderListClass.prototype.onClickGetFilesCountAndSizeButtonButton=function(e){BX.Disk.ajax({url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","calculateFileSizeAndCount"),method:"POST",dataType:"json",data:{folderId:this.currentFolder.id},onsuccess:BX.delegate(function(e){if(!e||e.status!="success"){BX.Disk.showModalWithStatusAction(e);return}BX.adjust(this.getFilesCountAndSize.sizeContainer,{text:e.size});BX.adjust(this.getFilesCountAndSize.countContainer,{text:e.count})},this)})};FolderListClass.prototype.onSliderMessage=function(e){var t=e.getData();if(e.getEventId()==="Disk.File:onMarkDeleted"){if(t.objectId){setTimeout(function(){this.removeRow(t.objectId)}.bind(this),500)}}if(e.getEventId()==="Disk.File:onDelete"){if(t.objectId){setTimeout(function(){this.removeRow(t.objectId)}.bind(this),500)}}if(e.getEventId()==="Disk.File:onRestore"){if(t.objectId){setTimeout(function(){this.removeRow(t.objectId)}.bind(this),500)}}if(e.getEventId()==="Disk.File:onNewVersionUploaded"){this.commonGrid.reload(BX.SidePanel.Instance.getPageUrl())}if(e.getEventId()==="Disk.File:onAddSharing"){this.showSharingIcon(t.objectId)}};FolderListClass.prototype.onPopState=function(e){var t=e.state;if(!t||!t.disk||!t.folder){window.location.reload();return}if(!t.folder.link){t.folder.link=window.location.pathname.toString()}BX.onCustomEvent("Disk.FolderListClass:onPopState",[t.folder]);this.openFolder(t.folder.id,t.folder)};FolderListClass.prototype.openGridFolder=function(e){if(e.shiftKey||e.ctrlKey){return}var t=e.target||e.srcElement;if(!t.dataset.objectId){return}var i=this.getRow(t.dataset.objectId);var s=BX.findChildByClassName(i.node,"js-disk-grid-folder");BX.fireEvent(s,"click")};FolderListClass.prototype.onOpenFolderByAnchor=function(e){var t={id:e.dataset.objectId,canAdd:e.dataset.canAdd,link:e.href,name:e.textContent.trim(),node:e};return this.onOpenFolder(t)};FolderListClass.prototype.onOpenFolder=function(e){if(!e.id){return false}BX.onCustomEvent("Disk.FolderListClass:onFolderBeforeOpen",[e]);var t={disk:true,folder:{id:e.id,name:e.name}};window.history.pushState(t,null,e.link);BX.onCustomEvent("Window:onPushState",[t,null,e.link]);this.openFolder(e.id,e);return true};FolderListClass.prototype.openFolderContextMenu=function(e,t,i,s){t.preventDefault();s.link=e.href;s.id=i;this.onOpenFolder(s)};FolderListClass.prototype.openFolder=function(e,t){this.commonGrid.reload(t.link,{resetFilter:1}).then(function(){BX.onCustomEvent("Disk.FolderListClass:onFolderOpen",[t,this.isFiltetedFolderList]);this.removeSearchProcessInConnectedFolders();BX.Disk.Page.changeFolder({id:t.id,name:t.name});if(t.canAdd===undefined){BX.ajax.runAction("disk.api.folder.getAllowedOperationsRights",{analyticsLabel:"folder.list",data:{folderId:t.id}}).then(function(e){var i=e.data.operations;i.disk_add?this.unblockCreateItemsButton():this.blockCreateItemsButton();t.canAdd=!!i.disk_add}.bind(this))}else{t.canAdd?this.unblockCreateItemsButton():this.blockCreateItemsButton()}window.scroll(0,0)}.bind(this))};FolderListClass.prototype.onClickDeleteGroup=function(e){if(!this.commonGrid.instance.IsActionEnabled())return false;var t=document.getElementById("actallrows_"+this.commonGrid.instance.table_id);this.openConfirmDeleteGroup({attemptDeleteAll:t&&t.checked});BX.PreventDefault(e);return false};FolderListClass.prototype.removeRow=function(e){this.commonGrid.removeItemById(e);BX.onCustomEvent("onRemoveRowFromDiskList",[e])};FolderListClass.prototype.getRow=function(e){return this.commonGrid.instance.getRows().getById(e)};FolderListClass.prototype.blockCreateItemsButton=function(){if(this.layout.createItemsButton){this.layout.createItemsButton.classList.add("ui-btn-disabled")}if(this.layout.emptyBlockUploadFileButtonId){BX.addClass(this.layout.emptyBlockUploadFileButtonId,"disk-folder-list-no-data-disabled")}if(this.layout.emptyBlockCreateFolderButtonId){BX.addClass(this.layout.emptyBlockCreateFolderButtonId,"disk-folder-list-no-data-disabled")}};FolderListClass.prototype.unblockCreateItemsButton=function(){if(this.layout.createItemsButton){this.layout.createItemsButton.classList.remove("ui-btn-disabled")}if(this.layout.emptyBlockUploadFileButtonId){BX.removeClass(this.layout.emptyBlockUploadFileButtonId,"disk-folder-list-no-data-disabled")}if(this.layout.emptyBlockCreateFolderButtonId){BX.removeClass(this.layout.emptyBlockCreateFolderButtonId,"disk-folder-list-no-data-disabled")}};FolderListClass.prototype.renameInline=function(e){if(this.commonGrid.isTile()){var t=this.commonGrid.instance.getItem(e);if(t){t.onRename()}return}this.commonGrid.instance.getRows().unselectAll();var i=this.commonGrid.instance.getRows().getById(e);i.select();this.commonGrid.instance.editSelected();var s=BX.Grid.Utils.getByClass(i.getNode(),"main-grid-editor-container",true);var o=BX.findChild(s,{tag:"input"},true);if(o){BX.bind(o,"keydown",function(e){if(e.key==="Enter"){e.stopPropagation();e.preventDefault();this.commonGrid.instance.editSelectedSave()}if(e.key==="Escape"){this.commonGrid.instance.editSelectedCancel()}}.bind(this));BX.focus(o)}};FolderListClass.prototype.processGridGroupActionRestore=function(){if(!this.commonGrid.isGrid()){return}var e=this.commonGrid.instance.getRows().getSelectedIds();if(!e.length){return}BX.ajax.runAction("disk.api.commonActions.restoreCollection",{analyticsLabel:"folder.list",data:{objectCollection:e}}).then(function(e){if(e.status==="success"){var t=e.data.restoredObjectIds.pop();window.document.location=BX.Disk.getUrlToShowObjectInGrid(t)}}.bind(this))};FolderListClass.prototype.openConfirmRestore=function(e){var t=e.object.name;var i=e.object.id;var s=e.object.isFolder;var o="";if(s){o=BX.message("DISK_TRASHCAN_TRASH_RESTORE_FOLDER_CONFIRM")}else{o=BX.message("DISK_TRASHCAN_TRASH_RESTORE_FILE_CONFIRM")}var n=this;var a=[new BX.PopupWindowCustomButton({text:BX.message("DISK_TRASHCAN_ACT_RESTORE"),className:"ui-btn ui-btn-success",events:{click:function(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.commonActions.restore",{analyticsLabel:"folder.list",data:{objectId:i}}).then(function(e){BX.PopupWindowManager.getCurrentPopup().close();this.commonGrid.selectItemById(i);window.document.location=BX.Disk.getUrlToShowObjectInGrid(e.data.object.id)}.bind(n))}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_TRASHCAN_TRASH_RESTORE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:o.replace("#NAME#",t),buttons:a})};FolderListClass.prototype.copyLinkInternalLink=function(e,t){t.classList.add("menu-popup-item-accept","disk-folder-list-context-menu-item-accept-animate");BX.clipboard.copy(e)};FolderListClass.prototype.openConfirmDelete=function(e){var t=e.object.name;var i=e.object.id;var s=e.object.isFolder;var o=e.object.isDeleted;var n=e.canDelete;var a="";if(s){a=BX.message(n?"DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_FOLDER_CONFIRM":"DISK_FOLDER_LIST_TRASH_DELETE_FOLDER_CONFIRM")}else{a=BX.message(n?"DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_FILE_CONFIRM":"DISK_FOLDER_LIST_TRASH_DELETE_FILE_CONFIRM")}if(o){a=s?BX.message("DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_DELETED_FOLDER_CONFIRM"):BX.message("DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_DELETED_FILE_CONFIRM")}var r=this;var d=[];if(!o){d.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.commonActions.markDeleted",{analyticsLabel:"folder.list",data:{objectId:i}}).then(function(e){BX.PopupWindowManager.getCurrentPopup().close();r.removeRow(i)})}}}))}if(n){d.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_BUTTON"),className:"ui-btn ui-btn-light-border",events:{click:function(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.commonActions.delete",{analyticsLabel:"folder.list",data:{objectId:i}}).then(function(e){BX.PopupWindowManager.getCurrentPopup().close();r.removeRow(i)})}}}))}d.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}}));BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"disk-popup-text-content",content:a.replace("#NAME#",t),buttons:d})};FolderListClass.prototype.onPopupFileUploadClose=function(e,t){this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(t,{resetFilter:1})).then(function(){this.resetFilter();this.commonGrid.selectItemById(t);if(this.commonGrid.isGrid()){var e=this.getRow(t);this.scrollToRow(e)}}.bind(this))};FolderListClass.prototype.onStepperHasBeenFinished=function(e){this.commonGrid.reload()};var alreadyRunEmptyTrash=false;FolderListClass.prototype.openConfirmEmptyTrash=function(){var e=this.storage.id;var t=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_EMPTY_TRASH"),className:"ui-btn ui-btn-success",events:{click:function(t){this.addClassName("ui-btn-clock");if(alreadyRunEmptyTrash){BX.PopupWindowManager.getCurrentPopup().close();return}alreadyRunEmptyTrash=true;BX.ajax.runAction("disk.api.trashcan.empty",{analyticsLabel:"folder.list",data:{storageId:e}}).then(function(e){BX.ajax.runComponentAction("bitrix:disk.folder.list","getSteppers",{mode:"class"}).then(function(e){if(e.data.html){var t=BX("disk-folder-list-place-for-stepper");if(t){BX.html(t,e.data.html)}}});BX.PopupWindowManager.getCurrentPopup().close()})}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-empty-trash-confirm",title:BX.message("DISK_FOLDER_LIST_TITLE_EMPTY_TRASH_TITLE"),contentClassName:"disk-popup-text-content",content:BX.message("DISK_FOLDER_LIST_TRASH_EMPTY_TRASH_DESCRIPTION"),buttons:t})};FolderListClass.prototype.openConfirmDetach=function(e){var t=e.object.name;var i=e.object.id;var s=e.object.isFolder;var o=e.onSuccess;var n="";if(s){n=BX.message("DISK_FOLDER_LIST_DETACH_FOLDER_CONFIRM")}else{n=BX.message("DISK_FOLDER_LIST_DETACH_FILE_CONFIRM")}var a=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_DETACH_BUTTON"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","detach"),data:{objectId:i},onsuccess:BX.delegate(function(e){if(!e){return}if(e.status=="success"){if(BX.type.isFunction(o)){BX.delegate(o,this)(e)}else{this.removeRow(i)}return}BX.Disk.showModalWithStatusAction(e)},this)});return false},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:s?BX.message("DISK_FOLDER_LIST_DETACH_FOLDER_TITLE"):BX.message("DISK_FOLDER_LIST_DETACH_FILE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:n.replace("#NAME#",t),buttons:a})};FolderListClass.prototype.openConfirmDeleteGroup=function(){var e=BX.message("DISK_FOLDER_LIST_TRASH_DELETE_GROUP_CONFIRM");var t=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();var t={};t[this.commonGrid.getActionKey()]="delete";var i={rows:this.commonGrid.getSelectedIds(),controls:t};this.commonGrid.reload(null,i).then(function(){BX.PopupWindowManager.getCurrentPopup().destroy()})}.bind(this)}})];var i=false;if(i){t.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_BUTTON"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();var t={};t[this.commonGrid.getActionKey()]="destroy";var i={rows:this.commonGrid.getSelectedIds(),controls:t};this.commonGrid.reload(null,i).then(function(){BX.PopupWindowManager.getCurrentPopup().destroy()})}.bind(this)}}))}t.push(new BX.PopupWindowCustomButton({className:"ui-btn ui-btn-link",text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}}));BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:e,buttons:t})};FolderListClass.prototype.openConfirmDestroyGroup=function(){var e=BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_GROUP_CONFIRM");var t=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();var t={};t[this.commonGrid.getActionKey()]="destroy";var i={rows:this.commonGrid.getSelectedIds(),controls:t};this.commonGrid.reload(null,i).then(function(){BX.PopupWindowManager.getCurrentPopup().destroy()})}.bind(this)}}),new BX.PopupWindowCustomButton({className:"ui-btn ui-btn-link",text:BX.message("DISK_JS_BTN_CANCEL"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"disk-popup-text-content",content:e,buttons:t})};FolderListClass.prototype.downloadGroup=function(){var e=this.commonGrid.getSelectedIds();if(!e.length){return}BX.ajax.runAction("disk.api.commonActions.getArchiveLink",{analyticsLabel:"folder.list",data:{objectCollection:e}}).then(function(e){document.location=e.data.downloadArchiveUri}).catch(function(e){BX.Disk.showModalWithStatusAction(e)}.bind(this))};FolderListClass.prototype.openConfirmCopyGroup=function(){var e;var t=this;var i=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_COPY_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(i){if(!e){return}this.addClassName("ui-btn-clock");var s={};s[t.commonGrid.getActionKey()]="copy";s["destinationFolderId"]=e;var o={rows:t.commonGrid.getSelectedIds(),controls:s};t.commonGrid.reload(null,o).then(function(){BX.PopupWindowManager.getCurrentPopup().destroy()})}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];this.showTree({title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MANY_COPY_TO"),buttons:i,onSelect:function(t){e=t}})};FolderListClass.prototype.openConfirmMoveGroup=function(){var e;var t=this;var i=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_MOVE_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(i){if(!e){return}this.addClassName("ui-btn-clock");var s={};s[t.commonGrid.getActionKey()]="move";s["destinationFolderId"]=e;var o={rows:t.commonGrid.getSelectedIds(),controls:s};t.commonGrid.reload(null,o).then(function(){BX.PopupWindowManager.getCurrentPopup().destroy()})}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];this.showTree({title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MANY_MOVE_TO"),buttons:i,onSelect:function(t){e=t}})};FolderListClass.prototype.connectObjectToDisk=function(e){var t=e.object.name;var i=e.object.id;var s=e.object.isFolder;BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","connectToUserStorage"),data:{objectId:i}}).then(function(e){if(!e){return}if(e.status=="success"){this.commonGrid.getActionById(i,"connect").hide=true;var o=this.commonGrid.getActionsMenu(i);o.getMenuItem("connect").hide=true;BX.addClass(o.getMenuItem("connect").layout.item,"disk-popup-menu-hidden-item");BX.Disk.showModalWithStatusAction({status:"success",message:s?BX.message("DISK_FOLDER_LIST_SUCCESS_CONNECT_TO_DISK_FOLDER").replace("#NAME#",t):BX.message("DISK_FOLDER_LIST_SUCCESS_CONNECT_TO_DISK_FILE").replace("#NAME#",t)})}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}.bind(this))};FolderListClass.prototype.unlockFile=function(e){var t=e.object.name;var i=e.object.id;BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","unlock"),data:{objectId:i}}).then(function(e){if(!e){return}if(e.status=="success"){this.commonGrid.getActionById(i,"lock").hide=false;this.commonGrid.getActionById(i,"unlock").hide=true;var t=this.commonGrid.getActionsMenu(i);t.getMenuItem("lock").hide=false;t.getMenuItem("unlock").hide=true;BX.removeClass(t.getMenuItem("lock").layout.item,"disk-popup-menu-hidden-item");BX.addClass(t.getMenuItem("unlock").layout.item,"disk-popup-menu-hidden-item");this.hideLockIcon(i)}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}.bind(this))};FolderListClass.prototype.lockFile=function(e){var t=e.object.name;var i=e.object.id;BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","lock"),data:{objectId:i}}).then(function(e){if(!e){return}if(e.status=="success"){this.commonGrid.getActionById(i,"unlock").hide=false;this.commonGrid.getActionById(i,"lock").hide=true;var t=this.commonGrid.getActionsMenu(i);t.getMenuItem("unlock").hide=false;t.getMenuItem("lock").hide=true;BX.removeClass(t.getMenuItem("unlock").layout.item,"disk-popup-menu-hidden-item");BX.addClass(t.getMenuItem("lock").layout.item,"disk-popup-menu-hidden-item");this.showLockIcon(i)}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}.bind(this))};FolderListClass.prototype.showSharingIcon=function(e){if(this.commonGrid.isTile()){var t=this.commonGrid.instance.getItem(e);t&&t.markAsShared()}else{var i=this.getRow(e);var s=BX.findChildByClassName(i.node,"bx-disk-file-icon",true)||BX.findChildByClassName(i.node,"bx-disk-folder-icon",true);if(s){BX.addClass(s,"icon-shared shared icon-shared_1 icon-shared_2")}}};FolderListClass.prototype.hideSharingIcon=function(e){if(this.commonGrid.isTile()){var t=this.commonGrid.instance.getItem(e);t&&t.unmarkAsShared()}else{var i=this.getRow(e);var s=BX.findChildByClassName(i.node,"bx-disk-file-icon",true)||BX.findChildByClassName(i.node,"bx-disk-folder-icon",true);if(s){BX.removeClass(s,"icon-shared shared icon-shared_1 icon-shared_2")}}};FolderListClass.prototype.showLockIcon=function(e){if(this.commonGrid.isGrid()){var t=this.getRow(e);var i=BX.findChildByClassName(t.node,"js-lock-icon",true);if(i){BX.show(i,"block")}}else{var s=this.commonGrid.instance.getItem(e);s.lock()}};FolderListClass.prototype.hideLockIcon=function(e){if(this.commonGrid.isGrid()){var t=this.getRow(e);var i=BX.findChildByClassName(t.node,"js-lock-icon",true);if(i){BX.hide(i,"block")}}else{var s=this.commonGrid.instance.getItem(e);s.unlock()}};FolderListClass.prototype.sortByColumn=function(e,t){t=t||"desc";this.sort.sortBy=e;this.sort.direction=t.toLowerCase();this.commonGrid.sortByColumn({sort_by:this.sort.sortBy,sort_order:this.sort.direction})};FolderListClass.prototype.showGridSortingMenu=function(e){var t=BX.getEventTarget(e);var i=function(e){if(t){BX.adjust(t,{text:e.text})}};var s=function(e){e.layout.item.classList.toggle("menu-popup-item-accept");e.layout.item.classList.toggle("menu-popup-no-icon")};var o=[];this.sortFields.forEach(function(e){o.push({title:e.label,text:e.label,field:e.field,onclick:function(e,t){this.sortByColumn(t.field,"desc");i(t);t.menuWindow.close()}.bind(this)})},this);o.push({delimiter:true},{title:BX.message("DISK_FOLDER_LIST_LABEL_SORT_INVERSE_DIRECTION"),text:BX.message("DISK_FOLDER_LIST_LABEL_SORT_INVERSE_DIRECTION"),className:this.sort.direction!=="desc"?"menu-popup-item menu-popup-item-accept":"",onclick:function(e,t){this.inverseSortByColumn();s(t);t.menuWindow.close()}.bind(this)},{delimiter:true},{title:BX.message("DISK_FOLDER_LIST_LABEL_SORT_MIX_MODE"),text:BX.message("DISK_FOLDER_LIST_LABEL_SORT_MIX_MODE"),className:this.sort.mix?"menu-popup-item menu-popup-item-accept":"",onclick:function(e,t){this.toggleMixSort();s(t);t.menuWindow.close()}.bind(this)});BX.PopupMenu.create("disk-folder-list-sorting-menu",this.sort.layout.label,o,{autoHide:true,className:"disk-folder-list-sorting-menu",offsetTop:0,offsetLeft:35,angle:{offset:45},events:{onPopupClose:function(){BX.PopupMenu.destroy("disk-folder-list-sorting-menu");this.destroy()}}}).show()};FolderListClass.prototype.inverseSortByColumn=function(){var e=this.sort.direction==="desc"?"asc":"desc";this.sortByColumn(this.sort.sortBy,e)};FolderListClass.prototype.toggleMixSort=function(){if(this.sort.mix){this.disableMixSort()}else{this.enableMixSort()}};FolderListClass.prototype.enableMixSort=function(){this.sort.mix=true;this.commonGrid.reload("",{sortMode:"mix"})};FolderListClass.prototype.disableMixSort=function(){this.sort.mix=false;this.commonGrid.reload("",{sortMode:"ord"})};FolderListClass.prototype.openExternalLinkDetailSettingsWithEditing=function(e){BX.Disk.modalWindowActionLoader("disk.api.commonActions.generateExternalLink",{analyticsLabel:"folder.list",id:"bx-disk-external-link-loader",postData:{objectId:e},afterSuccessLoad:function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}var i=new BX.Disk.Model.ExternalLink.Input({state:t.data.externalLink,data:{objectId:e},models:{externalLinkSettings:new BX.Disk.Model.ExternalLink.Settings({state:t.data.externalLink}),externalLinkDescription:new BX.Disk.Model.ExternalLink.Description({state:t.data.externalLink})}});i.render();BX.Disk.modalWindow({modalId:"bx-disk-external-link",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_GET_EXT_LINK"),contentClassName:"disk-popup-external-link-config",contentStyle:{},events:{onPopupClose:function(){this.destroy()}},content:[i.getContainer()],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:function(){i.externalLinkSettings.save();BX.PopupWindowManager.getCurrentPopup().close();setTimeout(function(){BX.Disk.showModalWithStatusAction({status:"success"})},300)}}}),new BX.PopupWindowCustomButton({className:"ui-btn ui-btn-link",text:BX.message("DISK_JS_BTN_CLOSE"),events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})};FolderListClass.prototype.onBeforeElementShow=function(e,t,i){if(t.hasOwnProperty("image")||!BX.message("disk_restriction")){return}i.prevent=true;BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose:function(){this.destroy()},autoHide:true,zIndex:11e3}).show()};FolderListClass.prototype.onIframeElementLoadDataToView=function(e,t){if(t&&t.status==="restriction"&&BX("bx-bitrix24-business-tools-info")){if(BX.CViewer&&BX.CViewer.objNowInShow){if(e.currentModalWindow){e.currentModalWindow.close()}BX.CViewer.objNowInShow.close()}BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose:function(){this.destroy()},autoHide:true,zIndex:11e3}).show()}};FolderListClass.prototype.getExternalLink=function(e){var t=BX.delegate(getObjectDataId,this)(e);var i=BX.hasClass(t.icon,"bx-disk-folder-icon");var s=this.ajaxUrl;s=BX.Disk.addToLinkParam(s,"action","generateExternalLink");s=BX.Disk.addToLinkParam(s,"isFolder",i);BX.Disk.modalWindowLoader(s,{id:"bx-disk-external-link-loader",responseType:"json",postData:{objectId:e},afterSuccessLoad:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.cacheExternalLinks[e]=t.link;BX.Disk.modalWindow({modalId:"bx-disk-external-link",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_GET_EXT_LINK"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow:function(){var e=BX("disk-get-external-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose:function(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-get-external-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-external-link",className:"bx-viewer-inp",type:"text",value:t.link}})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})},this)});return false};FolderListClass.prototype.getInternalLink=function(e){BX.Disk.modalWindow({modalId:"bx-disk-internal-link",title:BX.message("DISK_FOLDER_LIST_ACT_COPY_INTERNAL_LINK"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow:function(){var e=BX("disk-get-internal-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose:function(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-get-internal-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-internal-link",className:"bx-viewer-inp",type:"text",value:e}})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})};FolderListClass.prototype.openCopyModalWindow=function(e,t){var i=null;var s=null;var o=new BX.Disk.Tree.Modal(this.rootObject,{events:{onSelectFolder:function(e,t){if(!e.getAttribute("data-can-add")){BX.removeClass(e,"selected");return}if(s){BX.removeClass(s,"selected")}i=t;s=e},onUnSelectFolder:function(){i=null;s=null}},modalParameters:{title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_TREE"),contentTitle:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_COPY_TO").replace("#NAME#",t.name),buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_COPY_TO_BUTTON"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(e){if(!i){BX.PreventDefault(e);return false}BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","copyTo"),data:{objectId:t.id,targetObjectId:i},onsuccess:function(e){if(!e){return}if(e.status=="success"){if(e.isFolder){e.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_COPIED").replace("#FOLDER#",e.name)}else{e.message=BX.message("DISK_FOLDER_LIST_OK_FILE_COPIED").replace("#FILE#",e.name)}e.message=e.message.replace("#TARGET_FOLDER#",e.destination.name);BX.Disk.showModalWithStatusAction(e);return}BX.Disk.showModalWithStatusAction(e)}});return false},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]}});o.show()};FolderListClass.prototype.openMoveModalWindow=function(e,t){var i=null;var s=null;var o=new BX.Disk.Tree.Modal(this.rootObject,{events:{onSelectFolder:function(e,t){if(!e.getAttribute("data-can-add")){BX.removeClass(e,"selected");return}if(s){BX.removeClass(s,"selected")}i=t;s=e},onUnSelectFolder:function(){i=null;s=null}},modalParameters:{title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_TREE"),contentTitle:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MOVE_TO").replace("#NAME#",t.name),buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MOVE_TO_BUTTON"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(e){if(!i){BX.PreventDefault(e);return false}BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","moveTo"),data:{objectId:t.id,targetObjectId:i}}).then(function(e){if(this.commonGrid.isGrid()){this.commonGrid.instance.getRows().unselectAll()}this.commonGrid.selectItemById(t.id);this.commonGrid.reload();if(e.isFolder){e.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_MOVED").replace("#FOLDER#",e.name)}else{e.message=BX.message("DISK_FOLDER_LIST_OK_FILE_MOVED").replace("#FILE#",e.name)}e.message=e.message.replace("#TARGET_FOLDER#",e.destination.name);BX.Disk.showModalWithStatusAction(e)}.bind(this));return false},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]}});o.show()};var isChangedRights=false;var storageNewRights={};var originalRights={};var detachedRights={};var moduleTasks={};var entityToNewShared={};var loadedReadOnlyEntityToNewShared={};var entityToNewSharedMaxTaskName="";FolderListClass.prototype.showSharingDetailWithChangeRights=function(e){entityToNewShared={};loadedReadOnlyEntityToNewShared={};e=e||{};var t=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailChangeRights"),{id:"folder_list_sharing_detail_object_"+t,responseType:"json",postData:{objectId:t},afterSuccessLoad:BX.delegate(function(i){if(i.status!="success"){i.errors=i.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:i.errors.pop().message})}var s={name:i.owner.name,avatar:i.owner.avatar,link:i.owner.link};BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_2"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));for(var e in i.members){if(!i.members.hasOwnProperty(e)){continue}entityToNewShared[i.members[e].entityId]={item:{id:i.members[e].entityId,name:i.members[e].name,avatar:i.members[e].avatar},type:i.members[e].type,right:i.members[e].right}}BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:i.destination.items,itemsLast:i.destination.itemsLast,itemsSelected:i.destination.itemsSelected});var t=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(t);BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))},this),onPopupClose:BX.delegate(function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+s.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url('+s.avatar+');"></span>'+BX.util.htmlspecialchars(s.name)+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","changeSharingAndRights"),data:{objectId:t,entityToNewShared:entityToNewShared},onsuccess:BX.delegate(function(i){if(!i){return}if(e.object.isFolder){i.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_SHARE_MODIFIED").replace("#FOLDER#",e.object.name)}else{i.message=BX.message("DISK_FOLDER_LIST_OK_FILE_SHARE_MODIFIED").replace("#FILE#",e.object.name)}BX.Disk.showModalWithStatusAction(i);this.showSharingIcon(t)},this)});BX.PopupWindowManager.getCurrentPopup().close()},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})},this)})};function showAccessCodeFullName(e){e=e||{};return(e.provider?e.provider+": ":"")+e.name}FolderListClass.prototype.showRights=function(e){e=e||{};var t=e.object.id;var i={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsDetail"),{id:"folder_list_sharing_detail_object_"+t,responseType:"json",postData:{objectId:t},afterSuccessLoad:BX.delegate(function(e){if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}for(var t in e.rights){if(!e.rights.hasOwnProperty(t)){continue}var s=e.rights[t];for(var o in s){if(!s.hasOwnProperty(o)){continue}i[t]={readOnly:true,item:{id:t,name:showAccessCodeFullName(e.accessCodeNames[t]),avatar:null},type:"group",right:{title:s[o].TASK.TITLE}}}}BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_2"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){for(var e in i){if(!i.hasOwnProperty(e)){continue}BX.Disk.appendRight(i[e])}},this),onPopupClose:BX.delegate(function(){BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("a",{text:BX.message("DISK_FOLDER_TOOLBAR_BTN_CREATE_FOLDER"),props:{id:"bx-disk-destination-object-modal",className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent border"},events:{click:BX.delegate(function(){},this)},children:[BX.create("span",{props:{className:"bx-disk-btn-icon bx-disk-btn-icon-plus"}}),BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER")]}),BX.create("div",{html:'<span class="feed-add-destination-input-box" id="feed-add-post-destination-input-box">'+'<input autocomplete="nope" type="text" value="" class="feed-add-destination-inp" id="feed-add-post-destination-input"/>'+"</span>"})]})],buttons:[]})},this)})};FolderListClass.prototype.showRightsOnStorage=function(){storageNewRights={};var e=this.storage.id;var t={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsOnStorageDetail"),{id:"folder_list_rights_detail_storage_"+e,responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate(function(i,s){s&&s.close();if(i.status!="success"){i.errors=i.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:i.errors.pop().message})}if(BX.Disk.isEmptyObject(moduleTasks)){moduleTasks=BX.clone(i.tasks,true);BX.Disk.setModuleTasks(moduleTasks)}for(var o in i.rights){if(!i.rights.hasOwnProperty(o)){continue}var n=i.rights[o];for(var a in n){if(!n.hasOwnProperty(a)){continue}t[o]={readOnly:!!n[a].READ_ONLY,item:{id:o,name:showAccessCodeFullName(i.accessCodeNames[o]),avatar:null},type:"group",right:{title:n[a].TASK.TITLE,id:n[a].TASK.ID}}}}var r=!!i.showExtendedRights;var d=BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_RIGHTS_TITLE_MODAL"),withoutWindowManager:true,contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){storageNewRights=BX.clone(t,true);isChangedRights=false;BX.Access.Init({groups:{disabled:this.isBitrix24}});var e={};for(var i in storageNewRights){if(!storageNewRights.hasOwnProperty(i))continue;storageNewRights[i].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(storageNewRights[i])}BX.addCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeSystemRight,this));BX.addCustomEvent("onDetachSystemRight",BX.proxy(this.onDetachSystemRight,this));BX.bind(BX("feed-add-post-destination-container"),"click",BX.delegate(function(e){var t={};for(var i in storageNewRights){if(!storageNewRights.hasOwnProperty(i))continue;t[i]=true}BX.Access.SetSelected(t);BX.Access.ShowForm({showSelected:true,callback:BX.delegate(function(e){var t=[];for(var i in e){for(var s in e[i]){t.push(e[i][s]);this.onSelectSystemRight(e[i][s],i)}}},this)});BX.Access.popup.getPopupContainer().style.zIndex=d.getZindex()+10;return BX.PreventDefault(e)},this))},this),onPopupClose:BX.delegate(function(){BX.removeCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeRight,this))},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]}),BX.create("div",{style:{marginTop:"27px",marginBottom:"20px"},html:'<input type="checkbox" '+(r?'checked="checked"':"")+' id="showExtendedRights"/><label for="showExtendedRights">'+BX.message("DISK_FOLDER_LIST_LABEL_SHOW_EXTENDED_RIGHTS")+"</label>"})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveRightsOnStorage"),data:{isChangedRights:isChangedRights?1:0,showExtendedRights:BX("showExtendedRights").checked?1:0,storageId:e,storageNewRights:storageNewRights},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);document.location.reload()},this)});if(!!d){d.close()}},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){if(!!d){d.close()}}}})]})},this)})};FolderListClass.prototype.showRightsOnObjectDetail=function(e){storageNewRights={};var t=this.storage.id;var i={};e=e||{};var s=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsOnObjectDetail"),{id:"folder_list_rights_detail_object_"+s,responseType:"json",postData:{objectId:s,storageId:t},afterSuccessLoad:BX.delegate(function(t,o){o&&o.close();if(t.status!="success"){t.errors=t.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}if(BX.Disk.isEmptyObject(moduleTasks)){moduleTasks=BX.clone(t.tasks,true);BX.Disk.setModuleTasks(moduleTasks)}for(var n in t.rights){if(!t.rights.hasOwnProperty(n)){continue}var a=t.rights[n];for(var r in a){if(!a.hasOwnProperty(r)){continue}i[n]={item:{id:n,name:showAccessCodeFullName(t.accessCodeNames[n]),avatar:null},type:"group",right:{title:a[r].TASK.TITLE,id:a[r].TASK.ID}}}}var d=BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_RIGHTS_TITLE_MODAL"),withoutWindowManager:true,contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){storageNewRights=BX.clone(i,true);originalRights=BX.clone(i,true);detachedRights={};BX.Access.Init({groups:{disabled:this.isBitrix24}});for(var e in storageNewRights){if(!storageNewRights.hasOwnProperty(e))continue;storageNewRights[e].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(storageNewRights[e])}BX.addCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeSystemRight,this));BX.addCustomEvent("onDetachSystemRight",BX.proxy(this.onDetachSystemRight,this));BX.bind(BX("feed-add-post-destination-container"),"click",BX.delegate(function(e){var t={};for(var i in storageNewRights){if(!storageNewRights.hasOwnProperty(i))continue;t[i]=true}BX.Access.SetSelected(t);BX.Access.ShowForm({showSelected:true,callback:BX.delegate(function(e){var t=[];for(var i in e){for(var s in e[i]){t.push(e[i][s]);this.onSelectSystemRight(e[i][s],i)}}},this)});BX.Access.popup.getPopupContainer().style.zIndex=d.getZindex()+10;return BX.PreventDefault(e)},this))},this),onPopupClose:BX.delegate(function(){BX.removeCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeRight,this))},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveRightsOnObject"),data:{objectId:s,objectNewRights:storageNewRights,detachedRights:detachedRights},onsuccess:BX.delegate(function(t){if(!t){return}if(e.object.isFolder){t.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_RIGHTS_MODIFIED").replace("#FOLDER#",e.object.name)}else{t.message=BX.message("DISK_FOLDER_LIST_OK_FILE_RIGHTS_MODIFIED").replace("#FILE#",e.object.name)}BX.Disk.showModalWithStatusAction(t)},this)});if(!!d){d.close()}},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){if(!!d){d.close()}}}})]})},this)})};FolderListClass.prototype.openSlider=function(e){BX.SidePanel.Instance.open(e,{allowChangeHistory:false})};FolderListClass.prototype.showSettingsOnBizproc=function(){var e=this.storage.id;var t="";BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSettingsOnBizproc"),{responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate(function(i){if(i.status!="success"){i.errors=i.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:i.errors.pop().message})}if(i.statusBizProc){t="checked"}BX.Disk.modalWindow({modalId:"bx-disk-settings-bizproc",title:BX.message("DISK_FOLDER_LIST_BIZPROC_TITLE_MODAL"),contentClassName:"",events:{},content:[BX.create("table",{html:'<tr><td><label for="activationBizProc">'+BX.message("DISK_FOLDER_LIST_BIZPROC_LABEL")+"</label></td>"+'<td><input type="checkbox" id="activationBizProc" '+t+" /></td>"+"</tr>"})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveSettingsOnBizproc"),data:{storageId:e,activationBizproc:BX("activationBizProc").checked?1:0},onsuccess:BX.delegate(function(e){if(!e){return}if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}else{BX.Disk.showModalWithStatusAction(e)}location.reload()},this)})},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})},this)})};FolderListClass.prototype.openWindowForSelectDocumentService=function(e){var t=new BX.CViewer({});t.openWindowForSelectDocumentService({viewInUf:false})};FolderListClass.prototype.showHiddenContent=function(e){e.style.display=e.style.display=="none"?"block":"none"};FolderListClass.prototype.hide=function(e){if(!e.getAttribute("displayOld")){e.setAttribute("displayOld",e.style.display)}e.style.display="none"};FolderListClass.prototype.showNetworkDriveConnect=function(e){e=e||{};var t=e.link,i=this.showHiddenContent,s=this.hide;i(BX("bx-disk-network-drive-full"));BX.Disk.modalWindow({modalId:"bx-disk-show-network-drive-connect",title:BX.message("DISK_FOLDER_LIST_PAGE_TITLE_NETWORK_DRIVE"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow:function(){var e=BX("disk-get-network-drive-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose:function(){s(BX("bx-disk-network-drive"));s(BX("bx-disk-network-drive-full"));document.body.appendChild(BX("bx-disk-network-drive-full"));this.destroy()}},content:[BX.create("label",{text:BX.message("DISK_FOLDER_LIST_PAGE_TITLE_NETWORK_DRIVE_DESCR_MODAL")+" :",props:{className:"bx-disk-popup-label",for:"disk-get-network-drive-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-network-drive-link",className:"bx-disk-popup-input",type:"text",value:t}}),BX("bx-disk-network-drive-full")],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]});if(BX("bx-disk-network-drive-secure-label")){s(BX.findChildByClassName(BX("bx-disk-show-network-drive-connect"),"bx-disk-popup-label"));s(BX.findChildByClassName(BX("bx-disk-show-network-drive-connect"),"bx-disk-popup-input"))}};FolderListClass.prototype.showSharingDetailWithSharing=function(e){entityToNewShared={};loadedReadOnlyEntityToNewShared={};e=e||{};var t=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailAppendSharing"),{id:"folder_list_sharing_detail_object_"+t,responseType:"json",postData:{objectId:t},afterSuccessLoad:BX.delegate(function(e){if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}var i={name:e.owner.name,avatar:e.owner.avatar,link:e.owner.link};entityToNewSharedMaxTaskName=e.owner.maxTaskName;BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_2"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));for(var t in e.members){if(!e.members.hasOwnProperty(t)){continue}entityToNewShared[e.members[t].entityId]={item:{id:e.members[t].entityId,name:e.members[t].name,avatar:e.members[t].avatar},type:e.members[t].type,right:e.members[t].right}}loadedReadOnlyEntityToNewShared=BX.clone(entityToNewShared,true);BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:e.destination.items,itemsLast:e.destination.itemsLast,itemsSelected:e.destination.itemsSelected});var i=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(i);BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))},this),onPopupClose:BX.delegate(function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+i.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url('+i.avatar+');"></span>'+BX.util.htmlspecialchars(i.name)+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","appendSharing"),data:{objectId:t,entityToNewShared:entityToNewShared},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);var i=BX.delegate(getIconElementByObjectId,this)(t);if(i){if(!entityToNewShared||BX.Disk.isEmptyObject(entityToNewShared)){BX.removeClass(i,"icon-shared icon-shared_2 shared");BX.removeClass(i,"icon-shared_1")}else{BX.addClass(i,"icon-shared icon-shared_2 shared")}}},this)});BX.PopupWindowManager.getCurrentPopup().close()},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})},this)})};FolderListClass.prototype.onCreateExtendedFolder=function(){this.showCreateFolderWithSharing({})};FolderListClass.prototype.showCreateFolderWithSharing=function(){entityToNewShared={};storageNewRights={};var e=this.storage.id;var t={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showCreateFolderWithSharingInCommon"),{id:"folder_list_rights_detail_storage_"+e,responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate(function(i){if(i.status!="success"){i.errors=i.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:i.errors.pop().message})}if(BX.Disk.isEmptyObject(moduleTasks)){moduleTasks=BX.clone(i.tasks,true);BX.Disk.setModuleTasks(moduleTasks)}for(var s in i.rights){if(!i.rights.hasOwnProperty(s)){continue}var o=i.rights[s];for(var n in o){if(!o.hasOwnProperty(n)){continue}t[s]={detachOnly:true,item:{id:s,name:i.accessCodeNames[s].name,avatar:null},type:"group",right:{title:o[n].TASK.TITLE,id:o[n].TASK.ID}}}}BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-create-folder",title:BX.message("DISK_FOLDER_LIST_CREATE_FOLDER_MODAL"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){BX.focus(BX("disk-new-create-filename"));storageNewRights=BX.clone(t,true);for(var e in t){if(!t.hasOwnProperty(e)){continue}BX.Disk.appendRight(t[e])}BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.addCustomEvent("onChangeRight",BX.proxy(this.onChangeRight,this));BX.addCustomEvent("onDetachRight",BX.proxy(this.onDetachRight,this));BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:i.destination.items,itemsLast:i.destination.itemsLast,itemsSelected:i.destination.itemsSelected});var s=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(s);BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))},this),onPopupClose:BX.delegate(function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRight",BX.proxy(this.onChangeRight,this));BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content-small"},children:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-new-create-filename"},children:[BX.create("span",{props:{className:"req"},text:"*"}),BX.message("DISK_FOLDER_LIST_LABEL_NAME_CREATE_FOLDER")]}),BX.create("input",{props:{id:"disk-new-create-filename",className:"bx-disk-popup-input",type:"text",value:""},style:{fontSize:"16px",marginTop:"10px"}})]}),BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(function(){var t=BX("disk-new-create-filename").value;if(!t){BX.focus(BX("disk-new-create-filename"));return}BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","createFolderWithSharing"),data:{name:t,storageId:e,storageNewRights:storageNewRights||{},entityToNewShared:entityToNewShared||{}},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);if(e.status&&e.status=="success"){window.document.location=BX.Disk.getUrlToShowObjectInGrid(e.folder.id)}},this)});BX.PopupWindowManager.getCurrentPopup().close()},this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})},this)})};FolderListClass.prototype.onSelectSystemRight=function(e,t){storageNewRights[e.id]=storageNewRights[e.id]||{};isChangedRights=true;var i=BX.Access.GetProviderPrefix(t,e.id);storageNewRights[e.id]={item:{avatar:null,id:e.id,name:(i?i+": ":"")+e.name},type:"user",right:"read"};storageNewRights[e.id].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(storageNewRights[e.id])};FolderListClass.prototype.onSelectRightDestination=function(e,t,i){storageNewRights[e.id]=storageNewRights[e.id]||{};storageNewRights[e.id]={item:e,type:t,right:storageNewRights[e.id].right||{}};BX.Disk.appendRight({destFormName:this.destFormName,item:e,type:t,right:storageNewRights[e.id].right})};FolderListClass.prototype.onUnSelectRightDestination=function(e,t,i){var s=e.id;delete storageNewRights[s];var o=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":""+s+""}},true);if(o){BX.remove(o)}};FolderListClass.prototype.onChangeSystemRight=function(e,t){if(storageNewRights[e]){isChangedRights=true;storageNewRights[e].right={id:t.ID,title:t.TITLE}}};FolderListClass.prototype.onDetachSystemRight=function(e){if(storageNewRights[e]){isChangedRights=true;BX.Access.DeleteSelected(e);detachedRights[e]=storageNewRights[e];delete storageNewRights[e]}};FolderListClass.prototype.onChangeRight=function(e,t){if(storageNewRights[e]){storageNewRights[e].right={id:t.ID,title:t.TITLE}}};FolderListClass.prototype.onDetachRight=function(e){if(storageNewRights[e]){delete storageNewRights[e]}};FolderListClass.prototype.onSelectDestination=function(e,t,i){entityToNewShared[e.id]=entityToNewShared[e.id]||{};BX.Disk.appendNewShared({maxTaskName:entityToNewSharedMaxTaskName,readOnly:!!loadedReadOnlyEntityToNewShared[e.id],destFormName:this.destFormName,item:e,type:t,right:entityToNewShared[e.id].right});entityToNewShared[e.id]={item:e,type:t,right:entityToNewShared[e.id].right||"disk_access_read"}};FolderListClass.prototype.onUnSelectDestination=function(e,t,i){var s=e.id;if(!!loadedReadOnlyEntityToNewShared[s]){return false}delete entityToNewShared[s];var o=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":""+s+""}},true);if(o){BX.remove(o)}};FolderListClass.prototype.onChangeRightOfSharing=function(e,t){if(entityToNewShared[e]){entityToNewShared[e].right=t}};FolderListClass.prototype.onOpenDialogDestination=function(){BX.style(BX("feed-add-post-destination-input-box"),"display","inline-block");BX.style(BX("bx-destination-tag"),"display","none");BX.focus(BX("feed-add-post-destination-input"));if(BX.SocNetLogDestination.popupWindow)BX.SocNetLogDestination.popupWindow.adjustPosition({forceTop:true})};FolderListClass.prototype.onCloseDialogDestination=function(){var e=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&e&&e.value.length<=0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block")}};FolderListClass.prototype.onOpenSearchDestination=function(){if(BX.SocNetLogDestination.popupSearchWindow)BX.SocNetLogDestination.popupSearchWindow.adjustPosition({forceTop:true})};FolderListClass.prototype.onCloseSearchDestination=function(){var e=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&e&&e.value.length>0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block");BX("feed-add-post-destination-input").value=""}};FolderListClass.prototype.onKeyDownDestination=function(e){var t=this.destFormName;if(e.keyCode==8&&BX("feed-add-post-destination-input").value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(t)}return true};FolderListClass.prototype.onKeyUpDestination=function(e){var t=this.destFormName;if(e.keyCode==16||e.keyCode==17||e.keyCode==18||e.keyCode==20||e.keyCode==244||e.keyCode==224||e.keyCode==91)return false;if(e.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(t);return BX.PreventDefault(e)}if(e.keyCode==27){BX("feed-add-post-destination-input").value=""}else{BX.SocNetLogDestination.search(BX("feed-add-post-destination-input").value,true,t)}if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog())BX.SocNetLogDestination.closeDialog();if(e.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return BX.PreventDefault(e)};FolderListClass.prototype.showSearchProcessInConnectedFolders=function(){if(this.layout.loader){return}this.layout.loader=BX.create("div",{props:{className:"bx-disk-interface-filelist-loader"},children:[BX.create("div",{props:{className:"bx-disk-interface-filelist-loader-wrapper"},children:[this.layout.loaderWrapper=BX.create("div",{props:{className:"bx-disk-interface-filelist-loader-container"}}),BX.create("div",{props:{className:"bx-disk-interface-filelist-loader-text"},text:BX.message("DISK_FOLDER_LIST_SEARCH_PROGRESS_LABEL")})]})]});var e=new BX.Loader({size:170});e.show(this.layout.loaderWrapper);if(this.commonGrid.isGrid()){document.querySelector(".main-grid-wrapper").appendChild(this.layout.loader)}else if(this.commonGrid.isTile()){this.commonGrid.getContainer().parentNode.appendChild(this.layout.loader)}};FolderListClass.prototype.removeSearchProcessInConnectedFolders=function(){if(!this.layout.loader)return;this.layout.loader.parentNode.removeChild(this.layout.loader);this.layout.loader=null};return FolderListClass}();(function(){"use strict";BX.namespace("BX.Disk.Model.FolderList");BX.Disk.Model.FolderList.SearchProgress=function(e){BX.Disk.Model.Item.apply(this,arguments);this.templateId="search-progress"};BX.Disk.Model.FolderList.SearchProgress.prototype={__proto__:BX.Disk.Model.Item.prototype,constructor:BX.Disk.Model.FolderList.SearchProgress,isTimeToShow:function(){return this.state.total>0&&this.state.total!==this.state.current},getDefaultStateValues:function(){return{isTimeToShow:this.isTimeToShow.bind(this)}}};BX.Disk.Model.FolderList.CommonGrid=function(e){this.instance=e.instance};BX.Disk.Model.FolderList.CommonGrid.prototype={constructor:BX.Disk.Model.FolderList.CommonGrid,getId:function(){return this.instance.getId()},isGrid:function(){return!this.isTile()},isTile:function(){return BX.TileGrid.Grid&&this.instance instanceof BX.TileGrid.Grid},getContainer:function(){return this.instance.getContainer()},fade:function(){if(this.isGrid()){this.instance.tableFade()}else{this.instance.setFadeContainer();this.instance.getLoader();this.instance.showLoader()}},unFade:function(){if(this.isGrid()){this.instance.tableUnfade()}else{this.instance.getLoader().hide();this.instance.unSetFadeContainer()}},getActionKey:function(){return"action_button_"+this.instance.getId()},getSelectedIds:function(){if(this.isGrid()){return this.instance.getRows().getSelectedIds()}else{return this.instance.getSelectedItems().map(function(e){return e.getId()})}},countItems:function(){if(this.isGrid()){return this.instance.getRows().getBodyChild().length}else{return this.instance.countItems()}},reload:function(e,t){t=t||{};if(this.isGrid()){var i=new BX.Promise;this.instance.reloadTable("POST",t,function(){i.fulfill()},e);return i}else{return this.instance.reload(e,t)}},getActionsMenu:function(e){if(this.isGrid()){return this.instance.getRows().getById(e).getActionsMenu()}else{var t=this.instance.getItem(e);if(t){return t.getActionsMenu()}}},getItemById:function(e){if(this.isGrid()){return this.instance.getRows().getById(e)}else{return this.instance.getItem(e)}},getActionById:function(e,t){var i=this.getItemById(e);if(i){var s=i.getActions();for(var o=0;o<s.length;o++){if(s[o].id&&s[o].id===t){return s[o]}}}return null},removeItemById:function(e){BX.fireEvent(document,"click");if(this.isGrid()){this.instance.removeRow(e)}else{var t=this.instance.getItem(e);if(t){this.instance.removeItem(t)}}},selectItemById:function(e){var t;if(this.isGrid()){t=this.instance.getRows().getById(e);if(t){t.select()}}else{t=this.instance.getItem(e);if(t){this.instance.selectItem(t)}}},removeSelected:function(){if(this.isGrid()){this.instance.removeSelected()}else{}},sortByColumn:function(e){this.instance.sortByColumn(e)}};BX.namespace("BX.Disk.TileGrid");BX.Disk.TileGrid.Item=function(e){BX.TileGrid.Item.apply(this,arguments);this.isDraggable=e.isDraggable;this.isDroppable=e.isDroppable;this.dblClickDelay=0;this.title=e.name;this.isFolder=e.isFolder;this.isFile=e.isFile;this.canAdd=e.canAdd;this.isLocked=e.isLocked;this.isSymlink=e.isSymlink;this.image=e.image;this.actions=e.actions;this.link=e.link;this.attributes=e.attributes;this.item={container:null,action:null,title:null,titleWrapper:null,titleLink:null,titleInput:null,lock:null,symlink:null,imageBlock:null,picture:null,fileType:null,icons:null};this.actionsMenu=null;this.imageItemHandler=null;BX.addCustomEvent(window,"TileGrid.Grid:onItemDragStart",function(){if(this.actionsMenu)this.actionsMenu.popupWindow.close()}.bind(this))};BX.Disk.TileGrid.Item.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,handleDblClick:function(){BX.onCustomEvent("Disk.TileItem.Item:onItemDblClick",[this])},handleEnter:function(){BX.onCustomEvent("Disk.TileItem.Item:onItemEnter",[this])},getContent:function(){this.item.container=BX.create("div",{attrs:{className:this.isFile?"disk-folder-list-item":"disk-folder-list-item disk-folder-list-item-folder"},children:[this.getImage(),this.getActionBlock(),BX.create("div",{props:{className:!this.getLocked()&&!this.getSymlink()?"disk-folder-list-item-bottom disk-folder-list-item-bottom-without-icons":"disk-folder-list-item-bottom"},children:[this.getTitle(),this.getIconsContainer()]})],events:{contextmenu:function(e){if(e.ctrlKey){return}this.showActionsMenu(e);this.gridTile.resetSelection();this.gridTile.selectItem(this);e.preventDefault()}.bind(this)}});if(this.image){this.imageItemHandler=BX.throttle(this.appendImageItem,20).bind(this);BX.bind(window,"resize",this.imageItemHandler);BX.bind(window,"scroll",this.imageItemHandler)}return this.item.container},appendImageItem:function(){if(this.isVisibleOnFolderList()){this.item.picture.setAttribute("src",this.image);BX.bind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));BX.unbind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));BX.unbind(window,"resize",this.imageItemHandler);BX.unbind(window,"scroll",this.imageItemHandler)}},lock:function(){this.item.lock.style.display=null},unlock:function(){this.item.lock.style.display="none"},getIconsContainer:function(){this.item.icons=BX.create("div",{props:{className:"disk-folder-list-item-icons"},children:[this.getLocked(),this.getSymlink()]});return this.item.icons},getLocked:function(){this.item.lock=BX.create("div",{attrs:{className:"disk-folder-list-item-locked"},style:{display:this.isLocked?null:"none"}});return this.item.lock},getSymlink:function(){this.item.symlink=BX.create("div",{attrs:{className:"disk-folder-list-item-shared"},style:{display:this.isSymlink?null:"none"}});return this.item.symlink},getTitle:function(){return this.item.title=BX.create("div",{props:{className:"disk-folder-list-item-title"},children:[this.item.titleWrapper=BX.create("div",{props:{className:"disk-folder-list-item-title-wrapper"},children:[this.getTitleInput(),this.item.titleLink=BX.create("a",{attrs:{className:"disk-folder-list-item-title-link",href:this.link,title:this.title},text:this.title,dataset:BX.mergeEx({objectId:this.id,canAdd:this.canAdd},this.attributes)})]})]})},getTitleInput:function(){this.item.titleInput=BX.create("input",{attrs:{className:"disk-folder-list-item-title-input",type:"text",value:this.title}});BX.bind(this.item.titleInput,"click",function(e){e.stopPropagation()});BX.addCustomEvent(window,"BX.TileGrid.Grid:resetSelectAllItems",this.cancelRenaming.bind(this));BX.addCustomEvent(window,"BX.TileGrid.Grid:selectItem",this.cancelRenaming.bind(this));BX.bind(this.item.titleInput,"keydown",function(e){if(e.key==="Escape"){this.cancelRenaming();e.preventDefault()}if(e.key==="Enter"){this.cancelRenaming();this.runRename();e.preventDefault()}e.stopPropagation()}.bind(this));return this.item.titleInput},onRename:function(){this.gridTile.resetSelection();jsDD.Disable();this.item.titleInput.value=this.title;BX.addClass(this.item.title,"disk-folder-list-item-title-rename");this.item.titleInput.focus();if(this.isFile){this.item.titleInput.setSelectionRange(0,this.title.lastIndexOf("."))}else{this.item.titleInput.select()}},cancelRenaming:function(){BX.removeClass(this.item.title,"disk-folder-list-item-title-rename");this.item.titleInput.blur();jsDD.Enable()},rename:function(e){BX.addClass(this.item.titleLink,"disk-folder-list-item-title-link-renamed");this.item.titleLink.addEventListener("animationend",function(){BX.removeClass(this.item.titleLink,"disk-folder-list-item-title-link-renamed")}.bind(this));this.item.titleLink.textContent=e;this.item.titleLink.setAttribute("title",e);this.title=e;this.rebuildLinkAfterRename(e);jsDD.Enable()},rebuildLinkAfterRename:function(e){if(this.isFile){this.link=this.link.substring(0,this.link.lastIndexOf("/")+1)+encodeURIComponent(e)}else{this.link=this.link.substring(0,this.link.lastIndexOf("/",this.link.length-2)+1)+encodeURIComponent(e)+"/"}this.item.titleLink.href=this.link;this.actions.forEach(function(e){if(e.id==="open"&&e.href){e.href=this.link}},this);this.destroyActionsMenu()},runRename:function(){var e=this.title;this.rename(this.item.titleInput.value);BX.ajax.runAction("disk.api.commonActions.rename",{analyticsLabel:"folder.list",data:{objectId:this.getId(),newName:this.title,autoCorrect:true}}).catch(function(t){BX.Disk.showModalWithStatusAction(t);this.rename(e)}.bind(this))},afterRender:function(){if(!this.item.picture)return;if(this.isVisibleOnFolderList()){this.appendImageItem()}BX.bind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));this.item.picture.onload=function(){BX.show(this.item.picture);BX.hide(this.item.fileType)}.bind(this)},isVisibleOnFolderList:function(){var e=this.layout.container.getBoundingClientRect();var t=document.body.getBoundingClientRect();var i=this.layout.container.offsetHeight*2;if(e.top<0||e.bottom<0)return false;return t.height>e.top-i&&t.height>=e.bottom-i},getImage:function(){var e=this.getFileExtension(this.title);this.item.imageBlock=BX.create("div",{attrs:{className:"disk-folder-list-item-image"},children:[this.item.fileType=BX.create("div",{attrs:{className:"ui-icon ui-icon-file ui-icon-file-"+e},style:{width:this.isFolder?"85%":"70%"},html:"<i></i>"}),this.item.picture=this.image?BX.create("img",{attrs:{className:"disk-folder-list-item-image-img"},style:{display:"none"}}):null]});return this.item.imageBlock},markAsShared:function(){this.isSymlink=true;if(this.isFolder){this.item.fileType.classList.add("ui-icon-file-folder-shared")}else if(this.item.symlink){this.item.symlink.style.display=null}},unmarkAsShared:function(){this.isSymlink=false;if(this.isFolder){this.item.fileType.classList.remove("ui-icon-file-folder-shared")}else if(this.item.symlink){this.item.symlink.style.display="none"}},getFileExtension:function(e){var t=e.substring(e.lastIndexOf(".")+1);switch(t){case"mp4":case"mkv":case"mpeg":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"swf":case"wmv":t="mov";break;case"txt":t="txt";break;case"doc":case"docx":t="doc";break;case"xls":case"xlsx":t="xls";break;case"php":t="php";break;case"pdf":t="pdf";break;case"ppt":case"pptx":t="ppt";break;case"rar":t="rar";break;case"set":t="set";break;case"mov":t="mov";break;case"img":case"jpg":case"jpeg":case"gif":t="img";break;default:t="empty"}this.isFolder?t="folder":null;this.isSymlink&&this.isFolder?t="folder-shared":null;return t},getActionBlock:function(){if(!this.item.action){this.item.action=BX.create("div",{attrs:{className:"disk-folder-list-item-action"},events:{click:function(e){this.showActionsMenu(e,BX.getEventTarget(e))}.bind(this)}})}return this.item.action},getActions:function(){return this.actions},destroyActionsMenu:function(){if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}},getActionsMenu:function(e){if(this.actionsMenu){return this.actionsMenu}this.actionsMenu=BX.PopupMenu.create("-disk-folder-list-item-action-menu"+this.getId(),e,this.actions,{autoHide:true,offsetLeft:20,angle:true});BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",function(e){var t=this.getActionsMenu();if(t){var i=BX.getEventTarget(e);var s=BX.findParent(i,{className:"menu-popup-item"},10);if(!s||!s.dataset.preventCloseContextMenu){t.close()}}}.bind(this));return this.actionsMenu},showActionsMenu:function(e,t){BX.fireEvent(document.body,"click");var i=this.getActionsMenu(t);i.show();if(!t){i.popupWindow.popupContainer.style.top=e.pageY+"px";i.popupWindow.popupContainer.style.left=e.pageX-35+"px"}else if(t){var s=BX.pos(t);s.forceBindPosition=true;i.popupWindow.setBindElement(t);i.popupWindow.adjustPosition(s)}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?154412738446925";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.Filter=function(t,e,s,i,r,a){this.params=t;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=s;this.dateTypes=i;this.additionalDateTypes=a;this.numberTypes=r;this.settings=new BX.Filter.Settings(e,this);this.filter=null;this.api=null;this.isAddPresetModeState=false;this.firstInit=true;this.init()};function t(t){if(BX.type.isString(t)){t=t.toLowerCase();t=t.replace(/[\-_\s]+(.)?/g,function(t,e){return e?e.toUpperCase():""});return t.substr(0,1).toLowerCase()+t.substr(1)}return t}BX.Main.Filter.prototype={init:function(){BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));BX.bind(window,"load",BX.delegate(this.onWindowLoad,this));BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"))},onWindowLoad:function(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},clearGet:function(){if("history"in window){var t=window.location.toString();var e=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",e)}},adjustFocus:function(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function(t){if(BX.Filter.Utils.isKey(t,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}}},getApi:function(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function(t,e,s){var i=this.getPreset();var r=i.getContainer();var a=i.createSidebarItem(t,e,s);var n=i.getPresetNodeById(t);if(BX.type.isDomNode(n)){BX.remove(n);BX.prepend(a,r)}else{r&&r.insertBefore(a,i.getAddPresetField())}BX.bind(a,"click",BX.delegate(i._onPresetClick,i))},saveUserSettings:function(t){var e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var i=s.getCurrentPresetId();var r={};this.params["PRESETS"]=BX.clone(this.editablePresets);r.current_preset=i;s.getPresets().forEach(function(e,i){var a=s.getPresetId(e);if(a&&a!=="tmp_filter"){var n=s.getPreset(a);n.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(n.TITLE));n.SORT=i;s.updatePresetName(e,n.TITLE);r[a]={sort:i,name:n.TITLE,fields:this.preparePresetSettingsFields(n.FIELDS),for_all:t&&!BX.type.isBoolean(n.FOR_ALL)||t&&n.FOR_ALL===true}}},this);this.saveOptions(r,e,null,t)},isForAll:function(t){var e=this.getForAllCheckbox();return BX.type.isBoolean(t)&&t||!!e&&!!e.checked},getForAllCheckbox:function(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function(t){var e={};var s;(t||[]).forEach(function(t){switch(t.TYPE){case this.types.STRING:{e[t.NAME]=t.VALUE;break}case this.types.SELECT:{e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.DATE:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_datesel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_numsel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.DEST_SELECTOR:{if(BX.type.isPlainObject(t.VALUES)){e[t.NAME]=t.VALUES._value;e[t.NAME+"_label"]=t.VALUES._label}break}case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(t.VALUES)){e[t.NAME]=t.VALUES._value;e[t.NAME+"_label"]=t.VALUES._label}break}default:{break}}},this);return e},savePreset:function(){var t="filter_"+ +new Date;var e=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(t,e,null,true,null,null,true);this.addSidebarItem(t,e);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function(t,e,s,i,r,a,n){var l=this.getFilterFieldsValues();var o=this.getPreset().getFields().map(function(t){return BX.data(t,"name")});var h=this.getPreset().getCurrentPresetData();var d={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var u,c,f,p,g;var B={};B.additional={};if(t!=="tmp_filter"&&t!=="default_filter"&&!n){var E=BX.type.isArray(h.ADDITIONAL)?h.ADDITIONAL:[];E.forEach(function(t){Object.keys(l).forEach(function(e){if(e.indexOf(t.NAME)!==-1){B.additional[e]=l[e];delete l[e]}})})}u=Object.keys(l);if(!s){B.apply_filter="Y"}else{B.clear_filter="Y"}B.save="Y";B.fields=l;B.rows=o.join(",");B.preset_id=t||h.ID;if(BX.type.isNotEmptyString(e)){B.name=BX.util.htmlspecialchars(e)}else{f=this.getPreset().getPresetNodeById(B.preset_id);p=this.getPreset().getPresetInput(f);if(BX.type.isDomNode(p)&&BX.type.isNotEmptyString(p.value)){B.name=p.value}else{B.name=h.TITLE}}if((!("sort"in B)||!BX.type.isNumber(B.sort))&&i){g=this.getParam("PRESETS");B.sort=g.length+2}if(!s){u.forEach(function(t){if(BX.type.isArray(B.fields[t])){c=B.fields[t].length?{}:"";B.fields[t].forEach(function(t,e){c[e]=t},this);if(c||BX.type.isNumber(c)||BX.type.isBoolean(c)){B.fields[t]=c}}},this)}if(B.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(B)}if(BX.type.isFunction(r)){r()}var m=new BX.Promise(null,this);m.setAutoResolve("fulfill",0);m.then(function(){var t=new BX.Promise(null,this);this.saveOptions(B,d,BX.proxy(t.fulfill,t));return t}).then(function(){!!a&&a()});return m},saveFieldsSort:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var e=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(e)){s.rows=e.map(function(t){return BX.data(t,"name")});s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,t)},updateParams:function(t){var e,s;var i=[];if(BX.type.isPlainObject(t)&&"preset_id"in t){e=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(e)){if("name"in t&&BX.type.isNotEmptyString(t.name)){e.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach(function(e){t.fields[e]=""})}if("fields"in t){e.FIELDS=this.preparePresetFields(t.fields,t.rows)}if("additional"in t&&e.ID!=="tmp_filter"){e.ADDITIONAL=this.preparePresetFields(t.additional,t.rows)}}else{s=this.getParam("PRESETS");e={ID:t.preset_id,TITLE:t.name,SORT:s.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};s.push(e)}}},preparePresetFields:function(t,e){var s,i;var r=[];if(BX.type.isPlainObject(t)){e=BX.type.isNotEmptyString(e)?e.split(","):[];s=e.length?e:Object.keys(t);s.forEach(function(e){e=e.replace("_datesel","").replace("_numsel","");i=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(i)){if(i.TYPE===this.types.STRING){i.VALUE=t[e]}if(i.TYPE===this.types.MULTI_SELECT){i.VALUE=this.prepareMultiSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.SELECT||i.TYPE===this.types.CHECKBOX){i.VALUE=this.prepareSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.DATE){i.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_month"],_quarter:t[e+"_quarter"],_year:t[e+"_year"],_allow_year:t[e+"_allow_year"]}}if(i.TYPE===this.types.CUSTOM_DATE){i.VALUE={days:Object.keys(t[e+"_days"]||{}).map(function(s){return t[e+"_days"][s]}),months:Object.keys(t[e+"_months"]||{}).map(function(s){return t[e+"_months"][s]}),years:Object.keys(t[e+"_years"]||{}).map(function(s){return t[e+"_years"][s]})}}if(i.TYPE===this.types.NUMBER){i.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(i.TYPE===this.types.DEST_SELECTOR){if(typeof t[e+"_label"]!=="undefined"){i.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){i.VALUES._value=t[e]}}if(i.TYPE===this.types.CUSTOM_ENTITY){if(typeof t[e+"_label"]!=="undefined"){i.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){i.VALUES._value=t[e]}}if(i.TYPE===this.types.CUSTOM){i._VALUE=t[e]}r.push(i)}},this)}return r},prepareSelectValue:function(t,e){var s={};var i;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(e)){i=this.prepareMultiSelectValue({0:t},e);s=i.length>0?i[0]:{}}else{s=e[0]}return s},prepareMultiSelectValue:function(t,e){var s=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(e)){var i=Object.keys(t);var r=i.map(function(e){return t[e]});s=e.filter(function(t){return r.some(function(e){return e===t.VALUE})},this)}return s},getFieldByName:function(t){var e=this.getParam("FIELDS");e=e.filter(function(e){return e.NAME===t},this);return e.length>0?e[0]:null},confirmSaveForAll:function(){return new Promise(function(t){var e={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(e,t)}.bind(this))},saveOptions:function(e,s,i,r){s.action=t(s.action);s.forAll=this.isForAll(r);s.commonPresetsId=this.getParam("COMMON_PRESETS_ID");s.apply_filter=e.apply_filter||"N";s.clear_filter=e.clear_filter||"N";s.with_preset=e.with_preset||"N";s.save=e.save||"N";var a={params:s,data:e};delete e.apply_filter;delete e.save;delete e.clear_filter;delete e.with_preset;if(s.forAll&&s.action==="setFilterArray"){return this.confirmSaveForAll().then(function(){return this.backend(s.action,a)}.bind(this)).then(function(){this.disableEdit();this.disableAddPreset()}.bind(this))}return this.backend(s.action,a).then(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(i)&&i()}.bind(this))},backend:function(t,e){return BX.ajax.runComponentAction("bitrix:main.ui.filter",t,{mode:"ajax",data:e})},prepareEvent:function(t){var e,s;if(!("path"in t)||!t.path.length){t.path=[t.target];e=0;while((s=t.path[e++].parentNode)!==null){t.path.push(s)}}return t},restoreRemovedPreset:function(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var e=t.ID;var s=this.getPreset().getPresetNodeById(e);this.getPreset().applyPreset(e);this.getPreset().activatePreset(s)}}},hasScrollClick:function(t){var e="clientX"in t?t.clientX:"x"in t?t.x:0;return e>=document.documentElement.offsetWidth},isUseCommonPresets:function(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function(t){t=this.prepareEvent(t);return(t.path||[]).some(function(t){return BX.type.isDomNode(t)&&(BX.hasClass(t,this.settings.classFilterContainer)||BX.hasClass(t,this.settings.classSearchContainer)||BX.hasClass(t,this.settings.classDefaultPopup)||BX.hasClass(t,this.settings.classPopupOverlay))},this)},_onDocumentClick:function(t){var e=this.getPopup();if(!this.isInsideFilterEvent(t)&&!this.hasScrollClick(t)){if(e&&e.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function(t){var e=this.getFieldsPopup();t.stopPropagation();t.preventDefault();if(e&&!e.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function(t){if(BX.type.isPlainObject(t)){if(t.cache===false){this.fieldsPopupItems=null}}var e=this.getPreset().getFields();var s=this.getFieldsPopupItems();var i,r;if(BX.type.isArray(s)&&s.length){s.forEach(function(t){i=BX.data(t,"name").replace("_datesel","").replace("_numsel","");r=e.some(function(t){return BX.data(t,"name")===i});if(r){BX.addClass(t,this.settings.classMenuItemChecked)}else{BX.removeClass(t,this.settings.classMenuItemChecked)}},this)}},getFieldsPopupItems:function(){if(!BX.type.isArray(this.fieldsPopupItems)){var t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}}return this.fieldsPopupItems},getFieldListContainerClassName:function(t){var e=this.settings.classPopupFieldList1Column;if(t>6&&t<12){e=this.settings.classPopupFieldList2Column}if(t>12){e=this.settings.classPopupFieldList3Column}return e},prepareFieldsDecl:function(t){return(t||[]).map(function(t){return{block:"main-ui-filter-field-list-item",label:"LABEL"in t?t.LABEL:"",id:"ID"in t?t.ID:"",name:"NAME"in t?t.NAME:"",item:t,onClick:BX.delegate(this._clickOnFieldListItem,this)}},this)},getLazyLoadFields:function(){var t=new BX.Promise;BX.ajax({method:"GET",url:this.getParam("LAZY_LOAD")["GET_LIST"],dataType:"json",onsuccess:function(e){t.fulfill(e)}});return t},getFieldsListPopupContent:function(){var t=new BX.Promise;var e=this.getParam("FIELDS");var s=BX.type.isArray(e)?e.length:0;if(this.getParam("LAZY_LOAD")){this.getLazyLoadFields().then(function(e){var s={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(e.length),content:this.prepareFieldsDecl(e)};t.fulfill(BX.decl(s))}.bind(this));return t}var i={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(s),content:this.prepareFieldsDecl(e)};t.fulfill(BX.decl(i));return t},getFieldLoader:function(){if(!this.fieldLoader){this.fieldLoader=new BX.Loader({mode:"custom",size:18,offset:{left:"5px",top:"5px"}})}return this.fieldLoader},_clickOnFieldListItem:function(t){var e=t.target;var s;if(!BX.hasClass(e,this.settings.classFieldListItem)){e=BX.findParent(e,{className:this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(e)){try{s=JSON.parse(BX.data(e,"item"))}catch(t){}var i=new BX.Promise;if(this.getParam("LAZY_LOAD")){this.getFieldLoader().show(e);var r=e.querySelector(".main-ui-select-inner-label");if(r){r.classList.add("main-ui-no-before")}this.getLazyLoadField(s.NAME).then(function(t){i.fulfill(t);this.getFieldLoader().hide();if(r){r.classList.remove("main-ui-no-before")}}.bind(this))}else{i.fulfill(s)}i.then(function(t){this.params.FIELDS.push(t);if(BX.hasClass(e,this.settings.classMenuItemChecked)){BX.removeClass(e,this.settings.classMenuItemChecked);this.getPreset().removeField(t)}else{if(BX.type.isPlainObject(t)){this.getPreset().addField(t);BX.addClass(e,this.settings.classMenuItemChecked);if(BX.type.isString(t.HTML)){var s=BX.create("div");this.getHiddenElement().appendChild(s);BX.html(s,t.HTML)}}}this.syncFields()}.bind(this))}},getHiddenElement:function(){if(!this.hiddenElement){this.hiddenElement=BX.create("div");document.body.appendChild(this.hiddenElement)}return this.hiddenElement},getLazyLoadField:function(t){var e=new BX.Promise;BX.ajax({method:"get",url:BX.util.add_url_param(this.getParam("LAZY_LOAD")["GET_FIELD"],{id:t}),dataType:"json",onsuccess:function(t){e.fulfill(t)}});return e},showFieldsPopup:function(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function(){var t=this.getFieldsPopup();var e=BX.pos(this.getAddField());e.forceBindPosition=true;t.adjustPosition(e)},getFieldsPopup:function(){var t=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopupLoader=new BX.Loader({target:this.fieldsPopup.contentContainer});this.fieldsPopupLoader.show();this.fieldsPopup.contentContainer.style.width="630px";this.fieldsPopup.contentContainer.style.height="330px";this.getFieldsListPopupContent().then(function(t){this.fieldsPopup.contentContainer.removeAttribute("style");this.fieldsPopupLoader.hide();this.fieldsPopup.setContent(t);this.syncFields({cache:false})}.bind(this))}return this.fieldsPopup},_onAddPresetClick:function(){this.enableAddPreset()},enableWaitSate:function(t){!!t&&BX.addClass(t,this.settings.classWaitButtonClass)},disableWaitState:function(t){!!t&&BX.removeClass(t,this.settings.classWaitButtonClass)},_onSaveButtonClick:function(){var t=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;var e=this.getPreset().getAddPresetFieldInput();var s=e.parentNode.querySelector(".main-ui-filter-edit-mask");var i;function r(t){if(t.animationName==="fieldError"){t.currentTarget.removeEventListener("animationend",r);t.currentTarget.removeEventListener("oAnimationEnd",r);t.currentTarget.removeEventListener("webkitAnimationEnd",r);t.currentTarget.classList.remove("main-ui-filter-error")}}function a(t){t.addEventListener("animationend",r);t.addEventListener("oAnimationEnd",r);t.addEventListener("webkitAnimationEnd",r);t.classList.add("main-ui-filter-error");var e=new BX.Promise;e.fulfill(true);return e}this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!t){i=e.value;if(i.length){this.savePreset();this.disableAddPreset()}else{a(s).then(function(){e.focus()})}}if(this.isEditEnabled()){var n=this.getPreset();var l=n.getPresetNodeById(n.getCurrentPresetId());var o=n.getPresetInput(l);if(o.value.length){n.updateEditablePreset(n.getCurrentPresetId());this.saveUserSettings(t);!t&&this.disableEdit()}else{var h=l.querySelector(".main-ui-filter-edit-mask");a(h).then(function(){o.focus()})}}},_onCancelButtonClick:function(){this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterMousedown:function(t){var e=t.target;if(this.getFields().isDragButton(e)){var s=BX.Filter.Utils.getByTag(e.parentNode,"input",true);(s||[]).forEach(function(t){BX.fireEvent(t,"blur")});BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function(t){var e=this.getFields();var s=this.getPreset();var i;if(e.isFieldDelete(t.target)){i=e.getField(t.target);s.removeField(i)}if(e.isFieldValueDelete(t.target)){i=e.getField(t.target);e.clearFieldValue(i)}},getButtonsContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function(){return this.isAddPresetModeState},enableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=t.getAddPresetFieldInput();var i=this.getButtonsContainer();BX.show(e);BX.show(i);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=this.getButtonsContainer();BX.hide(e);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function(){var t=this.getFieldListContainer();var e=null;if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return e},getFilterFields:function(){var t=this.getFieldListContainer();var e=[];var s=[];if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classField,true);s=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(e)){e=[]}if(BX.type.isArray(s)){s.forEach(function(t){e.push(t)})}}return e},getFilterFieldsValues:function(){var t=this.getPreset().getFields();var e=this.getSearch();var s={};var i,r;s["FIND"]=e.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach(function(t){i=BX.data(t,"type");r=BX.data(t,"name");switch(i){case this.types.STRING:{this.prepareControlStringValue(s,t);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,r,t);break}case this.types.DATE:{this.prepareControlDateValue(s,r,t);break}case this.types.CUSTOM_DATE:{this.prepareControlCustomDateValue(s,r,t);break}case this.types.SELECT:{this.prepareControlSelectValue(s,r,t);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,r,t);break}case this.types.DEST_SELECTOR:{this.prepareControlCustomEntityValue(s,r,t);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,r,t);break}case this.types.CUSTOM_ENTITY:{this.prepareControlCustomEntityValue(s,r,t);break}default:{break}}},this)}return s},prepareControlCustomEntityValue:function(t,e,s){var i=this.fetchSquares(s);var r=this.fetchSquaresData(i);var a=BX.Main.ui.CustomEntity.isMultiple(s);t[e]="";t[e+"_label"]="";if(a){t[e]=[];t[e+"_label"]=[];!!r&&r.forEach(function(s){t[e].push(s._value.toString());t[e+"_label"].push(s._label.toString())})}else{if(r.length){t[e]=r[0]._value.toString();t[e+"_label"]=r[0]._label.toString()}}},fetchSquares:function(t){return!!t?BX.Filter.Utils.getByClass(t,this.settings.classSquare,true):[]},fetchSquaresData:function(t){return t.map(function(t){return JSON.parse(BX.data(t,"item"))},this)},prepareControlCustomValue:function(t,e,s){var i=BX.Filter.Utils.getByTag(s,"input",true);t[e]="";if(BX.type.isArray(i)){i.forEach(function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}})}},prepareControlMultiselectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var r=JSON.parse(BX.data(i,"value"));t[e]="";if(BX.type.isArray(r)&&r.length){t[e]={};r.forEach(function(s,i){t[e][i]=s.VALUE})}},prepareControlSelectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=JSON.parse(BX.data(i,"value"));t[e]=r.VALUE},prepareControlCustomDateValue:function(t,e,s){var i=s.querySelector('[data-name="'+e+"_days"+'"]');if(i){var r=JSON.parse(i.dataset.value);t[e+"_days"]=r.map(function(t){return t.VALUE})}var a=s.querySelector('[data-name="'+e+"_months"+'"]');if(a){var n=JSON.parse(a.dataset.value);t[e+"_months"]=n.map(function(t){return t.VALUE})}var l=s.querySelector('[data-name="'+e+"_years"+'"]');if(l){var o=JSON.parse(l.dataset.value);t[e+"_years"]=o.map(function(t){return t.VALUE})}},prepareControlDateValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=s.querySelector('.main-ui-select[data-name*="_allow_year"]');var a=e+this.settings.datePostfix;var n=e+this.settings.fromPostfix;var l=e+this.settings.toPostfix;var o=e+this.settings.daysPostfix;var h=e+this.settings.monthPostfix;var d=e+this.settings.quarterPostfix;var u=e+this.settings.yearPostfix;var c=e+"_allow_year";var f,p,g,B,E;t[a]="";t[n]="";t[l]="";t[o]="";t[h]="";t[d]="";t[u]="";f=JSON.parse(BX.data(i,"value"));t[a]=f.VALUE;if(r){E=JSON.parse(BX.data(r,"value"));t[c]=E.VALUE}switch(f.VALUE){case this.dateTypes.EXACT:{p=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);t[n]=p.value;t[l]=p.value;break}case this.dateTypes.QUARTER:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_quarter")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}if(B&&B.indexOf("_year")!==-1){t[u]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.YEAR:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_year")!==-1){t[u]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.MONTH:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_month")!==-1){t[h]=JSON.parse(BX.data(e,"value")).VALUE}if(B&&B.indexOf("_year")!==-1){t[u]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.additionalDateTypes.PREV_DAY:case this.additionalDateTypes.NEXT_DAY:case this.additionalDateTypes.MORE_THAN_DAYS_AGO:case this.additionalDateTypes.AFTER_DAYS:case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var m=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput);if(!!m&&m.name===o){t[o]=m.value}break}case this.dateTypes.RANGE:{p=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);p.forEach(function(e){if(e.name===n){t[n]=e.value}else if(e.name===l){t[l]=e.value}},this);break}case"CUSTOM_DATE":{var P={};this.prepareControlCustomDateValue(P,e,s);t[e+"_days"]=P[e+"_days"];t[h]=P[e+"_months"];t[u]=P[e+"_years"];break}default:{break}}},prepareControlNumberValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var r=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=e+this.settings.numberPostfix;var n=e+this.settings.fromPostfix;var l=e+this.settings.toPostfix;var o;t[n]="";t[l]="";o=JSON.parse(BX.data(r,"value"));t[a]=o.VALUE;i.forEach(function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[n]=e.value||"";if(t[a]==="exact"){t[l]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[l]=e.value||""}},this)},prepareControlStringValue:function(t,e){var s=BX.Filter.Utils.getByClass(e,this.settings.classStringInput);var i;if(BX.type.isDomNode(s)){i=s.name;t[i]=s.value}},showGridAnimation:function(){this.grid&&this.grid.tableFade()},hideGridAnimation:function(){this.grid&&this.grid.tableUnfade()},getPresetId:function(t,e){var s=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!e||s==="default_filter"&&!t){s="tmp_filter"}return s},applyFilter:function(t,e){var s=this.getPresetId(t,e);var i=this.getParam("FILTER_ID");var r=new BX.Promise(null,this);var a=this.getPreset();var n=this.getSearch();var l={autoResolve:!this.grid};var o=this;this.clearGet();this.showGridAnimation();BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[i,{},this,r]);this.updatePreset(s,null,t,null).then(function(){n.updatePreset(a.getPreset(s));if(o.getParam("VALUE_REQUIRED")){if(!n.getSquares().length){o.lastPromise=a.applyPinnedPreset()}}}).then(function(){var t={apply_filter:"Y",clear_nav:"Y"};var e=BX.delegate(r.fulfill,r);var s=BX.delegate(r.reject,r);o.grid&&o.grid.reloadTable("POST",t,e,s);BX.onCustomEvent(window,"BX.Main.Filter:apply",[i,{},o,r,l]);l.autoResolve&&r.fulfill()});return r},getAddField:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.CUSTOM_DATE:{t.VALUES={days:[],months:[],years:[]};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.DEST_SELECTOR:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function(t){var e=this.getPreset().getField({NAME:t});var s,i;if(BX.type.isDomNode(e)){s=this.getFieldByName(t);s=this.resetControlData(s);i=this.getPreset().createControl(s);BX.insertAfter(i,e);BX.remove(e)}},clearControls:function(t){if(BX.type.isArray(t)){t.forEach(function(t){"name"in t&&this.clearControl(t.name)},this)}else if(BX.type.isPlainObject(t)&&"name"in t){this.clearControl(t.name)}},getTemplate:function(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function(){var t=this.getPopup();var e=t.popupContainer;var s=this.settings.get("FILTER_CLOSE_DELAY");var i;setTimeout(BX.delegate(function(){if(!this.isIe()){BX.removeClass(e,this.settings.classAnimationShow);BX.addClass(e,this.settings.classAnimationClose);i=parseFloat(BX.style(e,"animation-duration"));if(BX.type.isNumber(i)){i=i*1e3}setTimeout(function(){t.close()},i)}else{t.close()}},this),s);this.closeFieldListPopup();this.adjustFocus()},showPopup:function(){var t=this.getPopup();var e;if(!t.isShown()){this.isOpened=true;var s=this.settings.get("FILTER_SHOW_DELAY");setTimeout(BX.delegate(function(){t.show();if(!this.isIe()){e=t.popupContainer;BX.removeClass(e,this.settings.classAnimationClose);BX.addClass(e,this.settings.classAnimationShow);BX.onCustomEvent(window,"BX.Main.Filter:show",[this])}},this),s)}},getSaveForAllCheckbox:function(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function(){if(!this.popupBindElement){var t=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var e=null;if(BX.type.isNotEmptyString(t)){e=BX.Filter.Utils.getBySelector(document,t)}this.popupBindElement=!!e?e:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function(){this.restoreDefaultFields()},restoreDefaultFields:function(){var t=this.getPreset().getPreset("default_filter",true);var e=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var r=t.FIELDS.map(function(t){return t.NAME});var a=r.join(",");e.forEach(function(s,i){if(s.ID==="default_filter"){e[i]=BX.clone(t)}},this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach(function(e,s){if(e.ID==="default_filter"){this.editablePresets[s]=BX.clone(t)}},this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:a,save:"Y",apply_filter:"N"},i)},getRestoreFieldsButton:function(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function(){var t=this.getParam("DEFAULT_PRESETS");var e=this.getParam("PRESETS");var s=false;var i,r,a;if(BX.type.isArray(t)){t.sort(function(t,e){return t.SORT<e.SORT});t.forEach(function(t){s=e.some(function(e,s){if(e.ID===t.ID){i=s;return true}});if(s){e[i]=BX.clone(t)}else{e.push(BX.clone(t))}if(t.ID!=="default_filter"){this.addSidebarItem(t.ID,t.TITLE,t.PINNED);if(t.PINNED){r=t.ID}}},this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!r){r="default_filter"}a=this.getPreset().getPresetNodeById(r);if(a){BX.fireEvent(a,"click")}},saveRestoreFilter:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var e=this.getParam("PRESETS");var s={};var i;if(BX.type.isArray(e)){e.forEach(function(t){i=t.FIELDS.map(function(t){return t.NAME});i=i.join(",");s[t.ID]={name:t.TITLE||null,sort:t.SORT,preset_id:t.ID,fields:this.prepareFields(t.FIELDS),rows:i,for_all:t.FOR_ALL}},this);this.saveOptions(s,t)}},prepareFields:function(t){var e={};var s;if(BX.type.isArray(t)){t.forEach(function(t){if(t.TYPE===this.types.SELECT){e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:""}if(t.TYPE===this.types.MULTI_SELECT){t.VALUE.forEach(function(s,i){e[t.NAME]=e[t.NAME]||{};e[t.NAME][i]=s.VALUE});e[t.NAME]=e[t.NAME]||""}if(t.TYPE===this.types.DATE||t.TYPE===this.types.NUMBER){s=Object.keys(t.VALUES);s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]});if(t.TYPE===this.types.DATE){e[t.NAME+"_datesel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}if(t.TYPE===this.types.NUMBER){e[t.NAME+"_numsel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}}if(t.TYPE===this.types.DEST_SELECTOR){e[t.NAME+"_label"]=t.VALUES._label;e[t.NAME+"_value"]=t.VALUES._value}if(t.TYPE===this.types.CUSTOM_ENTITY){e[t.NAME+"_label"]=t.VALUES._label;e[t.NAME+"_value"]=t.VALUES._value}},this)}return e},getRestoreButton:function(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getFindButton(),"click")}},_onFindButtonClick:function(){var t=this.getPreset();var e=t.getCurrentPresetId();var s;if(e!=="tmp_filter"&&e!=="default_filter"&&!t.isPresetValuesModified(e)){var i=t.getPreset(e);var r=t.getAdditionalValues(e);var a=t.getFields().map(function(t){return BX.data(t,"name")});i.ADDITIONAL=this.preparePresetFields(r,a);i.ADDITIONAL=i.ADDITIONAL.filter(function(t){return!this.getPreset().isEmptyField(t)},this);t.applyPreset(e);s=this.applyFilter(false,e);this.closePopup()}else{t.deactivateAllPresets();s=this.applyFilter();this.closePopup()}return s},_onResetButtonClick:function(){if(this.getParam("VALUE_REQUIRED")){var t=this.getPreset().getCurrentPresetData();if(t.ADDITIONAL.length){this.closePopup()}BX.fireEvent(this.getSearch().getClearButton(),"click")}else{if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()}},resetFilter:function(t){var e=this.getSearch();var s=this.getPreset();if(!t){e.clearInput()}e.removePreset();s.deactivateAllPresets();s.resetPreset(true);e.hideClearButton();e.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function(t){var e=this.getDragButton(t);e.onbxdragstart=BX.delegate(this._onFieldDragStart,this);e.onbxdragstop=BX.delegate(this._onFieldDragStop,this);e.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(e);jsDD.registerDest(e);return t},unregisterDragItem:function(t){var e=this.getDragButton(t);jsDD.unregisterObject(e);jsDD.unregisterDest(e)},_onFieldDragStart:function(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onFieldDragStop:function(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},disableFieldsDragAndDrop:function(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function(){var t,e,s,i;t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(e){i=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&i!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}},this)}},getDragButton:function(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},this)}},_onDragStart:function(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function(){var t,e;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)&&!BX.hasClass(t,this.settings.classDefaultFilter)){this.presetsList.push(t)}},this)}},_onDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},getSidebarControlsContainer:function(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function(){var t=this.getPreset();var e=t.getPresets();var s;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}},this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function(){var t=this.getPreset();var e=t.getPresets();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){BX.removeClass(t,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(t)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function(){return this.isEditEnabledState},getEditButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function(t,e){return t in this.params?this.params[t]:e},getFilter:function(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function(t,e,s){if("CONFIRM"in t&&t.CONFIRM){var i=this.getParam("FILTER_ID")+"-confirm-dialog";var r='<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>";var a="CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"";var n=new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy()}}});var l=new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindow(i,null,{content:r,titleBar:a,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[n,l]});BX.addCustomEvent(o,"onPopupClose",BX.delegate(function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},this));if(!o.isShown()){o.show();var h=o.popupContainer;BX.removeClass(h,this.settings.classAnimationShow);BX.addClass(h,this.settings.classAnimationShow)}}else{BX.type.isFunction(e)?e():null}}}})();(function(){BX.Main.filterManager={data:{},push:function(t,e){if(BX.type.isNotEmptyString(t)&&e){this.data[t]=e}},getById:function(t){var e=null;if(t in this.data){e=this.data[t]}return e}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?15441273841650";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Api=function(e){this.parent=e};BX.Filter.Api.prototype={setFields:function(e){var t,i;if(BX.type.isPlainObject(e)){this.parent.getPopup();t=this.parent.getPreset();t.deactivateAllPresets();i={preset_id:"tmp_filter",fields:e};this.parent.updateParams(i);t.applyPreset("tmp_filter")}},setFilter:function(e){if(typeof e==="object"){this.parent.updateParams(e);this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().activatePreset(e.preset_id);this.parent.getPreset().applyPreset(e.preset_id);if(!e.checkFields||!this.parent.getPreset().isPresetValuesModified(e.preset_id)){this.parent.applyFilter(false,e.preset_id)}else{var t={};if(BX.type.isPlainObject(e.fields)){t=Object.assign({},e.fields)}if(BX.type.isPlainObject(e.additional)){t=Object.assign({},e.additional)}this.parent.getPreset().deactivateAllPresets();this.setFields(t);this.apply()}}},extendFilter:function(e){if(!!e&&typeof e==="object"){Object.keys(e).forEach(function(t){if(BX.type.isNumber(e[t])){e[t]=""+e[t]}});var t=this.parent.getPreset().getCurrentPresetId();if(t==="tmp_filter"||t==="default_filter"){var i=Object.assign({},this.parent.getFilterFieldsValues(),e);this.setFields(i);this.apply();return}var s=this.parent.getPreset().getAdditionalValues(t);if(BX.type.isPlainObject(s)&&Object.keys(s).length){e=Object.assign({},s,e)}this.setFilter({preset_id:t,additional:e,checkFields:true})}},apply:function(){if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){this.parent.applyFilter()}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/destination-selector.min.js?15441273845460";s:6:"source";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/destination-selector.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.DestinationSelectorManager={fields:[],controls:{},onSelect:function(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.name)||typeof t.item=="undefined"||!BX.type.isNotEmptyString(t.type)){return}var e=t.name,i=t.type,o=t.item;BX.SocNetLogDestination.obItemsSelected[e]={};BX.SocNetLogDestination.obItemsSelected[e][o.id]=i;var n=BX.Filter.DestinationSelectorManager.controls[e];if(n){n.setData(BX.util.htmlspecialcharsback(o.name),o.id);n.getLabelNode().value="";n.getLabelNode().blur();if(BX.SocNetLogDestination.popupWindow!=null){BX.SocNetLogDestination.popupWindow.close()}if(BX.SocNetLogDestination.popupSearchWindow!=null){BX.SocNetLogDestination.popupSearchWindow.close()}}},onDialogOpen:function(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.name)){return}var e=t.name;var i=BX.Filter.DestinationSelector.items[e];if(i){i.onDialogOpen()}},onDialogClose:function(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.name)){return}var e=t.name;var i=BX.Filter.DestinationSelector.items[e];if(i){i.onDialogClose()}}};BX.Filter.DestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BX.Filter.DestinationSelector.items={};BX.Filter.DestinationSelector.create=function(t,e){if(typeof this.items[t]!="undefined"){return this.items[t]}var i=new BX.Filter.DestinationSelector(t,e);i.initialize(t,e);this.items[t]=i;BX.onCustomEvent(window,"BX.Filter.DestinationSelector:create",[t]);return i};BX.Filter.DestinationSelector.prototype.getSetting=function(t,e){return this.settings.hasOwnProperty(t)?this.settings[t]:e};BX.Filter.DestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BX.Filter.DestinationSelector.prototype.initialize=function(t,e){this.id=t;this.settings=e?e:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var o={};o[this.fieldId]=i.itemId;o[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(o)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.Selector:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSwitchTabFocus",BX.delegate(this.onBeforeSwitchTabFocus,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.delegate(this.onBeforeSelectItemFocus,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BX.Filter.DestinationSelector.prototype.open=function(){var t=this.id;if(!this.inited){var e=this.getSearchInput();e.id=e.name;BX.addCustomEvent(window,"BX.Main.Selector:afterInitDialog",BX.delegate(function(t){if(typeof t.id!="undefined"||t.id!=this.id){return}this.opened=true},this));BX.onCustomEvent(window,"BX.Filter.DestinationSelector:openInit",[{id:this.id,inputId:e.id,containerId:e.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Filter.DestinationSelector:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BX.Filter.DestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManager.controls[this.id]!=="undefined"){BX.Main.selectorManager.controls[this.id].closeDialog()}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorOpen=function(t){var e=t.getId();if(this.fieldId!==e){this.control=null}else{this.control=t;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BX.Filter.DestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorClose=function(t){if(this.fieldId===t.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BX.Filter.DestinationSelector.prototype.onGetStopBlur=function(t,e){if(BX.findParent(t.target,{className:"bx-lm-box"})){e.stopBlur=true}};BX.Filter.DestinationSelector.prototype.onCustomEntityRemove=function(t){if(this.fieldId===t.getId()){if(typeof t.hiddenInput!="undefined"&&typeof t.hiddenInput.value!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id]!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]!="undefined"){delete BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]}}};BX.Filter.DestinationSelector.prototype.onBeforeSwitchTabFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BX.Filter.DestinationSelector.prototype.onBeforeSelectItemFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BX.Filter.DestinationSelector.prototype.onBeforeInitDialog=function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}this.inited=true;if(!this.control){t.blockInit=true}};BX.Filter.DestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BX.Filter.DestinationSelector.prototype.onDialogClose=function(){this.opened=false}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15441273842703";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.FieldController=function(t,e){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(t,e)};BX.Filter.FieldController.prototype={init:function(t,e){if(!BX.type.isDomNode(t)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(e instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=t;this.parent=e;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function(){var t=this.getSquares();return this.getInputValue()||BX.type.isArray(t)&&t.length},getField:function(){return this.field},getInput:function(){var t,e;if(!BX.type.isDomNode(this.input)){t=this.getType();e=this.parent.types;if(t===e.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(t===e.NUMBER||t==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(t===e.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(t===e.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=""}},hideDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.parent.settings.classHide)}},showDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.parent.settings.classHide)}},removeSquares:function(){var t=this.getSquares();if(BX.type.isArray(t)&&t.length){t.forEach(function(t){BX.remove(t)})}},_onDeleteClick:function(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function(){var t="";var e=this.getInput();if(BX.type.isDomNode(e)){t=e.value}return t},getType:function(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?154412738423035";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Fields=function(t){this.parent=null;this.init(t)};BX.Filter.Fields.prototype={init:function(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",BX.delegate(this._onDateTypeChange,this))},deleteField:function(t){BX.remove(t)},isFieldDelete:function(t){return BX.hasClass(t,this.parent.settings.classFieldDelete)},isFieldValueDelete:function(t){return BX.hasClass(t,this.parent.settings.classValueDelete)||BX.hasClass(t.parentNode,this.parent.settings.classValueDelete)},isDragButton:function(t){return t&&BX.hasClass(t,this.parent.settings.classPresetDragButton)},clearFieldValue:function(t){if(t){var e=BX.Filter.Utils.getByClass(t,this.parent.settings.classControl,true);var n=BX.Filter.Utils.getByClass(t,this.parent.settings.classSquare,true);(n||[]).forEach(BX.remove);(e||[]).forEach(function(t){t&&"value"in t&&(t.value="")},this)}},getField:function(t){var e;if(BX.type.isDomNode(t)){e=BX.findParent(t,{class:this.parent.settings.classField},true,false);if(!BX.type.isDomNode(e)){e=BX.findParent(t,{class:this.parent.settings.classFieldGroup},true,false)}}return e},render:function(t,e){var n,i,a,r;if(BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(t)){n=Object.keys(e);n.forEach(function(n){r="{{"+n+"}}";t=t.replace(new RegExp(r,"g"),e[n])});a=BX.create("div",{html:t});i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldGroup);if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classField)}if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLine)}}return i},createInputText:function(t){var e={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:BX.type.isNotEmptyString(t.VALUE)||BX.type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]};return BX.decl(e)},createDestSelector:function(t){var e,n;var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var a=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}if(!BX.type.isArray(a)){a=[a]}var r=!!t.VALUES._value?t.VALUES._value:[];if(BX.type.isPlainObject(r)){r=Object.keys(r).map(function(t){return r[t]})}if(!BX.type.isArray(r)){r=[r]}a.forEach(function(t,e){i.content.content.push({block:"main-ui-square",tag:"span",name:t,item:{_label:t,_value:r[e]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES["_label"]:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:t.NAME+"_label",tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES["_value"]:"",tabindex:t.TABINDEX});i=BX.decl(i);e=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(e,"main-ui-square-search-item");BX.bind(e,"focus",function(t){BX.fireEvent(t.currentTarget,"click")});BX.bind(e,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){BX.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}BX.bind(e,"keydown",BX.proxy(this._onCustomEntityKeydown,this));BX.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));BX.ready(BX.proxy(function(){BX.Filter.DestinationSelector.create(t.NAME,{filterId:this.parent.getParam("FILTER_ID"),fieldId:t.NAME})},this));return i},createCustomEntity:function(t){var e,n;var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var a=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}if(!BX.type.isArray(a)){a=[a]}var r=!!t.VALUES._value?t.VALUES._value:[];if(BX.type.isPlainObject(r)){r=Object.keys(r).map(function(t){return r[t]})}if(!BX.type.isArray(r)){r=[r]}a.forEach(function(t,e){i.content.content.push({block:"main-ui-square",tag:"span",name:t,item:{_label:t,_value:r[e]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES["_label"]:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:t.NAME+"_label",tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES["_value"]:"",tabindex:t.TABINDEX});i=BX.decl(i);e=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(e,"main-ui-square-search-item");BX.bind(e,"focus",BX.proxy(this._onCustomEntityInputFocus,this));BX.bind(e,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){BX.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}BX.bind(e,"keydown",BX.proxy(this._onCustomEntityKeydown,this));BX.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i},_onCustomEntityInputFocus:function(t){BX.fireEvent(t.currentTarget,"click")},_onCustomEntityInputClick:function(t){var e,n,i,a;t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}e=new Date(this.trustTimestamp);n=new Date(this.notTrustTimestamp);i=e.getMinutes()+":"+e.getSeconds();a=n.getMinutes()+":"+n.getSeconds();if(i!==a){this._onCustomEntityFocus(t)}},_onDocumentFocus:function(t){var e=this.getCustomEntityInstance();var n=e.getPopupContainer();var i=e.getLabelNode()===t.target;var a=!!n&&n.contains(t.target);if(!i&&!a){this._onCustomEntityBlur(t)}},_onCustomEntityKeydown:function(t){var e=BX.Filter.Utils.getByClass(t.target.parentNode.parentNode,this.parent.settings.classSquare,true);var n=null;if(e.length){n=e[e.length-1]}if(BX.Filter.Utils.isKey(t,"backspace")&&t.currentTarget.selectionStart===0){if(BX.type.isDomNode(n)){if(BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.remove(n);var i=BX.Filter.Utils.getBySelector(t.target.parentNode.parentNode,'input[type="hidden"]');i.value="";BX.fireEvent(i,"input")}else{BX.addClass(n,this.parent.settings.classSquareSelected)}}}else if(BX.type.isDomNode(n)&&BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.removeClass(n,this.parent.settings.classSquareSelected)}},_onCustomEntityFieldClick:function(t){var e;if(BX.hasClass(t.target,this.parent.settings.classSquareDelete)){e=BX.findParent(t.target,{className:this.parent.settings.classSquare},true,false);if(BX.type.isDomNode(e)){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[n]);BX.remove(e)}}else{var i=BX.Filter.Utils.getBySelector(t.target,'input[type="text"]');BX.fireEvent(i,"focus")}},_onCustomEntityBlur:function(t){var e={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,e]);if(typeof e.stopBlur=="undefined"||!e.stopBlur){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);BX.unbind(n.getPopupContainer(),"click",this._stopPropagation);BX.removeClass(n.getField(),this.parent.settings.classFocus)}},_stopPropagation:function(t){t.stopPropagation()},getCustomEntityInstance:function(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance},_onCustomEntityFocus:function(t){var e=BX.findParent(t.currentTarget,{className:"main-ui-control-entity"},true,false);var n=this.getCustomEntityInstance();t.stopPropagation();n.setField(e);BX.onCustomEvent(window,"BX.Main.Filter:customEntityFocus",[n]);var i=n.getPopupContainer();if(BX.type.isElementNode(i)){BX.bind(i,"click",this._stopPropagation)}BX.addClass(e,this.parent.settings.classFocus)},createCustom:function(t){var e,n,i;var a=[];t.VALUE=BX.util.htmlspecialcharsback(t.VALUE);a.push("main-ui-control");a.push("main-ui-custom-style");i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:a,attrs:{"data-name":t.NAME},content:""}});n='name="'+t.NAME+'" value="'+("_VALUE"in t?t._VALUE:"")+'"';e=BX.Filter.Utils.getByClass(i,"main-ui-custom");try{t.VALUE=t.VALUE.replace('name="'+t.NAME+'"',n)}catch(t){}BX.html(e,t.VALUE);return i},createSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}})},createMultiSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}})},createCustomDate:function(t){var e={block:"main-ui-control-field-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(BX.type.isPlainObject(t.VALUE.days)){t.VALUE.days=Object.keys(t.VALUE.days).map(function(e){return t.VALUE.days[e]})}var n=t.DAYS.filter(function(e){return t.VALUE.days.some(function(t){return t===e.VALUE})});var i={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],placeholder:t.DAYS_PLACEHOLDER,dragButton:false,content:{block:"main-ui-multi-select",name:t.NAME+"_days",tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.DAYS,value:n,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.DAYS_PLACEHOLDER}}};if(BX.type.isPlainObject(t.VALUE.months)){t.VALUE.months=Object.keys(t.VALUE.months).map(function(e){return t.VALUE.months[e]})}var a=t.MONTHS.filter(function(e){return t.VALUE.months.some(function(t){return t===e.VALUE})});var r={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:t.NAME+"_months",tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.MONTHS,value:a,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.MONTHS_PLACEHOLDER}}};if(BX.type.isPlainObject(t.VALUE.years)){t.VALUE.years=Object.keys(t.VALUE.years).map(function(e){return t.VALUE.years[e]})}var l=t.YEARS.filter(function(e){return t.VALUE.years.some(function(t){return t===e.VALUE})});var s={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:t.NAME+"_years",tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.YEARS,value:l,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.YEARS_PLACEHOLDER}}};e.content.push(i);e.content.push(r);e.content.push(s);return BX.decl(e)},_onDateTypeChange:function(t,e){if(this.parent.getPopup().contentContainer.contains(t.node)){var n={};var i=null;var a,r,l,s,o,E,u,c;if(BX.type.isPlainObject(e)&&"VALUE"in e){s=BX.data(t.getNode(),"name");r=t.getParams();if(!BX.type.isPlainObject(r)&&(s.indexOf("_datesel")!==-1||s.indexOf("_numsel")!==-1)){a=t.getNode().parentNode.parentNode;n.TABINDEX=t.getInput().getAttribute("tabindex");n.SUB_TYPES=t.getItems();n.SUB_TYPE=e;n.NAME=BX.data(a,"name");n.TYPE=BX.data(a,"type");E=this.parent.getPreset().getCurrentPresetData();if("FIELDS"in E&&E.FIELDS.length){u=E.FIELDS.filter(function(t){return t.NAME===n.NAME},this);if(u.length){u=u[0];if(s.indexOf("_datesel")!==-1){n.MONTHS=u.MONTHS;n.MONTH=u.MONTH;n.YEARS=u.YEARS;n.YEAR=u.YEAR;n.QUARTERS=u.QUARTERS;n.QUARTER=u.QUARTER;n.ENABLE_TIME=u.ENABLE_TIME;n.YEARS_SWITCHER=u.YEARS_SWITCHER}n.VALUES=u.VALUES}}if(this.parent.getParam("ENABLE_LABEL")){l=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLabel);n.LABEL=l.innerText}if(s.indexOf("_datesel")!==-1){i=this.createDate(n)}else{i=this.createNumber(n)}if(BX.type.isArray(this.parent.fieldsList)){c=this.parent.fieldsList.indexOf(a);if(c!==-1){this.parent.fieldsList[c]=i;this.parent.registerDragItem(i)}}this.parent.unregisterDragItem(a);o=BX.Filter.Utils.getByClass(i,this.parent.settings.classField,true);if(BX.type.isArray(o)&&o.length){o.forEach(function(t){t.FieldController=new BX.Filter.FieldController(t,this.parent)},this)}BX.insertAfter(i,a);BX.remove(a)}}}},createNumber:function(t){var e,n,i,a,r,l;var s=this.parent.numberTypes;var o=s.SINGLE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){o=t.SUB_TYPE.VALUE;i="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_numsel","");e={block:"number-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-number-group"]:["main-ui-filter-number-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(o!==s.LESS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:i,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:""}};e.content.push(a)}if(o===s.RANGE){r={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};e.content.push(r)}if(o===s.RANGE||o===s.LESS){l={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:""}}}e.content.push(l);return BX.decl(e)},createDate:function(t){var e,n,i,a,r,l,s,o,E;var u=this.parent.dateTypes;var c=this.parent.additionalDateTypes;var A=u.NONE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){A=t.SUB_TYPE.VALUE;l="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_datesel","");if("VALUES"in t&&BX.type.isPlainObject(t.VALUES)){var m=Object.keys(t.VALUES);m.forEach(function(e){if(!t.VALUES[e]){t.VALUES[e]=""}})}e={block:"date-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",enableTime:"ENABLE_TIME"in t?t.ENABLE_TIME:false,deleteButton:true,content:[]};t.NAME=t.NAME.replace("_datesel","");if(A===u.EXACT){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:l,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",enableTime:t.ENABLE_TIME}};e.content.push(a)}if(A===u.NEXT_DAYS||A===u.PREV_DAYS||A===c.PREV_DAY||A===c.NEXT_DAY||A===c.MORE_THAN_DAYS_AGO||A===c.AFTER_DAYS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:l,name:"NAME"in t?t.NAME+"_days":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._days:""}};e.content.push(a)}if(A===u.RANGE){var d={block:"main-ui-filter-range-group",content:[]};n={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",placeholder:l,enableTime:t.ENABLE_TIME}};r={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};i={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:"",placeholder:l,enableTime:t.ENABLE_TIME}};d.content.push(n);d.content.push(r);d.content.push(i);e.content.push(d)}if(A===u.MONTH){if("_month"in t.VALUES&&t.VALUES._month){t.MONTH=t.MONTHS.filter(function(e){return e.VALUE===t.VALUES._month});t.MONTH=t.MONTH.length?t.MONTH[0]:null}if(!t.MONTH){t.MONTH=t.MONTHS[0]}E={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.MONTH,items:t.MONTHS,name:t.NAME+"_month",valueDelete:false}};if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}s={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(E);e.content.push(s)}if(A===u.QUARTER){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}s={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};if("_quarter"in t.VALUES&&t.VALUES._quarter){t.QUARTER=t.QUARTERS.filter(function(e){return e.VALUE===t.VALUES._quarter});t.QUARTER=t.QUARTER.length?t.QUARTER[0]:null}if(!t.QUARTER){t.QUARTER=t.QUARTERS[0]}o={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.QUARTER,items:t.QUARTERS,name:t.NAME+"_quarter",params:t.PARAMS,valueDelete:false}};e.content.push(o);e.content.push(s)}if(A===u.YEAR){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}s={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(s)}if(A==="CUSTOM_DATE"){var p=t.SUB_TYPES.filter(function(t){return t.VALUE==="CUSTOM_DATE"});if(p[0]){p=BX.clone(p[0].DECL);if(BX.type.isArray(t.VALUES._days)){p.VALUE.days=t.VALUES._days}if(BX.type.isArray(t.VALUES._month)){p.VALUE.months=t.VALUES._month}if(BX.type.isArray(t.VALUES._year)){p.VALUE.years=t.VALUES._year}var L=this.createCustomDate(p);L.classList.remove("main-ui-filter-wield-with-label");var B=L.querySelector(".main-ui-item-icon-container");if(B){BX.remove(B)}var _=L.querySelector(".main-ui-filter-icon-grab");if(_){BX.remove(_)}e.content.push(L);e.mix.push("main-ui-filter-custom-date-group")}}if(A!==u.NONE&&A!==c.CUSTOM_DATE&&t["YEARS_SWITCHER"]){if("_allow_year"in t.VALUES&&t.VALUES._allow_year){var f=t.YEARS_SWITCHER.ITEMS.filter(function(e){return e.VALUE===t.VALUES._allow_year});f=f.length?f[0]:null;if(f){t.YEARS_SWITCHER.VALUE=f}}var h=this.createSelect(t["YEARS_SWITCHER"]);h.classList.add("main-ui-filter-year-switcher");h.classList.add("main-ui-filter-with-padding");h.classList.remove("main-ui-filter-wield-with-label");B=h.querySelector(".main-ui-item-icon-container");if(B){BX.remove(B)}_=h.querySelector(".main-ui-filter-icon-grab");if(_){BX.remove(_)}if(e.content[e.content.length-1]){if(BX.type.isPlainObject(e.content[e.content.length-1])){if(!BX.type.isArray(e.content[e.content.length-1].mix)){e.content[e.content.length-1].mix=[]}e.content[e.content.length-1].mix.push("main-ui-filter-remove-margin-right")}if(BX.type.isDomNode(e.content[e.content.length-1])){e.content[e.content.length-1].classList.add("main-ui-filter-remove-margin-right")}}requestAnimationFrame(function(){h.previousElementSibling.classList.add("main-ui-filter-remove-margin-right")});e.content.push(h);e.mix.push("main-ui-filter-date-with-years-switcher")}return BX.decl(e)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:114:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15441273843115";s:6:"source";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(t){if(!!t&&!BX.hasClass(t,"main-ui-control-entity")){t=BX.Filter.Utils.getByClass(t,"main-ui-control-entity")}return!!t&&JSON.parse(BX.data(t,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function(t){if(this.field!==t){this.field=t;this.reset()}},isMultiple:function(){return BX.Main.ui.CustomEntity.isMultiple(this.getField())},reset:function(){this.labelInput=null;this.hiddenInput=null},getField:function(){return this.field},getId:function(){var t=this.getHiddenNode();var e=null;if(BX.type.isDomNode(t)){e=t.name}return e},getLabelNode:function(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function(t){return BX.Filter.Utils.getBySelector(this.getField(),['[data-item*=":'+BX.util.jsencode(t)+'}"]','[data-item*=":\\"'+BX.util.jsencode(t)+'\\"}"]'].join(", "))},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function(){this.getSquares().forEach(BX.remove)},setSquare:function(t,e){var i=this.getField();var n={block:"main-ui-square",name:t,item:{_label:t,_value:e}};var s=BX.decl(n);var l=this.getSquares();if(!l.length){BX.prepend(s,i)}else{BX.insertAfter(s,l[l.length-1])}},getCurrentValues:function(){var t=this.getSquares();var e,i;if(this.isMultiple()){i=[];for(var n=0,s=t.length;n<s;n++){try{e=JSON.parse(BX.data(t[n],"item"));i.push({label:e._label,value:e._value})}catch(t){}}}else{if(t.length===0){i={label:"",value:""}}else{try{e=JSON.parse(BX.data(t[0],"item"));i={label:e._label,value:e._value}}catch(t){i={label:"",value:""}}}}return i},setData:function(t,e){return this.isMultiple()?this.setMultipleData(t,e):this.setSingleData(t,e)},setSingleData:function(t,e){var i=this.getHiddenNode();this.removeSquares();this.setSquare(t,e);if(BX.type.isDomNode(i)){i.value=e;BX.fireEvent(i,"input")}},setMultipleData:function(t,e){var i=[];var n=this.getHiddenNode();if(BX.type.isArray(t)){this.removeSquares();if(BX.type.isArray(t)){t.forEach(function(t){i.push(t.value);this.setSquare(t.label,t.value)},this);if(BX.type.isDomNode(n)){n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}}if(!BX.type.isArray(t)&&e!==null){if(!this.getSquareByValue(e)){this.setSquare(t,e);this.getSquares().forEach(function(t){var e=JSON.parse(BX.data(t,"item"));if(BX.type.isPlainObject(e)){i.push(e._value)}});n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}},setPopupContainer:function(t){if(BX.type.isDomNode(t)){this.popupContainer=t}},getPopupContainer:function(){return this.popupContainer}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?154412738417210";s:6:"source";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Presets=function(e){this.parent=null;this.presets=null;this.container=null;this.init(e)};BX.Filter.Presets.prototype={init:function(e){this.parent=e},bindOnPresetClick:function(){(this.getPresets()||[]).forEach(function(e){BX.bind(e,"click",BX.delegate(this._onPresetClick,this))},this)},getAddPresetField:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classAddPresetField)},getAddPresetFieldInput:function(){return BX.Filter.Utils.getByClass(this.getAddPresetField(),this.parent.settings.classAddPresetFieldInput)},clearAddPresetFieldInput:function(){var e=this.getAddPresetFieldInput();e&&(e.value="")},normalizePreset:function(e){if(!BX.hasClass(e,this.parent.settings.classPreset)){e=BX.findParent(e,{className:this.parent.settings.classPreset},true,false)}return e},deactivateAllPresets:function(){var e=this.getPresets();var t=this;(e||[]).forEach(function(e){if(BX.hasClass(e,t.parent.settings.classPresetCurrent)){BX.removeClass(e,t.parent.settings.classPresetCurrent)}})},createSidebarItem:function(e,t,s){return BX.decl({block:"sidebar-item",text:BX.util.htmlspecialcharsback(t),id:e,pinned:s,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})},activatePreset:function(e){this.deactivateAllPresets();if(BX.type.isNotEmptyString(e)){e=this.getPresetNodeById(e)}if(e&&!BX.hasClass(e,this.parent.settings.classPresetCurrent)){BX.addClass(e,this.parent.settings.classPresetCurrent)}},getPresetNodeById:function(e){var t=this.getPresets();var s=t.filter(function(t){return BX.data(t,"id")===e},this);return s.length>0?s[0]:null},getPresetId:function(e){return BX.data(e,"id")},updatePresetName:function(e,t){var s;if(BX.type.isDomNode(e)&&BX.type.isNotEmptyString(t)){s=this.getPresetNameNode(e);if(BX.type.isDomNode(s)){BX.html(s,t)}}},removePreset:function(e,t,s){var i=this.getCurrentPresetId();var r=[];var a={preset_id:t,is_default:s};var n={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(a,n);BX.remove(e);if(BX.type.isArray(this.parent.params["PRESETS"])){r=this.parent.params["PRESETS"].filter(function(e){return e.ID!==t},this);this.parent.params["PRESETS"]=r}if(BX.type.isArray(this.parent.editablePresets)){r=this.parent.editablePresets.filter(function(e){return e.ID!==t},this);this.parent.editablePresets=r}if(t===i){this.parent.getSearch().removePreset();this.resetPreset()}},pinPreset:function(e){if(!BX.type.isNotEmptyString(e)){e="default_filter"}var t=this.getPresetNodeById(e);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(e==="default_filter"){return}}var s={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var i={preset_id:e};this.getPresets().forEach(function(e){BX.removeClass(e,this.parent.settings.classPinnedPreset)},this);BX.addClass(t,this.parent.settings.classPinnedPreset);this.parent.saveOptions(i,s)},_onPresetClick:function(e){var t,s,i,r,a,n,l;e.preventDefault();l=this.parent;n=l.settings;a=e.target;t=e.currentTarget;s=this.getPresetId(t);i=this.getPreset(s);if(BX.hasClass(a,n.classPinButton)){if(this.parent.isEditEnabled()){if(BX.hasClass(t,n.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(s)}}}if(BX.hasClass(a,n.classPresetEditButton)){this.enableEditPresetName(t)}if(BX.hasClass(a,n.classPresetDeleteButton)){r="IS_DEFAULT"in i?i.IS_DEFAULT:false;this.removePreset(t,s,r);return false}if(!BX.hasClass(a,n.classPresetDragButton)&&!BX.hasClass(a,n.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}var p=this.getPreset(this.getCurrentPresetId());var h=this.getPreset(s);p.ADDITIONAL=[];h.ADDITIONAL=[];this.activatePreset(t);this.applyPreset(s);if(!this.parent.isEditEnabled()){l.applyFilter(null,true);if(e.isTrusted){l.closePopup()}if(l.isAddPresetEnabled()){l.disableAddPreset()}}}},applyPinnedPreset:function(){var e=this.parent;var t=this.isPinned(this.getCurrentPresetId());var s;if(this.parent.getParam("VALUE_REQUIRED")&&this.getPinnedPresetId()==="default_filter"){this.applyPreset("default_filter");this.deactivateAllPresets();s=this.parent.applyFilter()}else{if(!t){var i=this.getPinnedPresetId();var r=this.getPinnedPresetNode();var a=false;var n=true;this.deactivateAllPresets();this.activatePreset(r);this.applyPreset(i);s=e.applyFilter(a,n);e.closePopup()}else{s=e.resetFilter()}}return s},updateEditablePreset:function(e){var t=this.parent.getFilterFieldsValues();var s=this.getFields().map(function(e){return BX.data(e,"name")});var i=this.parent.preparePresetFields(t,s);var r=this.getPreset(e);r.FIELDS=i;r.TITLE=this.getPresetInput(this.getPresetNodeById(e)).value;r.ROWS=s},getPresetInput:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetEditInput)},enableEditPresetName:function(e){var t=this.getPresetInput(e);BX.addClass(e,this.parent.settings.classPresetNameEdit);t.focus();t.value=BX.util.htmlspecialcharsback(t.value);BX.bind(t,"input",BX.delegate(this._onPresetNameInput,this))},_onPresetNameInput:function(e){var t=this.parent.getSearch();var s=e.currentTarget.value;var i=BX.findParent(e.currentTarget,{className:this.parent.settings.classPreset},true,false);var r=this.getPresetId(i);var a=this.getCurrentPresetId();var n={ID:r,TITLE:s};if(r===a){t.updatePreset(n)}},getPresetNameNode:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetName)},disableEditPresetName:function(e){var t=this.getPresetInput(e);BX.removeClass(e,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(t)){t.blur();BX.unbind(t,"input",BX.delegate(this._onPresetNameInput,this))}},getPreset:function(e,t){var s=this.parent.getParam(t?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!t){s=this.parent.editablePresets}var i=s.filter(function(t){return t.ID===e});if(e==="tmp_filter"&&!i.length){var r=BX.clone(this.getPreset("default_filter"));r.ID="tmp_filter";s.push(r);i.push(r)}return i.length!==0?i[0]:null},getPresetField:function(e,t){var s=this.getPreset(e);var i=null;if(BX.type.isPlainObject(s)&&"FIELDS"in s&&BX.type.isArray(s.FIELDS)){i=s.FIELDS.filter(function(e){return e.NAME===t});i=i.length?i[0]:null}return i},applyPreset:function(e,t){e=t?"default_filter":e||"default_filter";var s=this.getPreset(e);if(e!=="default_preset"){s=this.extendPreset(s)}this.parent.getSearch().updatePreset(s);this.updatePresetFields(s,t)},extendPreset:function(e){var t=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(e)){e=BX.clone(e);e.FIELDS.forEach(function(e){var s;var i=t.FIELDS.some(function(t,i){var r=false;if(t.NAME===e.NAME){s=i;r=true}return r},this);if(i&&s||i&&s===0){t.FIELDS[s]=e}else{if(!this.isEmptyField(e)){t.FIELDS.push(e)}}},this);e.FIELDS=t.FIELDS}return e},isEmptyField:function(e){var t=true;if(e.TYPE===this.parent.types.STRING){if(e.VALUE&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(e.VALUE)&&"VALUE"in e.VALUE&&e.VALUE.VALUE){t=false}}if(e.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(e.VALUE)&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.CUSTOM_DATE){if(BX.type.isArray(e.VALUE.days)&&e.VALUE.days.length||BX.type.isArray(e.VALUE.months)&&e.VALUE.months.length||BX.type.isArray(e.VALUE.years)&&e.VALUE.years.length){t=false}}if(e.TYPE===this.parent.types.CUSTOM_ENTITY||e.TYPE===this.parent.types.DEST_SELECTOR){if(BX.type.isPlainObject(e.VALUES)){if(BX.type.isNotEmptyString(e.VALUES._label)&&BX.type.isNotEmptyString(e.VALUES._value)){t=false}if(BX.type.isPlainObject(e.VALUES._label)&&BX.type.isPlainObject(e.VALUES._value)&&Object.keys(e.VALUES._label).length&&Object.keys(e.VALUES._value).length){t=false}if(BX.type.isArray(e.VALUES._label)&&BX.type.isArray(e.VALUES._value)&&e.VALUES._label.length&&e.VALUES._value.length){t=false}if((BX.type.isArray(e.VALUES._label)&&e.VALUES._label.length||BX.type.isPlainObject(e.VALUES._label)&&Object.keys(e.VALUES._label).length)&&(BX.type.isArray(e.VALUES._value)&&e.VALUES._value.length||BX.type.isPlainObject(e.VALUES._value)&&Object.keys(e.VALUES._value).length)){t=false}}}if(e.TYPE===this.parent.types.DATE){var s="_datesel"in e.VALUES?e.VALUES._datesel:e.SUB_TYPE.VALUE;if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to||e.VALUES._quarter||e.VALUES._month&&!BX.type.isArray(e.VALUES._month)||e.VALUES._year&&!BX.type.isArray(e.VALUES._year)||e.VALUES._days&&!BX.type.isArray(e.VALUES._days))||BX.type.isArray(e.VALUES._days)&&e.VALUES._days.length||BX.type.isArray(e.VALUES._month)&&e.VALUES._month.length||BX.type.isArray(e.VALUES._year)&&e.VALUES._year.length||(s===this.parent.dateTypes.CURRENT_DAY||s===this.parent.dateTypes.CURRENT_WEEK||s===this.parent.dateTypes.CURRENT_MONTH||s===this.parent.dateTypes.CURRENT_QUARTER||s===this.parent.dateTypes.LAST_7_DAYS||s===this.parent.dateTypes.LAST_30_DAYS||s===this.parent.dateTypes.LAST_60_DAYS||s===this.parent.dateTypes.LAST_90_DAYS||s===this.parent.dateTypes.LAST_WEEK||s===this.parent.dateTypes.LAST_MONTH||s===this.parent.dateTypes.TOMORROW||s===this.parent.dateTypes.YESTERDAY||s===this.parent.dateTypes.NEXT_WEEK||s===this.parent.dateTypes.NEXT_MONTH)){t=false}}if(e.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to)){t=false}}if(e.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE){t=false}}return t},resetPreset:function(e){this.applyPreset("",e)},getFields:function(){var e=this.parent.getFieldListContainer();var t=null;if(BX.type.isDomNode(e)){t=BX.Filter.Utils.getBySelector(e.parentNode,"."+this.parent.settings.classFileldControlList+" > div",true)}return t},getField:function(e){var t=this.getFields();var s=null;var i,r;if(BX.type.isArray(t)&&t.length){r=t.filter(function(t){if(BX.type.isDomNode(t)){i=BX.data(t,"name")}return i===e.NAME},this);s=r.length>0?r[0]:null}return s},removeField:function(e,t){var s,i;t=t||false;if(BX.type.isPlainObject(e)){i=e.NAME;e=this.getField(e);if(BX.type.isArray(this.parent.fieldsList)){s=this.parent.fieldsList.indexOf(e);if(s!==-1){delete this.parent.fieldsList[s]}}this.parent.unregisterDragItem(e)}if(BX.type.isDomNode(e)){i=BX.data(e,"name");this.parent.getFields().deleteField(e)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var r=this.getCurrentPresetId();var a=this.getPresetField(r,i);if(a&&!this.isEmptyField(a)){this.deactivateAllPresets();this.parent.applyFilter()}}if(!t){this.parent.saveFieldsSort()}},removeFields:function(e){e.forEach(function(e){this.removeField(e,true)},this);this.parent.saveFieldsSort()},addField:function(e){var t,s,i;if(BX.type.isPlainObject(e)){t=this.parent.getFieldListContainer();i=this.parent.getControls();s=BX.type.isArray(i)?i[i.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){e.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{e.TABINDEX=2}if(BX.type.isDomNode(t)){s=this.createControl(e);if(BX.type.isDomNode(s)){BX.append(s,t);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var r=this.getCurrentPresetId();var a=this.getPresetField(r,e.NAME);if(a&&!this.isEmptyField(a)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}this.parent.saveFieldsSort()},createControl:function(e){var t;switch(e.TYPE){case this.parent.types.STRING:{t=this.parent.getFields().createInputText(e);break}case this.parent.types.SELECT:{t=this.parent.getFields().createSelect(e);break}case this.parent.types.MULTI_SELECT:{t=this.parent.getFields().createMultiSelect(e);break}case this.parent.types.NUMBER:{t=this.parent.getFields().createNumber(e);break}case this.parent.types.DATE:{t=this.parent.getFields().createDate(e);break}case this.parent.types.CUSTOM_DATE:{t=this.parent.getFields().createCustomDate(e);break}case this.parent.types.DEST_SELECTOR:{t=this.parent.getFields().createDestSelector(e);break}case this.parent.types.CUSTOM:{t=this.parent.getFields().createCustom(e);break}case this.parent.types.CUSTOM_ENTITY:{t=this.parent.getFields().createCustomEntity(e);break}default:{break}}if(BX.type.isDomNode(t)){t.dataset.name=e.NAME;t.FieldController=new BX.Filter.FieldController(t,this.parent)}return t},removeNotCompareVariables:function(e,t){if(BX.type.isPlainObject(e)){var s=this.parent.dateTypes;var i=this.parent.additionalDateTypes;if("FIND"in e){delete e.FIND}if(!t){Object.keys(e).forEach(function(t){if(t.indexOf("_numsel")!==-1){delete e[t]}if(t.indexOf("_datesel")!==-1){var r=e[t];if(r===s.EXACT||r===s.RANGE||r===i.PREV_DAY||r===i.NEXT_DAY||r===i.MORE_THAN_DAYS_AGO||r===i.AFTER_DAYS||r===s.PREV_DAYS||r===s.NEXT_DAYS||r===s.YEAR||r===s.MONTH||r===s.QUARTER||r===s.NONE||r===s.CUSTOM_DATE){delete e[t]}}var a=this.parent.getFieldByName(t);if(e[t]===""&&(!a||!a["STRICT"])){delete e[t]}},this)}}},isPresetValuesModified:function(e){var t=this.getPreset(e);var s=this.parent.preparePresetSettingsFields(t.FIELDS);var i=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(i);var r=BX.Filter.Utils.sortObject(s);var a=BX.Filter.Utils.sortObject(i);return!Object.keys(r).every(function(e){return r[e]===a[e]||(BX.type.isPlainObject(r[e])||BX.type.isArray(r[e]))&&BX.Filter.Utils.objectsIsEquals(r[e],a[e])})},getAdditionalValues:function(e){var t=this.getPreset(e);var s=t.FIELDS.filter(function(e){return!this.isEmptyField(e)},this);var i=this.parent.preparePresetSettingsFields(s);var r=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(i,true);this.removeNotCompareVariables(r,true);this.removeSameProperties(r,i);return r},removeSameProperties:function(e,t){if(BX.type.isPlainObject(e)&&BX.type.isPlainObject(t)){Object.keys(t).forEach(function(t){if(t in e){delete e[t]}})}},removeAdditionalField:function(e){var t=this.getPreset(this.getCurrentPresetId());if(BX.type.isArray(t.ADDITIONAL)){t.ADDITIONAL=t.ADDITIONAL.filter(function(t){return t.NAME!==e})}},updatePresetFields:function(e,t){var s,i;var r=[];if(BX.type.isPlainObject(e)&&"FIELDS"in e){s=e.FIELDS;if(BX.type.isArray(e.ADDITIONAL)){e.ADDITIONAL.forEach(function(e){var t=false;e.IS_PRESET_FIELD=true;s.forEach(function(i,r){if(e.NAME===i.NAME){s[r]=e;t=true}});if(!t){s.push(e)}})}(s||[]).forEach(function(e,s){e.TABINDEX=s+1;if(t){switch(e.TYPE){case this.parent.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{e.VALUE=[];break}case this.parent.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.CUSTOM_DATE:{e.VALUE={days:[],months:[],years:[]};break}case this.parent.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{e._VALUE="";break}default:{if("VALUE"in e){if(BX.type.isArray(e.VALUE)){e.VALUE=[]}else{e.VALUE=""}}break}}}r.push(this.createControl(e))},this);this.parent.disableFieldsDragAndDrop();i=this.parent.getFieldListContainer();BX.cleanNode(i);if(r.length){r.forEach(function(t,r){if(BX.type.isDomNode(t)){if(e.ID!=="tmp_filter"&&e.ID!=="default_filter"&&!("IS_PRESET_FIELD"in s[r])&&!this.isEmptyField(s[r])){BX.addClass(t,this.parent.settings.classPresetField)}BX.append(t,i);if(BX.type.isString(s[r].HTML)){var a=BX.create("div");this.parent.getHiddenElement().appendChild(a);BX.html(a,s[r].HTML)}}},this);this.parent.enableFieldsDragAndDrop()}}},showCurrentPresetFields:function(){var e=this.getCurrentPresetData();this.updatePresetFields(e)},getCurrentPreset:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)},getCurrentPresetId:function(){var e=this.getCurrentPreset();var t=null;if(BX.type.isDomNode(e)){t=this.getPresetId(e)}else{t="tmp_filter"}return t},getCurrentPresetData:function(){var e=this.getCurrentPresetId();var t=null;if(BX.type.isNotEmptyString(e)){t=this.getPreset(e);t=this.extendPreset(t)}return t},getContainer:function(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)},getPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)},getDefaultPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)},getPinnedPresetNode:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)},isPinned:function(e){return this.getPinnedPresetId()===e},getPinnedPresetId:function(){var e=this.getPinnedPresetNode();var t="default_filter";if(!!e){var s=BX.data(e,"id");t=!!s?s:t}return t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?154412738418784";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Search=function(t){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(t)};BX.Filter.Search.prototype={init:function(t){this.parent=t;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.removeAutofocus();this.firstInit=true},removeAutofocus:function(){var t=this.getInput();if(!!t){t.blur();t.autofocus=null}},getFindButton:function(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function(){this.apply()},selectSquare:function(t){!!t&&BX.addClass(t,this.parent.settings.classSquareSelected)},selectSquares:function(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function(t){!!t&&BX.removeClass(t,this.parent.settings.classSquareSelected)},unselectSquares:function(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function(){var t=this.getSquares();return t.length&&t.every(this.isSquareSelected,this)},isSquareSelected:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareSelected)},getLastSquare:function(){var t=this.getSquares();return!!t?t[t.length-1]:null},isTextSelected:function(){var t=this.getSearchString().length;var e=this.getInput();var s=e.selectionStart;var i=e.selectionEnd;return s===0&&i!==0&&i===t},isSelectionStart:function(){var t=this.getInput();var e=t.selectionStart;var s=t.selectionEnd;return e===0&&s===0},isSquareRemoveButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareDelete)},isClearButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classClearSearchValueButton)},getClearButton:function(){return this.getContainer().querySelector("."+this.parent.settings.classClearSearchValueButton)},isSearchButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSearchButton)},adjustFocus:function(){if(!BX.browser.IsMobile()){var t=this.getInput();if(document.activeElement!==t&&window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}}},findSquareByChild:function(t){return BX.findParent(t,{className:this.parent.settings.classSquare},true,false)},getSquareData:function(t){var e=BX.data(t,"item");return!!t&&!!e?JSON.parse(e):null},isSquareControl:function(t){var e=this.getSquareData(t);return!!e&&(e.type==="control"||BX.type.isArray(e))},onPresetSquareRemove:function(){var t=this.parent;var e=t.getPreset();var s=e.getCurrentPresetId();var i=t.getParam("RESET_TO_DEFAULT_MODE");var r=t.getParam("VALUE_REQUIRED");var a=e.isPinned(s);var n=this.getSquares();if(n.length===1){if(r&&a){this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{if(i&&a||!i){var o=true;this.lastPromise=t.resetFilter(o);t.closePopup()}}if(i&&!a){this.lastPromise=t.getPreset().applyPinnedPreset()}}if(n.length>1){var h=e.getPreset(e.getCurrentPresetId());var l=e.getPreset("tmp_filter");l.FIELDS=BX.clone(h.ADDITIONAL);h.ADDITIONAL=[];e.deactivateAllPresets();e.applyPreset("tmp_filter");t.applyFilter()}},onControlSquareRemove:function(t){var e=this.parent;var s=e.getPreset();var i=e.getParam("RESET_TO_DEFAULT_MODE");var r=e.getParam("VALUE_REQUIRED");var a;if(i&&this.getSquares().length===1){if(r){a=this.getSquareData(t);e.clearControls(a);this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{this.lastPromise=e.getPreset().applyPinnedPreset()}}else{a=this.getSquareData(t);e.clearControls(a);e.closePopup();if(BX.type.isArray(a)){a.forEach(function(t){s.removeAdditionalField(t.name)})}if(BX.type.isPlainObject(a)){s.removeAdditionalField(a.name)}this.apply()}},onValueRequiredSquareRemove:function(){var t=this.parent;t.getPreset().deactivateAllPresets();t.showPopup();this.adjustPlaceholder()},complexSquareRemove:function(t){var e=this.parent.getParam("VALUE_REQUIRED_MODE");var s=!this.isSquareControl(t);if(e){this.onValueRequiredSquareRemove()}else{if(s){this.onPresetSquareRemove()}else{this.onControlSquareRemove(t)}}this.removeSquare(t);this.adjustClearButton()},adjustClearButton:function(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function(t){!!t&&BX.remove(t)},_onSearchContainerClick:function(t){var e=this.parent;if(this.isClearButton(t.target)){if(!e.getParam("VALUE_REQUIRED")){if(!e.getParam("VALUE_REQUIRED_MODE")){if(e.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.resetFilter()}e.closePopup();this.adjustFocus()}else{this.removeSquares();e.showPopup();this.adjustPlaceholder();this.hideClearButton();e.getPreset().deactivateAllPresets()}}else{var s=e.getPreset().isPinned(e.getPreset().getCurrentPresetId());if(s||e.getPreset().getCurrentPresetId()==="tmp_filter"){var i=e.getPreset().getPreset(e.getPreset().getCurrentPresetId());if(i.ADDITIONAL.length){i.ADDITIONAL=[];this.lastPromise=e.getPreset().applyPreset(e.getPreset().getCurrentPresetId());this.apply()}else{this.removeSquares();e.showPopup();this.adjustPlaceholder();this.hideClearButton();e.getPreset().deactivateAllPresets()}}else{if(e.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.resetFilter()}e.closePopup();this.adjustFocus()}this.clearInput()}}else if(this.isSearchButton(t.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(t.target)){var r=this.findSquareByChild(t.target);this.complexSquareRemove(r);this.adjustFocus()}else{if(!e.getPopup().isShown()){e.showPopup()}else{var a=this.getInput();var n=a.selectionStart;var o=a.selectionEnd;var h=this.getSearchString().length;if(!(h&&n===0&&o===h)){if(e.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.closePopup()}}else{e.closePopup();if(e.getParam("VALUE_REQUIRED_MODE")){e.restoreRemovedPreset()}}}}}},_onKeyDown:function(t){var e=BX.Filter.Utils;var s=this.parent;if(e.isKey(t,"enter")){if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}s.closePopup()}if(e.isKey(t,"tab")||e.isKey(t,"downArrow")){s.showPopup();s.adjustFocus();this.unselectSquares()}if(e.isKey(t,"upArrow")){s.closePopup();if(s.getParam("VALUE_REQUIRED_MODE")){this.parent.restoreRemovedPreset()}if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}}}if(e.isKey(t,"a")&&t.metaKey||e.isKey(t,"a")&&t.ctrlKey){this.selectSquares()}if(e.isKey(t,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("VALUE_REQUIRED")){var i=this.parent.getPreset().isPinned(this.parent.getPreset().getCurrentPresetId());if(i){this.removeSquares();this.parent.showPopup();this.adjustPlaceholder();this.hideClearButton();this.parent.getPreset().deactivateAllPresets()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.parent.resetFilter()}this.parent.closePopup();this.adjustFocus()}this.clearInput()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}}if(e.isKey(t,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var r=this.getLastSquare();this.isSquareSelected(r)?this.complexSquareRemove(r):this.selectSquare(r)}if(!e.isKey(t,"backspace")&&!t.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function(){var t=this.getInput();return!!t?t.value:""},getSquares:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function(){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"+(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")?"":"_DEFAULT")))},isResolvedRequest:function(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function(){if(this.isResolvedRequest()){this.lastPromise=this.parent._onFindButtonClick()}return this.lastPromise},reset:function(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate(function(){this.lastPromise=this.parent.resetFilter()},this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function(){clearTimeout(this.timeout);var t=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:t;if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,t])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(t){this.showClearButton()}else{if(!this.getSquares().length&&this.lastSearchString!==t){this.hideClearButton();this.adjustPlaceholder()}}},_onInput:function(){var t=this.getSearchString();if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=t},getButtonsContainer:function(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},setInputPlaceholder:function(t){var e=this.getInput();e.placeholder=t},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function(){this.clearInput();this.removePreset()},makeSquares:function(t,e,s){var i;var r=null;var a=this.getContainer();var n={squares:[],moreSquares:[]};t.forEach(function(t,o){if(o<e){i=BX.decl(t);r=r||i;if(!s){if(o===0){BX.prepend(i,a)}else{BX.insertAfter(i,r)}}else{var h=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(h){BX.insertAfter(i,h)}else{BX.prepend(i,a)}}r=i;n.squares.push(i)}else{n.moreSquares.push({type:"control",name:t.value,title:t.title})}},this);return n},squares:function(t,e,s){var i,r,a,n,o;var h=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(s){h.forEach(function(t){var e=BX.data(t,"item");if(e){BX.remove(t)}})}else{h.forEach(BX.remove)}i=this.prepareSquaresData(t);r=this.makeSquares(i,e,s);n=0;o={squaresData:i,width:0};if(r.moreSquares.length){a={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+r.moreSquares.length,item:r.moreSquares,title:r.moreSquares.map(function(t){return t.title}).join(", \n")};a=BX.decl(a);r.squares.push(a);BX.insertAfter(a,r.squares[r.squares.length-2]);n=r.squares.reduce(function(t,e){return t+BX.width(e)+(parseFloat(BX.style(e,"margin-right"))||0)},0)}o.width=n;return o},setPreset:function(t){var e=this.getContainer();var s,i;var r;if(BX.type.isPlainObject(t)){i=BX.Filter.Utils.getByClass(e,this.parent.settings.classSquare,true);i.forEach(BX.remove);t=BX.clone(t);t.ADDITIONAL=t.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[t,this]);if(t.ID!=="default_filter"&&t.ID!=="tmp_filter"){s=BX.decl({block:"main-ui-search-square",name:t.TITLE,value:t.ID,isPreset:true});BX.prepend(s,e);if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){r=this.squares(t.ADDITIONAL,1,true);if(BX.width(e)-r.width<100){r=this.squares(t.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){t.ADDITIONAL.forEach(function(e,s){if(!("ID"in e)){e.ID="ADDITIONAL_ID_"+s}if(!("NAME"in e)){e.NAME="ADDITIONAL_NAME_"+s}if(!("TYPE"in e)){e.TYPE="STRING"}if("LABEL"in e&&"LABEL"in e){t.FIELDS.push(e)}})}if(BX.type.isArray(t.FIELDS)&&t.FIELDS.length){r=this.squares(t.FIELDS,2);if(BX.width(e)-r.width<100){r=this.squares(t.FIELDS,1)}}}if(r&&BX.type.isArray(r.squaresData)&&r.squaresData.length||t.ID!=="default_filter"&&t.ID!=="tmp_filter"){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"));this.showClearButton()}else{if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function(t){var e,s,i,r;var a=[];t.map(function(t){e=null;switch(t.TYPE){case this.parent.types.DATE:{e=t.LABEL+": "+t.SUB_TYPE.NAME;if(t.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(t.VALUES._quarter)){var r=t.QUARTERS.filter(function(e){return e.VALUE==t.VALUES._quarter}).map(function(t){return t.NAME});r=r.length?r.join(""):"";e=t.LABEL+": "+r+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(t.VALUES._year)){e=t.LABEL+": "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(t.VALUES._month)){var n=t.MONTHS.filter(function(e){return e.VALUE==t.VALUES._month}).map(function(t){return t.NAME});n=n.length?n.join(""):"";e=t.LABEL+": "+n+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+t.VALUES._from}}if((t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(t.VALUES._days))){e=null}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){e=null}break}case this.parent.types.CUSTOM_DATE:{if(BX.type.isArray(t.VALUE.days)&&t.VALUE.days.length||BX.type.isArray(t.VALUE.months)&&t.VALUE.months.length||BX.type.isArray(t.VALUE.years)&&t.VALUE.years.length){e=t.LABEL}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE||t.STRICT){e=t.LABEL+": "+t.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){s=[];e=t.LABEL+": ";t.VALUE.forEach(function(t,e){if(e<2){s.push(t.NAME)}});e+=s.join(", ");if(t.VALUE.length>2){i=[];t.VALUE.forEach(function(t){i.push(t.NAME)});e=i.join(", ")}}break}case this.parent.types.NUMBER:{if(t.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": > ";e+=t.VALUES._from}}if(t.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": < ";e+=t.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:case this.parent.types.DEST_SELECTOR:{if(t.MULTIPLE){var o=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(o)){o=Object.keys(o).map(function(t){return o[t]})}if(!BX.type.isArray(o)){o=[o]}if(o.length>0){e=t.LABEL+": ";e+=o.join(", ")}}else{if(BX.type.isNotEmptyString(t.VALUES._value)&&BX.type.isNotEmptyString(t.VALUES._label)){e=t.LABEL+": ";e+=t.VALUES._label}}break}case this.parent.types.CUSTOM:{e="_VALUE"in t&&BX.type.isNotEmptyString(t._VALUE)?t.LABEL:null;break}default:{if(BX.type.isNotEmptyString(t.VALUE)){e=t.LABEL+": "+t.VALUE}break}}if(e!==null){a.push({block:"main-ui-search-square",name:e,value:t.NAME,item:{type:"control",name:t.NAME},title:e})}},this);return a},getPreset:function(){var t=this.getContainer();var e=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(t)){s=BX.Filter.Utils.getByClass(t,e)}return s},removePreset:function(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}this.hideClearButton()},updatePreset:function(t){this.removePreset();this.setPreset(t)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15441273844327";s:6:"source";s:74:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Settings=function(i,t){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="ui-btn-clock";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.classPresetField="main-ui-filter-preset-field";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.init(i,t)};BX.Filter.Settings.prototype={init:function(i,t){this.generalTemplateId=t.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(i)},get:function(i,t){return i&&i in this&&!BX.type.isFunction(this[i])?this[i]:t},mergeSettings:function(i){if(BX.type.isPlainObject(i)){Object.keys(i).forEach(function(t){if(!BX.type.isFunction(this[t])){this[t]=i[t]}},this)}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15441273842208";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function(e,t){var n;t=BX.type.isPlainObject(t)?t:null;n=Object.keys(t);[].forEach.call(e||[],function(e){n.forEach(function(n){BX.style(e,n,t[n])})})},closestParent:function(e,t){if(e){if(!t){return e.parentNode||null}else{return BX.findParent(e,{className:t})}}},closestChilds:function(e){return!!e?e.children:null},getNext:function(e){return!!e?e.nextElementSibling:null},getPrev:function(e){return!!e?e.previousElementSibling:null},collectionSort:function(e,t){var n,i,r,o,l;if(e&&t&&e!==t&&e.parentNode===t.parentNode){n=this.closestParent(t);i=this.closestChilds(n);r=i.length;o=this.getIndex(i,e);l=this.getIndex(i,t);if(r===l){n.appendChild(t)}if(o>l){n.insertBefore(e,t)}if(o<l&&r!==l){n.insertBefore(e,this.getNext(t))}}},getIndex:function(e,t){return[].indexOf.call(e||[],t)},getByClass:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByClassName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getByTag:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByTagName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getBySelector:function(e,t,n){var i=[];if(t){if(!n){i=(e||document.body).querySelector(t)}else{i=(e||document.body).querySelectorAll(t);i=[].slice.call(i)}}return i},requestAnimationFrame:function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};e.apply(window,arguments)},sortObject:function(e){var t={};Object.keys(e).sort().forEach(function(n){t[n]=e[n]});return t},objectsIsEquals:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},isKey:function(e,t){var n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var i=!!e?"keyCode"in e?e.keyCode:"which"in e?e.which:0:0;return i in n&&n[i]===t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15441273841411";s:6:"source";s:80:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(t){var e,n,i,a,l;e={block:"main-ui-control-field-group",name:"name"?t.name+"_datesel":"",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:"","data-time":t.enableTime},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){a={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(a)}n={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_datesel":"",params:"params"in t?t.params:"",valueDelete:false}};e.content.push(n);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){e.content.push(t.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(i);if(!("dragButton"in t)||t.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(l)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:116:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15441273841102";s:6:"source";s:97:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(t){var e,n,i,a;e={block:"main-ui-control-field-group",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){i={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(i)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("deleteButton"in t&&t.deleteButton===true){n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(n)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15441273841258";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(t){var e,n,i,l,a;e={block:"main-ui-control-field",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){l={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(l)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("valueDelete"in t&&t.valueDelete===true){i={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};e.content.push(i)}if("deleteButton"in t&&t.deleteButton===true){n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(n)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1544127384422";s:6:"source";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.js";s:3:"min";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js";s:3:"map";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(n){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in n?n.type:"text",name:"name"in n?n.name:"",placeholder:"placeholder"in n?n.placeholder:"",tabindex:"tabindex"in n?n.tabindex:"",value:"value"in n?n.value:""}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:118:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1544127384490";s:6:"source";s:100:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.js";s:3:"min";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js";s:3:"map";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(i){var e={block:"main-ui-select-inner-label",content:"label"in i?i.label:""};var n={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":i.id,"data-name":i.name,"data-item":"item"in i?JSON.stringify(i.item):{}},events:{click:"onClick"in i?i.onClick:""},content:e};return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:107:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1544127384250";s:6:"source";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.js";s:3:"min";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js";s:3:"map";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(t){return{block:"main-ui-filter-info",tag:"span",content:t.content,attrs:{title:t.title}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1544127384754";s:6:"source";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.js";s:3:"min";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(e){var n,i,t;n={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in e&&BX.type.isArray(e.mix)){e.mix.forEach(function(e){n.mix.push(e)})}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in e?e.name:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",placeholder:"placeholder"in e?e.placeholder:"",autocomplete:"off"}};n.content.push(i);if("valueDelete"in e&&e.valueDelete===true){t={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};n.content.push(t)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:109:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1544127384513";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(i){var e=["main-ui-filter-search-square"];if("isPreset"in i&&i.isPreset){e.push("main-ui-filter-search-square-preset")}return{block:"main-ui-square",mix:e,attrs:{"data-item":"item"in i?JSON.stringify(i.item):"",title:"title"in i?i.title:""},content:[{block:"main-ui-square-item",content:"name"in i?BX.util.htmlspecialcharsback(i.name):""},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15441273841390";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(t){var n,e,i,a,l;n={block:"main-ui-control-field-group",name:"name"in t?t.name+"_numsel":"",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){a={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};n.content.push(a)}e={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_numsel":"",params:"params"in t?t.params:"",valueDelete:false}};n.content.push(e);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){n.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){n.content.push(t.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};n.content.push(i);if(!("dragButton"in t)||t.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};n.content.push(l)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15441273841364";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(i){return{block:"main-ui-filter-sidebar-item"+("pinned"in i&&i.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in i?i.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in i&&i.dragTitle?i.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in i?i.placeholder:"",value:"text"in i?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(i.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in i?i.text:""},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in i&&i.noEditPinTitle?i.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in i&&i.editNameTitle?i.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in i&&i.removeTitle?i.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in i&&i.editPinTitle?i.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/disk.breadcrumbs/templates/.default/script.min.js?15441274045241";s:6:"source";s:71:"/bitrix/components/bitrix/disk.breadcrumbs/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Disk");BX.Disk.BreadcrumbsClass=function(){var t=function(t){this.storageId=t.storageId;this.containerId=t.containerId;this.collapsedCrumbs=t.collapsedCrumbs||[];this.showOnlyDeleted=t.showOnlyDeleted||0;this.enableDropdown=t.enableDropdown;this.container=BX(this.containerId);this.ajaxUrl="/bitrix/components/bitrix/disk.breadcrumbs/ajax.php";this.container.style.opacity=1;this.setEvents()};t.prototype.setEvents=function(){BX.bindDelegate(this.container,"click",{className:"js-disk-breadcrumbs-arrow"},this.onClickArrow.bind(this));BX.bind(this.getFirstCrumb(),"dblclick",function(t){var e=this.getFirstCrumb();new BX.Disk.Tree.NavigateModal({id:e.dataset.objectId,name:e.dataset.objectName},{}).show();t.preventDefault()}.bind(this));BX.bindDelegate(this.container,"click",{className:"js-disk-breadcrumbs-folder-link"},this.onClickBreadcrumb.bind(this));BX.addCustomEvent("Disk.FolderListClass:onFolderOpen",this.onOpenGridFolder.bind(this));BX.addCustomEvent("Disk.FolderListComponent:onFolderOpen",this.onOpenGridFolder.bind(this));BX.addCustomEvent("Disk.FolderListClass:onPopState",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.FolderListComponent:onPopState",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.FolderListClass:openFolderAfterFilter",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.TrashCanClass:openFolderAfterFilter",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.TrashCanClass:onPopState",this.reloadByPath.bind(this));BX.addCustomEvent("Disk.TrashCanClass:onFolderOpen",this.onOpenGridFolder.bind(this))};t.prototype.getSiblings=function(t){var e=[];var r=t;for(;r;r=r.nextSibling){if(r.nodeType==1&&r!=t){e.push(r)}}return e};t.prototype.expand=function(t,e,r){var s=t.dataset.objectId;var i=t.dataset.objectParentPath;if(i=="/"){i=""}else if(i.lastIndexOf("/")==i.length-1){i=i.substr(0,i.length-1)}var a=[];for(var n in r){if(!r.hasOwnProperty(n)){continue}var o=r[n];var d={text:o.name,title:o.name,href:i+"/"+encodeURIComponent(o.uriComponent)+"/",dataset:{objectId:o.id},onclick:function(t,e){e.menuWindow.close();var r=BX.findParent(e.menuWindow.bindElement,{className:"js-disk-breadcrumbs-folder"});this.removeRightSidedCrumbs(r)}.bind(this)};if(o.className){d.className=o.className+" menu-popup-no-icon"}a.push(d)}BX.PopupMenu.show("disk_breadcrumbs_"+s,e,a,{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}})};t.prototype.onClickBreadcrumb=function(t){var e=t.target||t.srcElement;if(BX.hasClass(e,"js-disk-breadcrumbs-arrow")){return}if(!BX.hasClass(e,"js-disk-breadcrumbs-folder")){e=BX.findParent(e,{className:"js-disk-breadcrumbs-folder"})}this.removeRightSidedCrumbs(e);this.hideArrow(e)};t.prototype.removeRightSidedCrumbs=function(t){this.getSiblings(t).forEach(function(t){BX.remove(t)})};t.prototype.onOpenGridFolder=function(t,e){var r=this.getLastCrumb();if(r.dataset.objectId==t.id){return}if(e){return}this.appendCrumb(t)};t.prototype.getLastCrumb=function(){var t=this.container.querySelectorAll(".js-disk-breadcrumbs-folder");if(!t.length){return null}return t[t.length-1]};t.prototype.getFirstCrumb=function(){return this.container.querySelector(".js-disk-breadcrumbs-folder")};t.prototype.appendCrumb=function(t){var e=this.createCrumb(t);var r=this.getLastCrumb();this.showArrow(r);this.container.appendChild(e)};t.prototype.reloadByPath=function(t,e){e=e||false;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","reloadBreadcrumbs"),data:{storageId:this.storageId,path:t.link,isTrashcan:e?1:0},onsuccess:function(t){if(!t||!t.html){return}var e=BX.create("div",{html:t.html});var r=e.querySelector(".js-disk-breadcrumbs");this.container.innerHTML=r.innerHTML}.bind(this)})};t.prototype.createCrumb=function(t){var e=this.getFirstCrumb();var r=BX.clone(e);r.setAttribute("data-object-parent-path",t.link);r.setAttribute("data-is-root","");r.setAttribute("data-object-id",t.id);r.setAttribute("data-object-name",t.name);var s=r.querySelector(".js-disk-breadcrumbs-folder-link");s.href=t.link;s.dataset.objectId=t.id;r.setAttribute("title",t.name);r.setAttribute("alt",t.name);this.hideArrow(r);BX.adjust(s,{text:t.name});return r};t.prototype.hideArrow=function(t){var e=t.querySelector(".js-disk-breadcrumbs-arrow");if(e){e.style.opacity="0"}};t.prototype.showArrow=function(t){var e=t.querySelector(".js-disk-breadcrumbs-arrow");if(e){e.style.opacity=""}};t.prototype.onClickDots=function(t){var e=t.srcElement||t.target;BX.PopupMenu.show("disk_breadcrumbs_dots",e,this.collapsedCrumbs,{autoHide:true,angle:{offset:0},events:{onPopupClose:function(){}}});BX.PreventDefault(t)};t.prototype.onClickArrow=function(t){if(!this.enableDropdown){t.preventDefault();return}var e=t.srcElement||t.target;var r=BX.findParent(e,{className:"js-disk-breadcrumbs-folder"},this.container);var s=r.getAttribute("data-object-id");var i=r.getAttribute("data-is-root");if(!s){BX.PreventDefault(t);return}BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFolders"),data:{objectId:s,showOnlyDeleted:this.showOnlyDeleted?1:0,isRoot:i?1:0},onsuccess:BX.delegate(function(t){if(!t){return}this.expand(r,e,t.items)},this)});BX.PreventDefault(t)};return t}();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:86:"/bitrix/components/bitrix/main.ui.grid/templates/tilegrid/script.min.js?15441273842738";s:6:"source";s:67:"/bitrix/components/bitrix/main.ui.grid/templates/tilegrid/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.TileGrid=function(t){BX.TileGrid.Grid.apply(this,arguments);this.navigation=t.navigation;this.isLoadingNextPortion=false;this.init(t)};BX.Main.TileGrid.prototype={__proto__:BX.TileGrid.Grid.prototype,constructor:BX.Main.TileGrid,bindEvents:function(){BX.TileGrid.Grid.prototype.bindEvents.call(this);window.addEventListener("scroll",BX.throttle(this.handleScroll.bind(this),100))},init:function(t){this.userOptions=new BX.Main.TileGrid.UserOptions(this,t.userOptions,t.userOptionsActions,t.userOptionsHandlerUrl)},handleScroll:function(){if(this.needToShowNextPortion()){this.showNextPortion()}},handleBackspace:function(){window.history.back()},reload:function(t,i){if(!BX.type.isString(t)){t=document.location.toString()}i=i||{};if(BX.message.SITE_ID){i.SITE_ID=BX.message.SITE_ID}i.sessid=BX.bitrix_sessid();var n={gridId:this.getId(),url:t,data:i};BX.onCustomEvent(window,"BX.TileGrid.Grid:beforeReload",[this,n]);t=n.url;i=n.data;var e=BX.ajax.promise({url:BX.util.add_url_param(t,{grid_id:this.getId(),internal:true}),data:i,method:"POST",dataType:"json"});this.setHeightContainer();this.setFadeContainer();if(!this.loader)this.getLoader();this.showLoader();e.then(function(t){this.navigation=t.data.navigation;this.redraw(t.data.tileGrid.items);this.loader.destroy();this.unSetFadeContainer();this.unSetHeightContainer()}.bind(this));return e},getUserOptions:function(){return this.userOptions},prepareSortUrl:function(t){var i=window.location.toString();if("sort_by"in t){i=BX.util.add_url_param(i,{by:t.sort_by})}if("sort_order"in t){i=BX.util.add_url_param(i,{order:t.sort_order})}return i},sortByColumn:function(t){var i=t;i.sort_url=this.prepareSortUrl(t);this.getUserOptions().setSort(i.sort_by,i.sort_order,function(){this.reload(i.sort_url,{grid_action:"sort"})}.bind(this))},needToShowNextPortion:function(){if(!this.navigation.hasNextPage){return false}var t=BX.pos(this.container).height;var i=document.body.offsetHeight;var n=t-i+this.container.getBoundingClientRect().top;var e=parseInt(this.navigation.pageSize/this.countItemsPerRow,10);var r=BX.pos(this.items[0].layout.container).height;if(r*Math.max(1,parseInt(e*.5,10))>=n){return true}return false},showNextPortion:function(){if(!this.navigation.hasNextPage||this.isLoadingNextPortion){return}this.isLoadingNextPortion=true;var t=BX.ajax.promise({url:BX.util.add_url_param(this.navigation.urlNextPage,{grid_id:this.getId(),internal:true}),method:"POST",dataType:"json"});t.then(function(t){this.isLoadingNextPortion=false;t.data.tileGrid.items.forEach(function(i){this.appendItem(i);this.navigation=t.data.navigation},this)}.bind(this)).catch(function(){this.isLoadingNextPortion=false}.bind(this))}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.grid/templates/tilegrid/js/manager.min.js?1544127384844";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/tilegrid/js/manager.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main");if(BX.Main.tileGridManager){return}BX.Main.tileGridManager={data:[],push:function(t,n){if(BX.type.isNotEmptyString(t)&&n){var i={id:t,instance:n,old:null};if(this.getById(t)===null){this.data.push(i)}else{this.data[0]=i}}},getById:function(t){var n=this.data.filter(function(n){return n.id===t});return n.length===1?n[0]:null},getInstanceById:function(t){var n=this.getById(t);return BX.type.isPlainObject(n)?n["instance"]:null},reload:function(t,n){var i=this.getInstanceById(t);if(i){i.reload(n)}},getDataIndex:function(t){var n=null;this.data.forEach(function(i,e){if(i.id===t){n=e}});return n},destroy:function(t){if(BX.type.isNotEmptyString(t)){var n=this.getInstanceById(t);if(n instanceof BX.Main.TileGrid){n.destroy();var i=this.getDataIndex(t);if(i!==null){delete this.data[i]}}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.ui.grid/templates/tilegrid/js/useroptions.min.js?15441273842878";s:6:"source";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/tilegrid/js/useroptions.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.TileGrid");BX.Main.TileGrid.UserOptions=function(t,i,s,e){this.options=null;this.actions=null;this.parent=null;this.url=null;this.init(t,i,s,e)};BX.Main.TileGrid.UserOptions.prototype={init:function(parent,userOptions,userOptionsActions,url){this.url=url;this.parent=parent;try{this.options=eval(userOptions)}catch(t){console.warn("BX.Main.TileGrid.UserOptions.init: Failed parse user options json string")}try{this.actions=eval(userOptionsActions)}catch(t){console.warn("BX.Main.TileGrid.UserOptions.init: Failed parse user options actions json string")}},getCurrentViewName:function(){var t=this.getOptions();return"current_view"in t?t.current_view:null},getViewsList:function(){var t=this.getOptions();return"views"in t?t.views:{}},getCurrentOptions:function(){var t=this.getCurrentViewName();var i=this.getViewsList();var s=null;if(t in i){s=i[t]}if(!BX.type.isPlainObject(s)){s={}}return s},getUrl:function(t){return BX.util.add_url_param(this.url,{GRID_ID:this.parent.getId(),action:t})},getOptions:function(){return this.options||{}},getActions:function(){return this.actions},getAction:function(t){var i=null;try{i=this.getActions()[t]}catch(t){i=null}return i},update:function(t){this.options=t},setColumns:function(t,i){var s=this.getCurrentOptions();if(BX.type.isPlainObject(s)){s.columns=t.join(",");this.save(this.getAction("GRID_SET_COLUMNS"),{columns:s.columns},i)}return this},setColumnsNames:function(t,i){var s={view_id:"default"};if(BX.type.isPlainObject(s)){s.custom_names=t;this.save(this.getAction("SET_CUSTOM_NAMES"),s,i)}return this},setColumnSizes:function(t,i){this.save(this.getAction("GRID_SET_COLUMN_SIZES"),{sizes:t,expand:i})},reset:function(t,i){var s={};if(!!t){s={view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()}}this.save(this.getAction("GRID_RESET"),s,i)},setSort:function(t,i,s){if(t&&i){this.save(this.getAction("GRID_SET_SORT"),{by:t,order:i},s)}return this},setPageSize:function(t,i){if(BX.type.isNumber(parseInt(t))){this.save(this.getAction("GRID_SET_PAGE_SIZE"),{pageSize:t},i)}},setExpandedRows:function(t,i){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_EXPANDED_ROWS"),{ids:t},i)},setCollapsedGroups:function(t,i){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_COLLAPSED_GROUPS"),{ids:t},i)},resetExpandedRows:function(){this.save(this.getAction("GRID_RESET_EXPANDED_ROWS"),{})},saveForAll:function(t){this.save(this.getAction("GRID_SAVE_SETTINGS"),{view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()},t)},batch:function(t,i){this.save(this.getAction("GRID_SAVE_BATH"),{bath:t},i)},save:function(t,i,s){var e=this;BX.ajax.post(this.getUrl(t),i,function(t){try{t=JSON.parse(t);if(!t.error){e.update(t);if(BX.type.isFunction(s)){s(t)}}}catch(t){}})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/disk.help.network.drive/templates/.default/script.js?1544127404302";s:6:"source";s:78:"/bitrix/components/bitrix/disk.help.network.drive/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Disk");
BX.Disk.HelpNetworkDriveClass = (function ()
{
	var HelpNetworkDriveClass = function (parameters){};
	HelpNetworkDriveClass.prototype.showContent = function (el)
	{
		el.style.display = (el.style.display == 'none') ? 'block' : 'none';
	};

	return HelpNetworkDriveClass;
})();

/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/disk.file.upload/templates/.default/script.min.js?154412740417035";s:6:"source";s:71:"/bitrix/components/bitrix/disk.file.upload/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){if(BX.DiskUpload)return;var e=[];BX.DiskUpload=function(e){this.bp=e["bp"];this.bpParameters=e["bpParameters"];this.bpParametersRequired=e["bpParametersRequired"];this.storageId=e["storageId"];this.ajaxUrl="/bitrix/components/bitrix/disk.folder.list/ajax.php";this.CID=e["CID"];this.nodeContent=BX.create("DIV",{style:{display:"none"},attrs:{id:e["CID"]+"ContentNode"},html:BX.message("DFU_TEMPLATE").replace(/#id#/gi,this.CID)+'<div class="wduf-uploader area">'+BX.message("DFU_DND_TEMPLATE")+"</div>"});document.body.appendChild(this.nodeContent);this.counter={all:[],uploaded:[],uploading:[]};this.init(e);return this};BX.DiskUpload.prototype={_camelToSNAKE:function(e){var t={},i,s;for(i in e){if(e.hasOwnProperty(i)){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}}return t},initAttempt:0,init:function(e){this.initAttempt++;if(this.initAttempt>10||this.agent)return;this.placeHolder=BX(this.CID+"PlaceHolder");if(this.placeHolder){this.templates={new:BX.message("DFU_NODE_TEMPLATE"),done:BX.message("DFU_NODE_TEMPLATE_DONE"),canceled:BX.message("DFU_NODE_TEMPLATE_CANCELED"),error:BX.message("DFU_NODE_TEMPLATE_ERROR"),error_double:BX.message("DFU_NODE_TEMPLATE_ERROR_DOUBLE")};var t,i,s,o,r,a;for(t in this.templates){o={};if(this.templates.hasOwnProperty(t)){i=this.templates[t];if(/^<tr(.*?)>/gi.test(i)){s=/^<tr(.*?)>/gi.exec(i);s=s[1].split(" ");if(s&&s.length>0){for(r=0;r<s.length;r++){a=s[r].split("=");if(a&&a.length==2){a[0]=a[0].replace(/['"]/gi,"");a[1]=a[1].replace(/['"]/gi,"");o[a[0]]=a[1]}}}}this.templates[t]={node:"TR",attrs:o,text:i.replace(/^<tr(.*?)>/i,"").replace(/<\/tr>$/i,"")}}}var n;if(this.bp){if(this.bpParameters){n="deferred"}else{n="immediate"}this.agent=BX.Uploader.getInstance({id:this.CID,streams:1,allowUpload:"A",uploadFormData:"Y",uploadMethod:n,uploadFileUrl:e["urlUpload"],showImage:false,sortItems:false,input:e["input"],dropZone:e["dropZone"],placeHolder:this.placeHolder,phpMaxFileUploads:1,queueFields:{thumb:{tagName:"TR",className:"bxu-item"}},fields:{thumb:{tagName:"",template:this.templates["new"].text}}})}else{this.agent=BX.Uploader.getInstance({id:this.CID,streams:1,allowUpload:"A",uploadFormData:"Y",uploadMethod:"immediate",uploadFileUrl:e["urlUpload"],showImage:false,sortItems:false,input:e["input"],dropZone:e["dropZone"],placeHolder:this.placeHolder,phpMaxFileUploads:1,queueFields:{thumb:{tagName:"TR",className:"bxu-item"}},fields:{thumb:{tagName:"",template:this.templates["new"].text}}})}this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onStart=BX.delegate(this.onStart,this);this._onError=BX.delegate(this.onError,this);if(BX(this.agent.fileInput)&&!this.agent.fileInput.hasAttribute("id"))this.agent.fileInput.setAttribute("id","diskUbloadFileInput"+this.CID);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onStart",this._onStart);BX.addCustomEvent(this.agent,"onError",this._onError);BX.addCustomEvent("Disk.Page:onChangeFolder",function(e,t){this.changeTargetFolderId(t.id)}.bind(this));this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onUploadStart=BX.delegate(this.onUploadStart,this);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadWindowClose=BX.delegate(this.onUploadWindowClose,this);this._onUploadWindowFirstShow=BX.delegate(this.onUploadWindowFirstShow,this);this._onStartBizproc=BX.delegate(this.onStartBizproc,this);if(BX(e["dropZone"])){var d=BX.create("DIV",{attrs:{className:"wduf-uploader area"},html:BX.message("DFU_DND_TEMPLATE")}),l=BX.pos(e["dropZone"]);BX.adjust(e["dropZone"],{style:{position:"relative"},children:[d]});BX.addCustomEvent(this.agent.dropZone,"dragEnter",function(){var e=BX.GetWindowInnerSize(),t=BX.GetWindowScrollPos();l["height"]=e["innerHeight"]-(l["top"]-t["scrollTop"]);d.style.height=l["height"]+"px"})}}else{setTimeout(BX.delegate(function(){this.init(e)},this),500)}},changeTargetFolderId:function(e){if(this.agent.form&&this.agent.form.targetFolderId){this.agent.form.targetFolderId.value=e;var t=this.agent.getItems().items;for(var i in t){if(!t.hasOwnProperty(i)){continue}var s=t[i];var o=this.agent.getItem(s.id);if(o.node){BX.remove(o.node)}}}},onItemIsAdded:function(){if(this.popup)this.popup.show();else if(this.bp&&this.bpParameters){var e=BX.findChildren(this.nodeContent);e.unshift(BX("parametersFormBp"));this.popup=BX.Disk.modalWindow({modalId:"bx-dfu-upload-"+this.CID,closeIcon:false,title:BX.message("DFU_UPLOAD_TITLE1"),contentClassName:" tac bx-disk-upload-file",withoutWindowManager:true,content:e,events:{onPopupFirstShow:this._onUploadWindowFirstShow,onPopupClose:function(){BX.reload()}},zIndex:-200,htmlButtons:[BX.create("A",{text:BX.message("DFU_SAVE_BP"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green mb0"},events:{click:this._onStartBizproc},attrs:{id:"bx-disk-savebp-button"}}),BX.create("LABEL",{text:BX.message("DFU_UPLOAD"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green mb0 bx-hide-button"},attrs:{id:"bx-disk-upload-button",for:this.agent.fileInput.getAttribute("id")}}),BX.create("A",{text:BX.message("DFU_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-gray mb0"},attrs:{id:this.CID+"ButtonClose",disabled:true},events:{click:this._onUploadWindowClose}})]})}else{this.popup=BX.Disk.modalWindow({modalId:"bx-dfu-upload-"+this.CID,closeIcon:false,title:BX.message("DFU_UPLOAD_TITLE1"),contentClassName:" tac bx-disk-upload-file",content:BX.findChildren(this.nodeContent),events:{onPopupFirstShow:this._onUploadWindowFirstShow,onPopupClose:BX.delegate(function(){BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded)},this)},htmlButtons:[BX.create("LABEL",{text:BX.message("DFU_UPLOAD"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green mb0"},attrs:{for:this.agent.fileInput.getAttribute("id")}}),BX.create("A",{text:BX.message("DFU_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-gray mb0"},attrs:{id:this.CID+"ButtonClose",disabled:true},events:{click:this._onUploadWindowClose}})]})}this.popup.destroy=BX.DoNothing;BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded)},onStartBizproc:function(){if(BX("formPostAjax").getElementsByTagName("div").length){BX("formPostAjax").removeChild(BX("divStartBizProc"))}var e=BX("divStartBizProc").cloneNode(true),t=BX("parametersFormBp").querySelectorAll("textarea"),i=BX("parametersFormBp").querySelectorAll("select"),s=e.querySelectorAll("textarea"),o=e.querySelectorAll("select"),r;if(t.length){for(r in t){if(t.hasOwnProperty(r)){s[r].value=t[r].value}}}if(i.length){for(r in i){if(i.hasOwnProperty(r)){o[r].value=i[r].value}}}BX("formPostAjax").appendChild(e);var a=BX.ajax.prepareForm(BX("formPostAjax")),n=this.agent;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","validateParameterAutoloadBizProc"),data:{required:this.bpParametersRequired,data:a,storageId:this.storageId},onsuccess:function(e){if(e.status=="success"){n.submit();BX("formPostAjax").removeChild(BX("divStartBizProc"));BX("errorTd").innerHTML="";if(!BX.hasClass(BX("bx-disk-savebp-button"),"bx-hide-button")){BX.toggleClass(BX("bx-disk-upload-button"),"bx-hide-button");BX.toggleClass(BX("bx-disk-savebp-button"),"bx-hide-button")}}else{if(BX("formPostAjax").getElementsByTagName("div").length){BX("formPostAjax").removeChild(BX("divStartBizProc"))}for(r in e["errors"]){if(e["errors"].hasOwnProperty(r)){BX("errorTd").innerHTML=e["errors"][r].message}}if(BX.hasClass(BX("bx-disk-savebp-button"),"bx-hide-button")){BX.toggleClass(BX("bx-disk-upload-button"),"bx-hide-button");BX.toggleClass(BX("bx-disk-savebp-button"),"bx-hide-button")}}}})},onFileIsInited:function(e,t){this.counter.all.push(e);BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onUploadStart",this._onUploadStart);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError);this.__checkButton();if(this.bp&&this.bpParameters&&this.popup){this.onStartBizproc()}},onFileIsAppended:function(e,t){var i=this.agent.getItem(e);this.__bindEventsToNode(i.node,t)},onUploadStart:function(e){this.counter.uploading.push(e.id);e.__progressBar=BX(e.id+"Progress");e.__progressBarWidth=5;if(e.__progressBar)e.__progressBar.style.width=e.__progressBarWidth+"%"},onUploadProgress:function(e,t){t=Math.min(t,96);if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;if(e.__progressBar)e.__progressBar.style.width=e.__progressBarWidth+"%"}},onUploadDone:function(e,t){if(e.__progressBar)e.__progressBar.style.width="100%";this.counter.uploading=BX.util.deleteFromArray(this.counter.uploading,BX.util.array_search(e.id,this.counter.uploading));this.counter.uploaded.push(e.id);e.fileId=t["file"]["fileId"];var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var o=this.templates.done.text;for(var r in s){if(s.hasOwnProperty(r)){o=o.replace(new RegExp("#"+r.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(s[r])).replace(new RegExp("#"+r.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(s[r]))}}var a;if(BX.browser.IsIE8()){a=i;while(a.cells.length>0){a.deleteCell(0)}var n=0;o.replace(/<\/td>/gi,"").replace(/<td([^>]+)>([^\002]+)\002/gi,function(e,t,i){var s=a.insertCell(n);s.innerHTML=i;t.replace(/class=["']([a-z\-\s]+)['"]/,function(e,t){s.className=t});n++;return""})}else{a=BX.create("TR",{attrs:this.templates.done.attrs,html:o});a.setAttribute("id",i.getAttribute("id"));i.parentNode.replaceChild(a,i)}}else{this.onUploadError(e,t)}this.__bindEventsToNode(i,e);this.__checkButton()},onUploadError:function(e,t,i){this.counter.uploading=BX.util.deleteFromArray(this.counter.uploading,BX.util.array_search(e.id,this.counter.uploading));t=typeof t=="object"&&t?t:{};var s=this.agent.getItem(e.id).node,o=this._camelToSNAKE(t);if(BX(s)&&(i==true||!BX(s).hasAttribute("bx-disk-error"))){o=!!o&&typeof o=="object"?o:{};var r=o["file"]&&o["file"]["isNotUnique"]?this.templates.error_double:this.templates.error,a=r.text,n;for(n in e){if(e.hasOwnProperty(n)&&typeof e[n]=="string"){a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(e[n])).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(e[n]))}}if(o){for(n in o){if(o.hasOwnProperty(n)){a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(o[n])).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(o[n]))}}if(o["file"]){for(n in o["file"]){if(o["file"].hasOwnProperty(n)){a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(o["file"][n])).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(o["file"][n]))}}}}var d=BX.create("TR",{attrs:r.attrs,html:a});d.setAttribute("id",s.getAttribute("id"));d.setAttribute("bx-disk-error","Y");s.parentNode.replaceChild(d,s);this.__bindEventsToNode(d,e);this.__checkButton();if(this.uploadParams.errored<=0){var l=BX.pos(d),p=BX.pos(this.placeHolder);this.placeHolder.parentNode.scrollTop=l.top-p.top}this.uploadParams.errored++}else{BX.debug("BX.Disk.Upload: node for error does not exist.")}},uploadParams:{errored:0},onStart:function(){this.uploadParams.errored=0},onError:function(e,t,i){if(i&&i.status==="restriction"&&BX("bx-bitrix24-business-tools-info")){BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose:function(){this.destroy()},autoHide:true}).show()}var s="Uploading error.",o=s,r,a;if(i){if(i["error"]&&typeof i["error"]=="string")o=i["error"];else if(i["message"]&&typeof i["message"]=="string")o=i["message"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){o=[];for(var n=0;n<i["errors"].length;n++){if(typeof i["errors"][n]=="object"&&i["errors"][n]["message"])o.push(i["errors"][n]["message"])}if(o.length<=0)o.push(s);o=o.join(" ")}}e["files"]=e.files||{};for(a in e["files"]){if(e["files"].hasOwnProperty(a)){r=this.agent.queue.items.getItem(a);this.onUploadError(r,{error:o},o!=s)}}},deleteFile:function(e,t){BX.addClass(e,"bx-disk-popup-upload-file-delete-event");var i=BX.findChild(e,{className:"file-delete"},true),s=BX.util.array_search(t.id,this.counter.uploaded);if(s>=0)this.counter.uploaded=BX.util.deleteFromArray(this.counter.uploaded,s);s=BX.util.array_search(t.id,this.counter.uploading);if(s>=0)this.counter.uploading=BX.util.deleteFromArray(this.counter.uploading,s);this.counter.all=BX.util.deleteFromArray(this.counter.all,BX.util.array_search(t.id,this.counter.all));delete t.hash;setTimeout(function(){t.deleteFile("deleteFile")},400);if(!!i&&i.getAttribute("href").length>0)BX.ajax.post(i.href,{sessid:BX.bitrix_sessid()});this.__checkButton()},replaceFile:function(e,t){if(BX(e)){var i=this.templates["new"].text;for(var s in t){if(t.hasOwnProperty(s)){i=i.replace(new RegExp("#"+s.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(t[s])).replace(new RegExp("#"+s.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(t[s]))}}var o=BX.create("TR",{attrs:this.templates["new"].attrs,html:i});o.setAttribute("id",e.getAttribute("id"));e.parentNode.replaceChild(o,e);this.__bindEventsToNode(e,t);this.__checkButton();var r=t.file.uploadStatus;this.agent.queue.restoreFiles(new BX.UploaderUtils.Hash(t.id,t),true);t.file.uploadStatus=r;if(this.agent.post){this.agent.post.data["REPLACE_FILE"]=this.agent.post.data["REPLACE_FILE"]||[];this.agent.post.data["REPLACE_FILE"].push(t.id)}var a;if(this.agent.form){a=BX.create("INPUT",{attrs:{id:"input"+t.id},props:{name:"REPLACE_FILE[]",value:t.id}});this.agent.form.appendChild(a)}this.agent.submit();if(this.agent.post){this.agent.post.data["REPLACE_FILE"].pop()}if(this.agent.form){BX.remove(a)}}},__checkButton:function(){var e=BX(this.CID+"ButtonClose"),t=BX(this.CID+"Number"),i=BX(this.CID+"Count");if(e)BX.adjust(e,{props:{disabled:this.counter.uploading.length>0}});if(t)t.innerHTML=this.counter.uploaded.length;if(i)i.innerHTML=this.counter.all.length},__bindEventsToNode:function(e,t){var i=BX.delegate(function(){this.deleteFile(e,t)},this),s=BX.delegate(function(){this.replaceFile(e,t)},this),o=BX.findChild(e,{attribute:{id:t.id+"Cancel"}},true),r=BX.findChild(e,{attribute:{id:t.id+"Replace"}},true);if(o&&!o.hasAttribute("bx-bound")){o.setAttribute("bx-bound","Y");BX.bind(o,"click",i)}if(r&&!r.hasAttribute("bx-bound")){r.setAttribute("bx-bound","Y");BX.bind(r,"click",s)}},onUploadWindowFirstShow:function(e){this.agent.initDropZone(e.contentContainer);if(this.bp&&this.bpParameters){var t=BX.findChildrenByClassName(BX("parametersFormBp"),"bx-html-editor"),i;for(var s in t){if(t.hasOwnProperty(s)){i=t[s].getAttribute("id").replace("bx-html-editor-","");window["BXHtmlEditor"].editors[i].CheckAndReInit()}}}},onUploadWindowClose:function(){if(this.popup&&this.counter.uploading.length<=0){this.popup.close();if(this.counter.uploaded.length>0){var e,t;var i=this.counter.uploaded.length;while((t=this.agent.getItem(this.counter.uploaded.pop()))&&t&&t["item"]&&(t=t["item"])){if(t["fileId"]){e=BX.Disk.getUrlToShowObjectInGrid(t["fileId"]);break}}if(i===1&&BX.SidePanel.Instance.getSliderByWindow(window)){document.location.reload();BX.SidePanel.Instance.postMessageAll(window,"Disk.File:onNewVersionUploaded",{objectId:t["fileId"]})}else{BX.onCustomEvent("onPopupFileUploadClose",[this,t["fileId"]])}}}}};BX.DiskUpload.initialize=function(t){t["CID"]=t["CID"]?t["CID"]:"DiskUpload";var i=BX.create("INPUT",{attrs:{id:"inputContainer"+t["CID"]},props:{type:"file",multiple:true,title:BX.message("DFU_UPLOAD_TITLE1")}});var s=BX.create("FORM",{attrs:{id:"formPostAjax"},style:{display:"none"},children:[i,t["targetFileId"]?BX.create("INPUT",{props:{type:"hidden",name:"targetFileId",value:t["targetFileId"]}}):BX.create("INPUT",{props:{type:"hidden",name:"targetFolderId",value:t["targetFolderId"]}})]});var o=BX.create("LABEL",{attrs:{id:"inputContainerLabel"+t["CID"],title:BX.message("DFU_UPLOAD_TITLE1"),for:"inputContainer"+t["CID"]},children:[]});var r=BX.create("DIV",{style:{display:"none"}});document.body.appendChild(r);if(t["inputContainer"]){var a=BX(t["inputContainer"]);BX.adjust(o,{attrs:{className:a.className,id:a.id,title:BX.message("DFU_UPLOAD_TITLE1"),for:"inputContainer"+t["CID"]},html:a.innerHTML});o.appendChild(s);a.parentNode.replaceChild(o,a)}else{o.appendChild(s);BX.addCustomEvent(window,"onDiskUploadPopupShow",function(e){e.appendChild(o)});BX.addCustomEvent(window,"onDiskUploadPopupClose",function(e){r.appendChild(o)})}t["input"]=i;if(!e[t["CID"]]){e[t["CID"]]=new BX.DiskUpload(t)}return e[t["CID"]]};BX.DiskUpload.getObj=function(t){return e[t]}})();
/* End */
;; /* /bitrix/templates/bitrix24/components/bitrix/socialnetwork.group_menu/.default/script.min.js?15441276453524*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575*/
; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527*/
; /* /bitrix/components/bitrix/disk.folder.list/templates/.default/script.min.js?1544127404101493*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?154412738446925*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?15441273841650*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/destination-selector.min.js?15441273845460*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15441273842703*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?154412738423035*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15441273843115*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?154412738417210*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?154412738418784*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15441273844327*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15441273842208*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15441273841411*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15441273841102*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15441273841258*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1544127384422*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1544127384490*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1544127384250*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1544127384754*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1544127384513*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15441273841390*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15441273841364*/
; /* /bitrix/components/bitrix/disk.breadcrumbs/templates/.default/script.min.js?15441274045241*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/tilegrid/script.min.js?15441273842738*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/tilegrid/js/manager.min.js?1544127384844*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/tilegrid/js/useroptions.min.js?15441273842878*/
; /* /bitrix/components/bitrix/disk.help.network.drive/templates/.default/script.js?1544127404302*/
; /* /bitrix/components/bitrix/disk.file.upload/templates/.default/script.min.js?154412740417035*/

//# sourceMappingURL=page_a2962debd7b0e5f116d61ecd1900f40e.map.js