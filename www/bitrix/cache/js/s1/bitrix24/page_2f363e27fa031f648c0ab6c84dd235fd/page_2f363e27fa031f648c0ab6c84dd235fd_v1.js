
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?154412746160";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(i);var r={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};s=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a,o={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"]};a=this.getListItems(t,s);if(a.length){o.items=a}i.push(o);delete t[s]}}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var i;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){i=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",i,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{var s="settings";BX.userOptions.save("ui",this.listContainer.id,s,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?15441274611848";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(t){return BX.Tasks.Component.TopMenu.instances[t]},addInstance:function(t,e){BX.Tasks.Component.TopMenu.instances[t]=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this)},bindEvents:function(){var t=this;try{var e=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(e.length){for(var n=0;n<e.length;n++){BX.bind(e[n],"click",function(t){BX.PreventDefault(t);var e=this.dataset.id=="view_all"?"":this.dataset.id;var n=this.dataset.url;BX.onCustomEvent("Tasks.TopMenu:onItem",[e,n]);var s=this.parentElement.getElementsByClassName("tasks_role_link");if(s.length){for(var a=0;a<s.length;a++){BX.removeClass(s[a],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")})}}}catch(t){}BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,n,s,a){var o=n.getFilterFieldsValues();var i=o.ROLEID;try{var r=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var l=r.querySelectorAll(".tasks_role_link");for(var c=0;c<l.length;c++){BX.removeClass(l[c],"main-buttons-item-active")}if(!i){i="view_all"}BX.addClass(BX("tasks_panel_menu_"+i),"main-buttons-item-active");var u=BX.Tasks.Component.TasksToolbar.getInstance();u.getToolbarData(i,function(){u.render()})}catch(t){}})},spotLightInit:function(){var t=this;var e=BX("tasks_panel_menu_more_button");var n=BX("tasks_panel_menu_view_effective");if(n){var s=new BX.SpotLight({id:"tasks_sl_effective",targetElement:n,content:t.option("text_sl_effective"),targetVertex:"middle-center",autoSave:true});s.show()}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?154412738466246";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"])return;var e={controller:{},handler:{}};BX.addCustomEvent(window,"BFileDLoadFormControllerWasBound",function(t){e.controller[t.id]=true});BX.addCustomEvent(window,"WDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"WDLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"DiskDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"DiskLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"OnEditorInitedBefore",function(t){if(e.handler[t.id]){t.__lhe_flags=["OnEditorInitedBefore"];if(e.handler[t.id]["params"]&&e.handler[t.id]["params"]["LHEJsObjName"])window[e.handler[t.id].params["LHEJsObjName"]]=t;e.handler[t.id].OnEditorInitedBefore(t)}});var t=function(t){if(e.handler[t.id]&&e.handler[t.id].editorIsLoaded!==true){e.handler[t.id].editorIsLoaded=true;e.handler[t.id].exec();BX.onCustomEvent(e.handler[t.id],"OnEditorIsLoaded",[e.handler[t.id],t])}};BX.addCustomEvent(window,"OnCreateIframeAfter",t);BX.addCustomEvent(window,"OnEditorInitedAfter",function(i,n){if(e.handler[i.id]){i.__lhe_flags.push("OnEditorInitedAfter");e.handler[i.id].OnEditorInitedAfter(i);if(e.handler[i.id].editorIsLoaded!==true&&n&&i.sandbox&&i.sandbox.inited)t.apply(i,[i])}});BX.util.object_search=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){if(t[i]==e)return true;else if(typeof t[i]=="object"&&t[i]!==null){var n=BX.util.object_search_key(e,t[i]);if(n!==false)return n}}}return false};var i=function(e,t,i){i=i&&i.length>0?i:[];if(typeof t=="object"&&t.length>0){var n;while((n=t.pop())&&n&&t.length>0){i.push(n)}t=n}i.push(t);this.exist=true;this.bxTag=e;this.tag=t;this.tags=i;this.regexp=new RegExp("\\[("+i.join("|")+")=((?:\\s|\\S)*?)(?:\\s*?WIDTH=(\\d+)\\s*?HEIGHT=(\\d+))?\\]","ig");this.code="["+t+"=#ID##ADDITIONAL#]";this.wysiwyg='<span style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;" id="#ID#"#ADDITIONAL#>#NAME#</span>'},n=function(t,i,n){this.CID=this.id=i;this.parser=t.parser["disk_file"]||null;this.params=n;this.node=BX("diskuf-selectdialog-"+i);this.handler=e.controller[i];this.manager=t;this.eventNode=this.manager.eventNode;this.parserName="disk_file";this.prefixNode="disk-edit-attach";this.prefixHTMLNode="disk-attach-";this.props={valueEditClassName:"wd-inline-file",securityCID:"disk-upload-cid"};this.storage="disk";this.fileToAttach={};this.xmlToAttach={};this.events={onInit:"DiskDLoadFormControllerInit",onShow:"DiskLoadFormController",onBound:"DiskLoadFormControllerWasBound"}};n.prototype={parser:false,eventNode:null,values:{},initialized:false,functionsToExec:[],exec:function(e,t){if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.handler&&this.handler!==true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},init:function(){if(this.initialized!==true){this.values={};this.functionsToExec=[];this.initialized=true;this.bindMainEvents(this.manager);if(this.parser!==null){this.bindEvents(this.manager);return this.initValues()}}return false},initValues:function(){var e=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(e&&e.length>0){this.exec(this.runCheckText);return true}return false},bindMainEvents:function(t){var i=null;BX.addCustomEvent(t.eventNode,"onReinitializeBefore",BX.proxy(this.clean,this));BX.addCustomEvent(t.eventNode,"onShowControllers",BX.proxy(function(e){i=e;BX.onCustomEvent(t.eventNode,this.events.onShow,[e])},this));if(!e.controller[this.id]){var o=BX.delegate(function(e){if(e["UID"]==this.id||e["id"]==this.id){if(i==="show"||i==="hide"){BX.onCustomEvent(t.eventNode,this.events.onShow,[i]);i=null}BX.removeCustomEvent(window,this.events.onBound,o)}},this);BX.addCustomEvent(window,this.events.onBound,o)}if(BX["DD"]&&this.storage=="disk"){var a=BX.delegate(function(e){if((e["UID"]==this.id||e["id"]==this.id)&&this.manager["dropZoneExists"]!==true){BX.removeCustomEvent(window,this.events.onBound,a);this.manager["dropZoneExists"]=true;var i=this.eventNode,o=this.id;n.dndCatcher=n.dndCatcher||{};n.dndCatcher[o]={catch:true,files:[],dropZone:null,dropZoneMicro:null,initdrag:BX.delegate(function(){n.dndCatcher[o].dropZone=new BX.DD.dropFiles(t.eventNode);BX.addCustomEvent(t.eventNode,"OnImageDataUriHandle",BX.delegate(function(e,t){if(BX["UploaderUtils"]){var i=BX.UploaderUtils.dataURLToBlob(t.src);if(i&&i.size>0&&i.type.indexOf("image/")==0){i.name=i.name||t.title||"image."+i.type.substr(6);i.referrerToEditor=t;if(n.dndCatcher[o]["catch"]===true)n.dndCatcher[o]["drop"]([i]);else if(this.handler&&this.handler["addFile"])this.handler.addFile(i);BX.onCustomEvent(e,"OnImageDataUriCaught",[t])}}},this));BX.addCustomEvent(n.dndCatcher[o].dropZone,"dropFiles",n.dndCatcher[o]["drop"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragEnter",n.dndCatcher[o]["dragover"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragLeave",n.dndCatcher[o]["dragleave"]);if(BX("micro"+t.__divId)){n.dndCatcher[o].dropZoneMicro=new BX.DD.dropFiles(BX("micro"+t.__divId));BX.addCustomEvent(n.dndCatcher[o].dropZoneMicro,"dragEnter",function(){BX.onCustomEvent(t.eventNode,"OnShowLHE",["justShow"])})}BX.unbind(document,"dragover",n.dndCatcher[o]["initdrag"]);BX.onCustomEvent(t.eventNode,"onDropZoneExists",[])},this),dragover:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragover",[])},this),dragleave:BX.delegate(function(){BX.removeClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragleave",[])},this),dragenterwindow:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.addClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragenterwindow",[])},this),dragleavewindow:BX.delegate(function(e){BX.removeClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.removeClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragleavewindow",[])},this),drop:BX.delegate(function(e){BX.onCustomEvent(t.eventNode,"drop",[]);BX.onCustomEvent(window,"dragWindowLeave");BX.onCustomEvent(window,"__dragWindowLeave");var i=0;if(e&&e.length>0){if(n.dndCatcher[o]["catch"]===true){n.dndCatcher[o].files=e;i=1}else{i=2}BX.onCustomEvent(t.eventNode,this.events.onShow,["show"]);BX.removeClass(t.eventNode,"feed-add-post-dnd-ready feed-add-post-dnd-over")}return i},this)};BX.ready(function(){n.dndCatcher[o]["initdrag"]()});BX.addCustomEvent(i,"OnIframeDrop",BX.delegate(function(e){BX.PreventDefault(e);if(e["dataTransfer"]&&e["dataTransfer"]["files"]){if(n.dndCatcher[o].drop(e["dataTransfer"]["files"])===2){this.handler.agent.onChange(e["dataTransfer"]["files"])}}},this));BX.addCustomEvent(i,"OnIframeDragOver",n.dndCatcher[o].dragover);BX.addCustomEvent(i,"OnIframeDragLeave",n.dndCatcher[o].dragleave);if(!window["bxMpfDndCatcher"]){window["bxMpfDndCatcher"]=true;var s=false,r=function(){if(s===false){s=true;BX.bind(document,"dragleave",l);BX.bind(document,"dragover",l);BX.bind(document,"mouseout",d);BX.onCustomEvent(window,"dragWindowEnter")}},d=function(e){BX.unbind(document,"dragleave",l);BX.unbind(document,"dragover",l);BX.unbind(document,"mouseout",d);s=false;BX.onCustomEvent(window,"dragWindowLeave")},l=function(e){if(h>0){clearTimeout(h);h=0}BX.fixEventPageXY(e);var t=true;if(e.pageX>0&&e.pageY>0){var i=BX.GetWindowSize();if(e.pageY<i.scrollHeight&&e.pageX<i.scrollWidth){var n=e.pageY-i.scrollTop,o=e.pageX-i.scrollLeft;if(0<n&&n<i.innerHeight-20&&0<o&&o<i.innerWidth-20){t=false}}}if(t){d(e)}else{h=setTimeout(function(){l({type:"intervalLimit"})},100)}},h=0;BX.bind(document,"dragenter",function(e){if(window["bxMpfDndCatcher"]>0){clearTimeout(window["bxMpfDndCatcher"])}var t=true;if(e&&e["dataTransfer"]&&e["dataTransfer"]["types"]){for(var i=0;i<e["dataTransfer"]["types"].length;i++){if(e["dataTransfer"]["types"][i]=="Files"){t=true;break}}}if(t){r()}});BX.addCustomEvent(window,"__dragWindowLeave",d);BX.bind(document,"dragover",function(e){return BX.PreventDefault(e)});BX.bind(document,"drop",function(e){d(e);return BX.PreventDefault(e)})}BX.addCustomEvent(window,"dragWindowEnter",n.dndCatcher[o].dragenterwindow);BX.addCustomEvent(window,"dragWindowLeave",n.dndCatcher[o].dragleavewindow);this.__initCatcher=BX.delegate(function(e,i){if(e==this.id){BX.removeCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher);i.agent.initDropZone(t.eventNode);if(n.dndCatcher[e].files.length>0){i.agent.onChange(n.dndCatcher[e].files);n.dndCatcher[e].files=[]}n.dndCatcher[e]["catch"]=false;this.__initCatcher=null}},this);BX.addCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher)}},this);BX.addCustomEvent(window,this.events.onBound,a);if(e.controller[this.id])a(e.controller[this.id])}},bindEvents:function(e){this._catchHandler=BX.delegate(function(t){BX.removeCustomEvent(this.eventNode,this.events.onInit,this._catchHandler);this.handler=t;var i=BX.findChild(BX(e.formID),{attr:{id:this.props.securityCID}},true,false);if(i)i.value=this.handler.CID;this.exec();var n=BX.delegate(function(){BX.onCustomEvent(e.eventNode,"onUploadsHasBeenChanged",arguments)},this);BX.addCustomEvent(this.handler.agent,"onFileIsInited",n);BX.addCustomEvent(this.handler.agent,"ChangeFileInput",n);BX.onCustomEvent(e.eventNode,"onControllerInitialized",[this.id,t])},this);if(typeof this.handler!="object"||!this.handler)BX.addCustomEvent(e.eventNode,this.events.onInit,this._catchHandler);else this._catchHandler(this.handler);BX.addCustomEvent(e.eventNode,"OnFileUploadSuccess",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){i=i||{};i.usePostfix=true;this.addFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadFailed",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){this.failFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadRemove",BX.delegate(function(e,t){if(this.id==t.CID||this.id==t.id){this.deleteFile(e,{usePostfix:true},t)}},this));BX.addCustomEvent(this,"onFileIsInText",BX.proxy(function(e,t){this.adjustFile(this.checkFile(e),t)},this))},addFile:function(e,t,i){var n=this.checkFile(e.element_id,e,t);if(n){setTimeout(BX.proxy(function(){this.bindFile(n);this.adjustFile(n,false)},this),100);BX.onCustomEvent(this.eventNode,"onFileIsAdded",[n,this,i,t])}else{this.failFile(this,t,i)}return true},failFile:function(e,t,i){BX.onCustomEvent(this.eventNode,"onFileIsFailed",[this,i,t])},checkFile:function(e,t){e=""+(typeof e=="object"?e.id:e);if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(t.place)){var i={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(t.place,true),xmlID:BX(t.place,true).getAttribute("bx-attach-xml-id"),fileID:BX(t.place,true).getAttribute("bx-attach-file-id"),fileType:BX(t.place,true).getAttribute("bx-attach-file-type")},n;if(/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name)&&(n=BX.findChild(i.place,{className:"files-preview",tagName:"IMG"},true,false))&&n){i.type="image/xyz";i.lowsrc=n.src;i.element_url=i.src=n.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight=(\d+)/,"");i.isImage=true;i.width=parseInt(n.getAttribute("data-bx-full-width")||n.getAttribute("data-bx-width"));i.height=parseInt(n.getAttribute("data-bx-full-height")||n.getAttribute("data-bx-height"))}if(i.xmlID)this.xmlToAttach[i.xmlID+""]=e;if(i.fileID)this.fileToAttach[i.fileID+""]=e;this.values[e]=i}return this.values[e]||false},bindFile:function(e){var t=e.place;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){var i=BX.findChild(t,{className:"f-wrap"},true,false),n=BX.findChild(t,{className:"files-preview"},true,false);if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e.id)},this));i.style.cursor="pointer";i.title=BX.message("MPF_FILE")}if(n){BX.bind(n,"click",BX.delegate(function(){this.insertFile(e.id)},this))}}},adjustFile:function(e,t){var i=e.place;if(t===true||t===false){if(!e.info)e.info=BX.findChild(e.place,{className:"files-info"},true,false);i=e.info;if(BX.type.isDomNode(i)){var n="check-in-text-"+e.id,o=BX(n),a=t===false?{attrs:{"bx-file-is-in-text":"N"},props:{className:"insert-btn"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_INSERT_IN_TEXT")+"</span>"}:{attrs:{"bx-file-is-in-text":"Y"},props:{className:"insert-text"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_IN_TEXT")+"</span>"};if(!o){a.attrs.id=n;a.events={click:BX.proxy(function(){this.insertFile(e.id)},this)};i.appendChild(BX.create("SPAN",a))}else{BX.adjust(o,a)}}}},insertFile:function(e){BX.onCustomEvent(this.eventNode,"onFileIsInserted",[this.checkFile(e),this])},deleteFile:function(e,t){e=this.checkFile(e,t);if(e){BX.onCustomEvent(this.eventNode,"onFileIsDeleted",[e,this]);this.values[e.id].place=null;delete this.values[e.id].place;this.values[e.id]=null;delete this.values[e.id];e=null;return true}return false},reinitValues:function(e,t){var i,n,o={};while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("data-bx-title")||n.getAttribute("data-title"),size:n.getAttribute("data-bx-size")||"",sizeInt:n.getAttribute("data-bx-size")||"",width:n.getAttribute("data-bx-width"),height:n.getAttribute("data-bx-height"),storage:"disk",previewUrl:n.tagName=="A"?"":n.getAttribute("data-bx-src")||n.getAttribute("data-src"),fileId:n.getAttribute("bx-attach-file-id")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");if(n.hasAttribute("bx-attach-file-type"))o["E"+i]["fileType"]=n.getAttribute("bx-attach-file-type")}}this.handler.selectFile({},{},o);this.runCheckText()},runCheckText:function(){if(!this._checkText)this._checkText=BX.delegate(this.checkText,this);this.manager.exec(this._checkText)},checkText:function(){var e,t=this.manager.getContent(),i=[],n,o;if(t!=""){e=t;for(o in this.xmlToAttach){if(this.xmlToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]").replace(new RegExp("\\[DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]")}}for(o in this.fileToAttach){if(this.fileToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;"+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]").replace(new RegExp("\\["+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]")}}n=new RegExp("(?:\\&\\#91\\;)("+this.parser["tags"].join("|")+")=([a-z=0-9 ]+)(?:\\&\\#93\\;)","gim");if(n.test(t)){for(o in this.values){if(this.values.hasOwnProperty(o)){i.push(o)}}if(i.length>0){n=new RegExp("(?:\\&\\#91\\;|\\[)("+this.parser["tags"].join("|")+")=("+i.join("|")+")([WIDTHHEIGHT=0-9 ]*)(?:\\&\\#93\\;|\\])","gim");if(n.test(t))t=t.replace(n,BX.delegate(function(e,t,i,n){return"["+t+"="+i+n+"]"},this))}}if(e!=t)BX.onCustomEvent(this.eventNode,"onFileIsDetected",[t,this])}return t},clean:function(){if(this.handler&&this.handler.values){var e,t,i,n=BX(this.manager.formID);while((e=this.handler.values.pop())&&e){BX.remove(e)}if(this.handler.params&&this.handler.params.controlName){t=BX.findChildren(n,{tagName:"INPUT",attribute:{name:this.handler.params.controlName}},true)}if(t){for(i=0;i<t.length;i++){BX.remove(t[i])}}}},reinit:function(e,t){var i=[],n,o;for(n in t){if(t.hasOwnProperty(n)){if(t[n]["USER_TYPE_ID"]==this.parserName&&t[n]["VALUE"]){for(o in t[n]["VALUE"]){if(t[n]["VALUE"].hasOwnProperty(o)){i.push(t[n]["VALUE"][o])}}}}}if(i.length>0){this.exec(this.reinitValues,[e,i]);return true}return false}};var o=function(e,t,i){o.superclass.constructor.apply(this,arguments);this.parser=e.parser["webdav_element"]||null;this.node=BX("wduf-selectdialog-"+t);this.manager=e;this.parserName="webdav_element";this.prefixNode="wd-doc";this.prefixHTMLNode="wdif-doc-";this.storage="webdav";this.events={onInit:"WDLoadFormControllerInit",onShow:"WDLoadFormController",onBound:"WDLoadFormControllerWasBound"}};BX.extend(o,n);o.prototype.reinitValues=function(e,t){var i,n,o={};this.waitAnswerFromServer=[];while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("alt"),storage:"webdav",size:n.getAttribute("data-bx-size"),sizeInt:1,ext:"",link:n.getAttribute("data-bx-document")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");this.waitAnswerFromServer.push(i)}}if(this.waitAnswerFromServer.length>0){if(!this._defferCheckText)this._defferCheckText=BX.delegate(this.defferCheckText,this);BX.addCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText);this.handler.WDFD_SelectFile({},{},o)}};o.prototype.defferCheckText=function(e){var t=BX.util.array_search(e.element_id,this.waitAnswerFromServer);if(t>=0){this.runCheckText();this.waitAnswerFromServer=BX.util.deleteFromArray(this.waitAnswerFromServer,t)}if(this.waitAnswerFromServer.length<=0)BX.removeCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText)};var a=function(e,t,i){a.superclass.constructor.apply(this,arguments);this.parser=e.parser["file"]?e.parser["file"]:e.parser["postimage"]["exist"]?e.parser["postimage"]:null;this.postfix=i["postfix"]||"";this.node=BX("file-selectdialog-"+t);this.parserName="file";this.prefixNode="wd-doc";this.prefixHTMLNode="file-doc-";this.props={valueEditClassName:"file-inline-file",securityCID:"upload-cid"};this.storage="bfile";this.events={onInit:"BFileDLoadFormControllerInit",onShow:"BFileDLoadFormController",onBound:"BFileDLoadFormControllerWasBound"}};BX.extend(a,n);a.prototype.initValues=function(e){var t;if(e!==true){t=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(t&&t.length>1){this.exec(this.initValues,[true]);return true}return false}t=this.handler.agent.values||[];var i,n,o,a,s={},r="/bitrix/components/bitrix/main.file.input/file.php?mfi_mode=down&cid="+this.handler.CID+"&sessid="+BX.bitrix_sessid();for(var d=0;d<t.length;d++){a=parseInt(t[d].getAttribute("id").replace(this.prefixNode,""));if(s["id"+a])continue;s["id"+a]="Y";if(a>0){n=BX.findChild(t[d],{className:"f-wrap"},true,false);if(!n)continue;o={element_id:a,element_name:n.innerHTML,parser:this.parser.bxTag,storage:"bfile",element_url:r+"&fileID="+a};i=this.addFile(o,{usePostfix:true,hasPreview:false})}}this.runCheckText();return true};a.prototype.checkFile=function(e,t,i){e=""+(typeof e=="object"?e.id:e);e=e+(i&&i["usePostfix"]===true?this.postfix:"");if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(this.prefixNode+t.element_id,true)){var n={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(this.prefixNode+t.element_id,true)},o;if((t["element_type"]&&t["element_type"].indexOf("image/")===0||/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name))&&((o=BX.findChild(n.place,{tagName:"IMG"},true,false))&&o||i&&i["hasPreview"]===false)){n.type="image/xyz";n.src=t["element_thumbnail"]||t["element_url"];n.isImage=true;n.hasPreview=false;n.lowsrc="";n.width="";n.height="";if(BX(o)){n.hasPreview=true;n.lowsrc=t["element_thumbnail"]||o["src"];n.width=parseInt(o.getAttribute("data-bx-full-width"));n.height=parseInt(o.getAttribute("data-bx-full-height"))}}else if(this.parser.bxTag=="postimage"){return false}if(BX(n.place,true).getAttribute("bx-attach-file-type")){n.fileType=BX(n.place,true).getAttribute("bx-attach-file-type")}this.values[e]=n}return this.values[e]||false};a.prototype.bindFile=function(e){var t=e&&e["place"]?e["place"]:null;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){if(e.isImage&&e.hasPreview){var i=BX.findChild(t,{className:"feed-add-img-title"},true,false),n=BX.findChild(t,{className:"feed-add-img-wrap"},true,false);if(n){BX.bind(n,"click",BX.proxy(function(){this.insertFile(e)},this));n.style.cursor="pointer";n.title=BX.message("MPF_IMAGE")}if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e)},this));i.style.cursor="pointer";i.title=BX.message("MPF_IMAGE")}}else a.superclass.bindFile.apply(this,arguments)}};a.prototype.clean=function(){a.superclass.clean.apply(this,arguments);if(this["handler"]&&this.handler["agent"]&&this.handler.agent["inputName"]){var e,t,i=BX(this.manager.formID);e=BX.findChildren(i,{tagName:"INPUT",attribute:{name:this.handler.agent.inputName+"[]"}},true);if(e){for(t=0;t<e.length;t++){BX.remove(e[t])}}}};var s=function(t,i){this.params=i;this.formID=t;this.showPinButton=!!BX("lhe_button_editor_"+this.formID);if(this.showPinButton){this.params.showPanelEditor=!!this.params.pinEditorPanel}this.oEditorId=i["LHEJsObjId"];this.__divId=i["LHEJsObjName"]||i["LHEJsObjId"];e.handler[this.oEditorId]=this;this.oEditor=s.getEditor(this.oEditorId);this.urlPreview=this.initUrlPreview(i);this.eventNode=BX("div"+this.__divId);BX.addCustomEvent(this.eventNode,"OnShowLHE",BX.delegate(this.OnShowLHE,this));BX.addCustomEvent(this.eventNode,"OnButtonClick",BX.delegate(this.OnButtonClick,this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){if(t.oEditor&&t.oEditor["AllowBeforeUnloadHandler"])t.oEditor.AllowBeforeUnloadHandler();if(t.monitoringWakeUp===true)t.monitoringStart()});BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",function(e,t){t.monitoringWakeUp=t.monitoringStop();if(t.oEditor&&t.oEditor["DenyBeforeUnloadHandler"])t.oEditor.DenyBeforeUnloadHandler()});this.initParsers(i);this.initFiles(t,i);BX.ready(BX.delegate(function(){if(BX("lhe_button_submit_"+t,true)){BX.bind(BX("lhe_button_submit_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["submit"]);return BX.PreventDefault(e)},this))}if(BX("lhe_button_cancel_"+t,true)){BX.bind(BX("lhe_button_cancel_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["cancel"]);return BX.PreventDefault(e)},this))}},this));this.inited=true;BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){e.FORM.setAttribute("bx-lhe-autosave-prepared","Y")});BX.onCustomEvent(this,"onInitialized",[this,t,i,this.parsers]);BX.onCustomEvent(this.eventNode,"onInitialized",[this,t,i,this.parsers]);if(this.oEditor&&this.oEditor.inited&&!this.oEditor["__lhe_flags"]){BX.onCustomEvent(this.oEditor,"OnEditorInitedBefore",[this.oEditor]);BX.onCustomEvent(this.oEditor,"OnEditorInitedAfter",[this.oEditor,true])}};s.prototype={editorIsLoaded:false,arFiles:{},parser:{},controllers:{},exec:function(e,t){this.functionsToExec=this.functionsToExec||[];if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.editorIsLoaded===true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},initParsers:function(e){this.parser={postimage:{exist:false,bxTag:"postimage",tag:"IMG ID",tags:["IMG ID"],regexp:/\[(IMG ID)=((?:\s|\S)*?)(?:\s*?WIDTH=(\d+)\s*?HEIGHT=(\d+))?\]/gi,code:"[IMG ID=#ID##ADDITIONAL#]",wysiwyg:'<img id="#ID#" src="'+'#SRC#" lowsrc="'+'#LOWSRC#" title=""#ADDITIONAL# />'},player:{exist:false,bxTag:"player",tag:"FILE ID",tags:["FILE ID"],regexp:/\[(FILE ID)=((?:\s|\S)*?)?\]/gi,code:"[FILE ID=#ID##ADDITIONAL#]",wysiwyg:'<img class="bxhtmled-player-surrogate" id="#ID#" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" contenteditable="false" title=""#ADDITIONAL# />'}};var t=e["parsers"]?e["parsers"]:{};for(var n in t){if(t.hasOwnProperty(n)&&/[a-z]/gi.test(n+"")){this.parser[n]=new i(n,t[n])}}if(BX.util.object_search("UploadImage",t)){this.parser["postimage"]["exist"]=true}if(typeof e["arSize"]=="object"){var o="";if(e["arSize"]["width"])o+="max-width:"+e["arSize"]["width"]+"px;";if(e["arSize"]["height"])o+="max-height:"+e["arSize"]["height"]+"px;";if(o!=="")this.parser["postimage"]["wysiwyg"]=this.parser["postimage"]["wysiwyg"].replace("#ADDITIONAL#",' style="'+o+'" #ADDITIONAL#')}},initFiles:function(e,t){this.arFiles={};this.controllers={common:{postfix:"",storage:"bfile",parser:"postimage",node:window,obj:null,init:false}};this.monitoring={interval:null,text:"",savedText:"",files:[],savedFiles:[]};if(!t["CID"]||typeof t["CID"]!=="object")return;BX.addCustomEvent(this.eventNode,"onFileIsAdded",BX.delegate(this.OnFileUploadSuccess,this));BX.addCustomEvent(this.eventNode,"onFileIsFailed",BX.delegate(this.OnFileUploadFailed,this));BX.addCustomEvent(this.eventNode,"onFileIsDeleted",BX.delegate(this.OnFileUploadRemove,this));BX.addCustomEvent(this.eventNode,"onFileIsDetected",BX.delegate(this.setContent,this));BX.addCustomEvent(this.eventNode,"onFileIsInserted",BX.delegate(this.insertFile,this));var i,s,r;for(s in t["CID"]){if(t["CID"].hasOwnProperty(s)){i=t["CID"][s]["parser"];if(i=="disk_file")this.controllers[s]=new n(this,s,t["CID"][s]);else if(i=="webdav_element")this.controllers[s]=new o(this,s,t["CID"][s]);else if(i=="file")this.controllers[s]=new a(this,s,t["CID"][s]);if(this.controllers[s]&&this.controllers[s].init()&&!r)r=true}}BX.ready(BX.delegate(function(){BX.bind(BX("bx-b-uploadfile-"+e),"click",BX.proxy(this.controllerInit,this));if(r)this.controllerInit("show")},this))},controllerInit:function(e){this.controllerInitStatus=e=="show"||e=="hide"?e:this.controllerInitStatus=="show"?"hide":"show";BX.onCustomEvent(this.eventNode,"onShowControllers",[this.controllerInitStatus])},initUrlPreview:function(){if(this.params["urlPreviewId"]&&window["BXUrlPreview"]&&BX(this.params["urlPreviewId"])){return new BXUrlPreview(BX(this.params["urlPreviewId"]))}return null},getContent:function(){return this.oEditor?this.oEditor.GetContent():""},setContent:function(e){if(this.oEditor)this.oEditor.SetContent(e)},OnFileUploadSuccess:function(e,t,i,n){if(this.controllers[t.id]){var o=t.parser.bxTag+e.id;this.arFiles[o]=this.arFiles[o]||[];this.arFiles[o].push(t.id);if(n&&n["referrerToEditor"]){var a=this.getFileToInsert(e,t);BX.onCustomEvent(n["referrerToEditor"],"OnImageDataUriCaughtUploaded",[a]);BX.onCustomEvent(this.oEditor,"OnImageDataUriCaughtUploaded",[n["referrerToEditor"],e,a])}else if(i===true&&e.isImage&&this.insertImageAfterUpload){if(!this._insertFile)this._insertFile=BX.delegate(this.insertFile,this);this.exec(this._insertFile,arguments)}}},OnFileUploadFailed:function(e,t,i){if(i&&i["referrerToEditor"]){BX.onCustomEvent(i["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(this.editor,"OnImageDataUriCaughtFailed",[i["referrerToEditor"]])}},OnFileUploadRemove:function(e,t){if(this.controllers[t.id]){var i=t.parser.bxTag+e.id;if(this.arFiles[i]){var n=BX.util.array_search(t.id,this.arFiles[i]);this.arFiles[i]=BX.util.deleteFromArray(this.arFiles[i],n);if(!this.arFiles[i]||this.arFiles[i].length<=0){this.arFiles[i]=null;delete this.arFiles[i];if(!this._deleteFile)this._deleteFile=BX.delegate(this.deleteFile,this);this.exec(this._deleteFile,arguments)}}}},showPanelEditor:function(e,t){if(e==undefined)e=!this.oEditor.toolbar.IsShown();this.params.showPanelEditor=e;var i=BX("lhe_button_editor_"+this.formID),n=BX("panel-close"+this.__divId);if(n){this.oEditor.dom.cont.appendChild(n)}if(e){this.oEditor.dom.toolbarCont.style.opacity="inherit";this.oEditor.toolbar.Show();if(i)BX.addClass(i,"feed-add-post-form-btn-active");if(n)n.style.display=""}else{this.oEditor.toolbar.Hide();if(i)BX.removeClass(i,"feed-add-post-form-btn-active");if(n)n.style.display="none"}if(t!==false)BX.userOptions.save("main.post.form","postEdit","showBBCode",e?"Y":"N")},monitoring:{},monitoringStart:function(){if(this.monitoring.interval===null){if(!this._monitoringStart){this._monitoringStart=BX.delegate(this.checkFilesInText,this);BX.addCustomEvent(this.oEditor,"OnContentChanged",BX.proxy(function(e){this.monitoring.text=e},this))}this.monitoring.interval=setInterval(this._monitoringStart,1e3)}},monitoringStop:function(){var e=this.monitoring.interval!==null;if(this.monitoring.interval!==null)clearInterval(this.monitoring.interval);this.monitoring.interval=null;return e},monitoringSetStatus:function(e,t,i){if(this.arFiles[e+t]){var n;for(var o=0;o<this.arFiles[e+t].length;o++){n=this.arFiles[e+t][o];BX.onCustomEvent(this.controllers[n],"onFileIsInText",[t,i])}}},checkFilesInText:function(){if(this.monitoring.text!==this.monitoring.savedText){this.monitoring.savedText=this.monitoring.text;this.monitoring.files=[];var e=this.monitoring.savedText,t,i=function(e,t){return function(i,n,o){e.monitoring.files.push([t,o].join("/"))}};for(t in this.parser){if(this.parser.hasOwnProperty(t)){if(!this.parser[t]["checkFilesInText"]){this.parser[t]["checkFilesInText"]=i(this,t)}e.replace(this.parser[t]["regexp"],this.parser[t]["checkFilesInText"])}}if(this.monitoring.savedFiles.join(",")!==this.monitoring.files.join(",")){var n={},o;while(o=this.monitoring.savedFiles.pop()){n[o]=null}for(t=0;t<this.monitoring.files.length;t++){o=this.monitoring.files[t];n[o]=n[o]>=0?n[o]+1:1}for(t in n){if(n.hasOwnProperty(t)){o=t.split("/");this.monitoringSetStatus(o[0],o[1],n[t]>0)}}}this.monitoring.savedFiles=this.monitoring.files;if(this.monitoring.savedFiles.length<=0)this.monitoringStop()}},checkFile:function(e,t){var i=false;if(typeof e=="string"){var n=typeof t=="string"?t:t.parser;if(!!this.arFiles[n+e]){var o=this.arFiles[n+e][0];t=this.controllers[o];i={file:t.values[e],controller:t}}}else if(this.controllers[t.id]){i={file:e,controller:t}}return i},insertFile:function(e,t){var i=this.oEditor;if(i&&e){var n=i.GetViewMode(),o=this.getFileToInsert(e,t);if(n=="wysiwyg"){i.InsertHtml(o.replacement);setTimeout(BX.delegate(i.AutoResizeSceleton,i),500);setTimeout(BX.delegate(i.AutoResizeSceleton,i),1e3)}else if(n=="code"){i.textareaView.Focus();if(!i.bbCode){var a=i.GetIframeDoc();var s=a.createElement("DIV");s.style.display="none";s.innerHTML=o.replacement;a.body.appendChild(s);o.replacement=i.Parse(o.replacement,true,false);s.parentNode.removeChild(s)}i.textareaView.WrapWith("","",o.replacement)}else{return}o["callback"]()}},getFileToInsert:function(e,t){var i=this.oEditor;if(i&&e){var n=e["id"],o="",a=t.parser,s=i.bbCode?i.GetViewMode():"wysiwyg",r=this.parser[a.bxTag][s];if(e["fileType"]&&this.parser[e["fileType"]]&&s=="wysiwyg"){r=this.parser[e["fileType"]][s]}if(e["isImage"]){r=s=="wysiwyg"?this.parser["postimage"][s]:r;if(e.width>0&&e.height>0&&i.sEditorMode=="html"){o=' style="width:'+e.width+"px;height:"+e.height+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}if(s=="wysiwyg"){r=r.replace("#ID#",i.SetBxTag(false,{tag:a.bxTag,params:{value:n}})).replace("#SRC#",e.src).replace("#URL#",e.url).replace("#LOWSRC#",e.lowsrc||"").replace("#NAME#",e.name).replace("#ADDITIONAL#",o)+"<span>&nbsp;</span>"}else if(s=="code"&&i.bbCode){r=r.replace("#ID#",n).replace("#ADDITIONAL#","")}return{replacement:r,callback:BX.proxy(function(){this.monitoringSetStatus(t.parser.bxTag,e.id,true);this.monitoringStart()},this)}}return{replacement:"",callback:BX.DoNothing}},deleteFile:function(e,t){var i=this.oEditor,n=t.parser,o=e.id,a=i.GetContent();if(n&&a.indexOf("="+o)>=0){if(i.GetViewMode()=="wysiwyg"){var s=i.GetIframeDoc(),r,d;for(r in i["bxTags"]){if(i["bxTags"].hasOwnProperty(r)){if(typeof i.bxTags[r]=="object"&&i.bxTags[r]["params"]&&i.bxTags[r]["params"]["value"]==e.id){d=s.getElementById(r);if(d)d.parentNode.removeChild(d)}}}i.SaveContent()}else{a=a.replace(n.regexp,function(t,i,n){return n==e.id?"":t});i.SetContent(a);i.Focus()}this.monitoringSetStatus(n.bxTag,e.id,false)}},reinit:function(e,t){BX.onCustomEvent(this.eventNode,"onReinitializeBefore",[this,e,t]);this.arFiles={};delete this.monitoringWakeUp;this.monitoringStop();this.oEditor.CheckAndReInit(e||"");BX.onCustomEvent(this.eventNode,"onReinitialize",[this,e,t]);var i,n=false;for(i in this.controllers){if(this.controllers.hasOwnProperty(i)){if(this.controllers[i]["init"]&&this.controllers[i].reinit(e,t))n=true}}this.controllerInit(n?"show":"hide");if(this.params["~height"]){this.oEditor.SetConfigHeight(this.params["~height"]);this.oEditor.ResizeSceleton()}if(this.urlPreview){this.urlPreview.detachUrlPreview();var o;for(var a in t){if(t.hasOwnProperty(a)&&t[a].hasOwnProperty("USER_TYPE_ID")&&t[a]["USER_TYPE_ID"]==="url_preview"){o=t[a]["VALUE"]}}if(o)this.urlPreview.attachUrlPreview({id:o})}},Parse:function(e,t,i){var n=this.parser[e],o=this;if(n){t=t.replace(n.regexp,function(t,a,s,r,d){var l=o.checkFile(s,e);if(l&&(l=l.file)&&l){var h="",f=l.isImage?o.parser.postimage.wysiwyg:n.wysiwyg;o.monitoringStart();if(l.fileType&&o.parser[l.fileType]&&o.parser[l.fileType].wysiwyg){f=o.parser[l.fileType].wysiwyg}if(l.isImage){r=parseInt(r);d=parseInt(d);h=r&&d?' width="'+r+'" height="'+d+'"':"";if(h===""&&l["width"]>0&&l["height"]>0){h=' style="width:'+l["width"]+"px;height:"+l["height"]+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}return f.replace("#ID#",i.SetBxTag(false,{tag:e,params:{value:s}})).replace("#NAME#",l.name).replace("#SRC#",l.src).replace("#LOWSRC#",l.lowsrc).replace("#ADDITIONAL#",h).replace("#WIDTH#",parseInt(r)).replace("#HEIGHT#",parseInt(d))}return t})}return t},Unparse:function(e,t){var i="",n=e.tag;if(this.parser[n]){var o=parseInt(t.node.hasAttribute("width")?t.node.getAttribute("width"):0),a=parseInt(t.node.hasAttribute("height")?t.node.getAttribute("height"):0),s="";if(o>0&&a>0){s=" WIDTH="+o+" HEIGHT="+a}i=this.parser[n]["code"].replace("#ID#",e.params.value).replace("#ADDITIONAL#",s).replace("#WIDTH#",o).replace("#HEIGHT#",a)}return i},OnShowLHE:function(e,t,i){var n=this.__divId;e=e===false?false:e==="hide"?"hide":e==="justShow"?"justShow":true;this.oEditor=this.oEditor||s.getEditor(this.oEditorId);if(!this.oEditor)return;this.oEditor.Init();var o=BX("micro"+n),a=this.eventNode;if(o){o.style.display=e===true||e==="justShow"?"none":"block"}if(e=="hide"){BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);if(this.eventNode.style.display=="none"){BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.eventNode.scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){a.style.height=e.height+"px";a.style.opacity=e.opacity/100},complete:BX.proxy(function(){this.eventNode.style.cssText="";this.eventNode.style.display="none";BX.onCustomEvent(a,"OnAfterHideLHE",[e,this])},this)}).animate()}}else if(e){BX.onCustomEvent(this.eventNode,"OnBeforeShowLHE",[e,this]);if(e=="justShow"){this.eventNode.style.display="block";BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else if(this.eventNode.style.display=="block"){BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else{BX.adjust(this.eventNode,{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:a.scrollHeight},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quad),step:function(e){a.style.height=e.height+"px";a.style.opacity=e.opacity/100},complete:BX.proxy(function(){BX.onCustomEvent(a,"OnAfterShowLHE",[e,this]);this.oEditor.Focus();this.eventNode.style.cssText=""},this)}).animate()}}else{BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);this.eventNode.style.display="none";BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}},OnButtonClick:function(e){if(e!=="cancel"){var t={result:true};BX.onCustomEvent(this.eventNode,"OnClickBeforeSubmit",[this,t]);if(t["result"]!==false)BX.onCustomEvent(this.eventNode,"OnClickSubmit",[this])}else{BX.onCustomEvent(this.eventNode,"OnClickCancel",[this]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["hide"])}},OnEditorInitedBefore:function(e){var t=this;this.oEditor=e;e.formID=this.formID;if(this.params)this.params["~height"]=e.config["height"];BX.addCustomEvent(e,"OnCtrlEnter",function(){e.SaveContent();if(t.params&&t.params["ctrlEnterHandler"]&&typeof window[t.params["ctrlEnterHandler"]]=="function")window[t.params["ctrlEnterHandler"]]();else BX.submit(BX(t.formID))});var i=this.params.parsers?this.params.parsers:[];if(BX.util.object_search("Spoiler",i)){e.AddButton({id:"spoiler",name:BX.message("spoilerText"),iconClassName:"spoiler",disabledForTextarea:false,src:BX.message("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.png",toolbarSort:205,handler:function(){var e=this,t=false;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){t=e.editor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=e.editor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}});e.AddParser({name:"spoiler",obj:{Parse:function(e,t,i){if(/\[(cut|spoiler)(([^\]])*)\]/gi.test(t)){t=t.replace(/[\001-\006]/gi,"").replace(/\[cut(((?:=)[^\]]*)|)\]/gi,"$1").replace(/\[\/cut]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"$1").replace(/\[\/spoiler]/gi,"");var n=/(?:\001([^\001]*)\001)([^\001-\004]+)\002/gi,o=/(?:\003([^\003]*)\003)([^\001-\004]+)\004/gi,a=function(e,t){e=e.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'+i.SetBxTag(false,{tag:"spoiler"})+'" title="'+e+'">'+t+"</blockquote>"},s=function(e,t,i){return a(t,i)};while(t.match(n)||t.match(o)){t=t.replace(n,s).replace(o,s)}}t=t.replace(/\001([^\001]*)\001/gi,"[cut$1]").replace(/\003([^\003]*)\003/gi,"[spoiler$1]").replace(/\002/gi,"[/cut]").replace(/\004/gi,"[/spoiler]");return t},UnParse:function(t,i){if(t.tag=="spoiler"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}})}if(BX.util.object_search("MentionUser",i)){e.AddParser({name:"postuser",obj:{Parse:function(t,i){i=i.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(t,i,n){n=BX.util.trim(n);if(n=="")return"";return'<span id="'+e.SetBxTag(false,{tag:"postuser",params:{value:parseInt(i)}})+'" class="bxhtmled-metion">'+n+"</span>"});return i},UnParse:function(t,i){if(t.tag=="postuser"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[USER="+t.params.value+"]"+n+"[/USER]"}return""}}})}var n=function(i,n){return t.Parse(i,n,e)},o=function(e,i){return t.Unparse(e,i)};for(var a in this.parser){if(this.parser.hasOwnProperty(a)){e.AddParser({name:a,obj:{Parse:n,UnParse:o}})}}if(this.showPinButton){this.pinEditorPanel=this.params&&this.params.pinEditorPanel===true;var s="toolbar_pin";var r=function(e,i){r.superclass.constructor.apply(this,arguments);this.id=s;this.title=BX.message("MPF_PIN_EDITOR_PANNEL");this.className+=" "+(t.pinEditorPanel?"bxhtmled-button-toolbar-pined":"bxhtmled-button-toolbar-pin");this.Create();if(i)i.appendChild(this.GetCont())};BX.extend(r,window.BXHtmlEditor.Button);r.prototype.OnClick=function(){BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pined");BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pin");if(t.pinEditorPanel){t.pinEditorPanel=false;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pin")}else{t.pinEditorPanel=true;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pined")}BX.userOptions.save("main.post.form","postEdit","pinEditorPanel",t.pinEditorPanel?"Y":"N")};window.BXHtmlEditor.Controls[s]=r;BX.addCustomEvent(e,"GetControlsMap",function(e){e.push({id:s,compact:true,hidden:false,sort:500,checkWidth:true,offsetWidth:32,wrap:"right"})})}},OnEditorInitedAfter:function(t){BX.addCustomEvent(t,"OnIframeDrop",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDrop",arguments)},this));BX.addCustomEvent(t,"OnIframeDragOver",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragOver",arguments)},this));BX.addCustomEvent(t,"OnIframeDragLeave",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragLeave",arguments)},this));BX.addCustomEvent(t,"OnImageDataUriHandle",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnImageDataUriHandle",arguments)},this));BX.addCustomEvent(t,"OnAfterUrlConvert",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(t,"OnBeforeCommandExec",this.OnBeforeCommandExec.bind(this));t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:BX.message("BXEdDelFromText"),bbMode:true,ACTION:function(){var e=t.contextMenu.GetTargetItem("postimage");if(!e)e=t.contextMenu.GetTargetItem("postdocument");if(!e)e=t.contextMenu.GetTargetItem("postfile");if(e&&e.element){t.selection.RemoveNode(e.element)}t.contextMenu.Hide()}}];if(!this.params["lazyLoad"]){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow",t,false])}if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){var i=e;setTimeout(function(){BX.addCustomEvent(t,"OnContentChanged",BX.proxy(function(e){this["mpfTextContent"]=e;this.Init()},i))},1500)});BX.addCustomEvent(BX(this.formID),"onAutoSave",BX.proxy(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"+this.formID]=e["mpfTextContent"]},this));BX.addCustomEvent(BX(this.formID),"onAutoSaveRestore",BX.proxy(function(i,n){if(e.handler[t.id]){for(var o in e.handler[t.id].controllers){if(e.handler[t.id].controllers.hasOwnProperty(o)&&e.handler[t.id].controllers[o].handler&&e.handler[t.id].controllers[o].handler.params&&e.handler[t.id].controllers[o].handler.params.controlName&&e.handler[t.id].controllers[o].handler.params.controlName){delete n[e.handler[t.id].controllers[o].handler.params.controlName]}}}if(n["text"+this.formID]&&/[^\s]+/gi.test(n["text"+this.formID])){t.CheckAndReInit(n["text"+this.formID])}},this));if(BX(this.formID)&&BX(this.formID).hasAttribute("bx-lhe-autosave-prepared")&&BX(this.formID).BXAUTOSAVE){BX(this.formID).removeAttribute("bx-lhe-autosave-prepared");setTimeout(BX.proxy(function(){BX(this.formID).BXAUTOSAVE.Prepare()},this),100)}var i=this.formID,n=this.params;this.showPanelEditor(n.showPanelEditor,false);if(!t.mainPostFormCustomized){t.mainPostFormCustomized=true;BX.addCustomEvent(t,"OnIframeKeydown",function(e){if(window.onKeyDownHandler){window.onKeyDownHandler(e,t,i)}});BX.addCustomEvent(t,"OnIframeKeyup",function(e){if(window.onKeyUpHandler){window.onKeyUpHandler(e,t,i)}});if(window["BXfpdStopMent"+i]){BX.addCustomEvent(t,"OnIframeClick",function(){window["BXfpdStopMent"+i]()})}if(t&&t.textareaView.GetCursorPosition){BX.addCustomEvent(t,"OnTextareaKeyup",function(e){if(window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(e,t,i)}});BX.addCustomEvent(t,"OnTextareaKeydown",function(e){if(window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(e,t,i)}})}}},OnAfterUrlConvert:function(e){if(this.urlPreview){this.urlPreview.attachUrlPreview({url:e})}},OnBeforeCommandExec:function(e,t,i,n){if(this.urlPreview&&t=="createLink"&&BX.type.isPlainObject(n)&&n.hasOwnProperty("href")){this.urlPreview.attachUrlPreview({url:n.href})}}};s.getEditor=function(e){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(typeof e=="object"?e.id:e):null};s.getHandler=function(t){return e.handler[typeof t=="object"?t.id:t]};s.unsetHandler=function(t){var i=typeof t=="object"?t.id:t;if(!e.handler[i])return;if(e.handler[i].oEditor)e.handler[i].oEditor.Destroy();e.handler[i]=null};s.reinitData=function(e,t,i){var n=s.getHandler(e);if(n)n.exec(n.reinit,[t,i]);return false};s.reinitDataBefore=function(e){var t=s.getHandler(e);if(t&&t["eventNode"])BX.onCustomEvent(t.eventNode,"onReinitializeBefore",[t])};window.LHEPostForm=s;window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var o=BX.util.trim(t[n]);if(o.length>0){var a=this.hiddenField.value.split(",");if(!BX.util.in_array(o,a)){var s;var r=BX.create("span",{children:[s=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});r.insertBefore(document.createTextNode(o),s);this.tagsContainer.insertBefore(r,this.addNewLink);BX.bind(s,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:r,tagValue:o}));this.hiddenField.value+=o+",";i.push(o)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy(function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)},this));BX.bind(this.activeBlock,"click",BX.proxy(function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)},this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var r=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");r=e;BX.defer(function(){e.disabled=true})()}};window.MPFbuttonCloseWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||r||this;if(e){e.disabled=false;BX.removeClass(e,"ui-btn-clock");r=null}};window.__mpf_wd_getinfofromnode=function(e,t){var i=BX.findChild(BX((e["prefixNode"]||"wd-doc")+e.element_id),{className:"files-preview",tagName:"IMG"},true,false);if(i){e.lowsrc=i.src;e.element_url=i.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight\=(\d+)/,"");e.width=parseInt(i.getAttribute("data-bx-full-width"));e.height=parseInt(i.getAttribute("data-bx-full-height"))}else if(t.urlGet){e.element_url=t.urlGet.replace("#element_id#",e.element_id).replace("#ELEMENT_ID#",e.element_id).replace("#element_name#",e.element_name).replace("#ELEMENT_NAME#",e.element_name)}};var d={listen:false,plus:false,text:"",bSearch:false};window.BXfpdSelectCallback=function(e,t,i,n,o,a){BX.SocNetLogDestination.BXfpSelectCallback({item:e,type:t,bUndeleted:n,containerInput:BX("feed-add-post-destination-item"),valueInput:BX("feed-add-post-destination-input"),formName:o,tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2"),state:typeof a!="undefined"?a:null})};window.BXfpdUnSelectCallback=function(e,t,i,n){BX.SocNetLogDestination.BXfpUnSelectCallback.call({formName:n,inputContainerName:"feed-add-post-destination-item",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")},e)};window.BXfpdOpenDialogCallback=function(e){BX.SocNetLogDestination.BXfpOpenDialogCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.BXfpdCloseDialogCallback=function(e){BX.SocNetLogDestination.BXfpCloseDialogCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.BXfpdCloseSearchCallback=function(e){BX.SocNetLogDestination.BXfpCloseSearchCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.onKeyDownHandler=function(e,t,i){var n=e.keyCode;if(!window["BXfpdStopMent"+i])return true;if(BX.util.in_array(n,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(n,[50,43,61])||e.altKey&&BX.util.in_array(n,[76])){setTimeout(function(){var e=t.selection.GetRange(),n=t.GetIframeDoc(),o=e?e.endContainer.textContent:"",a=o?o.slice(e.endOffset-1,e.endOffset):"",s=o?o.slice(e.endOffset-2,e.endOffset-1):"";if((a=="@"||a=="+")&&(!s||BX.util.in_array(s,["+","@",",","("])||s.length==1&&BX.util.trim(s)==="")){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=true;e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);var r=BX.create("SPAN",{props:{id:"bx-mention-node"}},n);t.selection.Surround(r,e);e.setStart(r,1);e.setEnd(r,1);t.selection.SetSelection(e);if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i],{bindNode:l(r,t)})}}},10)}if(d.listen){var o=d.bSearch?"search":BX.SocNetLogDestination.obTabSelected[window["BXSocNetLogDestinationFormNameMent"+i]];if(n==t.KEY_CODES["enter"]){BX.SocNetLogDestination.selectCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i]);t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["left"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"left");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["right"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"right");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["up"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"up");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["down"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"down");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}}if(!d.listen&&d.listenFlag&&n===t.KEY_CODES["enter"]){var a=t.selection.GetRange();if(a.collapsed){var s=a.endContainer,r=t.GetIframeDoc();if(s){if(s.className!=="bxhtmled-metion"){s=BX.findParent(s,function(e){return e.className=="bxhtmled-metion"},r.body)}if(s&&s.className=="bxhtmled-metion"){t.selection.SetAfter(s)}}}}};window.onKeyUpHandler=function(e,t,i){var n=e.keyCode,o,a,s;if(!window["BXfpdStopMent"+i])return true;if(d.listen===true){if(n==t.KEY_CODES["escape"]){window["BXfpdStopMent"+i]()}else if(n!==t.KEY_CODES["enter"]&&n!==t.KEY_CODES["left"]&&n!==t.KEY_CODES["right"]&&n!==t.KEY_CODES["up"]&&n!==t.KEY_CODES["down"]){o=t.GetIframeDoc();var r=o.getElementById("bx-mention-node");if(r){s=BX.util.trim(t.util.GetTextContent(r));var h=s;s=s.replace(/^[\+@]*/,"");d.bSearch=s.length>0;BX.SocNetLogDestination.search(s,true,window["BXSocNetLogDestinationFormNameMent"+i],BX.message("MPF_NAME_TEMPLATE"),{bindNode:l(r,t)});if(d.leaveContent&&d._lastText&&h===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&h!==""&&s===""){d.bSearch=false;window["BXfpdStopMent"+i]();BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i],{bindNode:l(r,t)})}d.lastText=s;d._lastText=h}else{window["BXfpdStopMent"+i]()}}}else{if(!e.shiftKey&&(n===t.KEY_CODES["space"]||n===t.KEY_CODES["escape"]||n===188||n===190)){a=t.selection.GetRange();if(a.collapsed){var f=a.endContainer;o=t.GetIframeDoc();if(f){if(f.className!=="bxhtmled-metion"){f=BX.findParent(f,function(e){return e.className=="bxhtmled-metion"},o.body)}if(f&&f.className=="bxhtmled-metion"){s=t.util.GetTextContent(f);var u=s.match(/[\s\.\,]$/);if(u||n===t.KEY_CODES["escape"]){f.innerHTML=s.replace(/[\s\.\,]$/,"");var c=BX.create("SPAN",{html:u||t.INVISIBLE_SPACE},o);t.util.InsertAfter(c,f);t.selection.SetAfter(c)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,i){var n=e.keyCode;if(d.listen&&n==t.KEY_CODES["enter"]){BX.SocNetLogDestination.selectFirstSearchItem(window["BXSocNetLogDestinationFormNameMent"+i]);t.textareaKeyDownPreventDefault=true;BX.PreventDefault(e)}};window.onTextareaKeyUpHandler=function(e,t,i){var n,o,a=e.keyCode;if(d.listen===true){if(a==27){window["BXfpdStopMent"+i]()}else if(a!==13){o=t.textareaView.GetValue(false);n=t.textareaView.GetCursorPosition();if(o.indexOf("+")!==-1||o.indexOf("@")!==-1){var s=o.substr(0,n),r=Math.max(s.lastIndexOf("+"),s.lastIndexOf("@"));if(r>=0){var l=s.substr(r),h=l;l=l.replace(/^[\+@]*/,"");if(BX.SocNetLogDestination&&!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}d.bSearch=l.length>0;if(BX.SocNetLogDestination)BX.SocNetLogDestination.search(l,true,window["BXSocNetLogDestinationFormNameMent"+i],BX.message("MPF_NAME_TEMPLATE"));if(d.leaveContent&&d._lastText&&h===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&h!==""&&l===""){window["BXfpdStopMent"+i]();if(BX.SocNetLogDestination)BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}d.lastText=l;d._lastText=h}}}}else{if(a==16){var f=this;this.shiftPressed=true;if(this.shiftTimeout)this.shiftTimeout=clearTimeout(this.shiftTimeout);this.shiftTimeout=setTimeout(function(){f.shiftPressed=false},100)}if(a==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(a,[187,50,107,43,61])){n=t.textareaView.element.selectionStart;if(n>0){o=t.textareaView.element.value;var u=o.substr(n-1,1);if(u&&(u==="+"||u==="@")){d.listen=true;d.listenFlag=true;d.text="";d.textarea=true;if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}}}}}};var l=function(e,t){var i=BX.pos(e),n=BX.pos(t.dom.areaCont),o=BX.GetWindowScrollPos(t.GetIframeDoc()),a=n.top+i.bottom-o.scrollTop+2,s=n.left+i.right-o.scrollLeft;return{top:a,left:s}};window.BxInsertMention=function(e){var t=e.item,i=e.type,n=e.formID,o=e.editorId,a=e.bNeedComa,r=s.getEditor(o),l;if(i=="users"&&t&&t.entityId>0&&r){if(r.GetViewMode()=="wysiwyg"){var h=r.GetIframeDoc(),f=r.selection.GetRange(),u=h.getElementById("bx-mention-node"),c=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},h);l=BX.create("SPAN",{html:a?",&nbsp;":"&nbsp;"},h);r.SetBxTag(c,{tag:"postuser",params:{value:t.entityId}});if(u){r.util.ReplaceNode(u,c)}else{r.selection.InsertNode(c,f)}if(c&&c.parentNode){var p=BX.findParent(c,{className:"bxhtmled-metion"},h.body);if(p){r.util.InsertAfter(c,p)}}if(c&&c.parentNode){r.util.InsertAfter(l,c);r.selection.SetAfter(l)}}else if(r.GetViewMode()=="code"&&r.bbCode){r.textareaView.Focus();var m=r.textareaView.GetValue(false),B=r.textareaView.GetCursorPosition(),g=m.substr(0,B),X=Math.max(g.lastIndexOf("+"),g.lastIndexOf("@"));if(X>=0&&B>X){r.textareaView.SetValue(m.substr(0,X)+m.substr(B));r.textareaView.element.setSelectionRange(X,X)}r.textareaView.WrapWith(false,false,"[USER="+t.entityId+"]"+t.name+"[/USER]"+(a?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t])}delete BX.SocNetLogDestination.obItemsSelected[window["BXSocNetLogDestinationFormNameMent"+n]][t.id];window["BXfpdStopMent"+n]();d["text"]="";if(r.GetViewMode()=="wysiwyg"){r.Focus();r.selection.SetAfter(l)}}};window.MPFMentionInit=function(e,t){if(!t["items"]["departmentRelation"]){t["items"]["departmentRelation"]=BX.SocNetLogDestination.buildDepartmentRelation(t["items"]["department"])}window["departmentRelation"]=t["items"]["departmentRelation"];if(t.initDestination===true){window.BXSocNetLogDestinationFormName="destination"+(""+(new Date).getTime()).substr(6);window.BXSocNetLogDestinationDisableBackspace=null;BX.SocNetLogDestination.init({name:window.BXSocNetLogDestinationFormName,searchInput:BX("feed-add-post-destination-input"),extranetUser:t["extranetUser"],bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:window.BXfpdSelectCallback,unSelect:BX.delegate(BX.SocNetLogDestination.BXfpUnSelectCallback,{formName:window.BXSocNetLogDestinationFormName,inputContainerName:"feed-add-post-destination-item",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")}),openDialog:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}),closeDialog:BX.delegate(BX.SocNetLogDestination.BXfpCloseDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}),openSearch:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})},items:t["items"],itemsLast:t["itemsLast"],itemsSelected:t["itemsSelected"],isCrmFeed:t["isCrmFeed"],useClientDatabase:!!t["useClientDatabase"],destSort:t["destSort"],allowAddUser:t["allowAddUser"],allowAddCrmContact:t["allowAddCrmContact"],allowSearchCrmEmailUsers:typeof t["allowSearchCrmEmailUsers"]!="undefined"?!!t["allowSearchCrmEmailUsers"]:false,userNameTemplate:typeof t["userNameTemplate"]!="undefined"?t["userNameTemplate"]:"",allowSonetGroupsAjaxSearch:typeof t["allowSonetGroupsAjaxSearch"]!="undefined"?t["allowSonetGroupsAjaxSearch"]:false,allowSonetGroupsAjaxSearchFeatures:typeof t["allowSonetGroupsAjaxSearchFeatures"]!="undefined"?t["allowSonetGroupsAjaxSearchFeatures"]:{},showVacations:true,usersVacation:typeof t["usersVacation"]!="undefined"?t["usersVacation"]:{}});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}));BX.bind(BX("feed-add-post-destination-input"),"paste",BX.defer(BX.SocNetLogDestination.BXfpSearch,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",onPasteEvent:true}));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input"}));BX.bind(BX("feed-add-post-destination-input"),"blur",BX.delegate(BX.SocNetLogDestination.BXfpBlurInput,{inputBoxName:"feed-add-post-destination-input-box",tagInputName:"bx-destination-tag"}));BX.bind(BX("bx-destination-tag"),"focus",function(e){BX.SocNetLogDestination.openDialog(window.BXSocNetLogDestinationFormName,{bByFocusEvent:true});return BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(window.BXSocNetLogDestinationFormName);return BX.PreventDefault(e)});BX.addCustomEvent(window,"onMentionAdd",function(e){if(!BX.type.isPlainObject(BX.SocNetLogDestination.obItems[window.BXSocNetLogDestinationFormName]["users"][e.id])){BX.SocNetLogDestination.obItems[window.BXSocNetLogDestinationFormName]["users"][e.id]=e}BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",function(e){if(e.id==window.BXSocNetLogDestinationFormName){e.blockFocus=true}});if(typeof BX.SocNetLogDestination.obItemsSelected[window.BXSocNetLogDestinationFormName][e.id]=="undefined"||!BX.SocNetLogDestination.obItemsSelected[window.BXSocNetLogDestinationFormName][e.id]){BX.SocNetLogDestination.selectItem(window.BXSocNetLogDestinationFormName,null,null,e.id,"users",false)}});if(t["itemsHidden"]){for(var i in t["itemsHidden"]){if(t["itemsHidden"].hasOwnProperty(i)){window.BXfpdSelectCallback({id:(typeof t["itemsHidden"][i]["PREFIX"]!="undefined"?t["itemsHidden"][i]["PREFIX"]:"SG")+t["itemsHidden"][i]["ID"],name:t["itemsHidden"][i]["NAME"]},typeof t["itemsHidden"][i]["TYPE"]!="undefined"?t["itemsHidden"][i]["TYPE"]:"sonetgroups","",true,"","init")}}}BX.SocNetLogDestination.BXfpSetLinkName({formName:window.BXSocNetLogDestinationFormName,tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")})}window["BXfpdSelectCallbackMent"+e]=function(i,n,o){window.BxInsertMention({item:i,type:n,formID:e,editorId:t.editorId,fireAddEvent:t.initDestination})};window["BXfpdStopMent"+e]=function(){BX.SocNetLogDestination.closeDialog();BX.SocNetLogDestination.closeSearch();clearTimeout(BX.SocNetLogDestination.searchTimeout);BX.SocNetLogDestination.searchOnSuccessHandle=false};window["BXfpdOnDialogOpen"+e]=function(){d.listen=true;d.listenFlag=true};window["BXfpdOnDialogClose"+e]=function(){d.listen=false;setTimeout(function(){d.listenFlag=false;if(!d.listen){var e=s.getEditor(t.editorId);if(e){var i=e.GetIframeDoc(),n=i.getElementById("bx-mention-node");if(n){e.selection.SetAfter(n);if(d.leaveContent){e.util.ReplaceWithOwnChildren(n)}else{BX.remove(n)}}e.Focus()}}},100)};window["BXSocNetLogDestinationFormNameMent"+e]="mention"+(""+(new Date).getTime()).substr(5);window["BXSocNetLogDestinationDisableBackspace"]=null;var n=BX("bx-b-mention-"+e);if(!t.extranetUser&&typeof t.items.extranetRoot!="undefined"){t["items"]["departmentExtranet"]=BX.clone(t["items"]["department"]);for(var o in t["items"]["extranetRoot"]){if(t["items"]["extranetRoot"].hasOwnProperty(o)){t["items"]["departmentExtranet"][o]=t["items"]["extranetRoot"][o]}}t["items"]["departmentRelationExtranet"]=BX.SocNetLogDestination.buildDepartmentRelation(t["items"]["departmentExtranet"])}BX.SocNetLogDestination.init({name:window["BXSocNetLogDestinationFormNameMent"+e],searchInput:n,extranetUser:t.extranetUser,bindMainPopup:{node:n,offsetTop:"1px",offsetLeft:"12px"},bindSearchPopup:{node:n,offsetTop:"1px",offsetLeft:"12px"},callback:{select:window["BXfpdSelectCallbackMent"+e],openDialog:window["BXfpdOnDialogOpen"+e],closeDialog:window["BXfpdOnDialogClose"+e],openSearch:window["BXfpdOnDialogOpen"+e],closeSearch:window["BXfpdOnDialogClose"+e]},items:{users:t["items"]["mentionUsers"],groups:{},sonetgroups:{},department:typeof t["items"]["departmentExtranet"]!="undefined"?t["items"]["departmentExtranet"]:t["items"]["department"],departmentRelation:typeof t["items"]["departmentRelationExtranet"]!="undefined"?t["items"]["departmentRelationExtranet"]:t["items"]["departmentRelation"]},itemsLast:{users:t["itemsLast"]["mentionUsers"],sonetgroups:{},department:{},groups:{}},itemsSelected:{},destSort:typeof t["mentionDestSort"]!="undefined"&&t["mentionDestSort"]?t["mentionDestSort"]:{},departmentSelectDisable:true,obWindowClass:"bx-lm-mention",obWindowCloseIcon:false,useClientDatabase:!!t["useClientDatabase"],userNameTemplate:typeof t["userNameTemplate"]!="undefined"?t["userNameTemplate"]:"",showVacations:false,showSearchInput:BX.browser.IsMobile()});BX.ready(function(){var i=BX("bx-b-mention-"+e);BX.bind(i,"mousedown",function(n){if(d.listen!==true){var o=s.getEditor(t.editorId),a=o.GetIframeDoc();if(o.GetViewMode()=="wysiwyg"&&a){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;var r=o.selection.GetRange(),l=a.getElementById("bx-mention-node");if(l){BX.remove(l)}o.InsertHtml('<span id="bx-mention-node">'+o.INVISIBLE_SPACE+"</span>",r);setTimeout(function(){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+e],{bindNode:i})}var t=a.getElementById("bx-mention-node");if(t){r.setStart(t,0);if(t.firstChild&&t.firstChild.nodeType==3&&t.firstChild.nodeValue.length>0){r.setEnd(t,1)}else{r.setEnd(t,0)}o.selection.SetSelection(r)}o.Focus()},100)}else if(o.GetViewMode()=="code"){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;setTimeout(function(){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+e],{bindNode:i})}},100)}BX.onCustomEvent(i,"mentionClick")}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1544127384814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?154412740428279";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){var t=false,i=false,s=0,o=null,a=null,n={};BX.namespace("BX.Disk");if(BX.Disk.UF)return;BX.Disk.UF=function(){var t=function(t){this.dialogName="DiskFileDialog";this.params=t;this.CID=t["UID"];this.controller=t.controller;this.values=t.values||[];this.prefix="diskuf-doc";this.onUploaderIsAlmostInited=BX.delegate(this.onUploaderIsAlmostInited,this);BX.addCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);this.agent=BX.Uploader.getInstance({id:t["UID"],streams:3,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:t["urlUpload"],showImage:false,sortItems:false,input:t["input"],dropZone:t["dropZone"],placeHolder:t["placeHolder"],queueFields:{thumb:{tagName:"TR",className:"wd-inline-file"}},fields:{thumb:{tagName:"",template:BX.message("DISK_TMPLT_THUMB")}}});this.urlSelect=!!t["urlSelect"]?t["urlSelect"]:null;this.urlRenameFile=!!t["urlRenameFile"]?t["urlRenameFile"]:null;this.urlDeleteFile=!!t["urlDeleteFile"]?t["urlDeleteFile"]:null;this.urlSelect=this._addUrlParam(this.urlSelect,"dialog2=Y&ACTION=SELECT&MULTI=Y");this.urlUpload=!!t["urlUpload"]?t["urlUpload"]:null;this.urlShow=!!t["urlShow"]?t["urlShow"]:null;this.params.controlName=this.params.controlName||"FILES[]";this.init();return this};t.prototype={_addUrlParam:function(e,t){if(!e)return null;if(e.indexOf(t)==-1)e+=(e.indexOf("?")==-1?"?":"&")+t;return e},_camelToSNAKE:function(e){var t={},i,s;for(i in e){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}return t},onUploaderIsAlmostInited:function(t,i){if(this.CID!=i["id"])return;BX.removeCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);var s=BX.findChild(this.controller,{className:"diskuf-simple"},true),o=BX.findChild(this.controller,{className:"diskuf-extended"},true);if(t=="BX.UploaderSimple"){BX.remove(o);BX.show(s)}else{BX.remove(s);BX.show(o)}i.input=BX.findChild(this.controller,{className:"diskuf-fileUploader"},true);i.dropZone=BX.findChild(this.controller,{className:"diskuf-extended"},false);this.params.placeHolder=i["placeHolder"]=BX.findChild(this.controller,{className:"diskuf-placeholder-tbody"},true)},init:function(){this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onFileIsAttached=BX.delegate(this.onFileIsAttached,this);this._onFileIsBound=BX.delegate(this.onFileIsBound,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onError=BX.delegate(this.onError,this);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onError",this._onError);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadRestore=BX.delegate(this.onUploadRestore,this);BX.onCustomEvent(BX(this.controller.parentNode),"DiskDLoadFormControllerInit",[this]);var e=[],t=[],i;for(var s=0;s<this.values.length;s++){i=BX.findChild(this.values[s],{className:"f-wrap"},true);if(!!i){e.push({name:i.innerHTML});t.push(this.values[s])}}this.values=[];this.agent.onAttach(e,t);var o=BX.findChild(this.controller,{className:"diskuf-selector-link"},true);if(!!o){BX.bind(o,"click",BX.proxy(this.showSelectDialog,this))}var a=BX.findChildren(this.controller,{className:"diskuf-selector-link-cloud"},true);if(!!a){for(var n in a){if(!a.hasOwnProperty(n))continue;BX.bind(a[n],"click",BX.proxy(this.showSelectDialogCloudImport,this))}}return false},addFile:function(e){return this.agent&&this.agent.onChange([e])},onItemIsAdded:function(){BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.show(BX.findParent(this.params.placeHolder,{className:"diskuf-files-block"}))},onFileIsInited:function(e,t){BX.addCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.addCustomEvent(t,"onFileIsAfterCreated",function(e,t,i,s){if(t&&!t.sizeInt){e.size=" "}});BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError)},onFileIs:function(e,t,i){this.bindEventsHandlers(e,t,i);var s={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,place:e,storage:"disk"};this.values.push(e);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadSuccess",[s,this,t.file,t]);t.__disk_element_id=i.element_id;BX.onCustomEvent(t,"OnFileUploadSuccess",[s,this])},onFileIsAppended:function(e,t){var i=this.agent.getItem(e),s=i.node;this.bindEventsHandlers(s,t,{})},onFileIsBound:function(e,t){var i=this.agent.getItem(e),s=i.node,o=s.getAttribute("id").replace("disk-edit-attach","");this.onFileIs(s,t,{element_id:o})},onFileIsAttached:function(e,t,i,s){if(!!s["sizeFormatted"])s["size"]=s["sizeFormatted"];if(!s.hasOwnProperty("service")){this.onUploadDone(t,{file:s});return}BX.Disk.ExternalLoader.startLoad({file:{id:s.id,name:s.name,service:s.service},onFinish:BX.delegate(function(e){var i=this.agent.getItem(t.id).node;BX.hide(i);var s={id:e.ufId,name:e.name,storage:e.storage,ext:t.ext,size:e.sizeFormatted,previewUrl:e.previewUrl,preview_url:e.previewUrl,element_url:e.previewUrl,size_int:parseInt(e.size,10)};var o;var a=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName);for(var n in s){o=s[n];if(s.hasOwnProperty(n)){if(n.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0||isNaN(s["size_int"])){o=""}}if(s.hasOwnProperty("SIZE_INT")||isNaN(s["SIZE_INT"])){if(parseInt(s["SIZE_INT"],10)==0){o=""}}}a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),o).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),o)}}var l={id:"disk-edit-attach"+s.id,"bx-agentFileId":t.id},r;r=BX.create("TR",{attrs:l,props:{className:"wd-inline-file"},html:a});var d=BX.findChild(r,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}i.parentNode.insertBefore(r,i);s.element_id=s.id;this.agent.onAttach([s],[r]);t.deleteFile()},this),onProgress:BX.delegate(function(e){this.onUploadProgress(t,e)},this)})},onUploadProgress:function(e,t){t=Math.min(t,98);var i=e.id;if(!e.__progressBarWidth)e.__progressBarWidth=5;if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;if(BX("wdu"+i+"Progressbar"))BX.adjust(BX("wdu"+i+"Progressbar"),{style:{width:e.__progressBarWidth+"%"}});if(BX("wdu"+i+"ProgressbarText"))BX.adjust(BX("wdu"+i+"ProgressbarText"),{text:e.__progressBarWidth+"%"})}},onUploadDone:function(e,t){if(t["file"]&&t["file"]["attachId"]&&t["file"]["attachId"]!=t["file"]["id"]){t["file"]["id"]=t["file"]["attachId"];delete t["file"]["attachId"]}var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var o=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName),a;for(var n in s){if(s.hasOwnProperty(n)){a=s[n];if(n.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0){a=""}}if(s.hasOwnProperty("SIZE_INT")){if(parseInt(s["SIZE_INT"],10)==0){a=""}}}if(n.toLowerCase()=="storage"&&a==="disk"){l(s.id).then(function(e){if(e.crumbs){var t=e.crumbs.join(" / ");var i=BX("disk-edit-attach"+s.id);if(i){var o=BX.findChild(i,{className:"files-placement"},true);if(o){BX.adjust(o,{text:t})}}}})}o=o.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),a).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),a)}}o=o.replace(new RegExp("#(width|height)#","gi"),"0").replace(new RegExp("#preview_url#","gi"),"javascript:void(0);");var r={id:"disk-edit-attach"+s.id,"bx-agentFileId":e.id},d;if(s["XML_ID"])r["bx-attach-xml-id"]=s["XML_ID"];if(s["FILE_ID"])r["bx-attach-file-id"]="n"+s["FILE_ID"];if(s["FILE_TYPE"])r["bx-attach-file-type"]=s["FILE_TYPE"];d=BX.create("TR",{attrs:r,props:{className:"wd-inline-file"},html:o});if(!t.file.canChangeName){var h=BX.findChild(d,{className:"files-name-edit-btn"},true);if(h){BX.remove(h)}}i.parentNode.replaceChild(d,i);s.element_id=s.id;this.onFileIs(d,e,s)}else{this.onUploadError(e,t,this.agent)}},onUploadError:function(e,t,i){var s=this.agent.getItem(e.id);if(!!s&&(s=s.node)&&BX(s)&&(i==true||!BX(s).hasAttribute("bx-disk-error"))){BX(s).setAttribute("bx-disk-error","Y");BX.adjust(s,{props:{className:"error-load"}});var o=t&&t["error"]?t["error"]:"Uploading error";s.cells[1].innerHTML="";s.cells[2].innerHTML='<span class="info-icon"></span><span class="error-text">'+o+"</span>";BX.onCustomEvent(e,"OnFileUploadFailed",[s,this]);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadFailed",[s,this,e.file,e])}},onError:function(e,t,i){var s="Uploading error.",o=s,a,n;if(i){if(i["error"]&&typeof i["error"]=="string")o=i["error"];else if(i["message"]&&typeof i["message"]=="string")o=i["message"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){o=[];for(var l=0;l<i["errors"].length;l++){if(typeof i["errors"][l]=="object"&&i["errors"][l]["message"])o.push(i["errors"][l]["message"])}if(o.length<=0)o.push("Uploading error.");o=o.join(" ")}}e.files=e.files||{};for(n in e.files){if(e.files.hasOwnProperty(n)){a=this.agent.queue.items.getItem(n);this.onUploadError(a,{error:o},o!=s)}}},onBlurRenameInput:function(e){var t=e.target||e.srcElement;var i=BX.findChild(t.parentNode,{className:"files-name-edit-btn"},true);if(!!i)BX.fireEvent(i,"click")},bindEventsHandlers:function(t,i,s){var o=s.element_id,a="file-action-control",n=BX.findChild(t,{className:"files-path"},true),l=BX.findChild(t,{className:"files-name-edit-btn"},true),r=BX.findChild(t,{className:"f-wrap"},true);if(!!l&&!!n&&!!r&&!n.getAttribute(a)){n.setAttribute(a,"enabled");BX.show(n,"inline");BX.hide(BX.findChild(t,{className:"files-placement"},true));BX.bind(n,"click",BX.delegate(function(){this.move(o,r.innerHTML,t)},this))}if(!!l){BX.bind(l,"click",BX.delegate(function(){BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t)},this));var d=BX.findChild(t,{className:"files-name-edit-inp"},true);if(d){BX.bind(d,"keydown",BX.delegate(function(i){var s=(i||e.event).keyCode||(i||e.event).charCode;if(s==13){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t);return BX.PreventDefault(i)}if(s==27){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.revertRename(o,t);return BX.PreventDefault(i)}},this))}}var h=BX.findChild(t,{className:"feed-add-post-loading"},true),u=BX.delegate(function(){this.deleteFile(t,i)},this),c=BX.create("SPAN",{props:{className:"del-but"},events:{click:u}});if(!!h){var m=BX.findChild(h,{className:"del-but"},true);if(!!m)BX.bind(m,"click",u);else h.appendChild(c.cloneNode(true))}if(!BX.findChild(t,{className:"files-info"},true)){t.appendChild(BX.create("TD",{props:{className:"files-info"}}))}if(!BX.findChild(t,{className:"files-del-btn"},true)){t.appendChild(BX.create("TD",{props:{className:"files-del-btn"},children:[c]}))}if(!c.hasAttribute("bx-bound")){c.setAttribute("bx-bound","Y");BX.bind(c,"click",u);BX.onCustomEvent(t,"OnMkClose",[t])}var p=BX.findChild(t,{className:"transformer-upgrade-popup"},true);if(p){BX.show(p.parentNode);BX.bind(p,"click",BX.proxy(BX.Disk.UF.showTransformationUpgradePopup,this))}},deleteFile:function(e,t){if(!!t.__disk_element_id){BX.Disk.ajax({url:this.urlDeleteFile,method:"POST",dataType:"json",data:{attachedId:t.__disk_element_id},onsuccess:function(e){}});BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[t.__disk_element_id,this])}BX.removeCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.removeCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.removeCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.removeCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.removeCustomEvent(t,"onUploadDone",this._onUploadDone);BX.removeCustomEvent(t,"onUploadError",this._onUploadError);delete t.hash;t.deleteFile("deleteFile");BX.remove(e)},move:function(e,t,i){var s=this._addUrlParam(this.urlSelect.replace("ACTION=SELECT","").replace("MULTI=Y",""),"ID=E"+e+"&NAME="+t+"&wish=fakemove");while(s.indexOf("&&")>=0)s=s.replace("&&","&");if(!this._checkFileName){this._checkFileName=BX.proxy(this.checkFileName,this);this._selectFolder=BX.proxy(this.selectFolder,this);this._openSection=BX.proxy(this.openSection,this);this._selectItem=BX.proxy(this.selectItem,this);this._unSelectItem=BX.proxy(this.unSelectItem,this)}var o=i||BX("disk-edit-attach"+e),a=BX.findChild(o,{className:"f-wrap"},true);BX.DiskFileDialog.arParams={};BX.DiskFileDialog.arParams[this.dialogName]={element_id:e,element_name:a.innerHTML};BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.addCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.addCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem);return BX.ajax.get(s,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFolder};BX.DiskFileDialog.openDialog(this.dialogName)},this),100)},this))},rename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var a=o.textContent||o.innerText;var n=a.split(".").pop();var l=s.value+"."+n;if(!!i){BX.focus(s);BX.bind(s,"blur",BX.proxy(this.onBlurRenameInput,this))}else if(s.value&&l!==a){BX.adjust(o,{text:l});var r=t.getAttribute("bx-agentFileId");var d=r?this.agent.getItem(r):null;if(!!d){d.item.file.name=l;d.item.name=l}var h=this.manager?this.manager.checkFile("disk_file"+e):null;if(!!h){h.name=l}BX.Disk.ajax({url:this.urlRenameFile,method:"POST",dataType:"json",data:{newName:l,attachedId:e},onsuccess:function(e){}})}},revertRename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var a=o.textContent||o.innerText;var n=a.split(".");var l=n.pop();s.value=n.join(".")},showMovedFile:function(e,t,i){if(!e)return false;var s,o=e,a=BX("disk-edit-attach"+o),n=BX.findChild(a,{className:"files-path"},true);BX.cleanNode(n);i=i.split("/").join(" / ");n.innerHTML=i;var l=parseInt(n.offsetWidth);var r=parseInt(n.parentNode.offsetWidth)-150,d;s=r/(l/i.length);if(l>r){d=Math.floor(s/2)+1;i=i.substr(0,d)+" ... "+i.substr(i.length-d);n.innerHTML=i}var h=BX("diskuf-doc"+o);if(!!h){var u=this._fileUnserialize(h.value);u.section=t["sectionID"];u.iblock=t["iblockID"];h.value=this._fileSerialize(u)}return true},_fileUnserialize:function(e){if(!BX.type.isString(e))return false;var t=e.split("|");return{id:t[0]||0,section:t[1]||0,iblock:t[2]||0}},_fileSerialize:function(e){var t=[e.id,e.section,e.iblock];return t.join("|")},selectFolder:function(e,t,i,s){var o=false,a=false,n,l,r;if(BX.DiskFileDialog.arParams&&BX.DiskFileDialog.arParams[this.dialogName]&&BX.DiskFileDialog.arParams[this.dialogName]["element_id"])o=BX.DiskFileDialog.arParams[this.dialogName]["element_id"];var d=BX.delegate(function(e,t,i,s){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:e,targetFolderId:t},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.showMovedFile(e,i,s)},this)})},this);for(n in i){if(i.hasOwnProperty(n)&&i[n].type==="folder"){l=e.name+i[n].path;r={sectionID:n,iblockID:e.iblock_id};d(o,i[n].id,r,l);a=true}}if(!a){l=e.name;r={sectionID:e.section_id,iblockID:e.iblock_id};if(!!s&&!!s.path&&s.path!="/"){l+=s.path;r.sectionID=s.id;if(!!s){d(o,s.id,r,l)}}}BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.removeCustomEvent(BX.DiskFileDialog,"loadItemsDone",this._checkFileName);BX.removeCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.removeCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem)},checkFileName:function(e){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}if(!!e&&e!=this.dialogName)return;var t=BX.DiskFileDialog.arParams[this.dialogName]["element_name"];var i=false,s;for(s in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(s)){if(BX.DiskFileDialog.obItems[this.dialogName][s]["name"]==t)i=true;if(i)break}}if(i)BX.DiskFileDialog.showNotice(BX.message("DISK_FILE_EXISTS"),this.dialogName);else BX.DiskFileDialog.closeNotice(this.dialogName)},selectItem:function(e,t,i){if(i!=this.dialogName)return;var s=t.substr(1);var o=BX.DiskFileDialog.obCurrentTab[i].link;o=o.replace("/index.php","")+"/element/upload/"+s+"/?use_light_view=Y&AJAX_CALL=Y&SIMPLE_UPLOAD=Y&IFRAME=Y&sessid="+BX.bitrix_sessid()+"&SECTION_ID="+s+"&CHECK_NAME="+BX.DiskFileDialog.arParams[this.dialogName]["element_name"];o=o.replace("/files/lib/","/files/");BX.ajax.loadJSON(o,BX.delegate(function(e){var t=e.permission===true&&e["okmsg"]!="";if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){if(t){BX.DiskFileDialog.showNotice(this.msg.file_exists,this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}},this),200)},this))},unSelectItem:function(){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){this.checkFileName()},this),200)},openSection:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y")}},openSectionCloud:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y");BX.DiskFileDialog.target[t]=this._addUrlParam(BX.DiskFileDialog.target[t],"cloudImport=1")}},selectFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},selectCloudFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){if(i[o].hasOwnProperty("provider")){i[o].service=i[o].provider}else{i[o].service=a}i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},showSelectDialog:function(){this._openSection=BX.proxy(this.openSection,this);this._selectFile=BX.proxy(this.selectFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))},showSelectDialogCloudImport:function(e){var t=e.target||e.srcElement;if(!BX.hasClass(t,"diskuf-selector-link-cloud")){t=BX.findParent(t,{className:"diskuf-selector-link-cloud"})}if(!t||!t.getAttribute("data-bx-doc-handler"))return;a=t.getAttribute("data-bx-doc-handler");this._openSection=BX.proxy(this.openSectionCloud,this);this._selectFile=BX.proxy(this.selectFile,this);this._selectCloudFile=BX.proxy(this.selectCloudFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"&cloudImport=1&service="+a+"&dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectCloudFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))}};return t}();BX.Disk.UF.dndCatcher={};BX.Disk.UF.add=function(e){e["controller"]=BX("diskuf-selectdialog-"+e["UID"]);if(e["controller"]&&BX.isNodeInDom(e["controller"])){e["values"]=BX.findChildren(e["controller"],{className:"wd-inline-file"},true);var t=BX(e["controller"]).parentNode;BX.onCustomEvent(e["controller"],"DiskLoadFormControllerWasBound",[e,"DiskLoadFormControllerWasBound"]);if(!BX(e["controller"]).hasAttribute("bx-disk-load-is-bound")){BX(e["controller"]).setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(t,"DiskLoadFormController",function(t){BX.Disk.UF.initialize(t,e)})}if(!!e["values"]&&e["values"].length>0&&!e["hideSelectDialog"])BX.onCustomEvent(e["controller"].parentNode,"DiskLoadFormController",["show"])}};BX.Disk.UF.initialize=function(e,t){e=e==="show"||e==="hide"?e:t["controller"].style.display!="none"?"hide":"show";if(!t["controller"].loaded){t["controller"].loaded=true;n[t["UID"]]=new BX.Disk.UF(t)}if(e=="show"){if(t["controller"].style.display!="block"){BX.fx.show(t["controller"],"fade",{time:.2});if(t["switcher"]&&t["switcher"].style.display!="none")BX.fx.hide(t["switcher"],"fade",{time:.1});BX.onCustomEvent(t["controller"],"onControllerIsShown",[t["controller"],n[t["UID"]]]);o=n[t["UID"]]}}else if(t["controller"].style.display!="none"){o=null;BX.fx.hide(t["controller"],"fade",{time:.2});BX.onCustomEvent(t["controller"],"onControllerIsHidden",[t["controller"],n[t["UID"]]])}return n[t["UID"]]};var l=function(e){return BX.Disk.ajaxPromise({url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var r=function(e){if(!BX(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;BX.unbindAll(e);BX.unbindAll(this.node);BX.show(this.node);BX.remove(this.node.nextSibling);this.id="wufdp_"+Math.random();BX.bind(this.node,"mouseover",BX.delegate(function(){this.turnOn()},this));BX.bind(this.node,"mouseout",BX.delegate(function(){this.turnOff()},this))};r.prototype={turnOn:function(){this.timeout=setTimeout(BX.delegate(function(){this.show()},this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(BX["UploaderUtils"]){var t=BX.UploaderUtils.scaleImage(e,{width:parseInt(BX.message("DISK_THUMB_WIDTH")),height:parseInt(BX.message("DISK_THUMB_HEIGHT"))});e=t.destin}this.popup=new BX.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("DIV",{props:e,children:[BX.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};BX.addCustomEvent("onDiskPreviewIsReady",function(e){new r(e)});BX.Disk.UF.runImport=function(e){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});BX.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:BX.delegate(function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}},this),onProgress:BX.delegate(function(e){},this)}).start()};BX.Disk.UF.disableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.enableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};e.DiskCreateDocument=function(e){if(!o){return false}if(!e){return false}var t=new BX.CViewer({createDoc:true});var i=t.createBlankElementByParams({docType:e,editUrl:BX.message("DISK_CREATE_BLANK_URL"),renameUrl:BX.message("DISK_RENAME_FILE_URL")});t.setCurrent(i);i.afterSuccessCreate=function(e){var t={};var i=e.name.split(".");i.pop();t["E"+e.objectId]={type:"file",id:"n"+e.objectId,name:e.name,label:i.join("."),storage:e.folderName,size:e.size,sizeInt:e.sizeInt,ext:e.extension,canChangeName:true,link:e.link};setTimeout(function(){o.selectFile({},{},t)},200)};t.runActionByCurrentElement("create",{obElementViewer:t});try{BX.PreventDefault()}catch(e){}return false};e.DiskOpenMenuCreateService=function(e){var t=new BX.CViewer({});t.openMenu("disk_open_menu_with_services",BX(e),[BX.CViewer.isDisabledLocalEdit?null:{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",href:"#",onclick:BX.delegate(function(t){if(BX.CViewer.isEnableLocalEditInDesktop()){this.setEditService("l");BX.adjust(e,{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")});BX.PopupMenu.destroy("disk_open_menu_with_services")}else{this.helpDiskDialog()}return BX.PreventDefault(t)},t)},{text:t.getNameEditService("google"),className:"bx-viewer-popup-item item-gdocs",href:"#",onclick:BX.delegate(function(t){this.setEditService("google");BX.adjust(e,{text:this.getNameEditService("google")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)},{text:t.getNameEditService("office365"),className:"bx-viewer-popup-item item-office365",href:"#",onclick:BX.delegate(function(t){this.setEditService("office365");BX.adjust(e,{text:this.getNameEditService("office365")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)},{text:t.getNameEditService("skydrive"),className:"bx-viewer-popup-item item-office",href:"#",onclick:BX.delegate(function(t){this.setEditService("skydrive");BX.adjust(e,{text:this.getNameEditService("skydrive")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)}],{offsetTop:0,offsetLeft:25})};e.DiskOpenMenuImportService=function(e,t){var i=[];for(var s in t){if(!t.hasOwnProperty(s))continue;i.push({text:t[s].name,code:t[s].id,href:"#",onclick:function(e,t){var i=t.layout.item;BX.addClass(i,"diskuf-selector-link-cloud");i.setAttribute("data-bx-doc-handler",t.code);BX.onCustomEvent("onManualChooseCloudImport",[{target:i}]);BX.removeClass(i,"diskuf-selector-link-cloud");i.removeAttribute("data-bx-doc-handler");BX.PopupMenu.destroy("disk_open_menu_with_import_services");return BX.PreventDefault(e)}})}var o=new BX.CViewer({});o.openMenu("disk_open_menu_with_import_services",BX(e),i,{offsetTop:0,offsetLeft:25});return BX.PreventDefault()};e.DiskActionFileMenu=function(e,t,i){s++;BX.PopupMenu.show("bx-viewer-wd-popup"+s+"_"+e,BX(t),i,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,t){var i=BX(t);if(i){BX.fireEvent(i,"click")}return false}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.min.js?154412746113856";s:6:"source";s:76:"/bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetCheckList!="undefined"){return}BX.Tasks.Component.TasksWidgetCheckList=BX.Tasks.Component.extend({sys:{code:"checklist"},options:{confirmDelete:false},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.getManager()},getManager:function(){return this.subInstance("manager",function(){var t=new this.constructor.ItemManager({scope:this.scope(),data:this.option("data"),preRendered:true,confirmDelete:this.option("confirmDelete"),enableSync:this.option("enableSync"),entityRoute:this.option("entityRoute"),entityId:this.option("entityId")});t.bindEvent("change",this.onManagerChange.bind(this));return t})},bindEvents:function(){this.bindControl("toggle-complete","click",this.onCompleteTogglerClick.bind(this))},onCompleteTogglerClick:function(){var t=this.control("is-items-complete");this.toggleCompleted(BX.hasClass(t,"invisible"))},onManagerChange:function(t){var e=0;var i=0;var n=1;var o=1;this.getManager().each(function(t){if(!t.isSeparator()){if(t.isChecked()){i++}e++;t.data().NUMBER=o++}t.data().SORT=t.data().SORT_INDEX=n++;t.sort(t.data().NUMBER)});this.control("total-counter").innerHTML=e;BX.Tasks.each(this.controlAll("complete-counter"),function(t){t.innerHTML=i});this.showHideCompleted(!i);if(!i){this.toggleCompleted(false)}BX[i?"removeClass":"addClass"](this.control("top-counter-set"),"invisible")},showHideCompleted:function(t){this.changeCSSFlag("hidden",t,this.control("complete-block"))},toggleCompleted:function(t){var e=this.control("is-items-complete");BX.Tasks.Util.fadeSlideToggleByClass(e);this.changeCSSFlag("down",t,this.control("toggle-complete"))},count:function(){return this.getManager().count()},openForm:function(){this.getManager().openAddForm()}}});BX.Tasks.Component.TasksWidgetCheckList.ItemManager=BX.Tasks.Util.ItemSet.extend({sys:{code:"checklist-is"},options:{controlBind:"class",itemFx:"vertical",confirmDelete:false,useDragNDrop:true,enableSync:false},methods:{bindEvents:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindEvents");this.bindControl("add-separator","click",this.onAddSeparatorClick.bind(this));this.vars.formInitialized=false},bindItemActions:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindItemActions");this.bindOnItemEx("i-toggle","click",this.onItemToggleClick);this.bindOnItemEx("i-toggle","change",this.onItemToggleChange);this.bindOnItemEx("i-edit","click",this.onItemEditClick);this.bindOnItemEx("i-apply","click",this.onItemApplyClick);this.bindOnItemEx("i-new-title","keypress",this.onItemNewTitleKeyPress)},bindDNDDropZones:function(t){this.callMethod(BX.Tasks.Util.ItemSet,"bindDNDDropZones",arguments);t.bindDropZone(this.control("items-complete"))},onDragNDropItemRelocatedAfter:function(t,e,i){var n=this.getItemByNode(e);if(n){var o=[];var s=n.isChecked();var r=i.zone==this.control("items-complete");if(r!=s){n.isChecked(r);o.push([r?"complete":"renew",{id:n.value()}])}var a=null;if(i.after!==null){a=this.getItemByNode(i.after)}if(r&&a===null){a=this.findLastUnCheckedItem()}if(!a||a.value()!=n.value()){o.push(["moveAfter",{id:n.value(),afterId:a?a.value():0}])}this.getSyncer().perform(o);this.callMethod(BX.Tasks.Util.ItemSet,"onDragNDropItemRelocatedAfter",arguments)}},onItemDeleteByCross:function(t){if(t.isEditMode()){this.toggleItemMode(false,t)}else{var e=arguments;if(this.option("confirmDelete")){BX.Tasks.confirmDelete(BX.message("TASKS_TTDP_CHECKLIST_ENTITY_NAME")).then(function(){this.deleteItemRemote.apply(this,e)}.bind(this))}else{this.deleteItemRemote.apply(this,e)}}},deleteItemRemote:function(t){var e=arguments;this.getSyncer().perform([["delete",{id:t.value()}]]).then(function(){this.callMethod(BX.Tasks.Util.ItemSet,"onItemDeleteByCross",e)}.bind(this))},onItemEditClick:function(t){this.toggleItemMode(false,t)},onItemApplyClick:function(t){this.toggleItemMode(true,t)},onItemToggleClick:function(t,e,i){if(t.isLockedCheck()){BX.eventReturnFalse(i||Window.event)}},onItemToggleChange:function(t){var e=function(t){this.getSyncer().perform([[t.isChecked()?"complete":"renew",{id:t.value()}]])}.bind(this);this.getStriker().toggle(t.control("title"),function(){t.isChecked(true);e(t);this.insertItemBefore(t,this.findItemBefore(t,true),true)}.bind(this),function(){t.isChecked(false);e(t);this.insertItemBefore(t,this.findItemBefore(t,false),false)}.bind(this))},onItemNewTitleKeyPress:function(t,e,i){i=i||Window.event;if(BX.Tasks.Util.isEnter(i)){this.toggleItemMode(true,t);BX.eventReturnFalse(i)}},insertItemBefore:function(t,e,i){var n=new BX.Promise;var o=this.control(i?"items-complete":"items");if(o){t.isLockedCheck(true);t.disappear().then(function(){if(e===null){BX.append(t.scope(),o)}else{o.insertBefore(t.scope(),e.scope())}t.appear().then(function(){t.isLockedCheck(false);n.resolve();this.fireEvent("change",[this.vars.order])}.bind(this),function(){t.isLockedCheck(false)})}.bind(this),function(){t.isLockedCheck(false)})}else{n.reject()}return n},findItemBefore:function(t,e){var i=t.data().SORT;var n=null;var o=this.first();this.each(function(t){if(!(e&&!t.isChecked())&&!(!e&&t.isChecked())){o=t}if(o.data().SORT>i){n=t;return false}});return n},findLastUnCheckedItem:function(){var t=0;var e=false;this.each(function(i){if(i.sort()>t&&!i.isChecked()){t=i.sort();e=i.value()}});return e===null?null:this.get(e)},openAddForm:function(){var t=this.control("add-item-form");if(t){if(!this.vars.formInitialized){this.bindControl("form-close","click",this.onFormCloseClick.bind(this));this.bindControl("form-submit","click",this.onFormSubmitClick.bind(this));this.bindControl("form-title","keypress",this.onFormTitleKeyPress.bind(this));this.vars.formInitialized=true}this.addItemByForm();this.clearForm();this.toggleForm(true).then(function(){if(!BX.hasClass(this.control("add-item-form"),"invisible")){this.focusForm()}}.bind(this))}},onAddSeparatorClick:function(){this.addItemRemote(this.makeItemData("==="))},onFormCloseClick:function(){this.toggleForm();this.clearForm()},onFormSubmitClick:function(){this.addItemByForm()},onFormTitleKeyPress:function(t){t=t||Window.event;if(BX.Tasks.Util.isEnter(t)){this.addItemByForm();BX.eventReturnFalse(t)}},addItemByForm:function(){var t=this.control("form-title").value;if(!t.length){return false}if(!this.opts.enableSync){t=BX.util.htmlspecialchars(t)}this.addItemRemote(this.makeItemData(t));return true},addItemRemote:function(t){this.lockInput();this.getSyncer().perform([["add",{data:{_OWNER_ENTITY_ID_:this.option("entityId"),TITLE:t.TITLE}},{code:"item-add"}]]).then(function(e){if(e){var i=e.getData()["item-add"].RESULT;var n=0;if("DATA"in i){n=i.DATA.ID}else{n=i.ID}t.VALUE=parseInt(n);t.DISPLAY=i.DATA.DISPLAY;t.TITLE=i.DATA.TITLE}this.addItem(t);this.clearForm();this.unLockInput();this.focusForm()}.bind(this),function(){this.unLockInput()}.bind(this))},clearForm:function(){this.control("form-title").value=""},toggleForm:function(t){var e=this.control("add-item-form");if(t&&!BX.hasClass(e,"invisible")){var i=new BX.Promise;i.resolve();return i}return BX.Tasks.Util.fadeSlideToggleByClass(this.control("add-item-form"))},focusForm:function(){this.control("form-title").focus()},lockInput:function(){BX.Tasks.Util.disable(this.control("form-title"))},unLockInput:function(){BX.Tasks.Util.enable(this.control("form-title"))},toggleItemMode:function(t,e){if(e.isEditMode()){if(t){var i=e.control("new-title").value;if(!i.length){return}e.lockInput();this.getSyncer().perform([["update",{id:e.value(),data:{TITLE:i}},{code:"item-update"}]]).then(function(t){if(t){var n=t.getData()["item-update"].RESULT;e.title(n.DATA.TITLE,n.DATA.DISPLAY)}else{e.title(i,BX.util.htmlspecialchars(i))}e.toggleMode();e.unLockInput()},function(){e.unLockInput()})}else{e.toggleMode()}}else{e.control("new-title").value=BX.util.htmlspecialcharsback(e.data().TITLE);e.toggleMode()}},makeItemData:function(t){var e=this.getGreatestSort();return{CHECKED:0,SORT:e["sort"]+1,SORT_INDEX:e["sort"]+1,NUMBER:e["number"]+1,TITLE:t,ACTION_UPDATE:true,ACTION_DELETE:true,ACTION_TOGGLE:true}},getGreatestSort:function(){var t={sort:0,number:0};this.each(function(e){var i=e.data().SORT;var n=e.data().NUMBER;if(i>t.sort){t.sort=i}if(!e.isSeparator()&&n>t.number){t.number=n}});return t},getItemClass:function(){return this.constructor.Item},getStriker:function(){return this.subInstance("striker",function(){return new t({duration:500,postTimeout:100})})},getSyncer:function(){return this.subInstance("sync",function(){return new e({enabled:this.option("enableSync"),routePrefix:this.option("entityRoute")})})},getItemDeleteControlId:function(){return"i-delete"}}});BX.Tasks.Component.TasksWidgetCheckList.ItemManager.Item=BX.Tasks.Util.ItemSet.Item.extend({sys:{code:"checklist-is-i"},options:{controlBind:"class"},methods:{isEditMode:function(){return!!this.vars.modeEdit},lockInput:function(){BX.Tasks.Util.disable(this.control("new-title"))},unLockInput:function(){BX.Tasks.Util.enable(this.control("new-title"))},toggleMode:function(){this.setCSSMode("mode",this.vars.modeEdit?"read":"edit");this.vars.modeEdit=!this.vars.modeEdit},title:function(t,e){if(typeof t!="undefined"){this.data().TITLE=t;this.data().DISPLAY=e;this.control("title").innerHTML=this.data().DISPLAY;this.control("title-field").value=this.data().TITLE;if(this.constructor.isSeparatorValue(t)){this.data().APPEARANCE="a-separator";this.setCSSMode("a","separator")}return}return this.data().TITLE},sort:function(t){if(typeof t!="undefined"){t=parseInt(t);this.control("number").innerHTML=t;this.control("sort-fld").value=this.data().SORT;return}return this.data().SORT},isChecked:function(t){if(typeof t!="undefined"){t=!!t;this.data().CHECKED=t?"1":"0";this.data().IS_COMPLETE=t?"Y":"N";this.control("toggle").checked=t;var e=t?"1":"0";if(this.parent().parent().option("compatibilityMode")){e=t?"Y":"N"}this.control("complete-fld").value=e;if(t){this.changeCSSFlag("stroke-out",true,this.control("title"))}else{this.parent().getStriker().unStrike(this.control("title"))}}return this.data().CHECKED=="1"},isLockedCheck:function(t){if(typeof t!=="undefined"){this.vars.checkLocked=!!t;return}return this.vars.checkLocked},isSeparator:function(){return this.constructor.isSeparatorValue(this.data().TITLE)}},methodsStatic:{extractValue:function(t){if("VALUE"in t){return t.VALUE}t.VALUE="n"+Math.abs(BX.util.hashCode(Math.random().toString()+Math.random().toString()));if(!("ID"in t)){t.ID=""}return t.VALUE},prepareDataSt:function(t){t.DISPLAY=t.DISPLAY||t.TITLE;t.APPEARANCE=this.isSeparatorValue(t.TITLE)?"a-separator":"a-generic";var e=t.CHECKED=="1";t.READONLY=t.ACTION_UPDATE?"":"noedit";t.CHECKED_ATTRIBUTE=e?"checked":"";t.DISABLED_ATTRIBUTE="";t.IS_COMPLETE=e?"Y":"N";t.STROKE_CSS=e?"stroke-out":"";if(this.isSeparatorValue(t.TITLE)){t.NUMBER=0}t.SORT_INDEX=t.SORT;t.ITEM_SET_INVISIBLE="invisible";return t},isSeparatorValue:function(t){t=t.toString().replace(/^\s+/,"").replace(/\s+$/,"");return!!t.match(/^(-|=|_|\*|\+){3,}$/)}}});var t=function(t){this.duration=t.duration||500;this.postTimeout=t.postTimeout||1;this.textChunkSize=t.textChunkSize||20;this.animations={}};t.prototype={addAnimation:function(t){var e=BX.util.hashCode(Math.random().toString()+Math.random().toString());this.animations[e]=t;return e},getAnimation:function(t){return this.animations[t]},removeAnimation:function(t,e){var i=this.getAnimation(t);if(i){clearTimeout(i.timer);var n=i.pr;delete this.animations[t];if(e){n.fulfill()}else{n.reject()}return n}return null},getAnimationKeyByBlock:function(t){var e=null;BX.Tasks.each(this.animations,function(i,n){if(i.block===t){e=n;return false}});return e},toggle:function(t,e,i){var n=this.getAnimationKeyByBlock(t);if(!n){if(BX.hasClass(t,"stroke-out")){this.unStrike(t).then(i)}else{this.strike(t).then(e)}}else{this.cancelStrikeAnimation(t,n)}},strike:function(t){var e=new BX.Promise;var i=t.childNodes.length;if(!i){e.resolve();return}var n=[];var o,s;for(o=0;o<t.childNodes.length;){var r=t.childNodes[o];if(r.nodeType==Node.TEXT_NODE){n=this.strSplit(r.textContent,this.textChunkSize);for(s=0;s<n.length;s++){t.insertBefore(BX.create("span",{text:n[s]}),r)}t.removeChild(r);o+=n.length}else{o++}}var a=t.childNodes.length;var l=this.addAnimation({block:t,tmOut:Math.floor(this.duration/a),k:0,length:a,pr:e,timer:null});var c=this.getAnimation(l);var h=function(){c.timer=setTimeout(function(){BX.addClass(c.block.childNodes[c.k],"chunk-stroke-out");c.k++;if(c.k<c.length){h()}else{c.timer=setTimeout(function(){this.removeAnimation(l,true);BX.addClass(c.block,"stroke-out")}.bind(this),this.postTimeout)}}.bind(this),c.tmOut)}.bind(this);h();return e},unStrike:function(t){this.clearStrike(t);var e=new BX.Promise;e.fulfill();return e},clearStrike:function(t){for(k=0;k<t.childNodes.length;k++){BX.removeClass(t.childNodes[k],"chunk-stroke-out")}BX.removeClass(t,"stroke-out")},cancelStrikeAnimation:function(t,e){if(!e){e=this.getAnimationKeyByBlock(t)}if(e){this.clearStrike(t);return this.removeAnimation(e,false)}return null},strSplit:function(t,e){var i=[];var n="";var o=0;while(t.length){if(o>100){break}n=t.substr(0,e);t=t.slice(e);if(!t.length&&n.length<4&&i.length>0){i[i.length-1]+=n}else{i.push(n)}o++}return i}};var e=function(t){this.enabled=!!t.enabled;this.prefix=t.routePrefix||"";this.sLock=false;this.query=null};e.prototype={getQuery:function(){if(this.query===null){this.query=new BX.Tasks.Util.Query}return this.query},perform:function(t){var e=new BX.Promise;if(!this.enabled){e.resolve();return e}if(this.sLock){e.reject();return e}var i=this.getQuery();this.sLock=true;var n=[];for(var o=0;o<t.length;o++){n.push({m:this.prefix+".checklist."+t[o][0],args:t[o][1],rp:t[o][2]})}i.load(n).execute().then(function(t){this.sLock=false;e.resolve(t)}.bind(this),function(t){this.sLock=false;e.reject(t)}.bind(this));return e}}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/.default/logic.min.js?15441274613614";s:6:"source";s:82:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/.default/logic.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetMemberSelector!="undefined"){return}BX.Tasks.Component.TasksWidgetMemberSelector=BX.Tasks.Component.extend({sys:{code:"tdp-mem-sel",types:[]},methodsStatic:{instances:[],getInstance:function(e){return BX.Tasks.Component.TasksWidgetMemberSelector.instances[e]},addInstance:function(e,t){BX.Tasks.Component.TasksWidgetMemberSelector.instances[e]=t}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksWidgetMemberSelector.addInstance(this.id(),this);this.getSelector();if(this.option("inputSpecial")){this.getSelector().bindEvent("change",this.onChanged.bind(this))}},onChanged:function(e){var t="";if(e[0]){t=this.getSelector().get(e[0]).id()}this.control("sole-input").value=t},getSelector:function(){return this.subInstance("selector",function(){var e={scope:this.scope(),hidePreviousIfSingleAndRequired:true,data:this.option("data"),max:this.option("max"),min:this.option("min"),nameTemplate:this.option("nameTemplate"),path:this.option("path"),preRendered:true,popupOffsetTop:3,popupOffsetLeft:40,readOnly:this.option("readOnly"),parent:this};var t=this.option("types");e.mode=t.USER?"user":"group";e.useAdd=!!t["USER.MAIL"]&&this.option("modulesAvailable").mail;var s=new this.constructor.ItemManager(e);s.bindEvent("change",function e(){this.fireEvent("change",[arguments[0]])}.bind(this));return s})},count:function(){return this.getSelector().count()},export:function(){return this.getSelector().exportItemData(true)},replaceItem:function(e,t){this.getSelector().replaceItem(e,t)},value:function(){return this.getSelector().value()},replaceAll:function(e){var t=this.getSelector();t.unload({itemFx:false,checkRestrictions:false});t.load(e)},readOnly:function(e){this.getSelector().readonly(e)}}});BX.Tasks.Component.TasksWidgetMemberSelector.ItemManager=BX.Tasks.UserItemSet.extend({sys:{code:"tdp-mem-sel-is"},options:{controlBind:"class",itemFx:"horizontal",itemFxHoverDelete:true,prefixId:true,mode:"all",path:{},hidePreviousIfSingleAndRequired:false},methods:{onSearchBlurred:function(){var e=BX("invite-email-email-user-popup");if(e!==null&&e.style.display==="block"){return}if(this.callMethod(BX.Tasks.UserItemSet,"onSearchBlurred")){if(this.option("hidePreviousIfSingleAndRequired")&&this.vars.constraint.min>0){this.restoreKept()}}},onSelectorItemSelected:function(e){if(this.option("hidePreviousIfSingleAndRequired")&&this.vars.constraint.min>0){this.vars.changed=true;var t=this.extractItemValue(e);if(!this.hasItem(t)){this.addItem(e);this.vars.toDelete=false;if(!this.checkCanAddItems()){this.instances.selector.close();this.onSearchBlurred()}}this.resetInput()}else{this.callMethod(BX.Tasks.UserItemSet,"onSelectorItemSelected",arguments)}},openAddForm:function(){if(this.option("hidePreviousIfSingleAndRequired")){if(this.vars.constraint.min==1&&this.vars.constraint.max==1){this.forceDeleteFirst()}}this.callMethod(BX.Tasks.UserItemSet,"openAddForm")},onItemDeleteByCross:function(e){if(!this.callMethod(BX.Tasks.UserItemSet,"onItemDeleteByCross",arguments)){if(this.option("hidePreviousIfSingleAndRequired")){if(this.vars.constraint.min==1&&this.count()==1){this.forceDeleteFirst();this.callMethod(BX.Tasks.UserItemSet,"openAddForm")}}return false}return true},forceDeleteFirst:function(){var e=this.getItemFirst();if(e){this.vars.toDelete=e.data();this.deleteItem(e.value(),{checkRestrictions:false})}},restoreKept:function(){if(this.vars.toDelete){this.addItem(this.vars.toDelete,{checkRestrictions:false});this.vars.toDelete=false}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/tasks.widget.optionbar/templates/.default/logic.min.js?15441274611103";s:6:"source";s:76:"/bitrix/components/bitrix/tasks.widget.optionbar/templates/.default/logic.js";s:3:"min";s:80:"/bitrix/components/bitrix/tasks.widget.optionbar/templates/.default/logic.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/tasks.widget.optionbar/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetOptionBar!="undefined"){return}BX.Tasks.Component.TasksWidgetOptionBar=BX.Tasks.Component.extend({sys:{code:"wg-optbar"},methods:{bindEvents:function(){this.bindDelegateControl("flag","click",this.passCtx(this.onToggleFlag))},onToggleFlag:function(t){var e=BX.data(t,"target");if(typeof e!="undefined"&&BX.type.isNotEmptyString(e)){var n=this.control(e);var a=BX.data(t,"flag-name");var i=BX.data(t,"yes-value")||"Y";var s=BX.data(t,"no-value")||"N";if(BX.type.isElementNode(n)){n.value=t.checked?i:s}this.fireEvent("toggle",[a,n.value==i])}},toggleFlag:function(t,e){},switchOption:function(t,e){t=t.toLowerCase().replace(/_/g,"-");var n=this.control("flag-"+t);if(n){if(e){BX.Tasks.Util.enable(n)}else{BX.Tasks.Util.disable(n);if(this.isOptionChecked(n)){n.checked=false;this.onToggleFlag(n)}}BX.data(this.control("flag-label-"+t),"hint-enabled",!e)}},switchFlag:function(t,e){return this.switchOption(t,e)},isOptionChecked:function(t){return t.checked}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:86:"/bitrix/components/bitrix/system.field.edit/templates/crm/script.min.js?15441273844535";s:6:"source";s:67:"/bitrix/components/bitrix/system.field.edit/templates/crm/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/system.field.edit/templates/crm/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/system.field.edit/templates/crm/script.map.js";}"*/
BX.CrmEntitySelector=function(){var t=function(t){this.randomString=t.randomString;this.jsObject=t.jsObject;this.fieldUid=t.fieldUid;this.fieldName=t.fieldName;this.usePrefix=t.usePrefix;this.listPrefix=t.listPrefix;this.multiple=t.multiple;this.listElement=t.listElement;this.listEntityType=t.listEntityType;this.pluralCreation=Boolean(t.pluralCreation);this.listEntityCreateUrl=t.listEntityCreateUrl;this.currentEntityType=t.currentEntityType;this.context=t.context;this.initialize()};t.prototype.initialize=function(){this.popupObject=null;this.popupId="crm-"+this.randomString+"-popup";this.popupBindElement=null;this.popupContent="";this.externalRequestData=null;this.externalEventHandler=null;BX.addCustomEvent("onCrmSelectedItem",BX.proxy(this.setSelectedElement,this));BX.addCustomEvent("onCrmUnSelectedItem",BX.proxy(this.unsetSelectedElement,this))};t.prototype.createNewEntity=function(t){if(this.pluralCreation){t=t||window.event;this.popupBindElement=t.currentTarget;this.createPopup()}else{this.performExternalRequest()}};t.prototype.performExternalRequest=function(t){if(this.popupObject){this.popupObject.popupWindow.close()}if(t){this.setCurrentEntityType(t)}var e=BX.util.add_url_param(this.getCreateUrl(),{external_context:this.context});if(!this.externalRequestData){this.externalRequestData={}}this.externalRequestData[this.context]={context:this.context,wnd:window.open(e)};if(!this.externalEventHandler){this.externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this.externalEventHandler)}};t.prototype.onExternalEvent=function(t){var e=BX.type.isNotEmptyString(t["key"])?t["key"]:"";var i=BX.type.isPlainObject(t["value"])?t["value"]:{};var s=BX.type.isNotEmptyString(i["entityTypeName"])?i["entityTypeName"]:"";var n=BX.type.isNotEmptyString(i["context"])?i["context"]:"";if(e==="onCrmEntityCreate"&&s===this.currentEntityType.toUpperCase()&&this.externalRequestData&&BX.type.isPlainObject(this.externalRequestData[n])){var r=BX.type.isBoolean(i["isCanceled"])?i["isCanceled"]:false;if(!r&&BX.type.isPlainObject(i["entityInfo"])){if(this.multiple!="Y"){for(var l=0;l<this.listElement.length;l++){this.listElement[l]["selected"]="N"}}i["entityInfo"]["selected"]="Y";var a=i["entityInfo"];if(this.usePrefix=="Y"){var p=a["type"].toUpperCase();a["id"]=this.listPrefix[p]+"_"+a["id"]}this.listElement.push(a);BX[""+this.jsObject+""].initWidgetEntitySelection()}if(this.externalRequestData[n]["wnd"]){this.externalRequestData[n]["wnd"].close()}delete this.externalRequestData[n]}};t.prototype.createPopup=function(){var t=[];for(var e=0;e<this.listEntityType.length;e++){t.push({text:BX.message("CRM_CES_CREATE_"+this.listEntityType[e].toUpperCase()),onclick:'BX["'+this.jsObject+'"].performExternalRequest("'+this.listEntityType[e]+'");'})}if(!BX.PopupMenu.getMenuById(this.popupId)){var i=this.popupBindElement.getBoundingClientRect();this.popupObject=BX.PopupMenu.create(this.popupId,this.popupBindElement,t,{closeByEsc:true,angle:true,offsetLeft:i.width/2})}if(this.popupObject){this.popupObject.popupWindow.show()}};t.prototype.setCurrentEntityType=function(t){this.currentEntityType=t};t.prototype.getCreateUrl=function(){if(this.listEntityCreateUrl.hasOwnProperty(this.currentEntityType)){return this.listEntityCreateUrl[this.currentEntityType]}else{return""}};t.prototype.setSelectedElement=function(t){for(var e in this.listElement){if(t.id===this.listElement[e].id){this.listElement[e].selected="Y"}}};t.prototype.unsetSelectedElement=function(t){for(var e in this.listElement){if(t.id===this.listElement[e].id){this.listElement[e].selected="N"}}};t.prototype.initWidgetEntitySelection=function(){BX.loadCSS("/bitrix/js/crm/css/crm.css");if(typeof CRM=="undefined"){BX.loadScript("/bitrix/js/crm/crm.js",BX[""+this.jsObject+""].initWidgetEntitySelection());return}CRM.Set(BX("crm-"+this.fieldUid+"-open"),this.fieldName,"",this.listElement,this.usePrefix==="Y",this.multiple==="Y",this.listEntityType,{lead:BX.message("CRM_FF_LEAD"),contact:BX.message("CRM_FF_CONTACT"),company:BX.message("CRM_FF_COMPANY"),deal:BX.message("CRM_FF_DEAL"),quote:BX.message("CRM_FF_QUOTE"),order:BX.message("CRM_FF_ORDER"),ok:BX.message("CRM_FF_OK"),cancel:BX.message("CRM_FF_CANCEL"),close:BX.message("CRM_FF_CLOSE"),wait:BX.message("CRM_FF_SEARCH"),noresult:BX.message("CRM_FF_NO_RESULT"),add:BX.message("CRM_FF_CHOISE"),edit:BX.message("CRM_FF_CHANGE"),search:BX.message("CRM_FF_SEARCH"),last:BX.message("CRM_FF_LAST")})};return t}();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/tasks.userfield.panel/templates/.default/logic.min.js?154412746113857";s:6:"source";s:75:"/bitrix/components/bitrix/tasks.userfield.panel/templates/.default/logic.js";s:3:"min";s:79:"/bitrix/components/bitrix/tasks.userfield.panel/templates/.default/logic.min.js";s:3:"map";s:79:"/bitrix/components/bitrix/tasks.userfield.panel/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.UserFieldPanel!="undefined"){return}BX.Tasks.Component.UserFieldPanel=BX.Tasks.Component.extend({sys:{code:"uf-panel"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.instances.items=new BX.Tasks.Component.UserFieldPanel.ItemSet({scope:this.scope(),data:this.option("scheme"),itemFx:"vertical",parent:this});this.instances.items.bindEvent("item-save",BX.delegate(this.onItemSave,this));this.instances.items.bindEvent("item-hide",BX.delegate(this.onItemHide,this));this.instances.items.bindEvent("item-delete",BX.delegate(this.onItemDelete,this));this.saveState=BX.debounce(this.saveStateInstant,1200,this);this.redrawButtons()},bindEvents:function(){this.bindControlPassCtx("add-field","click",this.showAddPopup);this.bindControlPassCtx("action","click",this.showActionPopup);this.bindControlPassCtx("un-hide-field","click",this.showUnHideFieldPopup);this.bindDelegateControl("item-label-edit","keypress",this.jamEnter,this.control("new-item-place"))},jamEnter:function(e){if(BX.Tasks.Util.isEnter(e)){BX.eventReturnFalse(e)}},redrawButtons:function(){var e=false;var t=true;this.instances.items.each(function(i){if(!i.data().STATE.D){e=true}else{t=false}});this.changeCSSFlag("invisible",!e,this.control("un-hide-field"));this.changeCSSFlag("not-empty",!t,this.control("items"))},openAddForm:function(e,t,i){e.popupWindow.close();i.options=i.options||{};this.instances.items.openAddForm(i.options.code||i.code)},onItemSave:function(e,t,i){i.ENTITY_CODE=this.option("entityCode");this.callRemote("this.saveField",{id:t,data:i,parameters:{INPUT_PREFIX:this.option("inputPrefix"),RELATED_ENTITIES:this.option("relatedEntities")}}).then(function(t){if(t.isSuccess()){e.fulfill(t.getData())}else{e.reject(t.getErrors())}})},onItemHide:function(e,t){var i=this.option("user");var s=this.option("restriction").MANAGE&&i.IS_SUPER;var n=BX.message(s?"TASKS_TUFP_FIELD_HIDE_DELETE_CONFIRM":"TASKS_TUFP_FIELD_HIDE_CONFIRM");var a={id:this.code()+"-fh-confirm-v2",ctx:this,isDisposable:!s,buttonSet:s?[{text:BX.message("TASKS_COMMON_DELETE"),type:"red",code:"delete"},{text:BX.message("TASKS_COMMON_HIDE"),type:"green",code:"continue","default":true}]:false};BX.Tasks.confirm(n,null,a).then(function(i){if(i=="continue"){this.setItemStateDisplay(t,false);e.fulfill("hide")}else if(i=="delete"){return this.callRemote("this.deleteField",{id:t,parameters:{RELATED_ENTITIES:this.option("relatedEntities")}}).then(function(t){if(!t.isSuccess()){BX.Tasks.alert(t.getErrors());e.reject()}else{e.fulfill("delete")}})}}.bind(this))},onItemDelete:function(e){this.redrawButtons()},setItemStateDisplay:function(e,t,i){this.instances.items.get(e).data().STATE.D=t;this.redrawButtons();if(i){this.saveStateInstant()}else{this.saveState()}},setItemSortBefore:function(e,t){var i=[];this.instances.items.each(function(e){i.push({value:parseInt(e.value()),sort:e.data().STATE.S})});i=i.sort(function(e,t){if(e.sort>t.sort){return 1}else if(e.sort<t.sort){return-1}return 0});var s=parseInt(e.value());var n=t?parseInt(t.value()):-1;var a=1;for(var o in i){if(i.hasOwnProperty(o)){if(i[o].value!=s){if(i[o].value==n){this.instances.items.get(s).data().STATE.S=a;a=a+1}this.instances.items.get(i[o].value).data().STATE.S=a;a=a+1}}}if(n<0){this.instances.items.get(s).data().STATE.S=a}this.saveState()},saveStateInstant:function(e){this.callRemote("this.setState",{state:this.packState(),dropAll:!!e,entityCode:this.option("entityCode")},{code:"setstate"})},packState:function(){var e={};this.instances.items.each(function(t){e[t.value()]=t.data().STATE});return e},initDragNDrop:function(){if(!this.instances.dragNDrop){var e=new BX.Tasks.Util.DragAndDrop({createFlying:BX.delegate(function(e){var t=this.getItemByNode(e);return this.getNodeByTemplate("item-flying",t.data())[0]},this),autoMarkItemAfter:true,autoMarkZoneTopBottom:true});e.bindDropZone(this.control("items"));e.bindEvent("item-relocation-before",this.onDragNDropItemRelocatedBefore,this);e.bindEvent("item-relocation-after",this.onDragNDropItemRelocatedAfter,this);this.instances.dragNDrop=e;this.instances.items.each(BX.delegate(this.bindDragNDropNode,this))}},onDragNDropItemRelocatedBefore:function(e,t,i){var s=this.getItemByNode(t);if(s){e.cancelAutoResolve();s.disappear().then(function(){e.fulfill()})}},onDragNDropItemRelocatedAfter:function(e,t,i){var s=this.getItemByNode(t);if(s){e.cancelAutoResolve();s.appear().then(function(){e.fulfill()});this.setItemSortBefore(s,this.getItemByNode(i.before))}},getItemByNode:function(e){var t=null;if(e){var i=BX.data(e,"item-value");if(i){t=this.instances.items.get(i)}}return t},bindDragNDropNode:function(e){if(this.instances.dragNDrop){this.instances.dragNDrop.bindNode(e.scope(),{handle:this.controlAll("item-drag",e.scope())})}},registerItem:function(e){this.bindDragNDropNode(e);this.saveStateInstant()},doMenuAction:function(e,t,i){e.popupWindow.close();var s=i.action;if(s=="dragToggle"){i.layout.text.innerHTML=BX.message("TASKS_TUFP_DRAG_N_DROP_"+(i.enabled?"ON":"OFF"));i.enabled=!i.enabled;if(i.enabled){this.initDragNDrop()}this.changeCSSFlag("drag-mode-on",i.enabled,this.scope())}else if(s=="saveToAll"){BX.Tasks.confirm(BX.message("TASKS_TUFP_SAVE_TO_ALL_CONFIRM"),null,{isDisposable:true,id:this.code()+"-savetoall-confirm",ctx:this}).then(function(){this.saveState(true)})}},getItem:function(e){var t=new BX.Promise(null,this);var i=this.instances.items.get(e);if(i.data().NO_FIELD_HTML){this.callRemote("this.getFieldHtml",{id:e,entityCode:this.option("entityCode"),entityId:this.option("entityId"),parameters:{INPUT_PREFIX:this.option("inputPrefix"),RELATED_ENTITIES:this.option("relatedEntities")}}).then(function(e){var s="";if(e.isSuccess()){s=e.getData()}else{s='<div class="task-message-label error">'+e.getErrors().getMessages(true).join("<br />")+"</div>"}i.setFieldHtml(s);t.fulfill(i)});i.data().NO_FIELD_HTML=false}else{t.fulfill(i)}return t},unHideField:function(e){var t=BX.data(e,"id");if(BX.type.isNotEmptyString(t)){this.setItemStateDisplay(t,true,true);this.getItem(t).then(function(e){this.instances.items.showItem(e)})}if(this.instances.unHideMenu){this.instances.unHideMenu.hide()}},showActionPopup:function(e){var t=this.option("user");var i=[{action:"dragToggle",enabled:false,text:BX.message("TASKS_TUFP_DRAG_N_DROP_ON"),onclick:this.passCtx(this.doMenuAction)}];if(t.IS_SUPER){i.unshift({action:"saveToAll",text:BX.message("TASKS_TUFP_SAVE_SCHEME_TO_EVERYONE"),onclick:this.passCtx(this.doMenuAction)})}BX.PopupMenu.show(this.id()+"action",e,i,{angle:true,position:"right",offsetLeft:18,offsetTop:0})},canManage:function(){if(!this.option("restriction").MANAGE&&B24){B24.licenseInfoPopup.show(this.code(),BX.message("TASKS_TUFP_LICENSE_TITLE"),"<span>"+BX.message("TASKS_TUFP_LICENSE_BODY")+"</span>");return false}return true},showAddPopup:function(e){if(!this.canManage()){return}var t=[];var i=this.option("typesToCreate");if(BX.type.isPlainObject(i)){for(var s in i){if(i.hasOwnProperty(s)){t.push({code:s,text:i[s],title:i[s],onclick:this.passCtx(this.openAddForm)})}}}BX.PopupMenu.show(this.id()+"add",e,t,{angle:true,closeByEsc:true,position:"top",offsetLeft:40,offsetTop:5})},showUnHideFieldPopup:function(e){var t="";var i=this.subInstance("items").exportItemData();if(!i.count()){return}i.sort([["STATE.S","asc"]]).each(BX.delegate(function(e){if(!e.STATE.D){t+=this.getHTMLByTemplate("menu-item",{LABEL:e.LABEL,ID:e.ID,LABEL_EXT:e.LABEL+(e.MANDATORY?" ("+BX.message("TASKS_TUFP_FIELD_MANDATORY")+")":""),STAR_INVISIBLE:e.MANDATORY?"":"invisible"})}},this));this.control("uhmenu").innerHTML=t;if(!this.instances.unHideMenu){this.instances.unHideMenu=new BX.Tasks.Util.ScrollPanePopup({scope:this.control("un-hide-menu"),maxHeight:300,popupParameters:{angle:true,position:"top",offsetLeft:40,offsetTop:5,noAllPaddings:true}});this.instances.unHideMenu.bindDelegateControl("item","click",this.passCtx(this.unHideField))}this.instances.unHideMenu.show(e)}}});BX.Tasks.Component.UserFieldPanel.ItemSet=BX.Tasks.Util.ItemSet.extend({options:{controlBind:"class",preRendered:true,itemAppearFxSpeed:300,itemDisappearFxSpeed:300},methods:{getItemClass:function(){return BX.Tasks.Component.UserFieldPanel.ItemSet.Item},bindItemActions:function(){this.bindDelegateControl("item-hide","click",this.bindOnItem(this.hideItem));this.bindDelegateControl("item-edit","click",this.bindOnItem(this.enterEditItem));this.bindDelegateControl("item-cancel","click",this.bindOnItem(this.leaveEditItem,this.leaveEditItemNew));this.bindDelegateControl("item-save","click",this.bindOnItem(this.saveItem,this.saveItemNew));this.bindDelegateControl("item-label-edit","keypress",this.bindOnItem(this.itemLabelChanged))},hideItem:function(e){var t=new BX.Promise(null,this);this.fireEvent("item-hide",[t,e.value()]);t.then(function(t){if(t=="hide"){e.disappear()}else if(t=="delete"){this.deleteItem(e.value())}})},showItem:function(e){e.appear()},enterEditItem:function(e){if(this.parent()&&!this.parent().canManage()){return}e.toggleEditMode(true);e.initForm()},leaveEditItem:function(e){e.toggleEditMode(false)},leaveEditItemNew:function(){if(this.instances.newItem){this.instances.newItem.disappear()}},itemLabelChanged:function(e,t){if(BX.Tasks.Util.isEnter(t)){this.saveItem(e);BX.eventReturnFalse(t)}},saveItem:function(e){if(e.isLoading()){return}e.setLoading(true);e.hideErrors();var t=new BX.Promise(null,this);this.fireEvent("item-save",[t,e.value(),e.getFormData()]);t.then(function(t){e.setLoading(false);e.update({LABEL:t.LABEL,MANDATORY:t.MANDATORY!="0"});e.toggleEditMode(false)},function(t){e.setLoading(false);e.showErrors(t)})},saveItemNew:function(){if(this.instances.newItem){var e=this.instances.newItem;if(e.isLoading()){return}e.setLoading(true);e.hideErrors();var t=new BX.Promise(null,this);this.fireEvent("item-save",[t,0,e.getFormData()]);t.then(function(t){e.setLoading(false);e.update({ID:t.ID,FIELD_HTML:t.FIELD_HTML,LABEL:t.LABEL,MULTIPLE:t.MULTIPLE!="0",MANDATORY:t.MANDATORY!="0",STATE:{D:true,S:999999}});e.toggleEditMode(false).then(BX.delegate(function(){this.registerItem(e,{useAppear:false});if(this.parent()){this.parent().registerItem(e)}this.instances.newItem=null},this))},function(t){e.setLoading(false);e.showErrors(t)})}},openAddForm:function(e){var t=BX.message("TASKS_TUFP_NEW_FIELD_"+e.toUpperCase());if(this.instances.newItem){this.instances.newItem.update({USER_TYPE_ID:e,LABEL:t,DISPLAY:t})}else{this.instances.newItem=this.createItem({VALUE:"new",DISPLAY:t,LABEL:t,USER_TYPE_ID:e,MANDATORY:false,MULTIPLE:false,FIELD_HTML:this.getHTMLByTemplate("item-field-stub"),REQUIRED:"",EDIT:"edit",INVISIBLE:"invisible",DEFACEABLE:"defaceable",DISPLAY_MULTIPLE:"0"});BX.append(this.instances.newItem.scope(),this.control("new-item-place"));this.instances.newItem.toggleEditMode(true,true)}this.instances.newItem.initForm();if(!this.instances.newItem.isShown()){this.instances.newItem.appear()}}}});BX.Tasks.Component.UserFieldPanel.ItemSet.Item=BX.Tasks.Util.ItemSet.Item.extend({options:{controlBind:"class"},methods:{toggleEditMode:function(e,t){this.changeCSSFlag("edit",e);var i=new BX.Promise(null,this);var s=this.control("form-place");if(t){this.changeCSSFlag("invisible",!e,s);i.fulfill()}else{BX.Tasks.Util.fadeSlideToggleByClass(s).then(function(){i.fulfill()})}if(e){this.initForm()}return i},initForm:function(){var e=this.data();var t=this.control("multiple-edit");this.control("label-edit").value=e.DISPLAY;this.control("required-edit").checked=e.MANDATORY;t.checked=e.MULTIPLE;var i=parseInt(e.VALUE)||e.USER_TYPE_ID=="boolean";t.disabled=i;BX[i?"addClass":"removeClass"](t.parentNode,"disabled");if(e.USER_TYPE_ID=="boolean"){t.checked=false}this.control("label-edit").focus();this.hideErrors()},getFormData:function(){var e=BX.clone(this.data());e.DISPLAY=e.LABEL=this.control("label-edit").value;e.MANDATORY=this.control("required-edit").checked;e.MULTIPLE=this.control("multiple-edit").checked;return e},update:function(e){var t=this.data();if("LABEL"in e){t.LABEL=t.DISPLAY=e.LABEL}if("MANDATORY"in e){t.MANDATORY=e.MANDATORY}if("MULTIPLE"in e){t.MULTIPLE=e.MULTIPLE}if("FIELD_HTML"in e){t.FIELD_HTML=e.FIELD_HTML}if("USER_TYPE_ID"in e){t.USER_TYPE_ID=e.USER_TYPE_ID}if("STATE"in e){t.STATE=e.STATE}if("ID"in e){this.value(e.ID)}this.redraw()},redraw:function(){this.control("label").innerHTML=BX.util.htmlspecialchars(this.data().LABEL);BX[this.data().MANDATORY?"addClass":"removeClass"](this.scope(),"required");this.scope().setAttribute("data-type",this.data().USER_TYPE_ID);this.scope().setAttribute("data-multiple",this.data().MULTIPLE?"1":"0");this.scope().setAttribute("data-item-value",this.data().VALUE);this.setFieldHtml(this.data().FIELD_HTML);delete this.data().FIELD_HTML},value:function(e){if(e){this.data().ID=e}return this.callMethod(BX.Tasks.Util.ItemSet.Item,"value",arguments)},isLoading:function(){return!!this.vars.actionInProgress},setLoading:function(e){this.vars.actionInProgress=e;if(!this.vars.loading){this.vars.loading=BX.Tasks.Util.delay(function(){BX.addClass(this.control("save"),"webform-small-button-wait")},function(){BX.removeClass(this.control("save"),"webform-small-button-wait")},300,this)}if(e){this.vars.loading.call(this)}else{this.vars.loading.cancel()}},setFieldHtml:function(e){if(!e){return}e=e.replace(new RegExp("/bitrix/js/main/core/images/calendar-icon.gif","g"),"/bitrix/js/tasks/css/images/calendar.png");BX.html(this.control("field-html"),e)},hideErrors:function(){BX.Tasks.Util.hideByClass(this.control("error"))},showErrors:function(e){this.control("error").innerHTML=e.getMessages(true).join("<br />");BX.Tasks.Util.showByClass(this.control("error"))}}});BX.Tasks.Component.UserFieldPanel.ItemSet.Item.prepareData=function(e){e.VALUE=e.ID;e.DISPLAY=e.LABEL;return e}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/tasks.widget.replication/templates/.default/logic.min.js?154412746110947";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.widget.replication/templates/.default/logic.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetReplication!="undefined"){return}var e=BX.Tasks.Util.Widget.extend({sys:{code:"timepicker"},options:{value:"",inputId:"",controlBind:"class"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.bindDelegateControl("display","click",this.openClock.bind(this));this.vars.formatDisplay=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME").replace(BX.message("FORMAT_DATE"),"").replace(":SS","").replace("/SS","").trim());this.vars.formatValue=BX.date.convertBitrixFormat("HH:MI");this.setTime(this.parseTime(this.option("value")));BX.bind(BX(this.option("inputId")),"change",this.passCtx(this.onTimeChange))},openClock:function(){var e="bxShowClock_"+this.option("inputId");if(BX.type.isFunction(window[e])){window[e].call(window)}},onTimeChange:function(e){var t=this.parseTime(e.value);this.setTime(t);this.fireEvent("change",[t])},setTime:function(e){var t=3600*e.h+60*e.m;this.control("display").value=this.dateStampToString(t,this.vars.formatDisplay);this.control("value").value=this.dateStampToString(t,this.vars.formatValue)},parseTime:function(e){var t=e.toString().trim();var a=0;var i=0;var n=t.match(new RegExp("^(\\d{1,2})[^\\d]+(\\d{2})","i"));if(n){a=n[1]?parseInt(n[1]):0;i=n[2]?parseInt(n[2]):0}n=t.match(new RegExp("(am|pm)","i"));var s=n&&n[1];var r=s&&n[1].toLowerCase()=="pm";if(!isNaN(a)&&!isNaN(i)&&(a>=0&&a<=23)&&(i>=0&&i<=59)){if(s){if(r){if(a!=12){a+=12}}else{if(a==12){a=0}}}return{h:a,m:i}}return false},dateStampToString:function(e,t){return BX.date.format(t,new Date(e*1e3),false,true)}}});BX.Tasks.Component.TasksWidgetReplication=BX.Tasks.Component.extend({sys:{code:"replication"},options:{data:false},constants:{PERIOD_DAILY:"daily",PERIOD_WEEKLY:"weekly",PERIOD_MONTHLY:"monthly",PERIOD_YEARLY:"yearly",REPEAT_TILL_ENDLESS:"endless",REPEAT_TILL_TIMES:"times",REPEAT_TILL_DATE:"date",MONDAY:0,TUESDAY:1,THURSDAY:3,SUNDAY:6},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.vars.prevPeriod=this.getCurrentPeriod();this.onPeriodChange()},getStartDate:function(){return this.subInstance("start-date-datepicker",function(){return new BX.Tasks.Util.DatePicker({scope:this.control("start-date-datepicker"),controlBind:"class",displayFormat:"system-short",defaultTime:{H:0,M:0,S:0}})})},getEndDate:function(){return this.subInstance("end-date-datepicker",function(){return new BX.Tasks.Util.DatePicker({scope:this.control("end-date-datepicker"),controlBind:"class",displayFormat:"system-short",defaultTime:{H:0,M:0,S:0}})})},getTime:function(){return this.subInstance("creation-time",function(){return new e({scope:this.control("timepicker"),inputId:this.option("timerId"),value:this.option("data").TIME})})},bindEvents:function(){var e=BX.delegate(this.onUpdateHint,this);this.bindDelegateControl("period-type","change",BX.delegate(this.onPeriodChange,this));this.bindDelegateControl("period-type-option","click",this.passCtx(this.onSetPeriodValue));this.bindDelegateControl("day-type","change",e);BX.bindDelegate(this.scope(),"change",{tag:"select"},e);BX.bindDelegate(this.scope(),"change",{tag:"input",attr:{type:"checkbox"}},e);BX.bindDelegate(this.scope(),"change",{tag:"input",attr:{type:"radio"}},e);BX.Tasks.Util.bindInstantChange(this.control("every-day"),e);BX.Tasks.Util.bindInstantChange(this.control("daily-month-interval"),e);BX.Tasks.Util.bindInstantChange(this.control("every-week"),e);BX.Tasks.Util.bindInstantChange(this.control("monthly-day-num"),e);BX.Tasks.Util.bindInstantChange(this.control("monthly-month-num-1"),e);BX.Tasks.Util.bindInstantChange(this.control("monthly-month-num-2"),e);BX.Tasks.Util.bindInstantChange(this.control("yearly-day-num"),e);BX.Tasks.Util.bindInstantChange(this.control("times"),e);this.getStartDate().bindEvent("change",e);this.getEndDate().bindEvent("change",e);this.getTime().bindEvent("change",e);BX.Tasks.Util.hintManager.bindHelp(this.scope())},getCurrentPeriod:function(){return this.getValueString("period-type")},onSetPeriodValue:function(e){var t=BX.data(e,"type");if(BX.util.in_array(t,[this.PERIOD_DAILY,this.PERIOD_WEEKLY,this.PERIOD_MONTHLY,this.PERIOD_YEARLY])){this.control("period-type").value=t;this.onPeriodChange()}},setConstraintPanelHeight:function(e){var t=this.control("panel-"+e);if(t){var a=BX.pos(t).height;this.control("panel").style.height=a+"px"}},onPeriodChange:function(){var e=this.getCurrentPeriod();this.dropCSSFlags("period-*");this.setCSSFlag("period-"+BX.util.htmlspecialchars(e));if(this.vars.prevPeriod!=e){var t=this.control("panel-"+this.vars.prevPeriod);var a=this.control("panel-"+e);if(t&&a){this.setConstraintPanelHeight(this.vars.prevPeriod);BX.addClass(t,"nodisplay");BX.removeClass(a,"nodisplay");this.setConstraintPanelHeight(e);this.vars.prevPeriod=e}}this.onUpdateHint()},onUpdateHint:function(){var e=this.control("hint");if(!e){return}var t=this.parseTime(this.getValueString("time"));var a={PERIOD:this.getValueString("period-type"),EVERY_DAY:this.getValueInt("every-day"),WORKDAY_ONLY:this.getValueString("day-type"),DAILY_MONTH_INTERVAL:this.getValueInt("daily-month-interval"),EVERY_WEEK:this.getValueInt("every-week"),WEEK_DAYS:this.getWeekDays(-1),MONTHLY_DAY_NUM:this.getValueInt("monthly-day-num"),MONTHLY_MONTH_NUM_1:this.getValueInt("monthly-month-num-1"),MONTHLY_TYPE:this.getCheckedControlValues("monthly-type")[0],MONTHLY_WEEK_DAY_NUM:this.getValueInt("monthly-week-day-num"),MONTHLY_WEEK_DAY:this.getValueInt("monthly-week-day"),MONTHLY_MONTH_NUM_2:this.getValueInt("monthly-month-num-2"),YEARLY_TYPE:this.getCheckedControlValues("yearly-type")[0],YEARLY_DAY_NUM:this.getValueInt("yearly-day-num"),YEARLY_MONTH_1:this.getValueInt("yearly-month-1"),YEARLY_WEEK_DAY_NUM:this.getValueInt("yearly-week-day-num"),YEARLY_WEEK_DAY:this.getValueInt("yearly-week-day"),YEARLY_MONTH_2:this.getValueInt("yearly-month-2"),START_DATE:this.getStartDate().getValue(),END_DATE:this.getEndDate().getValue(),TIME:t==""?"05:00":t,TIMES:this.getValueInt("times"),REPEAT_TILL:this.getRepeatTill()};e.innerHTML=this.makeHintText(a)},makeHintText:function(e){var t=parseInt(this.option("tzOffset"));var a=BX.message("TASKS_TTDP_REPLICATION_HINT_AT_TIME").replace("#TIME#",e.TIME+" (UTC "+(t>0?"+":"")+BX.Tasks.Util.formatTimeAmount(t,"HH:MI")+")");if(e.PERIOD==this.PERIOD_DAILY){var i=e.EVERY_DAY;a+=BX.message("TASKS_TTDP_REPLICATION_DAILY_EXT").replace("#NUMBER#",i>1?" "+i:"").replace("#DAY_TYPE#",e.WORK_DAY=="Y"?" "+BX.message("TASKS_TTDP_REPLICATION_DAILY_WORK"):"");var n=e.DAILY_MONTH_INTERVAL;if(n>0){a+=BX.message("TASKS_TTDP_REPLICATION_HINT_DAILY_MONTH_INTERVAL").replace("#TIMES#",n).replace("#TIMES_PLURAL#",BX.Tasks.Util.getMessagePlural(n,"TASKS_TTDP_REPLICATION_HINT_DAILY_MONTH_INTERVAL"))}}else if(e.PERIOD==this.PERIOD_WEEKLY){var s=e.EVERY_WEEK;a+=BX.message("TASKS_TTDP_REPLICATION_WEEKLY_EXT").replace("#NUMBER#",s>1?" "+s:"");var r="";if(e.WEEK_DAYS.length==7){r=BX.message("TASKS_TTDP_REPLICATION_EVERY_DAY")}else{r=[];for(var T=0;T<e.WEEK_DAYS.length;T++){r.push(BX.message("TASKS_TTDP_REPLICATION_WD_"+e.WEEK_DAYS[T]))}r=r.join(", ")}a+=" ("+r+")"}else if(e.PERIOD==this.PERIOD_MONTHLY){if(e.MONTHLY_TYPE==1){var s=e.MONTHLY_DAY_NUM;var o=e.MONTHLY_MONTH_NUM_1;a+=BX.message("TASKS_TTDP_REPLICATION_MONTHLY_EXT_TYPE_1").replace("#DAY_NUMBER#",s).replace("#MONTH_NUMBER#",o>1?" "+o:"")}else{var _=this.getWeekDayGender(e.MONTHLY_WEEK_DAY);var l=this.getWeekDayName(e.MONTHLY_WEEK_DAY);var s=BX.message("TASKS_TTDP_REPLICATION_NUMBER_"+e.MONTHLY_WEEK_DAY_NUM+_);var E=BX.message("TASKS_TTDP_REPLICATION_EACH"+this.getWeekDayGender(e.MONTHLY_WEEK_DAY));var o=e.MONTHLY_MONTH_NUM_2;a+=BX.message("TASKS_TTDP_REPLICATION_MONTHLY_EXT_TYPE_2").replace("#EACH#",E).replace("#DAY_NUMBER#",s).replace("#WEEKDAY_NAME#",l).replace("#MONTH_NUMBER#",o>1?" "+o:"")}}else{if(e.YEARLY_TYPE==1){var s=e.YEARLY_DAY_NUM;var h=BX.message("TASKS_TTDP_REPLICATION_MONTH_"+e.YEARLY_MONTH_1);a+=BX.message("TASKS_TTDP_REPLICATION_YEARLY_EXT_TYPE_1").replace("#DAY_NUMBER#",s).replace("#MONTH_NAME#",h)}else{var _=this.getWeekDayGender(e.YEARLY_WEEK_DAY);var l=this.getWeekDayName(e.YEARLY_WEEK_DAY);var s=BX.message("TASKS_TTDP_REPLICATION_NUMBER_"+e.YEARLY_WEEK_DAY_NUM+_);var E=BX.message("TASKS_TTDP_REPLICATION_EACH"+this.getWeekDayGender(e.YEARLY_WEEK_DAY));var h=BX.message("TASKS_TTDP_REPLICATION_MONTH_"+e.YEARLY_MONTH_2);a+=BX.message("TASKS_TTDP_REPLICATION_YEARLY_EXT_TYPE_2").replace("#EACH#",E).replace("#DAY_NUMBER#",s).replace("#WEEKDAY_NAME#",l).replace("#MONTH_NAME#",h)}}var A="";var I=e.TIMES;if(e.START_DATE!=""){var c=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),BX.parseDate(e.START_DATE,true),false,true);A+=BX.message("TASKS_TTDP_REPLICATION_HINT_START_CONSTRAINT").replace("#DATETIME#",c)}else{A+=BX.message("TASKS_TTDP_REPLICATION_HINT_START_CONSTRAINT_NONE")}var g=this.getRepeatTill();var u=true;if(e.END_DATE!=""&&g==this.REPEAT_TILL_DATE){var N=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),BX.parseDate(e.END_DATE,true),false,true);A+=BX.message("TASKS_TTDP_REPLICATION_HINT_END_CONSTRAINT").replace("#DATETIME#",N);u=false}else if(I>0&&g==this.REPEAT_TILL_TIMES){A+=BX.message("TASKS_TTDP_REPLICATION_HINT_END_CONSTRAINT_TIMES").replace("#TIMES#",I).replace("#TIMES_PLURAL#",BX.Tasks.Util.getMessagePlural(I,"TASKS_TTDP_REPLICATION_HINT_END_CONSTRAINT_TIMES"));u=false}if(u){A+=BX.message("TASKS_TTDP_REPLICATION_HINT_END_CONSTRAINT_NONE")}return BX.message("TASKS_TTDP_REPLICATION_HINT_BASE").replace("#CONDITION#",a).replace("#CONSTRAINT#",A)},getWeekDayName:function(e){var t=this.getWeekDayGender(e);return BX.message("TASKS_TTDP_REPLICATION_WD_"+e+(t=="_F"?"_ALT":""))},getValueString:function(e){var t=this.control(e);if(BX.type.isElementNode(t)){return BX.util.htmlspecialchars(t.value.toString())}return""},getValueInt:function(e){var t=this.control(e);if(BX.type.isElementNode(t)){var a=parseInt(t.value.toString());if(isNaN(a)){return 0}return a}return 0},getCheckedControlValues:function(e){var t=[];var a=this.controlAll(e);for(var i in a){if(a[i].checked){t.push(a[i].value)}}return t},parseTime:function(e){e=e.toString().replace(/^\s+/,"").replace(/\s+$/,"");if(e.length>0){var t=e.match(/^(\d{1,2}):(\d{1,2})$/);if(t===null){return""}var a=parseInt(t[1]);var i=parseInt(t[2]);if(a>23||i>59){return""}var n=function(e){e=e.toString();if(e.length==1){return"0"+e}return e};return n(a)+":"+n(i)}return e},getRepeatTill:function(){var e=this.getCheckedControlValues("repeat-till");if(typeof e[0]=="undefined"){return this.REPEAT_TILL_ENDLESS}return e[0]},getWeekDays:function(e){var t=this.getCheckedControlValues("week-days");if(t.length==0){t.push(this.MONDAY)}else{for(var a=0;a<t.length;a++){t[a]=parseInt(t[a])+e}}return t},getWeekDayGender:function(e){if(e==this.MONDAY||e==this.TUESDAY||e==this.THURSDAY){return"_M"}if(e==this.SUNDAY){return""}return"_F"}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/tasks.widget.timeestimate/templates/.default/logic.min.js?15441274611134";s:6:"source";s:79:"/bitrix/components/bitrix/tasks.widget.timeestimate/templates/.default/logic.js";s:3:"min";s:83:"/bitrix/components/bitrix/tasks.widget.timeestimate/templates/.default/logic.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/tasks.widget.timeestimate/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetTimeEstimate!="undefined"){return}BX.Tasks.Component.TasksWidgetTimeEstimate=BX.Tasks.Component.extend({sys:{code:"timeestimate"},methods:{bindEvents:function(){var t=this.controlAll("time");for(var e=0;e<t.length;e++){BX.Tasks.Util.bindInstantChange(t[e],this.onChange.bind(this))}this.bindDelegateControl("flag","click",this.passCtx(this.onToggleFlag))},onChange:function(){var t=this.control("hour");var e=this.control("minute");var n=this.control("second");if(!BX.type.isElementNode(n)){return}var a=0;if(BX.type.isElementNode(t)){var s=parseInt(t.value);if(!isNaN(s)){a=s}}var i=0;if(BX.type.isElementNode(e)){var s=parseInt(e.value);if(!isNaN(s)){i=s}}n.value=i*60+a*3600},onToggleFlag:function(t){var e=BX.data(t,"target");if(typeof e!="undefined"&&BX.type.isNotEmptyString(e)){var n=this.control(e);var a=BX.data(t,"yes-value")||"Y";var s=BX.data(t,"no-value")||"N";if(BX.type.isElementNode(n)){n.value=t.checked?a:s}BX.Tasks.Util.fadeToggleByClass(this.control("inputs"),200)}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/tasks.widget.tag.selector/templates/.default/logic.min.js?15441274611457";s:6:"source";s:79:"/bitrix/components/bitrix/tasks.widget.tag.selector/templates/.default/logic.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetTagSelector!="undefined"){return}BX.Tasks.Component.TasksWidgetTagSelector=BX.Tasks.Component.extend({sys:{code:"tag-sel-is"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.subInstance("items",function(){return new this.constructor.Items({scope:this.scope(),data:this.option("data"),preRendered:true})})}}});BX.Tasks.Component.TasksWidgetTagSelector.Items=BX.Tasks.Util.ItemSet.extend({sys:{code:"tag-sel"},options:{controlBind:"class",itemFx:"horizontal",itemFxHoverDelete:true},methods:{bindEvents:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindEvents");BX.addCustomEvent(window,"onTaskTagSelectAlt",this.onTagsChange.bind(this))},onTagsChange:function(t){for(var e=0;e<t.length;e++){var s={NAME:t[e]};this.addItem(s)}this.each(function(e){if(!BX.util.in_array(e.display(),t)){this.deleteItem(e.value())}})},openAddForm:function(t){if(!window.tasksTagsPopUp){BX.debug("tasksTagsPopUp is not defined");return}window.tasksTagsPopUp.popupWindow.setBindElement(t);window.tasksTagsPopUp.showPopup()},extractItemDisplay:function(t){return t.NAME},extractItemValue:function(t){if("VALUE"in t){return t.VALUE}return Math.abs(this.hashCode(t.NAME))},hashCode:function(t){if(!BX.type.isNotEmptyString(t)){return 0}var e=0;for(var s=0;s<t.length;s++){var n=t.charCodeAt(s);if(n>255){n-=848}e=(e<<5)-e+n;e=e&e}return e}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/components/bitrix/tasks.widget.related.selector/templates/.default/logic.min.js?15441274614477";s:6:"source";s:83:"/bitrix/components/bitrix/tasks.widget.related.selector/templates/.default/logic.js";s:3:"min";s:87:"/bitrix/components/bitrix/tasks.widget.related.selector/templates/.default/logic.min.js";s:3:"map";s:87:"/bitrix/components/bitrix/tasks.widget.related.selector/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetRelatedSelector!="undefined"){return}BX.Tasks.Component.TasksWidgetRelatedSelector=BX.Tasks.Component.extend({sys:{code:"task-sel-is"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);var t=this.getManager();t.bindEvent("change",this.onChanged.bind(this));t.bindEvent("selector-discover",this.loadSelector.bind(this));this.setTypes(this.option("types"),true)},onChanged:function(t){if(this.option("inputSpecial")){var e="";if(t[0]){e=this.subInstance("items").get(t[0]).data().ID}this.control("sole-input").value=e}this.fireEvent("change",arguments)},getIdByValue:function(t){var e=this.getManager().get(t);if(e){return e.id()}return null},deselect:function(){this.getManager().unload()},setTypes:function(t,e){this.vars.types=this.vars.types||{};if(!e&&this.vars.types.TASK==t.TASK){return}this.vars.types={};BX.Tasks.each(t,function(t,e){if(e=="TASK"||e=="TASK_TEMPLATE"){this.vars.types[e]=true}}.bind(this));this.changeTypes(t,e)},changeTypes:function(t,e){var s=this.subInstance("items");if(!e){s.unload();if(this.option("inputSpecial")){var n=BX.util.htmlspecialchars(this.option("inputPrefix")+(t.TASK?this.option("inputPostfixTask"):this.option("inputPostfixTaskTemplate")));this.control("sole-input").setAttribute("name",n)}}s.option("selectorCode",this.option(t.TASK?"selectorCodeTask":"selectorCodeTaskTemplate"));s.option("types",t);s.option("path",this.option(t.TASK?"pathTask":"pathTaskTemplate"))},loadSelector:function(t,e){e.cancelAutoResolve();var s=this.subInstance("items");var n=[];s.each(function(t){n.push(t.data().ID)});this.callRemoteTemplate("getSelector",{type:t,parameters:{COMPONENT_PARAMETERS:{MULTIPLE:this.option("max")>1?"Y":"N",NAME:s.option("selectorCode"),VALUE:n}}}).then(function(s){if(s.isSuccess()){var n=this.control("picker-content-"+t.toLowerCase());BX.html(n,s.getData()).then(function(){e.resolve()})}else{e.reject()}}.bind(this))},getManager:function(){return this.subInstance("items",function(){return new this.constructor.ItemManager({scope:this.scope(),data:this.option("data"),preRendered:true})})}}});BX.Tasks.Component.TasksWidgetRelatedSelector.ItemManager=BX.Tasks.PopupItemSet.extend({sys:{code:"task-sel"},options:{controlBind:"class",itemFx:"horizontal",selectorCode:"",itemFxHoverDelete:true,types:{}},methods:{checkSelectorLoaded:function(){return this.instances.selector&&this.instances.selector[this.getType()]},getSelector:function(){var t=new BX.Promise;var e=this.getType();this.instances.selector=this.instances.selector||{};var s=this.option("selectorCode");if(this.checkSelectorLoaded()){t.resolve(this.instances.selector[e])}else{var n=window["O_"+s];var i=function(e,s){this.bindSelectorEvents(s);t.resolve(s);this.instances.selector[e]=s};if(n){i.apply(this,[e,n])}else{var o=new BX.Promise;o.setAutoResolve(false);this.fireEvent("selector-discover",[e,o,this]);o.then(function(){var n=window["O_"+s];if(n){i.apply(this,[e,n])}else{t.reject()}}.bind(this),function(){t.reject()})}}return t},getPickerContainer:function(){return this.control("picker-content-"+this.getType().toLowerCase())},getType:function(){return this.option("types").TASK?"T":"TT"},extractItemDisplay:function(t){if(typeof t.DISPLAY!="undefined"){return t.DISPLAY}if(typeof t.name!="undefined"){return t.name}return t.TITLE},extractItemValue:function(t){t.ID=t.ID||t.id;if("VALUE"in t){return t.VALUE}return this.getType()+t.ID},prepareData:function(t){if(!("URL"in t)){t.URL=this.option("path").toString().replace("#id#",t.ID)}return t},bindSelectorEvents:function(t){BX.addCustomEvent(t,"on-change",BX.delegate(this.itemsChanged,this));if(typeof this.instances.window!="undefined"){BX.addCustomEvent(this.instances.window,"onAfterPopupShow",function(){setTimeout(function(){t.searchInput.focus()},100)})}},deleteItem:function(t,e){if(BX.type.isString(t)){t=this.get(t)}var s=t.data().ID;if(this.callMethod(BX.Tasks.PopupItemSet,"deleteItem",arguments)){if(this.checkSelectorLoaded()){this.getSelector().then(function(t){t.unselect(s)}.bind(this),function(){BX.debug("unable to get selector")})}}},getSelectionDelta:function(){var t=[];var e=[];var s=BX.clone(this.vars.temporalItems);this.each(function(t){var n=t.data().ID;if(!this.vars.temporalItems[n]){e.push(t.value())}else{delete s[n]}}.bind(this));for(var n in s){if(s[n]){t.push(n)}}return{added:t,deleted:e}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/tasks.widget.access/templates/.default/logic.min.js?15441274613384";s:6:"source";s:73:"/bitrix/components/bitrix/tasks.widget.access/templates/.default/logic.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetRights!="undefined"){return}BX.Tasks.Component.TasksWidgetAccess=BX.Tasks.Component.extend({sys:{code:"rights"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);var e=null;BX.Tasks.each(this.option("levels"),function(t){e=t;return false});this.vars.firstLevel=e;this.vars.addedUsersIds=[];this.getManager()},getManager:function(){return this.subInstance("items",function(){return new this.constructor.ItemManager({scope:this.scope(),preRendered:true,data:this.option("data"),parent:this})})}}});BX.Tasks.Component.TasksWidgetAccess.ItemManager=BX.Tasks.Util.ItemSet.extend({sys:{code:"rights-is"},options:{controlBind:"class",useSmartCodeNaming:true},methods:{bindItemActions:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindItemActions");this.bindOnItemEx("i-operation-title","click",this.onItemOperationClick.bind(this))},onItemOperationClick:function(e,t){var s=[];BX.Tasks.each(this.optionP("levels"),function(t){s.push({enabled:true,text:t.TITLE,onclick:this.passCtx(this.doMenuAction),itemRef:e,levelId:t.ID,levelTitle:t.TITLE})}.bind(this));BX.PopupMenu.show(this.id()+"-op-popup-"+e.value(),t,s,{angle:true,position:"right",offsetLeft:40,offsetTop:0})},doMenuAction:function(e,t,s){e.popupWindow.close();this.setItemOperation(s.itemRef,s.levelId,s.levelTitle)},setItemOperation:function(e,t,s){e.data().TASK_ID=t;e.control("operation-title").innerHTML=s;e.control("operation").value=t},extractItemValue:function(e){if("VALUE"in e){return e.VALUE}e.VALUE=this.getRandomHash();return e.VALUE},prepareData:function(e){var t=this.parent().vars.firstLevel;this.setField("ID",e,"");this.setField("TITLE",e,t.TITLE);this.setField("TASK_ID",e,t.ID);this.setField("MEMBER_ID",e,e.id);this.setField("DISPLAY",e,function(e){if("nameFormatted"in e){return BX.util.htmlspecialcharsback(e.nameFormatted)}var t=this.option("nameTemplate");if(t){var s=BX.formatName(e,t,"Y");if(s=="Noname"){s=e.LOGIN||e.login}return s}return e.LOGIN});e.ITEM_SET_INVISIBLE="";return e},openAddForm:function(){this.getSelector().open()},getSelector:function(){return this.subInstance("socnet",function(){var e=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:this.control("open-form"),id:this.id()+"socnet-sel",mode:"user",query:this.parent().getQuery(),useSearch:true,useAdd:false,controlBind:this.option("controlBind"),parent:this,popupOffsetTop:5,popupOffsetLeft:40,lastSelectedContext:"TASKS_RIGHTS"});e.bindEvent("item-selected",this.onSelectorItemSelected.bind(this));return e})},addItem:function(e){var t=e.MEMBER_ID.toString();if(!this.isUserAdded(t)){this.callMethod(BX.Tasks.Util.ItemSet,"addItem",arguments);this.addToAddedUsers(t)}},deleteItem:function(e){var t=this.getItem(e.value());var s=t.opts.data.MEMBER_ID.toString();this.callMethod(BX.Tasks.Util.ItemSet,"deleteItem",arguments);this.deleteFromAddedUsers(s)},onSelectorItemSelected:function(e){e.MEMBER_ID=e.id;delete e.id;this.addItem(e);this.getSelector().close();this.getSelector().deselectItem(e.MEMBER_ID)},isUserAdded:function(e){return this.parent().vars.addedUsersIds.includes(e)},addToAddedUsers:function(e){this.parent().vars.addedUsersIds.push(e)},deleteFromAddedUsers:function(e){var t=this.parent().vars.addedUsersIds.indexOf(e);this.parent().vars.addedUsersIds.splice(t,1)}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/tasks.widget.frame/templates/.default/logic.min.js?15441274614368";s:6:"source";s:72:"/bitrix/components/bitrix/tasks.widget.frame/templates/.default/logic.js";s:3:"min";s:76:"/bitrix/components/bitrix/tasks.widget.frame/templates/.default/logic.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/tasks.widget.frame/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetFrameEditForm!="undefined"){return}BX.Tasks.Component.TasksWidgetFrameEditForm=BX.Tasks.Component.extend({sys:{code:"wfr-edit-form"},methods:{bindEvents:function(){this.bindDelegateControl("toggler","click",this.passCtx(this.onToggleBlock));this.bindDelegateControl("pinner","click",this.passCtx(this.onPinBlock));this.bindDelegateControl("additional-header","click",this.passCtx(this.onToggleAdditionalBlock));this.bindDelegateControl("pin-footer","click",this.onPinFooterClick.bind(this))},onToggleBlock:function(t){var e=BX.data(t,"target");if(typeof e!="undefined"&&BX.type.isNotEmptyString(e)){this.toggleBlock(e).then(function(){this.fireEvent("block-toggle",[e,!BX.hasClass(this.control(e),"invisible")])}.bind(this))}},onToggleAdditionalBlock:function(t){var e=BX.hasClass(t,"opened");BX.toggleClass(t,"opened");var i=this.getState();var n=i.isAllDynamicOpened();var s=i.isAllDynamicClosed();BX.Tasks.each(i.getDynamicBlocks(),function(t){if(t&&!t.PINNED){var e=this.toJsCode(t.CODE)+"-block";if(n){if(t.OPENED){this.toggleBlock(e);t.OPENED=false}}else if(s){if(!t.OPENED){this.toggleBlock(e);t.OPENED=true}}else{if(!t.OPENED){this.toggleBlock(e);t.OPENED=true}}}}.bind(this))},toggleBlock:function(t,e){var i=null;if(BX.type.isElementNode(t)){i=t}else{i=this.control(t)}if(i){return BX.Tasks.Util.fadeSlideToggleByClass(i,400)}return null},onPinBlock:function(t){var e=this.control("chosen-blocks");var i=this.control("unchosen-blocks");if(!BX.type.isElementNode(e)||!BX.type.isElementNode(i)){return}var n=BX.data(t,"target");if(typeof n=="undefined"||!BX.type.isNotEmptyString(n)){return}t=this.control(n);var s=BX.data(t,"block-name");if(!BX.type.isNotEmptyString(s)||!BX.type.isElementNode(t)){return}var o=this.getState().getBlock(s).PINNED;this.getState().set("BLOCKS",s,!o);var a=this.getState().isAllDynamicPinned();if(typeof o!="undefined"){var l=!o;var r=this.control(n+"-place",l?e:i);var c=400;if(r){BX.Tasks.Util.fadeSlideToggleByClass(t,c).then(function(){BX.append(t,r);BX.toggleClass(t,"pinned");if(!a){BX.removeClass(this.control("additional"),"hidden")}return BX.Tasks.Util.fadeSlideToggleByClass(t,c)}.bind(this)).then(function(){if(a){BX.addClass(this.control("additional"),"hidden")}}.bind(this))}else{BX.toggleClass(t,"pinned")}}},onPinFooterClick:function(){var t=!this.getState().getFlag("FORM_FOOTER_PIN");var e=this.control("footer");if(e){BX[t?"addClass":"removeClass"](e,"pinned")}this.getState().set("FLAGS","FORM_FOOTER_PIN",t)},getState:function(){return this.subInstance("state",function(){return new BX.Tasks.Component.TasksWidgetFrameEditForm.State({scope:this.control("state"),parent:this})})},toJsCode:function(t){return t.toString().trim().toLowerCase()},showLoader:function(){BX.addClass(this.control("submit"),"webform-small-button-wait")}}});BX.Tasks.Component.TasksWidgetFrameEditForm.State=BX.Tasks.Util.Widget.extend({sys:{code:"wfr-edit-form-state"},options:{controlBind:"class"},methods:{getBlock:function(t){return this.optionP("state").BLOCKS[t]},getFlag:function(t){return this.optionP("state").FLAGS[t]},getDynamicBlocks:function(){if(!this.vars.dynamic){this.vars.dynamic=[];BX.Tasks.each(this.optionP("state").BLOCKS,function(t){if(t.CATEGORY=="DYNAMIC"){this.vars.dynamic.push(t)}}.bind(this))}return this.vars.dynamic},isAllDynamicPinned:function(){var t=false;var e=this.getDynamicBlocks();BX.Tasks.each(e,function(e){if(!e.PINNED){t=true;return false}});return!t},isAllDynamicOpened:function(){var t=false;var e=this.getDynamicBlocks();BX.Tasks.each(e,function(e){if(!e.OPENED&&!e.PINNED){t=true;return false}});return!t},isAllDynamicClosed:function(){var t=false;var e=this.getDynamicBlocks();BX.Tasks.each(e,function(e){if(e.OPENED&&!e.PINNED){t=true;return false}});return!t},get:function(t,e){if(t=="BLOCKS"){return this.vars.state[t][e].C}if(t=="FLAGS"){return this.vars.state[t][e]}},set:function(t,e,i){if(!BX.type.isNotEmptyString(e)){return}var n=this.optionP("state");if(typeof n[t]=="undefined"){n[t]={}}if(typeof n[t][e]=="undefined"){n[t][e]={}}if(t=="BLOCKS"){n[t][e].PINNED=i}if(t=="FLAGS"){n[t][e]=i}this.sync()},sync:function(){this.parent().callRemoteTemplate("setState",{structure:this.optionP("structure"),value:this.optionP("state")})}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/tasks.task.template/templates/.default/logic.min.js?154412746110251";s:6:"source";s:73:"/bitrix/components/bitrix/tasks.task.template/templates/.default/logic.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksTaskTemplate!="undefined"){return}BX.Tasks.Component.TasksTaskTemplate=BX.Tasks.Component.extend({sys:{code:"task-template-edit"},methods:{bindEvents:function(){if(this.option("isNewUserResponsible")){this.vars.prevResponsibles=[this.option("currentUser")]}this.vars.parentType=!parseInt(this.option("template").BASE_TEMPLATE_ID)&&parseInt(this.option("template").PARENT_ID)?"task":"template";this.vars.currentLock=false;this.bindDelegateControl("flag","click",this.passCtx(this.onToggleFlag));this.bindDelegateControl("pin-footer","click",BX.delegate(this.onPinFooterClick,this));this.bindControl("form","submit",BX.delegate(this.onForumSubmit,this));BX.Tasks.Util.hintManager.bindHelp(this.scope());this.bindNestedControls();BX.addCustomEvent("TaskAjaxError",function(t){BX.Tasks.alert(t)})},toggleReplicationLock:function(t){var e=this.control("flag-replication");if(t){BX.Tasks.Util.disable(e);if(this.isFlagEnabled(e)){this.onToggleFlag(e);e.checked=false}}else{BX.Tasks.Util.enable(e)}BX.data(this.control("hint-replication"),"hint-enabled",t)},toggleBaseTemplateLock:function(t){var e=this.control("hint-base-template");if(t){this.onParentTypeClick(this.control("parent-type-option-task"));BX.addClass(e,"disabled")}else{BX.removeClass(e,"disabled")}BX.data(e,"hint-enabled",t)},switchOption:function(t,e){BX.Tasks.Util.Dispatcher.find(this.id()+"-options").then(function(i){i.switchOption(t,e)}.bind(this))},toggleTypeNewLock:function(t){if(!t&&this.isEditMode()){return}this.switchOption("TPARAM_TYPE",!t)},solveFieldOpLock:function(t,e){if(this.vars.currentLock!=false&&this.vars.currentLock!=t){return}var i=function(){this.toggleReplicationLock(false);this.toggleBaseTemplateLock(false);this.toggleTypeNewLock(false);this.vars.currentLock=false}.bind(this);if(t=="TPARAM_TYPE"){if(e==1){this.toggleReplicationLock(true);this.toggleBaseTemplateLock(true);this.vars.currentLock=t}else{i()}}else if(t=="REPLICATE"){if(e){this.toggleTypeNewLock(true);this.toggleBaseTemplateLock(true);this.vars.currentLock=t}else{i()}}else if(t=="BASE_TEMPLATE_ID"){if(e){this.toggleReplicationLock(true);this.toggleTypeNewLock(true);this.vars.currentLock=t}else{i()}}},processEditorInit:function(){if(!this.isEditMode()){BX.ready(BX.delegate(function(){var t=BX.delegate(this.onFormKeyDown,this);BX.bind(document,"keydown",t);var e=this.option("id");var i=BXHtmlEditor.Get(e);if(i){this.bindEditorEvents(i,t);this.setFocusOnTitle(i,t)}else{BX.addCustomEvent(window,"OnEditorInitedAfter",BX.delegate(function(s){if(s!=null&&s.id==e){this.bindEditorEvents(s,t);this.setFocusOnTitle(i,t)}},this))}},this))}},bindEditorEvents:function(t,e){BX.addCustomEvent(t,"OnIframeKeyup",e);BX.addCustomEvent(t,"OnTextareaKeyup",e)},bindNestedControls:function(){BX.Tasks.Util.Dispatcher.bindEvent(this.id()+"-frame","block-toggle",this.onFrameBlockToggle.bind(this));BX.Tasks.Util.Dispatcher.bindEvent(this.id()+"-responsible","change",this.onResponsibleChange.bind(this));BX.Tasks.Util.Dispatcher.bindEvent(this.id()+"-options","toggle",this.processToggleFlag.bind(this));this.bindDelegateControl("parent-type-option","click",this.passCtx(this.onParentTypeClick));this.getInstanceDispatcher("parent").then(function(t){this.subInstance("parent",t);t.bindEvent("change",this.onParentChange.bind(this))}.bind(this));this.getDeadline();this.getStartDate().bindEvent("change",function(t){this.updateEndDatePlan(t,this.getDuration().getValue())}.bind(this));this.getDuration().bindEvent("change",function(t){this.updateEndDatePlan(this.getStartDate().getValue(),t)}.bind(this))},onFrameBlockToggle:function(t,e){if(e&&t=="se_checklist"){BX.Tasks.Util.Dispatcher.find(this.id()+"-checklist").then(function(t){if(!t.count()){t.openForm()}}.bind(this))}},onResponsibleChange:function(){BX.Tasks.Util.Dispatcher.find(this.id()+"-responsible").then(function(t){if(t.count()>1){BX.Tasks.Util.hintManager.showDisposable(t.scope(),BX.message("TASKS_TASK_TEMPLATE_COMPONENT_TEMPLATE_MULTIPLE_RESPONSIBLE_NOTICE"),"TASK_EDIT_MULTIPLE_RESPONSIBLES")}else{BX.Tasks.Util.hintManager.hide("TASK_EDIT_MULTIPLE_RESPONSIBLES")}}.bind(this))},setFocusOnTitle:function(t){setTimeout(function(){var e=this.control("title");if(e){t.Focus(false);e.focus();e.selectionStart=e.value.length;BX.focus()}}.bind(this),500)},isFlagEnabled:function(t){return t.checked},onToggleFlag:function(t){var e=BX.data(t,"target");if(typeof e!="undefined"&&BX.type.isNotEmptyString(e)){var i=this.control(e);var s=BX.data(t,"flag-name");var n=BX.data(t,"yes-value")||"Y";var a=BX.data(t,"no-value")||"N";if(BX.type.isElementNode(i)){i.value=t.checked?n:a}this.processToggleFlag(s,i.value==n)}},processToggleFlag:function(t,e){if(t=="REPLICATE"){var i=this.control("replication-panel");if(e){BX.Tasks.Util.fadeSlideToggleByClass(i)}else{BX.Tasks.Util.fadeSlideToggleByClass(i)}this.solveFieldOpLock("REPLICATE",e)}else if(t=="ALLOW_TIME_TRACKING"){BX.Tasks.Util.fadeToggleByClass(this.control("timeman-estimate-time"),200)}else if(t=="TPARAM_TYPE"){BX.Tasks.Util.Dispatcher.find(this.id()+"-responsible").then(function(t){if(e){this.vars.prevResponsibles=t.export();t.replaceAll([{ID:0,NAME:BX.message("TASKS_COMMON_NEW_USER"),entityType:"U",URL:"javascript:void(0);"}]);t.readOnly(true)}else{t.replaceAll(this.vars.prevResponsibles);this.vars.prevResponsibles=null;t.readOnly(false)}}.bind(this));this.solveFieldOpLock("TPARAM_TYPE",e)}else if(t==="MATCH_WORK_TIME"){Object.keys(this.instances).forEach(function(t){if(t==="deadline"||t==="start-date"||t==="duration"){var e=this.instances[t];e.updateRealValue(e.getDisplayValue(),e.vars.unit)}},this)}},isEditMode:function(){return this.option("template").ID>0},getDeadline:function(){return this.subInstance("deadline",function(){return new BX.Tasks.Component.TasksTaskTemplate.DurationPicker({scope:this.control("deadline"),unit:this.option("deadline").UNIT,displayValue:this.option("deadline").VALUE,companyWorkTime:this.option("auxData").COMPANY_WORKTIME})})},getStartDate:function(){return this.subInstance("start-date",function(){return new BX.Tasks.Component.TasksTaskTemplate.DurationPicker({scope:this.control("start-date"),unit:this.option("startDate").UNIT,displayValue:this.option("startDate").VALUE,companyWorkTime:this.option("auxData").COMPANY_WORKTIME})})},getDuration:function(){return this.subInstance("duration",function(){return new BX.Tasks.Component.TasksTaskTemplate.DurationPicker({scope:this.control("duration"),unit:this.option("duration").UNIT,displayValue:this.option("duration").VALUE,companyWorkTime:this.option("auxData").COMPANY_WORKTIME})})},updateEndDatePlan:function(t,e){this.control("end-date-input").value=t+e},onForumSubmit:function(t){t=t||window.event;if(this.vars.submitting){BX.PreventDefault(t);return}var e=this.control("csrf");if(e){e.value=BX.bitrix_sessid()}BX.Tasks.Util.Dispatcher.call(this.id()+"-frame","showLoader");this.vars.submitting=true},onParentChange:function(t){var e=this.control("parent-type-task");var i=this.control("parent-type-template");var s=this.subInstance("parent");var n="";if(t.length){n=s.getIdByValue(t[0])}if(this.vars.parentType=="task"){i.value="";e.value=t.length?n:""}else if(this.vars.parentType=="template"){i.value=t.length?n:"";e.value="";this.solveFieldOpLock("BASE_TEMPLATE_ID",!!i.value)}},onParentTypeClick:function(t){var e=BX.data(t,"type");if(BX.hasClass(t,"disabled")){return}this.setCSSMode("type",e,this.control("parent-type"));this.vars.parentType=e;this.getInstanceDispatcher("parent").then(function(t){t.setTypes(e=="task"?{TASK:true}:{TEMPLATE:true})}.bind(this));this.control("parent-type-task").value="";this.control("parent-type-template").value=""},getInstanceDispatcher:function(t){return BX.Tasks.Util.Dispatcher.find(this.id()+"-"+t)}}});BX.Tasks.Component.TasksTaskTemplate.DurationPicker=BX.Tasks.Util.Widget.extend({sys:{code:"dateplanmanager"},options:{controlBind:"class",unit:"mins",displayValue:0,companyWorkTime:false},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.bindDelegateControl("unit-setter","click",this.passCtx(this.onUnitChange));if(typeof this.instances==="undefined"){this.instances={}}this.instances.calendar=false;this.vars.unit=this.option("unit");this.vars.displayValue=this.option("displayValue");this.vars.companyWorkTime=this.option("companyWorkTime");this.vars.realValue=this.calculateRealValue(this.getDisplayValue(),this.getUnit());this.bindDelegateControl("display","keypress",this.onDisplayKeydown.bind(this));this.bindDelegateControl("display","input",this.onDisplayInput.bind(this));this.bindDelegateControl("display","bxchange",this.onDisplayChange.bind(this))},onUnitChange:function(t){var e=BX.data(t,"unit");if(e){this.setCSSMode("mode-unit-selected",e);this.vars.unit=e;this.updateRealValue(this.getDisplayValue(),e)}},updateRealValue:function(t,e){t=this.calculateRealValue(t,e);var i=this.control("value");if(i){i.value=t}this.vars.realValue=t;this.fireEvent("change",[t])},calculateRealValue:function(t,e){t=parseInt(t);if(isNaN(t)){t=0}if(e=="days"){return t*(this.getMatchWorkTime()?this.getWorkDayDuration():86400)}else if(e=="hours"){return t*3600}else{return t*60}},getCalendar:function(){if(this.instances.calendar===false){this.instances.calendar=new BX.Tasks.Calendar(BX.Tasks.Calendar.adaptSettings(this.vars.companyWorkTime))}return this.instances.calendar},getWorkDayDuration:function(){var t=this.getCalendar().getWorkDayDuration();return t>0?t/1e3:86400},getMatchWorkTime:function(){var t=document.getElementsByClassName("js-id-wg-optbar-flag-match-work-time");if(t.length){return t[0].checked}return false},getDisplayValue:function(){return this.vars.displayValue},getValue:function(){return this.vars.realValue},getUnit:function(){return this.vars.unit},onDisplayChange:function(t){t=t||window.event;var e=t.target;if(e.value!=this.vars.displayValue){this.updateRealValue(e.value,this.getUnit());this.vars.displayValue=e.value}},onDisplayKeydown:function(t){t=t||window.event;var e=t.which||t.keyCode;if(event.charCode&&(e<48||e>57)){event.preventDefault()}},onDisplayInput:function(t){t=t||window.event;var e=t.target;e.value=e.value.toString().replace(/[^\d]+/,"")}}})}).call(this);
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?154412746160*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?15441274611848*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?154412738466246*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1544127384814*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?154412740428279*/
; /* /bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.min.js?154412746113856*/
; /* /bitrix/components/bitrix/tasks.widget.member.selector/templates/.default/logic.min.js?15441274613614*/
; /* /bitrix/components/bitrix/tasks.widget.optionbar/templates/.default/logic.min.js?15441274611103*/
; /* /bitrix/components/bitrix/system.field.edit/templates/crm/script.min.js?15441273844535*/
; /* /bitrix/components/bitrix/tasks.userfield.panel/templates/.default/logic.min.js?154412746113857*/
; /* /bitrix/components/bitrix/tasks.widget.replication/templates/.default/logic.min.js?154412746110947*/
; /* /bitrix/components/bitrix/tasks.widget.timeestimate/templates/.default/logic.min.js?15441274611134*/
; /* /bitrix/components/bitrix/tasks.widget.tag.selector/templates/.default/logic.min.js?15441274611457*/
; /* /bitrix/components/bitrix/tasks.widget.related.selector/templates/.default/logic.min.js?15441274614477*/
; /* /bitrix/components/bitrix/tasks.widget.access/templates/.default/logic.min.js?15441274613384*/
; /* /bitrix/components/bitrix/tasks.widget.frame/templates/.default/logic.min.js?15441274614368*/
; /* /bitrix/components/bitrix/tasks.task.template/templates/.default/logic.min.js?154412746110251*/

//# sourceMappingURL=page_2f363e27fa031f648c0ab6c84dd235fd.map.js