; /* /bitrix/js/main/kanban/grid.min.js?154412738414697*/
; /* /bitrix/js/main/kanban/column.min.js?154412738424962*/
; /* /bitrix/js/main/kanban/item.min.js?15441273848264*/
; /* /bitrix/js/main/kanban/dropzone-area.min.js?15441273842627*/
; /* /bitrix/js/main/kanban/dropzone.min.js?15441273845518*/
; /* /bitrix/js/main/kanban/utils.min.js?15441273841475*/

; /* Start:"a:4:{s:4:"full";s:50:"/bitrix/js/main/kanban/grid.min.js?154412738414697";s:6:"source";s:30:"/bitrix/js/main/kanban/grid.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Kanban");BX.Kanban.Grid=function(t){if(!BX.type.isPlainObject(t)){throw new Error("BX.Kanban.Grid: 'options' is not an object.")}this.options=t;if(!BX.type.isDomNode(t.renderTo)){throw new Error("BX.Kanban.Grid: 'renderTo' is not a DOMNode.")}this.renderTo=t.renderTo;this.rendered=false;this.layout={outerContainer:null,innerContainer:null,gridContainer:null,earLeft:null,earRight:null,emptyStub:null,loader:null};this.itemType=this.getItemType(t.itemType);this.columnType=this.getColumnType(t.columnType);this.messages=BX.type.isPlainObject(t.messages)?t.messages:Object.create(null);this.columns=Object.create(null);this.columnsOrder=[];this.items=Object.create(null);this.data=BX.type.isPlainObject(t.data)?t.data:Object.create(null);this.bgColor=BX.Kanban.Utils.isValidColor(t.bgColor)||t.bgColor==="transparent"?t.bgColor:"ffffff";this.earTimer=null;this.firstRenderComplete=null;this.dragMode=BX.Kanban.DragMode.NONE;this.canAddColumn=false;this.canEditColumn=false;this.canSortColumn=false;this.canRemoveColumn=false;this.canAddItem=false;this.canSortItem=false;this.dropZoneArea=new BX.Kanban.DropZoneArea(this,{dropZoneType:t.dropZoneType,dropZoneTimeout:t.dropZoneTimeout});this.data=Object.create(null);this.setData(t.data);this.loadData(t);if(t.events){for(var e in t.events){if(t.events.hasOwnProperty(e)){BX.addCustomEvent(this,e,t.events[e])}}}BX.addCustomEvent(this,"Kanban.Grid:onItemDragStart",BX.delegate(this.onItemDragStart,this));BX.addCustomEvent(this,"Kanban.Grid:onItemDragStop",BX.delegate(this.onItemDragStop,this));BX.addCustomEvent(this,"Kanban.Grid:onColumnDragStart",BX.delegate(this.onColumnDragStart,this));BX.addCustomEvent(this,"Kanban.Grid:onColumnDragStop",BX.delegate(this.onColumnDragStop,this))};BX.Kanban.DragMode={NONE:0,ITEM:1,COLUMN:2};BX.Kanban.Grid.prototype={addColumn:function(t){t=t||{};if(this.getColumn(t.id)!==null){return null}var e=this.getColumnType(t.type);var n=new e(t);if(!(n instanceof BX.Kanban.Column)){throw new Error("Column type must be an instance of BX.Kanban.Column")}n.setGrid(this);this.columns[n.getId()]=n;var i=this.getColumn(t.targetId);var r=BX.util.array_search(i,this.columnsOrder);if(r>=0){this.columnsOrder.splice(r,0,n)}else{this.columnsOrder.push(n)}if(this.isRendered()){if(i){this.getGridContainer().insertBefore(n.render(),i.getContainer())}else{this.getGridContainer().appendChild(n.render())}}return n},removeColumn:function(t){t=this.getColumn(t);if(!t){return false}this.removeColumnItems(t);this.columnsOrder=this.columnsOrder.filter(function(e){return t!==e});delete this.columns[t.getId()];BX.remove(t.getContainer());return true},updateColumn:function(t,e){t=this.getColumn(t);if(!t){return false}t.setOptions(e);t.render();return true},getNextColumnSibling:function(t){var e=this.getColumnIndex(t);var n=this.getColumns();return e!==-1&&n[e+1]?n[e+1]:null},getPreviousColumnSibling:function(t){var e=this.getColumnIndex(t);var n=this.getColumns();return e>0&&n[e-1]?n[e-1]:null},addItem:function(t){t=t||{};var e=this.getColumn(t.columnId);if(!e){return null}var n=this.getItemType(t.type);var i=new n(t);if(!(i instanceof BX.Kanban.Item)){throw new Error("Item type must be an instance of BX.Kanban.Item")}if(this.items[i.getId()]){return null}i.setGrid(this);this.items[i.getId()]=i;var r=this.getItem(t.targetId);e.addItem(i,r);return i},removeItem:function(t){var e=this.getItem(t);if(e){var n=e.getColumn();delete this.items[e.getId()];n.removeItem(e);e.dispose()}return e},removeColumnItems:function(t){t=this.getColumn(t);var e=t.getItems();t.removeItems();e.forEach(function(t){this.removeItem(t)},this)},removeItems:function(){this.getColumns().forEach(function(t){this.removeColumnItems(t)},this)},updateItem:function(t,e){t=this.getItem(t);if(!t){return false}if(BX.Kanban.Utils.isValidId(e.columnId)&&e.columnId!==t.getColumn().getId()){this.moveItem(t,this.getColumn(e.columnId),this.getItem(e.targetId))}var n=["UPDATE",{task:t,options:e}];BX.onCustomEvent(window,"tasksTaskEvent",n);t.setOptions(e);t.render();return true},hideItem:function(t){t=this.getItem(t);if(!t||!t.isVisible()){return false}t.setOptions({visible:false});if(t.isCountable()){t.getColumn().decrementTotal()}t.getColumn().render();return true},unhideItem:function(t){t=this.getItem(t);if(!t||t.isVisible()){return false}t.setOptions({visible:true});if(t.isCountable()){t.getColumn().incrementTotal()}t.getColumn().render();return true},getColumn:function(t){var e=t instanceof BX.Kanban.Column?t.getId():t;return this.columns[e]?this.columns[e]:null},getColumns:function(){return this.columnsOrder},getColumnsCount:function(){return this.columnsOrder.length},getColumnIndex:function(t){t=this.getColumn(t);return BX.util.array_search(t,this.getColumns())},getItem:function(t){var e=t instanceof BX.Kanban.Item?t.getId():t;return this.items[e]?this.items[e]:null},getItemByElement:function(t){if(BX.type.isDomNode(t)&&t.dataset.id&&t.dataset.type==="item"){return this.getItem(t.dataset.id)}return null},getItems:function(){return this.items},getItemType:function(t){var e=BX.Kanban.Utils.getClass(t);if(BX.type.isFunction(e)){return e}return this.itemType||BX.Kanban.Item},getColumnType:function(t){var e=BX.Kanban.Utils.getClass(t);if(BX.type.isFunction(e)){return e}return this.columnType||BX.Kanban.Column},getDropZoneArea:function(){return this.dropZoneArea},getData:function(){return this.data},setData:function(t){if(BX.type.isPlainObject(t)){this.data=t}},getBgColor:function(){return this.bgColor},getBgColorStyle:function(){return this.getBgColor()==="transparent"?this.getBgColor():"#"+this.getBgColor()},getOptions:function(){return this.options},loadData:function(t){var e=this.isRendered();this.setRenderStatus(false);var n=["canAddColumn","canEditColumn","canSortColumn","canRemoveColumn","canAddItem","canSortItem"];n.forEach(function(e){if(BX.type.isBoolean(t[e])){this[e]=t[e]}},this);if(BX.type.isArray(t.columns)){t.columns.forEach(function(t){if(t&&BX.Kanban.Utils.isValidId(t.id)&&this.getColumn(t.id)){this.updateColumn(t.id,t)}else{this.addColumn(t)}},this)}if(BX.type.isArray(t.items)){t.items.forEach(function(t){if(t&&BX.Kanban.Utils.isValidId(t.id)&&this.getItem(t.id)){this.updateItem(t.id,t)}else{this.addItem(t)}},this)}if(BX.type.isArray(t.dropZones)){t.dropZones.forEach(function(t){if(t&&BX.Kanban.Utils.isValidId(t.id)&&this.getDropZoneArea().getDropZone(t.id)){this.getDropZoneArea().updateDropZone(t.id,t)}else{this.getDropZoneArea().addDropZone(t)}},this)}if(e){this.draw()}},draw:function(){var t=document.createDocumentFragment();var e=this.getColumns();for(var n=0;n<e.length;n++){var i=e[n];t.appendChild(i.render())}BX.cleanNode(this.getGridContainer());this.getGridContainer().appendChild(t);this.getDropZoneArea().render();if(!this.isRendered()){this.renderLayout();this.adjustLayout();this.setRenderStatus(true);BX.onCustomEvent(this,"Kanban.Grid:onFirstRender",[this])}else{this.adjustLayout()}this.adjustEmptyStub();BX.onCustomEvent(this,"Kanban.Grid:onRender",[this]);this.firstRenderComplete=true},renderLayout:function(){if(this.getOuterContainer().parentNode){return}var t=this.getInnerContainer();t.appendChild(this.getEmptyStub());t.appendChild(this.getLeftEar());t.appendChild(this.getRightEar());t.appendChild(this.getDropZoneArea().getContainer());t.appendChild(this.getLoader());t.appendChild(this.getGridContainer());var e=this.getOuterContainer();e.appendChild(t);this.renderTo.appendChild(this.getOuterContainer());BX.bind(window,"resize",this.adjustLayout.bind(this));BX.bind(window,"scroll",this.adjustHeight.bind(this))},isRendered:function(){return this.rendered},setRenderStatus:function(t){if(BX.type.isBoolean(t)){this.rendered=t}},getLeftEar:function(){if(this.layout.earLeft){return this.layout.earLeft}this.layout.earLeft=BX.create("div",{attrs:{className:"main-kanban-ear-left"},events:{mouseenter:this.scrollToLeft.bind(this),mouseleave:this.stopAutoScroll.bind(this)}});return this.layout.earLeft},getRightEar:function(){if(this.layout.earRight){return this.layout.earRight}this.layout.earRight=BX.create("div",{attrs:{className:"main-kanban-ear-right"},events:{mouseenter:this.scrollToRight.bind(this),mouseleave:this.stopAutoScroll.bind(this)}});return this.layout.earRight},getRenderToContainer:function(){return this.renderTo},getOuterContainer:function(){if(this.layout.outerContainer){return this.layout.outerContainer}this.layout.outerContainer=BX.create("div",{props:{className:"main-kanban"},style:{backgroundColor:this.getBgColorStyle()}});return this.layout.outerContainer},getInnerContainer:function(){if(this.layout.innerContainer){return this.layout.innerContainer}this.layout.innerContainer=BX.create("div",{props:{className:"main-kanban-inner"},style:{backgroundColor:this.getBgColorStyle()}});return this.layout.innerContainer},getGridContainer:function(){if(this.layout.gridContainer){return this.layout.gridContainer}this.layout.gridContainer=BX.create("div",{props:{className:"main-kanban-grid"},events:{scroll:this.adjustEars.bind(this)}});return this.layout.gridContainer},getEmptyStub:function(){if(this.layout.emptyStub){return this.layout.emptyStub}this.layout.emptyStub=BX.create("div",{attrs:{className:"main-kanban-no-data"},children:[BX.create("div",{attrs:{className:"main-kanban-no-data-inner"},children:[BX.create("div",{attrs:{className:"main-kanban-no-data-image"}}),BX.create("div",{attrs:{className:"main-kanban-no-data-text"},text:this.getMessage("NO_DATA")})]})]});return this.layout.emptyStub},getLoader:function(){if(this.layout.loader){return this.layout.loader}this.layout.loader=BX.create("div",{props:{className:"main-kanban-loader-container"},html:'<svg class="main-kanban-loader-circular" viewBox="25 25 50 50">'+'<circle class="main-kanban-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>'+"</svg>"});return this.layout.loader},adjustLayout:function(){this.adjustWidth();this.adjustHeight();this.adjustEars()},adjustEars:function(){var t=this.getGridContainer();var e=t.scrollLeft;var n=e>0;var i=t.scrollWidth>Math.round(e+t.offsetWidth);this.getOuterContainer().classList[n?"add":"remove"]("main-kanban-left-ear-shown");this.getOuterContainer().classList[i?"add":"remove"]("main-kanban-right-ear-shown")},adjustWidth:function(){this.getOuterContainer().style.width=this.renderTo.offsetWidth+"px"},adjustHeight:function(){var t=this.getOuterContainer();var e=this.getInnerContainer();if(t.getBoundingClientRect().top>=15){var n=document.documentElement.clientHeight-e.getBoundingClientRect().top;e.style.height=n+"px";if(e.classList.contains("main-kanban-fixed")){BX.onCustomEvent(this,"Kanban.Grid:onFixedModeEnd",[this])}t.style.minHeight=document.documentElement.clientHeight+"px";e.style.removeProperty("top");e.style.removeProperty("left");e.style.removeProperty("width");e.classList.remove("main-kanban-fixed")}else{if(!e.classList.contains("main-kanban-fixed")){BX.onCustomEvent(this,"Kanban.Grid:onFixedModeStart",[this])}var i=this.renderTo.getBoundingClientRect();e.style.left=i.left+"px";e.style.width=i.width+"px";e.style.removeProperty("height");e.classList.add("main-kanban-fixed")}},adjustEmptyStub:function(){var t=true;var e=this.getItems();for(var n in e){var i=e[n];if(i.isVisible()){t=false;break}}this.getInnerContainer().classList[t?"add":"remove"]("main-kanban-no-data-mode")},moveItem:function(t,e,n){t=this.getItem(t);e=this.getColumn(e);n=this.getItem(n);if(!t||!e||t===n){return false}var i=t.getColumn();i.removeItem(t);e.addItem(t,n);return true},moveColumn:function(t,e){t=this.getColumn(t);e=this.getColumn(e);if(!t||t===e){return false}var n=BX.util.array_search(t,this.columnsOrder);this.columnsOrder.splice(n,1);var i=BX.util.array_search(e,this.columnsOrder);if(i>=0){this.columnsOrder.splice(i,0,t);if(this.isRendered()){t.getContainer().parentNode.insertBefore(t.getContainer(),e.getContainer())}}else{this.columnsOrder.push(t);if(this.isRendered()){t.getContainer().parentNode.appendChild(t.getContainer())}}return true},canAddColumns:function(){return this.canAddColumn},canEditColumns:function(){return this.canEditColumn},canSortColumns:function(){return this.canSortColumn},canRemoveColumns:function(){return this.canRemoveColumn},canAddItems:function(){return this.canAddItem},canSortItems:function(){return this.canSortItem},scrollToRight:function(){this.earTimer=setInterval(function(){this.getGridContainer().scrollLeft+=10}.bind(this),20)},scrollToLeft:function(){this.earTimer=setInterval(function(){this.getGridContainer().scrollLeft-=10}.bind(this),20)},stopAutoScroll:function(){clearInterval(this.earTimer);jsDD.refreshDestArea()},getDragMode:function(){return this.dragMode},getDragModeCode:function(t){for(var e in BX.Kanban.DragMode){if(BX.Kanban.DragMode[e]===t){return e}}return null},setDragMode:function(t){var e=this.getDragModeCode(t);if(e!==null){this.getOuterContainer().classList.add("main-kanban-drag-mode-"+e.toLowerCase());this.dragMode=t}},resetDragMode:function(){var t=this.getDragModeCode(this.getDragMode());if(t!==null){this.getOuterContainer().classList.remove("main-kanban-drag-mode-"+t.toLowerCase())}this.dragMode=BX.Kanban.DragMode.NONE},onItemDragStart:function(t){this.setDragMode(BX.Kanban.DragMode.ITEM);var e=this.getItems();for(var n in e){e[n].enableDropping()}this.getColumns().forEach(function(t){t.enableDropping()});this.getDropZoneArea().emptyAll();this.getDropZoneArea().show()},onItemDragStop:function(t){this.resetDragMode();this.getDropZoneArea().hide()},onColumnDragStart:function(t){this.setDragMode(BX.Kanban.DragMode.COLUMN)},onColumnDragStop:function(t){this.resetDragMode()},getEventPromise:function(t,e,n,i){var r=[];e=BX.type.isArray(e)?e:[];BX.onCustomEvent(this,t,[r].concat(e));var a=new BX.Promise;var o=a;for(var s=0;s<r.length;s++){a=a.then(r[s])}a.then(BX.type.isFunction(n)?n:null,BX.type.isFunction(i)?i:null);return o},fadeOut:function(){this.getOuterContainer().classList.add("main-kanban-faded")},fadeIn:function(){this.getOuterContainer().classList.remove("main-kanban-faded")},getMessage:function(t){return t in this.messages?this.messages[t]:BX.message("MAIN_KANBAN_"+t)}};BX.Kanban.DragEvent=function(t){this.item=null;this.targetColumn=null;this.targetItem=null;this.action=true};BX.Kanban.DragEvent.prototype={allowAction:function(){this.action=true},denyAction:function(){this.action=false},isActionAllowed:function(){return this.action},setItem:function(t){this.item=t},getItem:function(){return this.item},setTargetItem:function(t){this.targetItem=t},getTargetItem:function(){return this.targetItem},setTargetColumn:function(t){this.targetColumn=t},getTargetColumn:function(){return this.targetColumn}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:52:"/bitrix/js/main/kanban/column.min.js?154412738424962";s:6:"source";s:32:"/bitrix/js/main/kanban/column.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Kanban");BX.Kanban.Column=function(t){t=t||{};if(!BX.Kanban.Utils.isValidId(t.id)){throw new Error("BX.Kanban.Column: 'id' parameter is not valid.")}this.id=t.id;this.name=null;this.color=null;this.data=Object.create(null);this.total=null;this.isTotalFrozen=false;this.canEdit=null;this.canSort=null;this.canRemove=null;this.canAddItem=null;this.droppable=true;this.setOptions(t);this.items=[];this.draftItem=null;this.grid=null;this.page=1;this.layout={container:null,items:null,dragTarget:null,title:null,subTitle:null,subTitleAddButton:null,total:null,name:null,titleArrow:null,color:null,editForm:null,fillColorButton:null,titleTextBox:null,addColumnButton:null,editButton:null,removeButton:null};this.rectArea=null;this.dragColumnOffset=null;this.dragColumnIndex=null;this.dragTargetColumn=null;this.confirmDialog=null;this.textBoxTimeout=null;this.colorChanged=false;this.pagination=new BX.Kanban.Pagination(this)};BX.Kanban.Column.DEFAULT_COLOR="ace9fb";BX.Kanban.Column.prototype={getId:function(){return this.id},setOptions:function(t){if(!t){return}this.setName(t.name);this.setTotal(t.total);this.setColor(t.color);this.setData(t.data);var e=["canEdit","canSort","canRemove","canAddItem","droppable"];e.forEach(function(e){if(BX.type.isBoolean(t[e])){this[e]=t[e]}},this)},setColor:function(t){if(BX.Kanban.Utils.isValidColor(t)){this.color=t.toLowerCase()}},getColor:function(){return this.color!==null?this.color:BX.Kanban.Column.DEFAULT_COLOR},setGrid:function(t){this.grid=t;BX.onCustomEvent(this,"Kanban.Column:onAddedToGrid",[this])},getGrid:function(){return this.grid},getPagination:function(){return this.pagination},addItem:function(t,e){if(!(t instanceof BX.Kanban.Item)){throw new Error("item must be an instance of BX.Kanban.Item")}t.setColumnId(this.getId());var i=BX.util.array_search(e,this.items);if(i>=0){this.items.splice(i,0,t)}else{this.items.push(t)}if(t.isCountable()){this.incrementTotal()}if(this.getGrid().isRendered()){this.render()}},getItems:function(){return this.items},getItemsCount:function(){return this.items.reduce(function(t,e){return e.isCountable()&&e.isVisible()?t+1:t},0)},getFirstItem:function(t){var e=this.getItems();for(var i=0;i<e.length;i++){var n=e[i];if(n.isVisible()||t===false){return n}}return null},getLastItem:function(t){var e=this.getItems();for(var i=e.length-1;i>=0;i--){var n=e[i];if(n.isVisible()||t===false){return n}}return null},getNextItemSibling:function(t,e){t=this.getGrid().getItem(t);var i=this.getItems();var n=BX.util.array_search(t,i);if(n===-1||!i[n+1]){return null}for(var a=n+1;a<i.length;a++){var o=i[a];if(o.isVisible()||e===false){return o}}return null},getPreviousItemSibling:function(t,e){t=this.getGrid().getItem(t);var i=this.getItems();var n=BX.util.array_search(t,i);if(n===-1||!i[n-1]){return null}for(var a=n-1;a>=0;a--){var o=i[a];if(o.isVisible()||e===false){return o}}return null},removeItem:function(t){var e=false;this.items=this.items.filter(function(i){if(i===t){e=true;return false}return true});if(e){if(t.isCountable()&&t.isVisible()){this.decrementTotal()}if(this.getGrid().isRendered()){this.render()}}},removeItems:function(){this.items=[];this.total=null;BX.cleanNode(this.layout.items);this.render()},setName:function(t){if(BX.type.isNotEmptyString(t)){this.name=t}},getName:function(){return this.name},getData:function(){return this.data},setData:function(t){if(BX.type.isPlainObject(t)){this.data=t}},getGridData:function(){return this.getGrid().getData()},isEditable:function(){return this.canEdit!==null?this.canEdit:this.getGrid().canEditColumns()},isSortable:function(){return this.canSort!==null?this.canSort:this.getGrid().canSortColumns()},isRemovable:function(){return this.canRemove!==null?this.canRemove:this.getGrid().canRemoveColumns()},canAddItems:function(){return this.canAddItem!==null?this.canAddItem:this.getGrid().canAddItems()},getTotal:function(){return this.total!==null?this.total:this.getItemsCount()},incrementTotal:function(t){if(this.total!==null&&this.getGrid().isRendered()&&!this.isTotalFrozen){t=BX.type.isNumber(t)?t:1;this.total=Math.max(this.total+t,this.getItemsCount())}},decrementTotal:function(t){if(this.total!==null&&this.getGrid().isRendered()&&!this.isTotalFrozen){t=BX.type.isNumber(t)?t:1;this.total=Math.max(this.total-t,this.getItemsCount())}},freezeTotal:function(){this.isTotalFrozen=true},unfreezeTotal:function(){this.isTotalFrozen=false},setTotal:function(t){if(BX.type.isNumber(t)&&t>=0){this.total=t}},refreshTotal:function(){if(this.total!==null&&this.total<this.getItemsCount()){this.total=this.getItemsCount();this.renderTitle()}},hasLoading:function(){return this.total!==null&&this.total>this.getItemsCount()},getIndex:function(){return this.getGrid().getColumnIndex(this)},render:function(){var t=this.getTitleContainer();BX.cleanNode(t);t.appendChild(this.renderTitle());if(this.getGrid().canAddColumns()){t.appendChild(this.getAddColumnButton())}var e=this.getSubTitle();BX.cleanNode(e);var i=this.renderSubTitle();if(i!==null){e.appendChild(i)}BX.cleanNode(this.layout.items);var n=true;var a=document.createDocumentFragment();for(var o=0;o<this.items.length;o++){var s=this.items[o];if(s.isVisible()){n=false;a.appendChild(s.renderLayout())}}if(!n){this.layout.items.appendChild(a)}var r=this.getContainer();r.classList[n?"add":"remove"]("main-kanban-column-empty");r.classList[this.isDroppable()?"add":"remove"]("main-kanban-column-droppable");if(this.getGrid().isRendered()){this.getPagination().adjust();this.getGrid().adjustEmptyStub()}BX.onCustomEvent(this,"Kanban.Column:render",[this]);return r},renderTitle:function(){var t=this.getDefaultTitleLayout();var e=BX.Kanban.Utils.isDarkColor(this.getColor());t.classList[e?"add":"remove"]("main-kanban-column-title-dark");this.layout.nameInner.textContent=this.getName();this.layout.total.textContent=this.getTotal();this.layout.color.style.backgroundColor="#"+this.getColor();this.layout.titleArrow.style.background="transparent url(data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%"+"20width%3D%2213%22%20height%3D%2232%22%20viewBox%3D%220%200%2013%2032%22%3E%3Cpath%20fill%3D%22%23"+this.getColor()+"%22%20fill-opacity%3D%221%22%20d%3D%22M0%200h3c2.8%200%204%203%204%203l6%2013-6%2013s-1.06%203-"+"4%203H0V0z%22/%3E%3C/svg%3E) no-repeat";return t},getDefaultTitleLayout:function(){if(this.layout.titleBody){return this.layout.titleBody}var t=this.getCustomTitleButtons();if(BX.type.isDomNode(t)){t=[t]}else if(!BX.type.isArray(t)){t=[]}this.layout.titleBody=BX.create("div",{attrs:{className:"main-kanban-column-title-wrapper"},children:[this.layout.color=BX.create("div",{attrs:{className:"main-kanban-column-title-bg",style:"background: #"+this.getColor()}}),this.layout.info=BX.create("div",{attrs:{className:"main-kanban-column-title-info"},children:[this.layout.name=BX.create("div",{attrs:{className:"main-kanban-column-title-text"},children:[this.getColumnTitle(),this.getTotalItem()]}),this.isEditable()?this.getEditButton():null].concat(t)}),this.isEditable()?this.getEditForm():null,this.layout.titleArrow=BX.create("span",{attrs:{className:"main-kanban-column-title-right"}})]});return this.layout.titleBody},getColumnTitle:function(){return this.layout.nameInner=BX.create("div",{attrs:{className:"main-kanban-column-title-text-inner"}})},getTotalItem:function(){return this.layout.total=BX.create("div",{attrs:{className:"main-kanban-column-total-item"}})},getEditButton:function(){if(this.layout.editButton){return this.layout.editButton}this.layout.editButton=BX.create("div",{attrs:{className:"main-kanban-column-edit"},events:{click:this.switchToEditMode.bind(this)}});return this.layout.editButton},getCustomTitleButtons:function(){return null},getRemoveButton:function(){if(this.layout.removeButton){return this.layout.removeButton}this.layout.removeButton=BX.create("div",{attrs:{className:"main-kanban-column-remove-button"},events:{click:this.handleRemoveButtonClick.bind(this)}});return this.layout.removeButton},getEditForm:function(){if(this.layout.editForm){return this.layout.editForm}this.layout.editForm=BX.create("div",{attrs:{className:"main-kanban-column-title-block-edit"},children:[this.getTitleTextBox(),this.getFillColorButton(),this.isRemovable()?this.getRemoveButton():null]});return this.layout.editForm},getTitleTextBox:function(){if(this.layout.titleTextBox){return this.layout.titleTextBox}this.layout.titleTextBox=BX.create("input",{attrs:{className:"main-kanban-column-title-input-edit",type:"text",placeholder:this.getGrid().getMessage("COLUMN_TITLE_PLACEHOLDER")},events:{blur:this.handleTextBoxBlur.bind(this),keydown:this.handleTextBoxKeyDown.bind(this)}});return this.layout.titleTextBox},getFillColorButton:function(){if(this.layout.fillColorButton){return this.layout.fillColorButton}this.layout.fillColorButton=BX.create("div",{attrs:{className:"main-kanban-column-color"},events:{click:this.showColorPicker.bind(this)}});return this.layout.fillColorButton},switchToEditMode:function(){this.disableDragging();this.getContainer().classList.add("main-kanban-column-edit-mode");this.getTitleTextBox().value=this.getName();this.focusTextBox()},applyEditMode:function(){var t=BX.util.trim(this.getTitleTextBox().value);var e=false;if(t.length>0&&this.getName()!==t){e=true}if(e||this.colorChanged){if(e){this.setName(t)}BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnUpdated",[this]);this.render()}this.colorChanged=false;this.enableDragging();this.getContainer().classList.remove("main-kanban-column-edit-mode")},handleTextBoxBlur:function(t){this.textBoxTimeout=setTimeout(function(){this.applyEditMode();this.textBoxTimeout=null}.bind(this),250)},stopTextBoxBlur:function(){if(this.textBoxTimeout){clearTimeout(this.textBoxTimeout)}},focusTextBox:function(){this.getTitleTextBox().focus()},handleTextBoxKeyDown:function(t){if(t.keyCode===13){this.applyEditMode()}},handleRemoveButtonClick:function(t){this.showRemoveConfirmDialog()},showColorPicker:function(){this.stopTextBoxBlur();this.getColorPicker().open()},getColorPicker:function(){if(this.colorPicker){return this.colorPicker}this.colorPicker=new BX.ColorPicker({bindElement:this.getFillColorButton(),onColorSelected:this.onColorSelected.bind(this),popupOptions:{events:{onPopupClose:this.focusTextBox.bind(this)}}});return this.colorPicker},onColorSelected:function(t){this.setColor(t.substr(1));this.colorChanged=true;this.render()},getConfirmDialog:function(){if(this.confirmDialog){return this.confirmDialog}this.confirmDialog=new BX.PopupWindow("main-kanban-confirm-"+BX.util.getRandomString(5),null,{titleBar:this.getGrid().getMessage("REMOVE_COLUMN_CONFIRM_TITLE"),content:this.getGrid().getMessage("REMOVE_COLUMN_CONFIRM_DESC"),width:400,autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},buttons:[new BX.PopupWindowButton({text:this.getGrid().getMessage("REMOVE_BUTTON"),id:"main-kanban-confirm-remove-button",className:"popup-window-button-create",events:{click:this.handleConfirmButtonClick.bind(this)}}),new BX.PopupWindowButtonLink({text:this.getGrid().getMessage("CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],events:{onPopupClose:function(){this.focusTextBox();this.confirmDialog.destroy();this.confirmDialog=null}.bind(this)}});return this.confirmDialog},handleConfirmButtonClick:function(){var t=this.getConfirmDialog();var e=t.getButton("main-kanban-confirm-remove-button");if(e.getContainer().classList.contains("popup-window-button-wait")){return}e.addClassName("popup-window-button-wait");var i=this.getGrid().getEventPromise("Kanban.Grid:onColumnRemovedAsync",null,function(i){this.getGrid().removeColumn(this);e.removeClassName("popup-window-button-wait");t.close()}.bind(this),function(i){t.setContent(i);e.getContainer().style.display="none"}.bind(this));i.fulfill(this)},showRemoveConfirmDialog:function(){this.stopTextBoxBlur();var t=this.getConfirmDialog();t.show()},handleAddColumnButtonClick:function(t){var e=this.getGrid().addColumn({id:"kanban-new-column-"+BX.util.getRandomString(5),type:"BX.Kanban.DraftColumn",canSort:false,canAddItem:false,droppable:false,targetId:this.getGrid().getNextColumnSibling(this)});e.switchToEditMode()},renderSubTitle:function(){if(this.layout.subTitleAddButton){return this.layout.subTitleAddButton}this.layout.subTitleAddButton=BX.create("div",{attrs:{className:"main-kanban-column-subtitle-box"},children:[this.canAddItems()?BX.create("div",{attrs:{className:"main-kanban-column-add-item-button"},events:{click:this.handleAddItemButtonClick.bind(this)}}):null]});return this.layout.subTitleAddButton},handleAddItemButtonClick:function(t){this.addDraftItem(this.getFirstItem(false))},getDraftItem:function(){return this.draftItem},addDraftItem:function(t){var e="kanban-new-item-"+this.getId();if(this.getGrid().getItem(e)){return null}var i=null;if(t instanceof BX.Kanban.Item&&t.getColumn()===this){i=t}this.draftItem=this.getGrid().addItem({id:e,type:"BX.Kanban.DraftItem",columnId:this.getId(),draggable:false,droppable:false,countable:false,targetId:i});if(this.draftItem){this.draftItem.focusDraftTextArea()}return this.draftItem},removeDraftItem:function(){if(this.draftItem!==null){this.getGrid().removeItem(this.draftItem);this.draftItem=null}},getContainer:function(){if(this.layout.container!==null){return this.layout.container}this.layout.container=BX.create("div",{attrs:{className:"main-kanban-column"},children:[this.getHeader(),this.getBody()]});this.makeDraggable();this.makeDroppable();return this.layout.container},getHeader:function(){if(this.layout.header){return this.layout.header}this.layout.header=BX.create("div",{attrs:{className:"main-kanban-column-header"},children:[this.getTitleContainer(),this.getSubTitle()]});return this.layout.header},getBody:function(){if(this.layout.body){return this.layout.body}this.layout.body=BX.create("div",{attrs:{className:"main-kanban-column-body","data-id":this.getId(),"data-type":"column"},events:{wheel:BX.delegate(this.blockPageScroll,this)},children:[this.getItemsContainer(),this.getDragTarget()]});return this.layout.body},getTitleContainer:function(){if(this.layout.title){return this.layout.title}this.layout.title=BX.create("div",{attrs:{className:"main-kanban-column-title"}});return this.layout.title},getSubTitle:function(){if(!this.layout.subTitle){this.layout.subTitle=BX.create("div",{attrs:{className:"main-kanban-column-subtitle"}})}return this.layout.subTitle},getAddColumnButton:function(){if(this.layout.addColumnButton){return this.layout.addColumnButton}this.layout.addColumnButton=BX.create("div",{attrs:{className:"main-kanban-column-title-add-column"},events:{click:this.handleAddColumnButtonClick.bind(this)}});return this.layout.addColumnButton},getItemsContainer:function(){if(!this.layout.items){this.layout.items=BX.create("div",{attrs:{className:"main-kanban-column-items"}})}return this.layout.items},getDragTarget:function(){if(!this.layout.dragTarget){this.layout.dragTarget=BX.create("div",{attrs:{className:"main-kanban-column-drag-target"}})}return this.layout.dragTarget},blockPageScroll:function(t){var e=this.getBody();if(e.scrollHeight>e.offsetHeight){var i=t.deltaY||t.detail||t.wheelDelta;if(i<0&&e.scrollTop===0){t.preventDefault()}if(i>0&&e.scrollHeight-e.clientHeight-e.scrollTop<=1){t.preventDefault()}}},makeDraggable:function(){if(!this.isSortable()){return}var t=this.getTitleContainer();t.onbxdragstart=BX.delegate(this.onColumnDragStart,this);t.onbxdrag=BX.delegate(this.onColumnDrag,this);t.onbxdragstop=BX.delegate(this.onColumnDragStop,this);this.enableDragging()},makeDroppable:function(){if(!this.isDroppable()){return}var t=this.getBody();t.onbxdestdraghover=BX.delegate(this.onDragEnter,this);t.onbxdestdraghout=BX.delegate(this.onDragLeave,this);t.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);t.onbxdestdragstop=BX.delegate(this.onItemDragEnd,this);jsDD.registerDest(t,40);this.disableDropping()},disableDragging:function(){if(this.isSortable()){jsDD.unregisterObject(this.getTitleContainer())}},enableDragging:function(){if(this.isSortable()){jsDD.registerObject(this.getTitleContainer())}},disableDropping:function(){if(this.isDroppable()){jsDD.disableDest(this.getBody())}},enableDropping:function(){if(this.isDroppable()){jsDD.enableDest(this.getBody())}},isDraggable:function(){return this.isSortable()},isDroppable:function(){return this.droppable},onDragEnter:function(t,e,i){var n=this.getGrid().getItemByElement(t);this.showDragTarget(n.getBodyContainer().offsetHeight)},onDragLeave:function(t,e,i){this.hideDragTarget()},onDragDrop:function(t,e,i){this.hideDragTarget();var n=this.getGrid().getItemByElement(t);var a=new BX.Kanban.DragEvent;a.setItem(n);a.setTargetColumn(this);BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onBeforeItemMoved",[a]);if(!a.isActionAllowed()){return}var o=this.getGrid().moveItem(n,this);if(o){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemMoved",[n,this,null])}},onItemDragEnd:function(t,e,i){this.disableDropping()},onColumnDragStart:function(){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnDragStart",[this]);this.getContainer().classList.add("main-kanban-column-draggable");this.dragColumnOffset=jsDD.start_x-this.getRectArea().left;this.dragColumnIndex=this.getIndex();this.dragTargetColumn=this.dragTargetColumn||this},onColumnDrag:function(t,e){this.getContainer().style.transform="translateX("+(t-this.dragColumnOffset-this.getRectArea().left)+"px)";var i=this.getGrid().getColumns();var n=this.getRectArea().width;for(var a in i){var o=i[a];if(o===this||!o.isSortable()){continue}var s=o.getContainer();var r=o.getRectArea();var l=r.middle;if(t>l&&a>this.dragColumnIndex&&s.style.transform!=="translateX("+-n+"px)"){s.style.transition="300ms";s.style.transform="translateX("+-n+"px)";this.dragTargetColumn=this.getGrid().getNextColumnSibling(o);o.resetRectArea()}if(t<l&&a<this.dragColumnIndex&&s.style.transform!=="translateX("+n+"px)"){s.style.transition="300ms";s.style.transform="translateX("+n+"px)";this.dragTargetColumn=o;o.resetRectArea()}var u=t<l&&a>this.dragColumnIndex&&s.style.transform!==""&&s.style.transform!=="translateX(0px)";var h=t>l&&a<this.dragColumnIndex&&s.style.transform!==""&&s.style.transform!=="translateX(0px)";if(h||u){s.style.transition="300ms";s.style.transform="translateX(0px)";this.dragTargetColumn=u?o:this.getGrid().getNextColumnSibling(o);o.resetRectArea()}}},onColumnDragStop:function(t,e){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnDragStop",[this]);var i=this.getGrid().moveColumn(this,this.dragTargetColumn);if(i){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnMoved",[this,this.getGrid().getNextColumnSibling(this)])}this.getContainer().classList.remove("main-kanban-column-draggable");var n=this.getGrid().getColumns();for(var a in n){var o=n[a];var s=o.getContainer();o.resetRectArea();s.style.removeProperty("transition");s.style.removeProperty("transform")}this.getGrid().adjustEars()},getRectArea:function(){if(!this.rectArea){this.rectArea=BX.pos(this.getContainer());this.rectArea.middle=this.rectArea.left+this.rectArea.width/2}return this.rectArea},resetRectArea:function(){this.rectArea=null},showDragTarget:function(t){this.getContainer().classList.add("main-kanban-column-target-shown");this.getDragTarget().style.height=t+"px"},hideDragTarget:function(){this.getContainer().classList.remove("main-kanban-column-target-shown");this.getDragTarget().style.removeProperty("height")}};BX.Kanban.DraftColumn=function(t){BX.Kanban.Column.apply(this,arguments);this.asyncEventStarted=false;BX.addCustomEvent(this,"Kanban.Column:onAddedToGrid",this.onAddedToGrid.bind(this))};BX.Kanban.DraftColumn.lastColorIndex=-1;BX.Kanban.DraftColumn.prototype={__proto__:BX.Kanban.Column.prototype,constructor:BX.Kanban.DraftColumn,applyEditMode:function(){if(this.asyncEventStarted){return}var t=BX.util.trim(this.getTitleTextBox().value);if(!t.length){t=this.getGrid().getMessage("COLUMN_TITLE_PLACEHOLDER")}this.setName(t);this.getContainer().classList.add("main-kanban-column-disabled");this.getTitleTextBox().disabled=true;this.asyncEventStarted=true;var e=this.getGrid().getEventPromise("Kanban.Grid:onColumnAddedAsync",null,function(t){if(!BX.Kanban.Utils.isValidId(t.targetId)){var e=this.getGrid().getNextColumnSibling(this);if(e){t.targetId=e.getId()}}this.getGrid().removeColumn(this);this.getGrid().addColumn(t)}.bind(this),function(t){this.getGrid().removeColumn(this)}.bind(this));e.fulfill(this)},handleRemoveButtonClick:function(t){this.stopTextBoxBlur();this.getGrid().removeColumn(this)},onAddedToGrid:function(){this.setColor(this.getNextColor())},getNextColor:function(){var t=BX.Kanban.Utils.getDefaultColors();if(!t.length){return null}if(BX.Kanban.DraftColumn.lastColorIndex===-1){var e=this.getGrid().getColumns();for(var i=e.length-1;i>=0;i--){var n=e[i];var a=BX.util.array_search(n.getColor(),t);if(a!==-1){BX.Kanban.DraftColumn.lastColorIndex=a;break}}}BX.Kanban.DraftColumn.lastColorIndex=t[BX.Kanban.DraftColumn.lastColorIndex+1]?BX.Kanban.DraftColumn.lastColorIndex+1:0;return t[BX.Kanban.DraftColumn.lastColorIndex]}};BX.Kanban.Pagination=function(t){this.column=t;this.timer=null;this.page=1;this.loadingInProgress=false;this.layout={topButton:null,bottomButton:null,loader:null};BX.addCustomEvent(t,"Kanban.Column:onAddedToGrid",this.init.bind(this))};BX.Kanban.Pagination.prototype={init:function(){var t=this.getColumn();var e=t.getContainer();var i=t.getBody();e.appendChild(this.getTopButton());e.appendChild(this.getBottomButton());i.appendChild(this.getLoader());var n=BX.delegate(this.adjust,this);BX.bind(i,"scroll",BX.throttle(n,150));BX.bind(window,"scroll",BX.throttle(n,150));BX.addCustomEvent("Kanban.Grid:onFirstRender",n)},adjust:function(){var t=this.getColumn();var e=t.getContainer();var i=t.getBody();var n=i.scrollHeight;var a=i.offsetHeight;var o=i.scrollTop;var s=i.scrollTop>0;var r=n>a+o;e.classList[s?"add":"remove"]("main-kanban-column-top-button-shown");e.classList[r?"add":"remove"]("main-kanban-column-bottom-button-shown");if(e.classList.contains("main-kanban-column-top-button-shown")){this.getTopButton().style.top=this.getColumn().getBody().offsetTop+"px"}jsDD.refreshDestArea();var l=this.getLoader();if(!this.loadingInProgress&&t.hasLoading()&&l.offsetTop<o+a){this.showLoader();this.loadItems()}},loadItems:function(){this.loadingInProgress=true;var t=this.getColumn().getGrid().getEventPromise("Kanban.Grid:onColumnLoadAsync",null,this.onPromiseFulfilled.bind(this),this.onPromiseRejected.bind(this));t.fulfill(this.getColumn())},onPromiseFulfilled:function(t){this.hideLoader();this.processPromiseResult(t)},onPromiseRejected:function(t){this.hideLoader()},processPromiseResult:function(t){if(!BX.type.isArray(t)||!t.length){return}var e=this.getColumn();e.freezeTotal();e.getGrid().setRenderStatus(false);var i=e.getBody().scrollTop;for(var n=0;n<t.length;n++){var a=t[n];e.getGrid().addItem(a)}e.render();e.getBody().scrollTop=i;e.getGrid().setRenderStatus(true);e.unfreezeTotal();e.refreshTotal();this.page++;this.loadingInProgress=false;this.adjust()},getColumn:function(){return this.column},getPage:function(){return this.page},getTopButton:function(){if(this.layout.topButton){return this.layout.topButton}this.layout.topButton=BX.create("div",{attrs:{className:"main-kanban-column-top-button"},events:{mouseenter:BX.delegate(this.scrollUp,this),mouseleave:BX.delegate(this.stopScroll,this)}});return this.layout.topButton},getBottomButton:function(){if(this.layout.bottomButton){return this.layout.bottomButton}this.layout.bottomButton=BX.create("div",{attrs:{className:"main-kanban-column-bottom-button"},events:{mouseenter:BX.delegate(this.scrollDown,this),mouseleave:BX.delegate(this.stopScroll,this)}});return this.layout.bottomButton},getLoader:function(){if(this.layout.loader){return this.layout.loader}this.layout.loader=BX.create("div",{attrs:{className:"main-kanban-loader"},html:'<div class="main-kanban-loader-outer">'+'<div class="main-kanban-loader-inner">'+'<svg class="main-kanban-loader-circle" viewBox="25 25 50 50">'+"<circle "+'class="main-kanban-loader-path" cx="50" cy="50" r="20" fill="none" '+'stroke-width="1" stroke-miterlimit="10"'+"/>"+"</svg>"+"</div>"+"</div>"});return this.layout.loader},showLoader:function(){this.getLoader().classList.add("main-kanban-loader-shown")},hideLoader:function(){this.getLoader().classList.remove("main-kanban-loader-shown")},scrollUp:function(){if(this.getColumn().getGrid().getDragMode()!==BX.Kanban.DragMode.ITEM){return}this.timer=setInterval(BX.delegate(function(){this.getColumn().getBody().scrollTop-=10},this),20)},scrollDown:function(){if(this.getColumn().getGrid().getDragMode()!==BX.Kanban.DragMode.ITEM){return}this.timer=setInterval(BX.delegate(function(){this.getColumn().getBody().scrollTop+=10},this),20)},stopScroll:function(){clearInterval(this.timer)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:49:"/bitrix/js/main/kanban/item.min.js?15441273848264";s:6:"source";s:30:"/bitrix/js/main/kanban/item.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Kanban");BX.Kanban.Item=function(t){if(!BX.type.isPlainObject(t)){throw new Error("BX.Kanban.Item: 'options' is not an object.")}this.options=t;if(!BX.Kanban.Utils.isValidId(t.id)){throw new Error("BX.Kanban.Item: 'id' parameter is not valid.")}this.id=t.id;this.grid=null;this.columnId=null;this.layout={container:null,dragTarget:null,bodyContainer:null};this.dragElement=null;this.draggable=true;this.droppable=true;this.countable=true;this.visible=true;this.data=Object.create(null);this.setOptions(t)};BX.Kanban.Item.prototype={getId:function(){return this.id},getColumnId:function(){return this.columnId},setColumnId:function(t){this.columnId=t},getColumn:function(){if(this.getGrid()){return this.getGrid().getColumn(this.getColumnId())}return null},setGrid:function(t){if(t instanceof BX.Kanban.Grid){this.grid=t}},getGrid:function(){return this.grid},setOptions:function(t){if(!t){return}this.setData(t.data);this.droppable=BX.type.isBoolean(t.droppable)?t.droppable:this.droppable;this.draggable=BX.type.isBoolean(t.draggable)?t.draggable:this.draggable;this.countable=BX.type.isBoolean(t.countable)?t.countable:this.countable;this.visible=BX.type.isBoolean(t.visible)?t.visible:this.visible},getData:function(){return this.data},setData:function(t){if(BX.type.isPlainObject(t)){this.data=t}},isCountable:function(){return this.countable},isVisible:function(){return this.visible},getGridData:function(){return this.getGrid().getData()},renderLayout:function(){var t=this.getBodyContainer();BX.cleanNode(t);t.appendChild(this.render());return this.getContainer()},getContainer:function(){if(this.layout.container!==null){return this.layout.container}this.layout.container=BX.create("div",{attrs:{className:this.grid.firstRenderComplete?"main-kanban-item main-kanban-item-new":"main-kanban-item","data-id":this.getId(),"data-type":"item"},children:[this.getDragTarget(),this.getBodyContainer()]});this.makeDraggable();this.makeDroppable();return this.layout.container},getDragTarget:function(){if(!this.layout.dragTarget){this.layout.dragTarget=BX.create("div",{attrs:{className:"main-kanban-item-drag-target"}})}return this.layout.dragTarget},getDragElement:function(){return this.dragElement},getBodyContainer:function(){if(!this.layout.bodyContainer){this.layout.bodyContainer=BX.create("div",{attrs:{className:"main-kanban-item-wrapper"}})}return this.layout.bodyContainer},render:function(){if(!this.layout.content){this.layout.content=BX.create("div",{props:{className:"main-kanban-item-default"}})}this.layout.content.style.borderLeft="2px solid #"+this.getColumn().getColor();this.layout.content.textContent="#"+this.getId();return this.layout.content},dispose:function(){jsDD.unregisterDest(this.getContainer());jsDD.unregisterObject(this.getContainer())},makeDraggable:function(){if(!this.isDraggable()){return}var t=this.getContainer();t.onbxdragstart=BX.delegate(this.onDragStart,this);t.onbxdrag=BX.delegate(this.onDrag,this);t.onbxdragstop=BX.delegate(this.onDragStop,this);jsDD.registerObject(t)},makeDroppable:function(){if(!this.isDroppable()){return}var t=this.getContainer();t.onbxdestdraghover=BX.delegate(this.onDragEnter,this);t.onbxdestdraghout=BX.delegate(this.onDragLeave,this);t.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);t.onbxdestdragstop=BX.delegate(this.onItemDragEnd,this);jsDD.registerDest(t,30);if(this.getGrid().getDragMode()!==BX.Kanban.DragMode.ITEM){this.disableDropping()}},disableDragging:function(){if(this.isDraggable()){jsDD.unregisterObject(this.getContainer())}},enableDragging:function(){if(this.isDraggable()){jsDD.registerObject(this.getContainer())}},disableDropping:function(){if(this.isDroppable()){jsDD.disableDest(this.getContainer())}},enableDropping:function(){if(this.isDroppable()){jsDD.enableDest(this.getContainer())}},isDraggable:function(){return this.draggable&&this.getGrid().canSortItems()},isDroppable:function(){return this.droppable},onDragStart:function(){this.getContainer().classList.add("main-kanban-item-disabled");if(!this.dragElement){var t=this.getContainer();var e=this.getBodyContainer();this.dragElement=t.cloneNode(true);this.dragElement.style.position="absolute";this.dragElement.style.width=e.offsetWidth+"px";this.dragElement.className="main-kanban-item main-kanban-item-drag";document.body.appendChild(this.dragElement)}BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemDragStart",[this])},onDragStop:function(t,e){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemDragStop",[this]);this.getContainer().classList.remove("main-kanban-item-disabled");BX.remove(this.dragElement);this.dragElement=null},onDrag:function(t,e){if(this.dragElement){this.dragElement.style.left=t+"px";this.dragElement.style.top=e+"px"}},onDragEnter:function(t,e,i){var n=this.getGrid().getItemByElement(t);if(n!==this){this.showDragTarget(n.getBodyContainer().offsetHeight)}},onDragLeave:function(t,e,i){this.hideDragTarget()},onDragDrop:function(t,e,i){this.hideDragTarget();var n=this.getGrid().getItemByElement(t);var a=new BX.Kanban.DragEvent;a.setItem(n);a.setTargetColumn(this.getColumn());a.setTargetItem(this);BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onBeforeItemMoved",[a]);if(!a.isActionAllowed()){return}var r=this.getGrid().moveItem(n,this.getColumn(),this);if(r){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemMoved",[n,this.getColumn(),this])}},onItemDragEnd:function(t,e,i){this.disableDropping()},showDragTarget:function(t){this.getContainer().classList.add("main-kanban-item-target-shown");this.getDragTarget().style.height=t+"px"},hideDragTarget:function(){this.getContainer().classList.remove("main-kanban-item-target-shown");this.getDragTarget().style.removeProperty("height")}};BX.Kanban.DraftItem=function(t){BX.Kanban.Item.apply(this,arguments);this.asyncEventStarted=false;this.draftContainer=null;this.draftTextArea=null};BX.Kanban.DraftItem.prototype={__proto__:BX.Kanban.Item.prototype,constructor:BX.Kanban.DraftItem,render:function(){if(this.draftContainer){return this.draftContainer}this.draftContainer=BX.create("div",{props:{className:"main-kanban-item-draft"},children:[this.getDraftTextArea()]});return this.draftContainer},setGrid:function(t){BX.Kanban.Item.prototype.setGrid.apply(this,arguments);BX.addCustomEvent(this.getGrid(),"Kanban.Grid:onItemDragStart",BX.proxy(this.applyDraftEditMode,this))},getDraftTextArea:function(){if(this.draftTextArea){return this.draftTextArea}this.draftTextArea=BX.create("textarea",{attrs:{className:"main-kanban-item-draft-textarea",placeholder:this.getGrid().getMessage("ITEM_TITLE_PLACEHOLDER")},events:{blur:this.handleDraftTextAreaBlur.bind(this),keydown:this.handleDraftTextAreaKeyDown.bind(this)}});return this.draftTextArea},applyDraftEditMode:function(){if(this.asyncEventStarted){return}this.asyncEventStarted=true;var t=BX.util.trim(this.getDraftTextArea().value);if(!t.length){this.removeDraftItem();return}this.setData({title:t});this.getContainer().classList.add("main-kanban-item-draft-disabled");this.getDraftTextArea().disabled=true;var e=this.getGrid().getEventPromise("Kanban.Grid:onItemAddedAsync",null,this.onItemAddedFulfilled.bind(this),this.onItemAddedRejected.bind(this));e.fulfill(this)},onItemAddedFulfilled:function(t){if(!BX.type.isPlainObject(t)){this.removeDraftItem();return}if(!BX.Kanban.Utils.isValidId(t.targetId)){var e=this.getColumn().getNextItemSibling(this);if(e){t.targetId=e.getId()}}this.removeDraftItem();var i=this.getGrid().addItem(t);if(i&&this.getGrid().getDragMode()===BX.Kanban.DragMode.NONE){var n=this.getGrid().getColumns().some(function(t){return t.getDraftItem()!==null});if(!n){var a=i.getColumn().getNextItemSibling(i);i.getColumn().addDraftItem(a)}}},onItemAddedRejected:function(t){this.removeDraftItem()},removeDraftItem:function(){this.asyncEventStarted=true;BX.removeCustomEvent(this.getGrid(),"Kanban.Grid:onItemDragStart",BX.proxy(this.applyDraftEditMode,this));this.getColumn().removeDraftItem()},focusDraftTextArea:function(){this.getDraftTextArea().focus()},handleDraftTextAreaBlur:function(t){setTimeout(function(){this.applyDraftEditMode()}.bind(this),0)},handleDraftTextAreaKeyDown:function(t){if(t.keyCode===13){this.applyDraftEditMode()}else if(t.keyCode===27){this.removeDraftItem()}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:58:"/bitrix/js/main/kanban/dropzone-area.min.js?15441273842627";s:6:"source";s:39:"/bitrix/js/main/kanban/dropzone-area.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Kanban");BX.Kanban.DropZoneArea=function(e,n){this.dropZoneType=this.getDropZoneType(n.dropZoneType);this.dropZoneTimeout=BX.type.isNumber(n.dropZoneTimeout)&&n.dropZoneTimeout>500?n.dropZoneTimeout:8e3;this.grid=e;this.layout={container:null};this.dropZones=Object.create(null);this.dropZonesOrder=[]};BX.Kanban.DropZoneArea.prototype={getGrid:function(){return this.grid},addDropZone:function(e){e=e||{};if(this.getDropZone(e.id)!==null){return null}var n=this.getDropZoneType(e.type);var t=new n(e);if(!(t instanceof BX.Kanban.DropZone)){throw new Error("DropZone type must be an instance of BX.Kanban.DropZone")}t.setDropZoneArea(this);this.dropZones[t.getId()]=t;var o=this.getDropZone(e.targetId);var r=BX.util.array_search(o,this.dropZonesOrder);if(r>=0){this.dropZonesOrder.splice(r,0,t)}else{this.dropZonesOrder.push(t)}if(this.getGrid().isRendered()){this.render()}return t},updateDropZone:function(e,n){e=this.getDropZone(e);if(!e){return false}e.setOptions(n);e.render();return true},removeDropZone:function(e){var n=this.getDropZone(e);if(n){this.dropZonesOrder=this.dropZonesOrder.filter(function(e){return n!==e});delete this.dropZones[n.getId()];if(this.getGrid().isRendered()){this.render()}}return n},render:function(){var e=document.createDocumentFragment();var n=this.getDropZones();for(var t=0;t<n.length;t++){e.appendChild(n[t].render())}BX.cleanNode(this.getContainer());this.getContainer().appendChild(e)},getDropZone:function(e){var n=e instanceof BX.Kanban.DropZone?e.getId():e;return this.dropZones[n]?this.dropZones[n]:null},getDropZones:function(){return this.dropZonesOrder},getDropZonesCount:function(){return this.dropZonesOrder.length},getDropZoneType:function(e){var n=BX.Kanban.Utils.getClass(e);if(BX.type.isFunction(n)){return n}return this.dropZoneType||BX.Kanban.DropZone},getDropZoneTimeout:function(){return this.dropZoneTimeout},getContainer:function(){if(this.layout.container){return this.layout.container}this.layout.container=BX.create("div",{attrs:{className:"main-kanban-dropzone-area"}});return this.layout.container},emptyAll:function(){this.getDropZones().forEach(function(e){e.empty()})},show:function(){if(this.getDropZonesCount()){this.getContainer().classList.add("main-kanban-dropzone-show")}},hide:function(){this.getDropZones().forEach(function(e){e.unsetActive()});this.getContainer().classList.remove("main-kanban-dropzone-show")},setActive:function(){this.getContainer().classList.add("main-kanban-dropzone-area-active")},unsetActive:function(){this.getContainer().classList.remove("main-kanban-dropzone-area-active")}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:53:"/bitrix/js/main/kanban/dropzone.min.js?15441273845518";s:6:"source";s:34:"/bitrix/js/main/kanban/dropzone.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Kanban");BX.Kanban.DropZone=function(t){t=t||{};if(!BX.Kanban.Utils.isValidId(t.id)){throw new Error("BX.Kanban.DropZone: 'id' parameter is not valid.")}this.id=t.id;this.name=null;this.color=null;this.data=Object.create(null);this.dropZoneArea=null;this.setOptions(t);this.layout={container:null,name:null,bg:null,cancel:null};this.droppedItem=null;this.captureTimeout=null};BX.Kanban.DropZone.DEFAULT_COLOR="1eae43";BX.Kanban.DropZone.prototype={getId:function(){return this.id},setOptions:function(t){if(!t){return}this.setName(t.name);this.setColor(t.color);this.setData(t.data)},setName:function(t){if(BX.type.isNotEmptyString(t)){this.name=t}},getName:function(){return this.name},setColor:function(t){if(BX.Kanban.Utils.isValidColor(t)){this.color=t.toLowerCase()}},getColor:function(){return this.color!==null?this.color:BX.Kanban.DropZone.DEFAULT_COLOR},getData:function(){return this.data},setData:function(t){if(BX.type.isPlainObject(t)){this.data=t}},getGridData:function(){return this.getGrid().getData()},setDropZoneArea:function(t){this.dropZoneArea=t},getDropZoneArea:function(){return this.dropZoneArea},getGrid:function(){return this.getDropZoneArea().getGrid()},makeDroppable:function(){var t=this.getContainer();t.onbxdestdraghover=BX.delegate(this.onDragEnter,this);t.onbxdestdraghout=BX.delegate(this.onDragLeave,this);t.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);jsDD.registerDest(t,10)},setActive:function(){this.getContainer().classList.add("main-kanban-dropzone-active")},unsetActive:function(){this.getContainer().classList.remove("main-kanban-dropzone-active")},setCaptured:function(){this.getContainer().classList.add("main-kanban-dropzone-captured")},unsetCaptured:function(){this.getContainer().classList.remove("main-kanban-dropzone-captured")},onDragEnter:function(t,e,n){this.setActive();this.getDropZoneArea().setActive()},onDragLeave:function(t,e,n){this.unsetActive();this.getDropZoneArea().unsetActive()},onDragDrop:function(t,e,n){var i=this.getGrid().getItemByElement(t);this.captureItem(i);this.getDropZoneArea().unsetActive()},captureItem:function(t){var e=new BX.Kanban.DropZoneEvent;e.setItem(t);e.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemCaptured",[e]);if(!e.isActionAllowed()){return}this.empty();this.droppedItem=t;this.getDropZoneArea().show();this.setCaptured();this.unsetActive();this.animateRemove(t.layout.container);this.getGrid().hideItem(t);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemCaptured",[t,this]);this.captureTimeout=setTimeout(function(){this.empty();this.getDropZoneArea().hide()}.bind(this),this.getDropZoneArea().getDropZoneTimeout())},animateRemove:function(t){this.dropZoneArea.layout.container.parentNode.style.overflow="hidden";setTimeout(function(){this.dropZoneArea.layout.container.parentNode.style.overflow="inherit"}.bind(this),250)},restore:function(){if(this.captureTimeout){clearTimeout(this.captureTimeout)}if(this.droppedItem===null){return}var t=new BX.Kanban.DropZoneEvent;t.setItem(this.droppedItem);t.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemRestored",[t]);if(!t.isActionAllowed()){return}this.unsetActive();this.unsetCaptured();this.getGrid().unhideItem(this.droppedItem);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemRestored",[this.droppedItem,this]);this.droppedItem=null},empty:function(){if(this.captureTimeout){clearTimeout(this.captureTimeout)}if(this.droppedItem===null){return}this.unsetActive();this.unsetCaptured();this.getGrid().removeItem(this.droppedItem);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemEmptied",[this.droppedItem,this]);this.droppedItem=null},getContainer:function(){if(this.layout.container!==null){return this.layout.container}this.layout.container=BX.create("div",{attrs:{className:"main-kanban-dropzone","data-id":this.getId()},children:[this.getNameContainer(),this.getCancelLink(),this.getBgContainer()]});this.makeDroppable();return this.layout.container},getNameContainer:function(){if(!this.layout.name){var t=BX.Kanban.Utils.isDarkColor(this.getColor());this.layout.name=BX.create("div",{attrs:{className:t?"main-kanban-dropzone-title":"main-kanban-dropzone-title main-kanban-dropzone-title-light"}})}return this.layout.name},getCancelLink:function(){if(!this.layout.cancel){this.layout.cancel=BX.create("div",{attrs:{className:"main-kanban-dropzone-cancel"},children:[BX.create("span",{attrs:{className:"main-kanban-dropzone-cancel-link"},events:{click:this.handleCancelClick.bind(this)},html:this.getGrid().getMessage("DROPZONE_CANCEL")})]})}return this.layout.cancel},handleCancelClick:function(t){this.restore();this.getDropZoneArea().hide()},getBgContainer:function(){if(!this.layout.bg){this.layout.bg=BX.create("div",{attrs:{className:"main-kanban-dropzone-bg"}})}return this.layout.bg},render:function(){this.getNameContainer().innerHTML=this.getName();this.getBgContainer().style.backgroundColor="#"+this.getColor();return this.getContainer()}};BX.Kanban.DropZoneEvent=function(t){t=BX.type.isPlainObject(t)||{};this.action=BX.type.isBoolean(t.action)?t.action:true;this.item=null;this.dropZone=null};BX.Kanban.DropZoneEvent.prototype={allowAction:function(){this.action=true},denyAction:function(){this.action=false},isActionAllowed:function(){return this.action},setItem:function(t){this.item=t},getItem:function(){return this.item},setDropZone:function(t){this.dropZone=t},getDropZone:function(){return this.dropZone}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:50:"/bitrix/js/main/kanban/utils.min.js?15441273841475";s:6:"source";s:31:"/bitrix/js/main/kanban/utils.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Kanban");BX.Kanban.Utils={isValidId:function(t){return BX.type.isNumber(t)||BX.type.isNotEmptyString(t)},getClass:function(t){if(!BX.type.isNotEmptyString(t)){return null}var e=null;var r=window;var n=t.split(".");for(var a=0;a<n.length;a++){var o=n[a];if(!r[o]){return null}r=r[o];e=r}return e},isEmptyObject:function(t){for(var e in t){return false}return true},isValidColor:function(t){return BX.type.isNotEmptyString(t)&&t.match(/^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)},getDefaultColors:function(){return["00c4fb","47d1e2","75d900","ffab00","ff5752","468ee5","1eae43"]},isDarkColor:function(t){if(!this.isValidColor(t)){return false}if(t.length===3){t=t.replace(/([a-f0-9])/gi,"$1$1")}t=t.toLowerCase();var e=this.getDefaultColors();if(BX.util.in_array(t,e)){return true}var r=parseInt(t,16);var n=r>>16&255;var a=r>>8&255;var o=r&255;var i=(n*299+a*587+o*114)/1e3;return i<128},showErrorDialog:function(t,e){var r=BX.PopupWindowManager.create("main-kanban-error-dialog",null,{titleBar:BX.message("MAIN_KANBAN_ERROR"),content:"",width:400,autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},contentColor:"white"});r.setContent(t);r.setButtons([new BX.PopupWindowButton({text:e===true?BX.message("MAIN_KANBAN_RELOAD"):BX.message("MAIN_KANBAN_ERROR_CLOSE"),className:"popup-window-button-accept",events:{click:function(){if(e===true){BX.reload()}this.popupWindow.close()}}})]);r.show();return r}}})();
/* End */
;