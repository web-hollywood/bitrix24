
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/sender.letter.edit/templates/.default/script.min.js?15441274502935";s:6:"source";s:73:"/bitrix/components/bitrix/sender.letter.edit/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){BX.namespace("BX.Sender");if(BX.Sender.Letter){return}var t=BX.Sender.Page;var i=BX.Sender.Helper;function s(){this.context=null}s.prototype.init=function(e){this.context=BX(e.containerId);this.actionUri=e.actionUri;this.isFrame=e.isFrame||false;this.prettyDateFormat=e.prettyDateFormat;this.isFrame=e.isFrame||false;this.isSaved=e.isSaved||false;this.isOutside=e.isOutside||false;this.mess=e.mess;this.letterTile=e.letterTile||{};this.templateChangeButton=BX("SENDER_LETTER_BUTTON_CHANGE");this.selectorNode=i.getNode("template-selector",this.context);this.editorNode=i.getNode("letter-editor",this.context);this.titleNode=i.getNode("letter-title",this.context);this.buttonsNode=i.getNode("letter-buttons",this.context);this.templateNameNode=i.getNode("template-name",this.editorNode);this.templateTypeNode=i.getNode("template-type",this.editorNode);this.templateIdNode=i.getNode("template-id",this.editorNode);if(BX.Sender.Template&&BX.Sender.Template.Selector){var s=BX.Sender.Template.Selector;BX.addCustomEvent(s,s.events.templateSelect,this.onTemplateSelect.bind(this));BX.addCustomEvent(s,s.events.selectorClose,this.closeTemplateSelector.bind(this))}if(this.templateChangeButton){BX.bind(this.templateChangeButton,"click",this.showTemplateSelector.bind(this))}if(this.isFrame){i.titleEditor.init({dataNode:this.titleNode,disabled:e.isTemplateShowed,defaultTitle:this.getPatternTitle(this.mess.name)})}t.initButtons();if(this.isFrame&&this.isSaved){top.BX.onCustomEvent(top,"sender-letter-edit-change",[this.letterTile]);BX.Sender.Page.slider.close();if(this.isOutside){BX.UI.Notification.Center.notify({content:this.mess.outsideSaveSuccess,autoHideDelay:5e3})}}};s.prototype.getPatternTitle=function(e){return i.replace(this.mess.patternTitle,{name:e,date:BX.date.format(this.prettyDateFormat)})};s.prototype.onTemplateSelect=function(t){if(this.templateNameNode){this.templateNameNode.textContent=t.name}if(this.templateTypeNode){this.templateTypeNode.value=t.type}if(this.templateIdNode){this.templateIdNode.value=t.code}if(t.dispatch){i.getNodes("dispatch",this.context).forEach(function(e){var i=e.getAttribute("data-code");if(t.dispatch[i]){e.value=t.dispatch[i]}})}this.titleNode.value=this.getPatternTitle(t.name);BX.fireEvent(this.titleNode,"change");this.closeTemplateSelector();e.scrollTo(0,0)};s.prototype.closeTemplateSelector=function(){this.changeDisplayingTemplateSelector(false)};s.prototype.showTemplateSelector=function(){this.changeDisplayingTemplateSelector(true)};s.prototype.changeDisplayingTemplateSelector=function(e){var t="bx-sender-letter-show";var s="bx-sender-letter-hide";i.changeClass(this.selectorNode,t,e);i.changeClass(this.selectorNode,s,!e);i.changeClass(this.editorNode,t,!e);i.changeClass(this.editorNode,s,e);i.changeDisplay(this.templateChangeButton,!e);i.changeDisplay(this.buttonsNode,!e);e?i.titleEditor.disable():i.titleEditor.enable()};BX.Sender.Letter=new s})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/sender.template.selector/templates/.default/script.min.js?15441274503780";s:6:"source";s:79:"/bitrix/components/bitrix/sender.template.selector/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){BX.namespace("BX.Sender.Template");if(BX.Sender.Template.Selector){return}var t=BX.Sender.Helper;function i(){}i.prototype.attributes={button:"data-bx-sender-tmpl-type-btn",close:"data-bx-sender-tmpl-close",item:"data-bx-sender-tmpl-item",items:"data-bx-sender-tmpl-type-items"};i.prototype.events={selectorClose:"close",categorySelect:"category-select",templateSelect:"template-select",templatePreview:"template-preview"};i.prototype.init=function(e){if(!e.containerId){return}this.container=BX(e.containerId);if(!this.container){return}this.mess=e.mess;this.actionUri=e.actionUri;this.ajaxAction=new BX.AjaxAction(this.actionUri);this.previewer=new n({selector:this});this.initGrid(e.grid);this.initControls()};i.prototype.onGridSelect=function(e){this.fireEvent(this.events.templateSelect,[{type:e.data.templateType,code:e.data.templateId,name:e.name,messageFields:e.data.messageFields,segments:e.data.segments,dispatch:e.data.dispatch}])};i.prototype.initGrid=function(e){this.grid=new BX.Sender.TileGrid({templates:{row:t.getNode("tpl-row",this.container),item:t.getNode("tpl-item",this.container),button:t.getNode("tpl-button",this.container)},rows:e.rows,items:e.items,type:e.type,mess:this.mess,container:t.getNode("draw-place",this.container)});BX.addCustomEvent(this.grid,this.grid.events.itemClick,this.onGridSelect.bind(this));this.grid.draw()};i.prototype.initControls=function(){this.closeNode=this.container.querySelector("["+this.attributes.close+"]");BX.bind(this.closeNode,"click",this.close.bind(this));BX.addCustomEvent(this,this.events.templatePreview,this.previewTemplate.bind(this))};i.prototype.fireEvent=function(t,i){BX.onCustomEvent(this,t,i);BX.onCustomEvent(e,"sender-template-selector-"+t,i)};i.prototype.close=function(){this.fireEvent(this.events.selectorClose,[this])};i.prototype.getTemplateRequestingUri=function(e){return this.ajaxAction.getRequestingUri("getTemplate",{lang:e.lang,template_type:e.type,template_id:e.code})};i.prototype.getTemplate=function(e,t){this.ajaxAction.requestHtml({action:"getTemplate",onsuccess:t,data:{lang:e.lang,template_type:e.type,template_id:e.code}})};i.prototype.previewTemplate=function(e){this.previewer.load({uri:this.getTemplateRequestingUri(e),title:e.name,template:e})};function n(e){this.selector=e.selector;this.popup=null;this.iframe=null;this.currentTemplate=null}n.prototype.getPopup=function(){if(this.popup){return this.popup}var e=BX.PopupWindowManager.create("sender-template-selector-preview",null,{titleBar:this.selector.mess.dlgPreviewTitle.replace("%name%",""),autoHide:true,lightShadow:true,closeIcon:true,closeByEsc:true,contentNoPaddings:true,overlay:{backgroundColor:"black",opacity:500}});e.setButtons([new BX.PopupWindowButton({text:this.selector.mess.dlgBtnSelect,className:"popup-window-button-accept",events:{click:this.onSelect.bind(this)}}),new BX.PopupWindowButton({text:this.selector.mess.dlgBtnCancel,events:{click:this.onCancel.bind(this)}})]);var t=BX("sender-template-selector-preview");e.setContent(t.innerHTML);this.popup=e;return this.popup};n.prototype.getFrame=function(){if(this.iframe){return this.iframe}this.iframe=this.getPopup().contentContainer.querySelector("iframe");BX.bind(this.iframe,"load",this.onFrameLoad.bind(this));return this.iframe};n.prototype.onFrameLoad=function(){this.getPopup().show()};n.prototype.onSelect=function(){this.getPopup().close();this.selector.fireEvent(this.selector.events.templateSelect,[this.currentTemplate])};n.prototype.onCancel=function(){this.getPopup().close()};n.prototype.load=function(e){this.getPopup().setTitleBar(this.selector.mess.dlgPreviewTitle.replace("%name%",e.title));this.getFrame().src=e.uri;this.currentTemplate=e.template;this.getPopup().show()};BX.Sender.Template.Selector=new i})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/sender.template.selector/templates/.default/grid.min.js?15441274504882";s:6:"source";s:77:"/bitrix/components/bitrix/sender.template.selector/templates/.default/grid.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(t){BX.namespace("BX.Sender");if(BX.Sender.TileGrid){return}var i=BX.Sender.Helper;function e(t){this.rows=Object.create(null);this.items=Object.create(null);this.buttons=[];this.container=t.container;this.tpls=t.templates;this.type=t.type;this.mess=t.mess;if(!this.tpls){throw new Error("Templates parameter `templates` is not set.")}this.loadData(t)}e.prototype={events:{itemClick:"item-click",itemButtonClick:"item-button-click"},getRow:function(t){return this.rows[t]?this.rows[t]:null},getItem:function(t){return this.items[t]?this.items[t]:null},draw:function(){var t=document.createDocumentFragment();for(var i in this.rows){t.appendChild(this.rows[i].render())}this.container.classList.add("sender-tpl-"+this.type);this.container.appendChild(t)},getItemInRow:function(){return Math.round(this.container.offsetWidth/320)},addRow:function(t){t=t||{};if(this.getRow(t.id)!==null){return}t.tpl=this.tpls.row;t.manager=this;this.rows[t.id]=new n(t)},addItem:function(t){t=t||{};if(this.getItem(t.id)!==null){return}var i=this.getRow(t.rowId);if(i){if(!t.buttons){t.buttons=this.buttons}t.tpl=this.tpls.item;t.tplButton=this.tpls.button;t.manager=this;var e=new s(t);this.items[t.id]=e;i.addItem(e)}},loadData:function(t){if(t.buttons){this.buttons=t.buttons}t.rows.forEach(function(t){this.addRow(t)},this);t.items.forEach(function(t){this.addItem(t)},this)}};function n(t){this.manager=t.manager;this.id=t.id;this.name=t.name;this.items=[];this.tpl=t.tpl;this.showMoreButton=null;this.layout={container:null,items:null,name:null}}n.prototype={addItem:function(t){t.rowId=this.id;this.items.push(t);if(this.layout.container){this.render()}},createLayout:function(){this.layout.container=i.getTemplatedNode(this.tpl,{name:this.name});this.layout.name=i.getNode("row-name",this.layout.container);this.layout.items=i.getNode("row-items",this.layout.container);return this.layout.container},getShowMoreButton:function(){this.showMoreButton=BX.create("div",{attrs:{className:"sender-tpl-item-show-more"},children:[BX.create("div",{attrs:{className:"webform-small-button webform-small-button-transparent"},events:{click:BX.delegate(this.showAllItems,this)},html:this.manager.mess.showMore})]});return this.showMoreButton},showAllItems:function(t){this.layout.container.classList.add("sender-tpl-items-show-all");this.showMoreButton.classList.add("sender-tpl-item-show-hide")},render:function(){if(this.layout.container===null){this.createLayout()}for(var t=0;t<this.items.length;t++){var i=this.items[t];this.layout.items.appendChild(i.render(t))}if(this.items.length>this.manager.getItemInRow()*3+1){this.layout.items.appendChild(this.getShowMoreButton())}return this.layout.container}};function s(t){this.manager=t.manager;this.id=t.id;this.name=t.name||"";this.data=t.data||{};this.rowId=t.rowId;this.description=t.description||"";this.type=t.type||"";this.image=t.image;this.buttons=t.buttons;this.tpl=t.tpl;this.tplButton=t.tplButton;this.hot=t.hot;this.hint=t.hint;this.layout={container:null,title:null,image:null,description:null,buttons:null}}s.prototype={getItemWidth:function(){return 100/this.getItemLengthInRow()},getItemLengthInRow:function(){return Math.round(this.manager.container.offsetWidth/320)},clipDescription:function(){if(this.hot){return this.description.substr(0,40)+"..."}return this.description.substr(0,55)+"..."},initButton:function(t){var e=i.getTemplatedNode(this.tplButton,t);this.layout.buttons.appendChild(e);BX.bind(e,"click",this.onButtonClick.bind(this,t))},onButtonClick:function(t){BX.onCustomEvent(this.manager,this.manager.events.itemButtonClick,[this,t]);if(t.handler){t.handler.apply(this.manager,[this,t])}},onClick:function(){BX.onCustomEvent(this.manager,this.manager.events.itemClick,[this])},render:function(t){this.layout.container=i.getTemplatedNode(this.tpl,{name:this.name,style:"width: "+this.getItemWidth()+"%","image-style":this.image?"background-image: url("+this.image+"); "+"background-size: cover;":"",desc:this.clipDescription()});this.layout.content=i.getNode("item-content",this.layout.container);this.layout.title=i.getNode("item-title",this.layout.container);this.layout.image=i.getNode("item-image",this.layout.container);this.layout.description=i.getNode("item-desc",this.layout.container);this.hot?this.layout.description.classList.add("sender-tpl-item-description-hot"):null;this.description===""?this.layout.container.classList.add("sender-tpl-content-without-description"):null;if(this.hint){this.layout.title.appendChild(BX.UI.Hint.createNode(this.hint))}if(t>this.getItemLengthInRow()*3-1){this.layout.container.classList.add("sender-tpl-item-hidden")}if(this.buttons){this.layout.buttons=i.getNode("item-buttons",this.layout.container);this.buttons.forEach(this.initButton,this)}BX.bind(this.layout.content,"click",this.onClick.bind(this));return this.layout.container}};BX.Sender.TileGrid=e})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/sender.segment.selector/templates/.default/script.min.js?15441274506447";s:6:"source";s:78:"/bitrix/components/bitrix/sender.segment.selector/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.Sender.Segment");if(BX.Sender.Segment.Selector){return}var t=BX.Sender.Helper;function e(t){this.init(t)}e.prototype.init=function(e){this.manager=e.manager;this.id=e.id;this.pathToAdd=e.pathToAdd;this.pathToEdit=e.pathToEdit;this.context=BX(e.containerId);this.actionUri=e.actionUri;this.include=e.include;this.messageCode=e.messageCode;this.mess=e.mess||{searchTitle:""};this.popupContent=t.getNode("popup-content",this.context);this.ajaxAction=new BX.AjaxAction(this.actionUri);this.initSelector();t.hint.init(this.context)};e.prototype.initSelector=function(){this.selector=BX.Sender.UI.TileSelector.getById(this.id);if(!this.selector){throw new Error("Tile selector `"+this.id+"` not found.")}BX.addCustomEvent(this.selector,this.selector.events.buttonSelect,this.onButtonSelect.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonSelectFirst,this.onButtonSelectFirst.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonAdd,this.onButtonAdd.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileClick,this.onTileClick.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileRemove,this.fireChangeCount.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileEdit,this.fireChangeCount.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileAdd,this.fireChangeCount.bind(this));BX.addCustomEvent(this.selector,this.selector.events.input,this.onInput.bind(this));BX.addCustomEvent(this.selector,this.selector.events.search,this.onSearch.bind(this))};e.prototype.onButtonSelect=function(){this.selector.showSearcher(this.mess.searchTitle)};e.prototype.onButtonSelectFirst=function(){var t=this.selector;this.ajaxAction.request({action:"getSegments",onsuccess:function(e){t.setSearcherData(e.list||[])},onfailure:t.hideSearcher.bind(t),data:{include:this.include?"Y":"N",messageCode:this.messageCode}})};e.prototype.onButtonAdd=function(){this.manager.currentAddSelector=this;BX.Sender.Page.open(BX.util.add_url_param(this.pathToAdd,{hidden:"Y"}))};e.prototype.onTileClick=function(t){BX.Sender.Page.open(this.pathToEdit.replace("#id#",t.id))};e.prototype.onInput=function(t){};e.prototype.onSearch=function(t){};e.prototype.getCount=function(t){return this.selector.getTilesData().reduce(function(e,i){return e+(i&&i.count&&i.count[t]?parseInt(i.count[t]):0)},0)};e.prototype.getDuration=function(){return this.selector.getTilesData().reduce(function(t,e){return t+(e&&e.duration?parseInt(e.duration):0)},0)};e.prototype.fireChangeCount=function(){this.fire("change-count")};e.prototype.fire=function(t,e){e=e||{};BX.onCustomEvent(this,t,e)};e.prototype.actualizeTiles=function(t,e){var i=this.selector.getTile(t.id);if(i){this.selector.updateTile(i,t.name,t.data,t.bgcolor,t.color)}else if(e){this.selector.addTile(t.name,t.data,t.id,t.bgcolor,t.color)}};e.prototype.actualize=function(t,e){this.selector.clearSearcher();this.actualizeTiles(t,e)};function i(t){this.init(t)}i.prototype.classNameExcludeBtnActive="sender-segment-selector-link-active";i.prototype.init=function(e){this.id=e.id;this.pathToAdd=e.pathToAdd;this.pathToEdit=e.pathToEdit;this.context=BX(e.containerId);this.actionUri=e.actionUri;this.messageCode=e.messageCode;this.recipientCount=e.recipientCount;this.recipientTypes=e.recipientTypes||[];this.mess=e.mess;this.duration=e.duration||{};this.duration.node=t.getNode("duration",this.context);this.duration.nodeText=t.getNode("duration-text",this.duration.node);this.counter=t.getNode("counter",this.context);this.excludeAddButton=t.getNode("exclude-add-button",this.context);this.excludeRemoveButton=t.getNode("exclude-remove-button",this.context);this.excludeContainer=t.getNode("exclude-container",this.context);this.ajaxAction=new BX.AjaxAction(this.actionUri);this.initSelectors(e);this.initExcludeButtons();if(this.recipientCount===null){this.calculate()}top.BX.addCustomEvent(top,"sender-segment-edit-change",this.onSegmentChange.bind(this));if(BX.Sender.Template&&BX.Sender.Template.Selector){var i=BX.Sender.Template.Selector;BX.addCustomEvent(i,i.events.templateSelect,this.onTemplateSelect.bind(this))}};i.prototype.onTemplateSelect=function(t){if(!t.segments||t.segments.length===0){return}this.selectorInclude.selector.removeTiles();t.segments.forEach(function(t){this.selectorInclude.selector.addTile(t.name,t.data,t.id)},this)};i.prototype.onSegmentChange=function(t){var e=this.currentAddSelector;var i=e===this.selectorInclude;this.selectorInclude.actualize(t,i&&e);this.selectorExclude.actualize(t,!i&&e);this.currentAddSelector=null};i.prototype.initExcludeButtons=function(){BX.bind(this.excludeAddButton,"click",this.onExcludeAddButtonClick.bind(this));BX.bind(this.excludeRemoveButton,"click",this.onExcludeRemoveButtonClick.bind(this))};i.prototype.onExcludeAddButtonClick=function(){t.display.change(this.excludeContainer,true);t.changeClass(this.excludeAddButton,this.classNameExcludeBtnActive,false)};i.prototype.onExcludeRemoveButtonClick=function(){t.display.change(this.excludeContainer,false);t.changeClass(this.excludeAddButton,this.classNameExcludeBtnActive,true);this.selectorExclude.selector.removeTiles()};i.prototype.initSelectors=function(t){this.currentAddSelector=null;var i=BX.clone(t);i.manager=this;i.include=true;i.id="segment-include";this.selectorInclude=new e(i);BX.addCustomEvent(this.selectorInclude,"change-count",this.calculate.bind(this));var n=BX.clone(t);n.manager=this;n.include=false;n.id="segment-exclude";this.selectorExclude=new e(n)};i.prototype.calculate=function(){this.calculateCount();this.calculateDuration()};i.prototype.calculateCount=function(){var e=this.recipientTypes.map(function(t){return this.selectorInclude.getCount(t)},this).reduce(function(t,e){return t+e},0);t.animate.numbers(this.counter,e)};i.prototype.calculateDuration=function(){var e=this.duration.minimalInterval;var i=this.duration.maximalInterval;var n=this.duration.warnInterval;var o;var s=this.selectorInclude.getDuration();if(s<e){o=this.duration.formattedMinimalInterval}else if(s>i){o=this.duration.formattedMaximalInterval}else{s=Math.round(s/e)*e;var c=new Date(Date.now()-s*1e3);o=BX.date.format("Hdiff",c)}this.duration.nodeText.textContent=o;t.changeClass(this.duration.node,"sender-segment-selector-duration-active",true);t.changeClass(this.duration.nodeText,"sender-segment-selector-duration-warn",s>n)};BX.Sender.Segment.SelectorManager=i})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/sender.ui.tile.selector/templates/.default/script.min.js?154412745011203";s:6:"source";s:78:"/bitrix/components/bitrix/sender.ui.tile.selector/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(t){BX.namespace("BX.Sender.UI");if(BX.Sender.UI.TileSelector){return}var e=[];function i(t){this.id=t.id;this.node=t.node;this.data=t.data;this.nameNode=r.getNode("tile-item-name",this.node)}function n(t){this.init(t)}n.prototype.events={containerClick:"container-click",tileClick:"tile-click",tileRemove:"tile-remove",tileEdit:"tile-edit",tileAdd:"tile-add",buttonAdd:"add",buttonSelect:"select",buttonSelectFirst:"select-first",search:"search",input:"input",searcherCategoryClick:"popup-category-click",searcherItemClick:"popup-item-click"};n.getById=function(t){var i=e.filter(function(e){return e.id===t});return i.length>0?i[0]:null};n.getList=function(){return e};n.prototype.init=function(t){this.list=[];this.id=t.id;this.context=BX(t.containerId);this.duplicates=t.duplicates;this.multiple=t.multiple;this.readonly=t.readonly;this.attributeId="data-bx-id";this.attributeData="data-bx-data";this.tileContainer=r.getNode("tile-container",this.context);this.tileTemplate=r.getNode("tile-template",this.context);this.input=r.getNode("tile-input",this.context);this.buttonAdd=r.getNode("tile-add",this.context);this.buttonSelect=r.getNode("tile-select",this.context);if(!this.context||!this.input){return}r.getNodes("tile-item",this.context).forEach(this.initNode.bind(this));if(!this.readonly){this.initEventHandlers()}this.searcher=null;e.push(this)};n.prototype.initEventHandlers=function(){if(this.buttonAdd){BX.bind(this.buttonAdd,"click",this.onButtonAdd.bind(this))}if(this.context){BX.bind(this.context,"click",this.onContainerClick.bind(this))}if(this.buttonSelect){BX.bind(this.buttonSelect,"click",this.onButtonSelect.bind(this));BX.bind(this.tileContainer,"click",this.onButtonSelect.bind(this))}BX.bind(this.input,"input",this.onInput.bind(this));BX.bind(this.input,"blur",this.onInputEnd.bind(this));r.handleKeyEnter(this.input,this.onInputEnd.bind(this))};n.prototype.getSearchInput=function(){return this.input};n.prototype.isSearcherInit=function(){return!!this.searcher};n.prototype.clearSearcher=function(){this.isButtonSelectFired=false;if(this.searcher){this.searcher.hide();this.searcher=null}};n.prototype.hideSearcher=function(){this.searcher.hide()};n.prototype.showSearcher=function(t){if(!this.searcher){this.searcher=new o({id:this.id,caller:this,context:this.context,title:t||""})}this.searcher.filterByName();this.searcher.show()};n.prototype.setSearcherData=function(t){if(!this.searcher){this.showSearcher()}this.searcher.setCategories(t)};n.prototype.initNode=function(t){if(!t){return null}var e=t.getAttribute(this.attributeId);var n=t.getAttribute(this.attributeData);try{n=JSON.parse(n)}catch(t){try{n=JSON.parse(BX.util.htmlspecialcharsback(n))}catch(t){n={}}}var o=new i({id:e,node:t,data:n});if(o.id&&!this.duplicates&&this.findDuplicates(o.id)){o=null;return null}var s=r.getNode("remove",t);if(s){BX.bind(s,"click",this.onRemove.bind(this,o))}BX.bind(t,"click",this.onClick.bind(this,o));this.list.push(o);return o};n.prototype.onRemove=function(t,e){e.preventDefault();e.stopPropagation();this.removeTile(t);return false};n.prototype.onClick=function(t,e){e.preventDefault();e.stopPropagation();this.fire(this.events.tileClick,[t])};n.prototype.removeTiles=function(){var t=this.list;t.forEach(this.removeTile.bind(this))};n.prototype.removeTile=function(t){this.list=BX.util.deleteFromArray(this.list,this.list.indexOf(t));BX.remove(t.node);this.fire(this.events.tileRemove,[t])};n.prototype.getTile=function(t){var e=this.list.filter(function(e){return e.id===t});return e.length>0?e[0]:null};n.prototype.getTilesData=function(){return this.list.map(function(t){return t.data})};n.prototype.getTilesId=function(){return this.list.map(function(t){return t.id}).filter(function(t){return!!t})};n.prototype.getTiles=function(){return this.list};n.prototype.findDuplicates=function(t){var e=this.getTile(t);if(!e){return false}this.removeTile(e)};n.prototype.addTile=function(t,e,i,n,o){if(!t||this.readonly){return null}if(!this.multiple){this.removeTiles();if(this.isSearcherInit()){this.hideSearcher()}}e=e||{};i=i||"";o=o||"";n=n||"";var s=this.tileTemplate;if(!s){return null}s=s.innerHTML;var a="";if(o){a+="color: "+BX.util.htmlspecialchars(o)+"; "}if(n){a+="background-color: "+BX.util.htmlspecialchars(n)+"; "}s=r.replace(s,{id:BX.util.htmlspecialchars(i+""),name:BX.util.htmlspecialchars(t),data:BX.util.htmlspecialchars(JSON.stringify(e)),style:a});var h=document.createElement("div");h.innerHTML=s;h=h.children[0];var l=this.initNode(h);if(!l){return null}this.input.parentNode.insertBefore(h,this.input);this.fire(this.events.tileAdd,[l]);return l};n.prototype.updateTile=function(t,e,i,n,r){if(!t||this.readonly){return null}e=e||null;i=i||null;n=n||null;r=r||null;if(e){t.nameNode.textContent=e}if(i){t.data=i}if(n||n===null){t.node.style.backgroundColor=n}if(r){t.node.style.color=r}this.fire(this.events.tileEdit,[t]);return t};n.prototype.fire=function(t,e){BX.onCustomEvent(this,t,e)};n.prototype.onInput=function(){var t=this.input.value;if(this.searcher&&t.length>0){this.searcher.filterByName(t)}this.fire(this.events.input,[this.input.value])};n.prototype.onInputEnd=function(){var t=this.input.value;this.input.value="";r.changeDisplay(this.input,false);r.changeDisplay(this.buttonSelect,true);this.fire(this.events.search,[t])};n.prototype.onButtonAdd=function(t){t.preventDefault();t.stopPropagation();this.fire(this.events.buttonAdd,[])};n.prototype.onContainerClick=function(){this.fire(this.events.containerClick,[])};n.prototype.onButtonSelect=function(t){t.preventDefault();t.stopPropagation();r.changeDisplay(this.buttonSelect,false);r.changeDisplay(this.input,true);this.input.focus();this.fire(this.events.buttonSelect,[]);if(!this.isButtonSelectFired){this.fire(this.events.buttonSelectFirst,[]);this.isButtonSelectFired=true}};var r={getObjectByKey:function(t,e,i){var n=t.filter(function(t){return t.hasOwnProperty(e)&&t[e]===i});return n.length>0?n[0]:null},getNode:function(t,e){var i=this.getNodes(t,e);return i.length>0?i[0]:null},getNodes:function(t,e){if(!e){return[]}return BX.convert.nodeListToArray(e.querySelectorAll('[data-role="'+t+'"]'))},changeClass:function(t,e,i){if(!t){return}if(i){BX.addClass(t,e)}else{BX.removeClass(t,e)}},changeDisplay:function(t,e){if(!t){return}t.style.display=e?"":"none"},replace:function(t,e,i){e=e||{};i=i||false;if(!t){return""}for(var n in e){if(!e.hasOwnProperty(n)){continue}var r=e[n];r=r||"";if(!i&&r){r=BX.util.htmlspecialchars(r)}t=t.replace(new RegExp("%"+n+"%","g"),r)}return t},handleKeyEnter:function(e,i){if(!i){return}var n=function(e){e=e||t.event;if(e.keyCode===10||e.keyCode===13){e.preventDefault();e.stopPropagation();i();return false}};BX.bind(e,"keyup",n)},getTemplatedNode:function(t,e,i){if(!t){return null}var n=r.replace(t.innerHTML,e,i);var o=document.createElement("div");o.innerHTML=n;return o.children[0]}};function o(t){this.init(t)}o.prototype.classNameCategoryActive="sender-ui-tile-searcher-sidebar-item-selected";o.prototype.classNameItemActive="sender-ui-tile-searcher-content-item-selected";o.prototype.init=function(t){this.id=t.id;this.context=t.context;this.caller=t.caller;this.categories=[];this.items=[];this.currentCategory=null;this.categoryTemplate=r.getNode("popup-category-template",this.context);this.itemTemplate=r.getNode("popup-item-template",this.context);this.content=r.getTemplatedNode(r.getNode("popup-template",this.context));this.loader=r.getNode("popup-loader",this.content);this.categoryContainer=r.getNode("popup-category-list",this.content);this.itemContainer=r.getNode("popup-item-list",this.content);this.itemContainer.innerHTML="";this.categoryContainer.innerHTML="";this.title=r.getNode("popup-title",this.content);if(this.title){this.title.textContent=t.title}if(t.dataList){this.setCategories(t.dataList)}BX.addCustomEvent(this.caller,this.caller.events.tileAdd,this.onTileAdd.bind(this));BX.addCustomEvent(this.caller,this.caller.events.tileRemove,this.onTileRemove.bind(this))};o.prototype.onTileAdd=function(t){var e=r.getObjectByKey(this.items,"id",t.id);if(!e){return}r.changeClass(e.node,this.classNameItemActive,true)};o.prototype.onTileRemove=function(t){var e=r.getObjectByKey(this.items,"id",t.id);if(!e){return}r.changeClass(e.node,this.classNameItemActive,false)};o.prototype.filterByName=function(t){t=t||"";if(t.length<3){r.changeDisplay(this.categoryContainer,true);this.setCurrentCategory();return}var e=new RegExp(BX.util.escapeRegExp(t),"i");this.items.forEach(function(t){r.changeDisplay(t.node,e.test(t.name))});r.changeDisplay(this.categoryContainer,false)};o.prototype.onCategoryClick=function(t){this.setCurrentCategory(t);this.caller.fire(this.caller.events.searcherCategoryClick,[t])};o.prototype.setCurrentCategory=function(t){t=t||this.categories[0];if(this.currentCategory){BX.removeClass(this.currentCategory.node,this.classNameCategoryActive)}this.currentCategory=t;if(!t){return}BX.addClass(this.currentCategory.node,this.classNameCategoryActive);this.items.forEach(function(e){r.changeDisplay(e.node,e.category===t)})};o.prototype.onItemClick=function(t){this.caller.addTile(t.name,t.data,t.id,t.bgcolor,t.color);this.caller.fire(this.caller.events.searcherItemClick,[t])};o.prototype.getCategory=function(t){return r.getObjectByKey(this.categories,"id",t)};o.prototype.getItem=function(t){return r.getObjectByKey(this.items,"id",t)};o.prototype.updateItem=function(t,e,i){if(e){t.node.textContent=e;t.node.title=e}if(i){t.data=i}};o.prototype.addItem=function(t,e,i,n){var o=r.getTemplatedNode(this.itemTemplate,{name:i});var s={category:t,node:o,id:e,name:i,data:n||{}};this.items.push(s);this.itemContainer.appendChild(o);BX.bind(o,"click",this.onItemClick.bind(this,s));return s};o.prototype.setItems=function(t,e){this.items=[];e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};o.prototype.addItems=function(t,e){e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};o.prototype.addCategory=function(t,e,i,n){var o=r.getTemplatedNode(this.categoryTemplate,{name:e});var s={node:o,id:t,name:e,data:i||{}};this.categories.push(s);this.categoryContainer.appendChild(o);BX.bind(o,"click",this.onCategoryClick.bind(this,s));this.addItems(s,n);return s};o.prototype.setCategories=function(t){this.categories=[];t.forEach(function(t){this.addCategory(t.id,t.name,t.data,t.items)},this);if(this.categories.length>0){this.setCurrentCategory(this.categories[0])}var e=this.caller.getTilesId();this.items.filter(function(t){var i=t.id&&BX.util.in_array(t.id,e);r.changeClass(t.node,this.classNameItemActive,i)},this);r.changeDisplay(this.loader,false);r.changeDisplay(this.itemContainer,true);r.changeDisplay(this.categoryContainer,true)};o.prototype.showLoader=function(){r.changeDisplay(this.loader,true)};o.prototype.hide=function(){if(!this.popup){return}this.popup.close()};o.prototype.show=function(){if(this.popup){this.popup.show();return}this.popup=BX.PopupWindowManager.create(this.id,this.context,{width:620,height:225,autoHide:true,lightShadow:true,closeByEsc:true,closeIcon:true,offsetLeft:40,angle:true});this.popup.setContent(this.content);r.changeDisplay(this.content,true);this.popup.show()};BX.Sender.UI.TileSelector=n})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/sender.message.editor/templates/.default/script.min.js?15441274503128";s:6:"source";s:76:"/bitrix/components/bitrix/sender.message.editor/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.Sender.Message");if(BX.Sender.Message.Editor){return}var e=BX.Sender.Helper;function t(){this.context=null;this.editor=null}t.prototype.classNameMoreActive="sender-more-active";t.prototype.init=function(t){this.context=BX(t.containerId);this.actionUri=t.actionUri;this.mess=t.mess;this.fieldPrefix=t.fieldPrefix;this.messageCode=t.messageCode;this.templateType=t.templateType;this.templateId=t.templateId;this.moreButton=e.getNode("more-btn",this.context);this.moreFields=e.getNode("more-fields",this.context);if(this.moreButton&&this.moreFields){BX.bind(this.moreButton,"click",this.onMoreClick.bind(this))}this.configuration=new i(this);this.ajaxAction=new BX.AjaxAction(this.actionUri);e.hint.init(this.context);this.bindNodes();this.initFields()};t.prototype.initFields=function(){var t=this.context.querySelectorAll("[data-bx-field]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){var i=t.getAttribute("data-bx-field");var n=t.querySelector('[name="'+i+'"]');e.tag.init(t,n)},this)};t.prototype.onMoreClick=function(){e.display.toggle(this.moreFields);BX.toggleClass(this.moreButton,this.classNameMoreActive)};t.prototype.setAdaptedInstance=function(e){this.editor=e};t.prototype.initTester=function(){var e=BX.Sender.Message.Tester;if(!e){return}BX.addCustomEvent(e,e.eventNameSend,this.onTestSend.bind(this))};t.prototype.bindNodes=function(){setTimeout(this.initTester.bind(this),200);if(BX.Sender.Template&&BX.Sender.Template.Selector){var e=BX.Sender.Template.Selector;BX.addCustomEvent(e,e.events.templateSelect,this.onTemplateSelect.bind(this))}};t.prototype.onTemplateSelect=function(e){this.setTemplate(e)};t.prototype.setTemplate=function(e){this.templateType=e.type;this.templateId=e.code;var t={};(e.messageFields||{}).reduce(function(e,t){if(!t.onDemand){e[t.code]=t.value}return e},t);this.configuration.set(t)};t.prototype.onTestSend=function(e){e.data=this.getConfiguration()};t.prototype.getConfiguration=function(){return this.configuration.get()};function i(e){this.manager=e}i.prototype={getInputs:function(e){e=e||{};e.disableChecked=e.disableChecked||false;var t=e.disableChecked?"":":checked";var i=this.manager.context.querySelectorAll("select, textarea, "+'input[type="text"], '+'input[type="hidden"], '+'input[type="radio"]'+t+", "+'input[type="checkbox"]'+t);i=BX.convert.nodeListToArray(i);return i.filter(function(e){return!!this.getInputName(e)},this)},getInputName:function(e){var t=e.name;if(t.indexOf(this.manager.fieldPrefix)!==0){return""}return t.substring(this.manager.fieldPrefix.length)},set:function(e){this.getInputs({disableChecked:true}).forEach(function(t){var i=this.getInputName(t);if(e[i]){switch(t.type){case"checkbox":t.checked=t.value===e[i];break;default:t.value=e[i]}BX.fireEvent(t,"change")}},this)},get:function(){var e={};this.getInputs().forEach(function(t){var i=this.getInputName(t);if(!t.value){return}if(e[i]){if(!BX.type.isArray(e[i])){e[i]=[e[i]]}e[i].push(t.value)}else{e[i]=t.value}},this);e.TEMPLATE_TYPE=this.manager.templateType;e.TEMPLATE_ID=this.manager.templateId;return e}};BX.Sender.Message.Editor=new t})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.min.js?15441273845080";s:6:"source";s:71:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.colorpicker/templates/.default/script.map.js";}"*/
function BXColorPicker(o){if(!o.name)o.name=o.id;if(!o.title)o.title=o.name;this.disabled=false;this.bCreated=false;this.bOpened=false;this.zIndex=o.zIndex?o.zIndex:1e3;this.fid=o.id.toLowerCase();this.oPar=o;this.oneGifSrc="/bitrix/images/1.gif";this.BeforeCreate()}BXColorPicker.prototype.BeforeCreate=function(){var o=this;this.pWnd=BX.create("IMG",{props:{src:this.oneGifSrc,title:this.oPar.title,className:"bx-colpic-button bx-colpic-button-normal",id:"bx_btn_"+this.oPar.id.toLowerCase()}});this.pWnd.onmouseover=function(e){o.OnMouseOver(e,this)};this.pWnd.onmouseout=function(e){o.OnMouseOut(e,this)};this.pWnd.onclick=function(e){o.OnClick(e,this)};this.pCont=BX.create("DIV",{props:{className:"bx-colpic-button-cont"}});this.pCont.appendChild(this.pWnd)};BXColorPicker.prototype.Create=function(){var o=this;window["bx_colpic_keypress_"+this.fid]=function(e){o.OnKeyPress(e)};window["bx_colpic_click_"+this.fid]=function(e){o.OnDocumentClick(e)};this.pColCont=document.body.appendChild(BX.create("DIV",{props:{className:"bx-colpic-cont"},style:{zIndex:this.zIndex}}));var e=["#ACE9FB","#BEEDF1","#9AE1DD","#E3F19E","#FFED9A","#FFDD99","#DFD3B7","#E2C6BC","#FEAD99","#FFBDBC","#FFCBD8","#FEC5E4","#C5BBEC","#DBDDE0","#DBF199","#FFBEBD","#3AD0FF","#A6DC00","#FF5C5A","#B47153","#2FC7F7","#04B4AB","#FFA801","#5CD1DF","#6E54D1","#29AD49","#FE5957","#DAA187","#78D4F1","#43DAD2","#EECE8F","#AEE5EC","#FF0000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF","#FFFFFF","#EBEBEB","#E1E1E1","#D7D7D7","#CCCCCC","#C2C2C2","#B7B7B7","#ACACAC","#A0A0A0","#959595","#EE1D24","#FFF100","#00A650","#00AEEF","#2F3192","#ED008C","#898989","#7D7D7D","#707070","#626262","#555555","#464646","#363636","#262626","#111111","#000000","#F7977A","#FBAD82","#FDC68C","#FFF799","#C6DF9C","#A4D49D","#81CA9D","#7BCDC9","#6CCFF7","#7CA6D8","#8293CA","#8881BE","#A286BD","#BC8CBF","#F49BC1","#F5999D","#F16C4D","#F68E54","#FBAF5A","#FFF467","#ACD372","#7DC473","#39B778","#16BCB4","#00BFF3","#438CCB","#5573B7","#5E5CA7","#855FA8","#A763A9","#EF6EA8","#F16D7E","#EE1D24","#F16522","#F7941D","#FFF100","#8FC63D","#37B44A","#00A650","#00A99E","#00AEEF","#0072BC","#0054A5","#2F3192","#652C91","#91278F","#ED008C","#EE105A","#9D0A0F","#A1410D","#A36209","#ABA000","#588528","#197B30","#007236","#00736A","#0076A4","#004A80","#003370","#1D1363","#450E61","#62055F","#9E005C","#9D0039","#790000","#7B3000","#7C4900","#827A00","#3E6617","#045F20","#005824","#005951","#005B7E","#003562","#002056","#0C004B","#30004A","#4B0048","#7A0045","#7A0026"];var t,i,n,s=BX.create("TABLE",{props:{className:"bx-colpic-tbl"}}),c,l=e.length;t=s.insertRow(-1);i=t.insertCell(-1);i.colSpan=8;var r=i.appendChild(BX.create("SPAN",{props:{className:"bx-colpic-def-but"}}));r.innerHTML=window.jsColorPickerMess.DefaultColor;r.onmouseover=function(){this.className="bx-colpic-def-but bx-colpic-def-but-over";n.style.backgroundColor="transparent"};r.onmouseout=function(){this.className="bx-colpic-def-but"};r.onclick=function(e){o.Select(false)};n=t.insertCell(-1);n.colSpan=8;n.className="bx-color-inp-cell";n.style.backgroundColor=e[38];for(c=0;c<l;c++){if(Math.round(c/16)==c/16)t=s.insertRow(-1);i=t.insertCell(-1);i.innerHTML="&nbsp;";i.className="bx-colpic-col-cell";i.style.backgroundColor=e[c];i.id="bx_color_id__"+c;i.onmouseover=function(o){this.className="bx-colpic-col-cell bx-colpic-col-cell-over";n.style.backgroundColor=e[this.id.substring("bx_color_id__".length)]};i.onmouseout=function(o){this.className="bx-colpic-col-cell"};i.onclick=function(t){var i=this.id.substring("bx_color_id__".length);o.Select(e[i])}}this.pColCont.appendChild(s);this.bCreated=true};BXColorPicker.prototype.OnClick=function(o,e){if(this.disabled)return false;if(!this.bCreated)this.Create();if(this.bOpened)return this.Close();this.Open()};BXColorPicker.prototype.Open=function(){var o=BX.align(this.pWnd,240,130),e=this;BX.bind(window,"keypress",window["bx_colpic_keypress_"+this.fid]);BX.defer(function(){BX.bind(window,"click",window["bx_colpic_click_"+e.fid])})();this.pColCont.style.display="block";this.pColCont.style.top=o.top+"px";this.pColCont.style.left=o.left+"px";this.bOpened=true};BXColorPicker.prototype.Close=function(){this.pColCont.style.display="none";BX.unbind(window,"keypress",window["bx_colpic_keypress_"+this.fid]);BX.unbind(window,"click",window["bx_colpic_click_"+this.fid]);this.bOpened=false};BXColorPicker.prototype.OnMouseOver=function(o,e){if(this.disabled)return;e.className="bx-colpic-button bx-colpic-button-over"};BXColorPicker.prototype.OnMouseOut=function(o,e){if(this.disabled)return;e.className="bx-colpic-button bx-colpic-button-normal"};BXColorPicker.prototype.OnKeyPress=function(o){if(!o)o=window.event;if(o.keyCode==27)this.Close()};BXColorPicker.prototype.OnDocumentClick=function(o){if(!o)o=window.event;var e=o.target||o.srcElement;if(e&&!BX.findParent(e,{className:"bx-colpic-cont"}))this.Close()};BXColorPicker.prototype.Select=function(o){if(this.oPar.OnSelect&&typeof this.oPar.OnSelect=="function")this.oPar.OnSelect(o,this);this.Close()};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/sender.mail.editor/templates/.default/script.min.js?15441274503573";s:6:"source";s:73:"/bitrix/components/bitrix/sender.mail.editor/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){BX.namespace("BX.Sender.Mail");if(BX.Sender.Mail.Editor){return}var t={changeDisplay:function(e,t){if(!e){return}e.style.display=t?"":"none"}};function i(){}i.prototype.init=function(e){this.id=e.id;this.input=BX(e.inputId);this.placeHolders=e.placeHolders;this.mess=e.mess;this.context=BX(e.containerId);this.blockNode=this.context.querySelector("[data-bx-editor-block]");this.plainNode=this.context.querySelector("[data-bx-editor-plain]");this.inputNode=this.plainNode.querySelector("[data-bx-input]");BX.addCustomEvent("OnEditorInitedBefore",this.onEditorInitedBefore.bind(this));BX.addCustomEvent("OnEditorInitedAfter",this.onEditorInitedAfter.bind(this));if(BX.Sender.Template&&BX.Sender.Template.Selector){var t=BX.Sender.Template.Selector;BX.addCustomEvent(t,t.events.templateSelect,this.onTemplateSelect.bind(this))}};i.prototype.onTemplateSelect=function(e){var t=e.messageFields.some(function(e){return e.code==="MESSAGE"&&e.onDemand});if(t){var i=BX.Sender.Template.Selector.getTemplateRequestingUri(e);this.setTemplateUri(i)}else{e.messageFields.forEach(function(e){if(e.code!=="MESSAGE"){return}this.setContent(e.value)},this)}};i.prototype.isTargetEditor=function(e){if(!e){return false}return e.id.indexOf("BX_BLOCK_EDITOR_CONTENT")===0};i.prototype.onEditorInitedAfter=function(e){if(!this.isTargetEditor(e)){return}e.components.SetComponentIcludeMethod("EventMessageThemeCompiler::includeComponent")};i.prototype.onEditorInitedBefore=function(t){if(!this.isTargetEditor(t)){return}BX.extend(o,e.BXHtmlEditor.DropDownList);e.BXHtmlEditor.Controls["placeholder_selector"]=o;BX.addCustomEvent(t,"PlaceHolderSelectorListCreate",this.onPlaceHolderSelectorListCreate.bind(this));BX.addCustomEvent(t,"GetControlsMap",this.onGetControlsMap.bind(this))};i.prototype.onGetControlsMap=function(e){e.push({id:"placeholder_selector",compact:true,hidden:false,sort:1,checkWidth:false,offsetWidth:32})};i.prototype.onPlaceHolderSelectorListCreate=function(e){e.placeHolders=this.placeHolders};i.prototype.isSupportedTemplateUri=function(){return true};i.prototype.setTemplateUri=function(e){if(this.input.value&&!this.isShowedBlock()&&!this.confirmTemplateChange()){return}BX.BlockEditorManager.get(this.id).load(e);this.switchView(true)};i.prototype.isShowedBlock=function(){return this.blockNode.style.display!=="none"};i.prototype.confirmTemplateChange=function(){return confirm(this.mess.changeTemplate)};i.prototype.switchView=function(e){t.changeDisplay(this.blockNode,e);t.changeDisplay(this.plainNode,!e)};i.prototype.setContent=function(e){if(this.isShowedBlock()&&!this.confirmTemplateChange()){return}this.inputNode.value=e;this.switchView(false)};function o(e,t){var i=BX.Sender.Mail.Editor.mess.placeHolderTitle;o.superclass.constructor.apply(this,arguments);this.id="placeholder_selector";this.title=i;this.action="insertHTML";this.zIndex=3008;this.placeHolders=[];e.On("PlaceHolderSelectorListCreate",[this]);this.disabledForTextarea=false;this.arValues=[];for(var n in this.placeHolders){var r=this.placeHolders[n];r.value="#"+r.CODE+"#";this.arValues.push({id:r.CODE,name:r.NAME,topName:i,title:r.value+" - "+r.DESC,className:"",style:"",action:"insertHTML",value:r.value})}this.Create();this.pCont.innerHTML=i;if(t){t.appendChild(this.GetCont())}}setTimeout(function(){if(e.BXHtmlEditor){BX.extend(o,e.BXHtmlEditor.DropDownList);e.BXHtmlEditor.Controls["placeholder_selector"]=o}},300);BX.Sender.Mail.Editor=new i;if(BX.Sender.Message.Editor.setAdaptedInstance){BX.Sender.Message.Editor.setAdaptedInstance(BX.Sender.Mail.Editor)}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.mail.confirm/templates/.default/script.min.js?15441273846063";s:6:"source";s:72:"/bitrix/components/bitrix/main.mail.confirm/templates/.default/script.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.mail.confirm/templates/.default/script.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.mail.confirm/templates/.default/script.map.js";}"*/
(function(){if(window.BXMainMailConfirm)return;var e={showForm:function(e,t){var a="email";var i;var n=t&&t.mode?t.mode:"add";var o=new BX.PopupWindow("add_from_email",null,{width:480,titleBar:BX.message("MAIN_MAIL_CONFIRM_TITLE"),draggable:true,closeIcon:true,lightShadow:true,contentColor:"white",contentNoPaddings:true,content:BX("new_from_email_dialog_content").innerHTML,buttons:[new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_GET_CODE"),className:"popup-window-button-create",events:{click:function(){var n=this;if(BX.hasClass(n.buttonNode,"popup-window-button-wait"))return;var l=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);var s=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-code-block",true);var r=BX.findChild(l,{attr:{"data-name":"name"}},true);var d=BX.findChild(l,{attr:{"data-name":"email"}},true);var m=BX.findChild(s,{attr:{"data-name":"code"}},true);var u=BX.findChild(o.contentContainer,{attr:{"data-name":"public"}},true);var f=BX.findChild(l,{attr:{"data-name":"smtp-server"}},true);var c=BX.findChild(l,{attr:{"data-name":"smtp-port"}},true);var _=BX.findChild(l,{attr:{"data-name":"smtp-login"}},true);var h=BX.findChild(l,{attr:{"data-name":"smtp-password"}},true);if("email"==a||"smtp"==a){m.value="";var N="[=a-z0-9_+~'!$&*^`|#%/?{}-]";var M=new RegExp("^"+N+"+(\\."+N+"+)*@([a-z0-9-]+\\.)+[a-z0-9-]{2,20}$","i");if(!d.value.match(M)){o.showNotify(BX.message(d.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_EMAIL":"MAIN_MAIL_CONFIRM_EMPTY_EMAIL"));return}}if("smtp"==a){if(!f.value.match(/^([a-z0-9-]+\.)+[a-z0-9-]{2,20}$/)){o.showNotify(BX.message(f.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_SMTP_SERVER":"MAIN_MAIL_CONFIRM_EMPTY_SMTP_SERVER"));return}if(!c.value.match(/^[0-9]+$/)||c.value<1||c.value>65535){o.showNotify(BX.message(c.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_SMTP_PORT":"MAIN_MAIL_CONFIRM_EMPTY_SMTP_PORT"));return}if(!(_.value.length>0)){o.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_SMTP_LOGIN"));return}if(!(h.value.length>0)){o.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_SMTP_PASSWORD"));return}}if("code"==a){if(m.value.length==0){o.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_CODE"));return}}o.hideNotify();BX.addClass(n.buttonNode,"popup-window-button-wait");var C={name:r.value,email:d.value,smtp:{},code:"",public:u.checked?u.value:""};if("smtp"==a){C.smtp={server:f.value,port:c.value,login:_.value,password:h.value}}if("code"==a){C.code=m.value}if(t&&t.data){for(var I in t.data){if(t.data.hasOwnProperty(I)){C[I]=t.data[I]}}}BX.ajax({url:"/bitrix/components/bitrix/main.mail.confirm/ajax.php?act=add",method:"POST",dataType:"json",data:C,onsuccess:function(t){BX.removeClass(n.buttonNode,"popup-window-button-wait");if(t.senderId){i=t.senderId}if(t.result=="error"){o.showNotify(t.error)}else if("email"==a||"smtp"==a){o.switchBlock("code")}else{n.popupWindow.close();if(BX.type.isFunction(e)){var l=r.value.length>0?r.value:BX.message("MAIN_MAIL_CONFIRM_USER_FULL_NAME");e({name:l,email:d.value,id:i},l.length>0?l+" <"+d.value+">":d.value)}}},onfailure:function(e){BX.removeClass(n.buttonNode,"popup-window-button-wait");o.showNotify(BX.message("MAIN_MAIL_CONFIRM_AJAX_ERROR"))}})}}}),new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_CANCEL"),className:"popup-window-button-link",events:{click:function(){if("code"==a&&"confirm"!=n){var e=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-smtp-block",true);o.switchBlock(e&&e.offsetHeight>0?"smtp":"email");o.hideNotify()}else{this.popupWindow.close()}}}})]});o.hideNotify=function(){var e=BX.findChild(o.contentContainer,{class:"new-from-email-dialog-error"},true);BX.hide(e,"block")};o.showNotify=function(e){var t=BX.findChild(o.contentContainer,{class:"new-from-email-dialog-error"},true);t.innerHTML=e;BX.show(t,"block")};o.switchBlock=function(e,t){var i=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);var n=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-code-block",true);var l,s;if("code"!=a&&"code"==e){l=i;s=n;o.buttons[0].setName(BX.message("MAIN_MAIL_CONFIRM_SAVE"));o.buttons[1].setName(BX.message("MAIN_MAIL_CONFIRM_BACK"))}else if("code"==a&&"code"!=e){l=n;s=i;o.buttons[0].setName(BX.message("MAIN_MAIL_CONFIRM_GET_CODE"));o.buttons[1].setName(BX.message("MAIN_MAIL_CONFIRM_CANCEL"))}a=e;if(l&&s){if(t){s.style.position="";s.style.height="";s.style.display="";l.style.display="none"}else{l.style.height=l.offsetHeight+"px";l.offsetHeight;l.style.height="0px";s.style.position="absolute";s.style.height="";s.style.display="";var r=s.offsetHeight;s.style.height="0px";s.style.position="";s.offsetHeight;s.style.height=r+"px"}}};var l=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-smtp-link",true);var s=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-smtp-block",true);if(l&&s){BX.bind(l,"click",function(e){var t=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);t.style.height="";if("smtp"==a){a="email";BX.hide(s,"table-row-group")}else{a="smtp";BX.show(s,"table-row-group")}e.preventDefault()})}if("confirm"==n){o.switchBlock("code",true);o.setOverlay(true)}o.show();var r=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);var d=BX.findChild(r,{attr:{"data-name":"name"}},true);var m=BX.findChild(r,{attr:{"data-name":"email"}},true);if(d.value.length>0){m.focus()}else{d.focus()}},deleteSender:function(e,t){if(e>0){if(confirm(BX.message("MAIN_MAIL_CONFIRM_DELETE_SENDER_CONFIRM"))){BX.ajax({url:"/bitrix/components/bitrix/main.mail.confirm/ajax.php?act=delete",method:"POST",dataType:"json",data:{senderId:e},onsuccess:function(e){if(e.result=="error"){BX.UI.Notification.Center.notify({content:BX.message("MAIN_MAIL_DELETE_SENDER_ERROR")})}else{if(BX.type.isFunction(t)){t()}}},onfailure:function(e){BX.UI.Notification.Center.notify({content:BX.message("MAIN_MAIL_DELETE_SENDER_ERROR")})}})}}}};window.BXMainMailConfirm=e})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/sender.mail.sender/templates/.default/script.min.js?15441274501292";s:6:"source";s:73:"/bitrix/components/bitrix/sender.mail.sender/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(t){BX.namespace("BX.Sender.UI.Mailbox");if(BX.Sender.UI.Mailbox.Selector){return}var e=BX.Sender.Helper;function i(t){}i.prototype.init=function(t){this.mess=t.mess;this.list=t.list;this.context=BX(t.containerId);this.input=e.getNode("mailbox-input",this.context);this.mailbox=e.getNode("mailbox",this.context);BX.bind(this.mailbox,"click",this.showMenu.bind(this))};i.prototype.onClick=function(t){this.input.value=t.sender;this.mailbox.textContent=t.sender;this.popupMenu.close()};i.prototype.showAdd=function(){BXMainMailConfirm.showForm(this.onAdd.bind(this));this.popupMenu.close()};i.prototype.onAdd=function(t,e){if(!e){return}t.sender=e;t.id=BX.util.hashCode(t.sender);this.list.push(t);this.popupMenu.addMenuItem(this.getMenuItem(t),"new")};i.prototype.getMenuItem=function(t){return{id:t.id,text:BX.util.htmlspecialchars(t.sender),onclick:this.onClick.bind(this,t)}};i.prototype.showMenu=function(){if(this.popupMenu){this.popupMenu.show();return}var t=this.list.map(this.getMenuItem,this);t.push({delimiter:true});t.push({id:"new",text:this.mess.addAddress,onclick:this.showAdd.bind(this)});this.popupMenu=BX.PopupMenu.create("sender-ui-mailbox-selector",this.mailbox,t,{autoHide:true,autoClose:true});this.popupMenu.show()};BX.Sender.UI.Mailbox.Selector=new i})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/sender.mail.link.editor/templates/.default/script.min.js?15441274504022";s:6:"source";s:78:"/bitrix/components/bitrix/sender.mail.link.editor/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.Sender.Mail");if(BX.Sender.Mail.LinkEditor){return}var t=BX.Sender.Helper;function e(){}e.prototype.init=function(e){this.context=BX(e.containerId);this.defaultValue=e.defaultValue;this.placeholders=e.placeholders||[];this.mess=e.mess;this.input=t.getNode("input",this.context);this.button=t.getNode("button",this.context);this.popupContent=t.getNode("popup-content",this.context);BX.bind(this.button,"click",this.onClick.bind(this));this.initPlaceholders();if(e.useDefault){this.setDefaultParameters();this.runPlaceholderWatcher()}};e.prototype.setDefaultParameters=function(){this.setParameters(this.getDefaultParameters())};e.prototype.initPlaceholders=function(){this.placeholders=this.placeholders.filter(function(t){if(!t.inputName){return false}t.input=document.body.querySelector('input[name="'+t.inputName+'"]');return!!t.input},this)};e.prototype.onPlaceholderWatcher=function(){if(this.placeholderWatchersStopped){return}this.canStopPlaceholderWatchers=false;this.setDefaultParameters();this.canStopPlaceholderWatchers=true};e.prototype.runPlaceholderWatcher=function(){this.placeholderWatchersStopped=false;this.placeholders.forEach(function(t){BX.bind(t.input,"bxchange",this.onPlaceholderWatcher.bind(this));BX.bind(t.input,"input",this.onPlaceholderWatcher.bind(this))},this);BX.bind(this.input,"input",this.stopPlaceholderWatcher.bind(this));BX.bind(this.input,"bxchange",this.stopPlaceholderWatcher.bind(this))};e.prototype.stopPlaceholderWatcher=function(){if(!this.canStopPlaceholderWatchers){return}this.placeholderWatchersStopped=true};e.prototype.onClick=function(){this.showPopup()};e.prototype.showPopup=function(){if(!this.popup){this.popup=BX.PopupWindowManager.create("sender-mail-link-editor-utm",this.button,{content:this.popupContent,autoHide:true,lightShadow:false,closeByEsc:true,contentColor:"white",angle:true,buttons:[new BX.PopupWindowButton({text:this.mess.accept,className:"popup-window-button-accept",events:{click:this.onPopupApply.bind(this)}}),new BX.PopupWindowButtonLink({text:this.mess.cancel,events:{click:function(){this.popupWindow.close()}}})]})}if(this.popup.isShown()){return}this.loadUtmParameters();t.changeDisplay(this.popupContent,true);this.popup.show()};e.prototype.onPopupApply=function(){this.saveUtmParameters();this.popup.close()};e.prototype.getDefaultParameters=function(){var e={};this.placeholders.forEach(function(t){if(!t.input.value){return}e[t.code]=BX.translit(t.input.value)},this);var i=t.replace(this.defaultValue,e,true);return this.parseParameters(i)};e.prototype.loadUtmParameters=function(){var e=this.getParameters();var i={};var n=false;this.getUtmNames().forEach(function(t){i[t]=e[t]||"";if(!n){n=i[t].length>0}},this);if(!n){i=this.getDefaultParameters()}this.getUtmNames().forEach(function(e){var n=i[e]||"";var r=t.getNode(e,this.popupContent);r?r.value=n:null},this)};e.prototype.saveUtmParameters=function(){var e={};this.getUtmNames().forEach(function(i){var n=t.getNode(i,this.popupContent);e[i]=n?BX.translit(n.value):""},this);this.setParameters(e)};e.prototype.getUtmNames=function(){return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"]};e.prototype.setParameters=function(t){t=t||{};t=BX.mergeEx(this.getParameters(),t);var e=[];for(var i in t){if(!t.hasOwnProperty(i)){continue}if(t[i]===""||t[i]===null){continue}e.push(i+"="+encodeURIComponent(t[i]))}this.input.value=e.join("&")};e.prototype.getParameters=function(){return this.parseParameters(this.input.value)};e.prototype.parseParameters=function(t){var e={};t=t.trim();if(t.substring(0,1)==="?"){t=t.substring(1)}if(!t){return e}t.split("&").reduce(this.reduceParameter.bind(this),e);return e};e.prototype.reduceParameter=function(t,e){var i=e.split("=");if(!i[0]){return t}var n=decodeURIComponent(i[0].trim());if(!n){return t}var r=i[1].trim();if(!/%[a-zA-Z]{3,50}%/.test(r)){r=decodeURIComponent(r)}if(BX.util.in_array(n,this.getUtmNames())){r=BX.translit(r)}t[n]=r;return t};BX.Sender.Mail.LinkEditor=new e})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/sender.message.tester/templates/.default/script.min.js?15441274503615";s:6:"source";s:76:"/bitrix/components/bitrix/sender.message.tester/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(t){t.BX.namespace("BX.Sender.Message");if(BX.Sender.Message.Tester){return}var e=BX.Sender.Helper;function s(){}s.prototype.classNameBtnWait="ui-btn-wait";s.prototype.eventNameSend="sender-message-test-send";s.prototype.init=function(t){this.context=BX(t.containerId);this.id=t.id;this.actionUri=t.actionUri;this.mess=t.mess||{};this.ajaxAction=new BX.AjaxAction(this.actionUri);this.messageCode=t.messageCode;this.lastRecipients=t.lastRecipients;this.type=t.type;this.types=t.types;this.button=e.getNode("test-button",this.context);this.result=e.getNode("test-result",this.context);this.initSelector();BX.bind(this.button,"click",this.send.bind(this))};s.prototype.validate=function(t){switch(this.type){case this.types.mail:return this.validateEmail(t);break;case this.types.phone:return this.validatePhone(t);break}return true};s.prototype.initSelector=function(){this.selector=BX.Sender.UI.TileSelector.getById(this.id);if(!this.selector){throw new Error("Tile selector `"+this.id+"` not found.")}BX.addCustomEvent(this.selector,this.selector.events.search,this.onSearch.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonSelect,this.onButtonSelect.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonSelectFirst,this.onButtonSelectFirst.bind(this))};s.prototype.onButtonSelect=function(){var t="";switch(this.type){case this.types.mail:t=this.mess.searchTitleMail;break;case this.types.phone:t=this.mess.searchTitlePhone;break}this.selector.showSearcher(t)};s.prototype.onButtonSelectFirst=function(){var t=[{id:"last",name:this.mess.categoryLast,items:this.lastRecipients.map(function(t){return{id:t,name:t,data:{}}})}];this.selector.setSearcherData(t)};s.prototype.onSearch=function(t){(t||"").split(",").forEach(function(t){t=t.trim();if(!t||!this.validate(t)){return}this.selector.addTile(t,{},t)},this)};s.prototype.validateEmail=function(t){return null!==t.match(/^[\w\.\d-_]+@[\w\.\d-_]+\.\w{2,15}$/i)};s.prototype.validatePhone=function(t){return null!==t.match(/^[\+]?[\d]{4,25}$/i)};s.prototype.printResult=function(t){t=t||{isSuccess:null};var e;if(t.isSuccess===null){e=""}else if(!t.isSuccess){e=t.resultErrors.join("\n")}else if(this.messageCode==="mail"){e=this.mess.testSuccess}else{e=this.mess.testSuccessPhone}this.result.textContent=e;this.removeWaitingIndicator()};s.prototype.removeWaitingIndicator=function(){BX.removeClass(this.button,this.classNameBtnWait)};s.prototype.addWaitingIndicator=function(){BX.addClass(this.button,this.classNameBtnWait)};s.prototype.convertDataFromPostToJson=function(t){for(var e in t){if(!t.hasOwnProperty(e)){continue}if(!/[\[]+/.test(e)){continue}var s=e.split("[").map(function(t){return t.replace("]","")});s.reduce(function(t,e){if(!t[e]||!BX.type.isPlainObject(t[e])){t[e]={}}return t[e]},t);s.reduce(function(s,i){if(!BX.type.isPlainObject(s[i])){return}if(!BX.type.isNotEmptyObject(s[i])){s[i]=t[e];return}return s[i]},t);t[e]=null}return t};s.prototype.send=function(){var t=this.selector.getTilesId().map(function(t){return t.trim()}).filter(function(t){return t.length>0});if(t.length===0){this.printResult({isSuccess:false,resultErrors:[this.mess.testEmpty]});return}var e={id:null,data:{}};BX.onCustomEvent(this,this.eventNameSend,[e]);this.printResult();this.addWaitingIndicator(this.button,this.classNameBtnWait);this.ajaxAction.request({action:"test",onsuccess:this.printResult.bind(this),onfailure:this.removeWaitingIndicator.bind(this),data:{list:t,messageCode:this.messageCode,messageId:e.id,messageData:this.convertDataFromPostToJson(e.data)}})};BX.Sender.Message.Tester=new s})(window);
/* End */
;; /* /bitrix/components/bitrix/sender.letter.edit/templates/.default/script.min.js?15441274502935*/
; /* /bitrix/components/bitrix/sender.template.selector/templates/.default/script.min.js?15441274503780*/
; /* /bitrix/components/bitrix/sender.template.selector/templates/.default/grid.min.js?15441274504882*/
; /* /bitrix/components/bitrix/sender.segment.selector/templates/.default/script.min.js?15441274506447*/
; /* /bitrix/components/bitrix/sender.ui.tile.selector/templates/.default/script.min.js?154412745011203*/
; /* /bitrix/components/bitrix/sender.message.editor/templates/.default/script.min.js?15441274503128*/
; /* /bitrix/components/bitrix/main.colorpicker/templates/.default/script.min.js?15441273845080*/
; /* /bitrix/components/bitrix/sender.mail.editor/templates/.default/script.min.js?15441274503573*/
; /* /bitrix/components/bitrix/main.mail.confirm/templates/.default/script.min.js?15441273846063*/
; /* /bitrix/components/bitrix/sender.mail.sender/templates/.default/script.min.js?15441274501292*/
; /* /bitrix/components/bitrix/sender.mail.link.editor/templates/.default/script.min.js?15441274504022*/
; /* /bitrix/components/bitrix/sender.message.tester/templates/.default/script.min.js?15441274503615*/

//# sourceMappingURL=page_f775605867545289006af9dd909fb585.map.js