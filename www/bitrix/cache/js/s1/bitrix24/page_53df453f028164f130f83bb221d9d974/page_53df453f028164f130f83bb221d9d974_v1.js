
; /* Start:"a:4:{s:4:"full";s:133:"/bitrix/components/bitrix/bizproc.interface.grid/templates/.default/bitrix/main.interface.grid/.default/script.min.js?154412738736576";s:6:"source";s:113:"/bitrix/components/bitrix/bizproc.interface.grid/templates/.default/bitrix/main.interface.grid/.default/script.js";s:3:"min";s:117:"/bitrix/components/bitrix/bizproc.interface.grid/templates/.default/bitrix/main.interface.grid/.default/script.min.js";s:3:"map";s:117:"/bitrix/components/bitrix/bizproc.interface.grid/templates/.default/bitrix/main.interface.grid/.default/script.map.js";}"*/
function BxInterfaceGrid(e){this.oActions={};this.oColsMeta={};this.oColsNames={};this.oEditData={};this.oSaveData={};this.oOptions={};this.oVisibleCols=null;this.vars={};this.menu=null;this.settingsMenu=[];this.filterMenu=[];this.checkBoxCount=0;this.bColsChanged=false;this.bViewsChanged=false;this.oFilterRows={};this.activeRow=null;var t=this;this.table_id=e;this.tableNode=BX(this.table_id);this.InitTable=function(){var e=document.getElementById(this.table_id);if(!e||e.rows.length<1||e.rows[0].cells.length<1)return;var i;var s=e.rows[0].cells.length;for(i=0;i<s;i++){var n;for(n=0;n<2;n++){var a=e.rows[n].cells[i];a.onmouseover=function(){t.HighlightGutter(this,true)};a.onmouseout=function(){t.HighlightGutter(this,false)};if(n==1){if(a.className&&(a.className=="bx-bizproc-actions-col"||a.className=="bx-bizproc-checkbox-col"))continue;if(this.vars.user_authorized){a.onbxdragstart=t.DragStart;a.onbxdragstop=t.DragStop;a.onbxdrag=t.Drag;a.onbxdraghout=function(){t.HighlightGutter(this,false)};jsDD.registerObject(a);a.onbxdestdraghover=t.DragHover;a.onbxdestdraghout=t.DragOut;a.onbxdestdragfinish=t.DragFinish;jsDD.registerDest(a)}}}}var r=e.rows.length;for(i=0;i<r;i++){var o=e.rows[i];if(o.className&&o.className=="bx-bizproc-grid-footer")continue;o.cells[0].className+=" bx-bizproc-left";o.cells[o.cells.length-1].className+=" bx-bizproc-right";if(i>=2){var l=o.cells[0].childNodes[0];if(l&&l.tagName&&l.tagName.toUpperCase()=="INPUT"&&l.type.toUpperCase()=="CHECKBOX"){l.onclick=function(){t.SelectRow(this);t.EnableActions()};jsUtils.addEvent(o,"click",t.OnClickRow);this.checkBoxCount++}}if(o.oncontextmenu)jsUtils.addEvent(o,"contextmenu",this.OnRowContext)}if(e.rows.length>2){e.rows[2].className+=" bx-top";var h=e.rows[e.rows.length-1];if(h.className&&h.className=="bx-bizproc-grid-footer")h=e.rows[e.rows.length-2];h.className+=" bx-bizproc-bottom"}};this.OnRowContext=function(e){if(!t.menu)return;if(!e)e=window.event;if(!phpVars.opt_context_ctrl&&e.ctrlKey||phpVars.opt_context_ctrl&&!e.ctrlKey)return;var i;if(e.target)i=e.target;else if(e.srcElement)i=e.srcElement;var s=i;while(s&&!(s.tagName&&s.tagName.toUpperCase()=="TD"&&s.oncontextmenu))s=jsUtils.FindParentObject(s,"td");var n=null;if(s&&s.oncontextmenu){n=s.oncontextmenu();n[n.length]={SEPARATOR:true}}s=i;while(s&&!(s.tagName&&s.tagName.toUpperCase()=="TR"&&s.oncontextmenu))s=jsUtils.FindParentObject(s,"tr");var a=t.menu;a.PopupHide();t.activeRow=s;if(t.activeRow)t.activeRow.className+=" bx-active";a.OnClose=function(){if(t.activeRow){t.activeRow.className=t.activeRow.className.replace(/\s*bx-active/i,"");t.activeRow=null}t.SaveColumns()};var r=BX.util.array_merge(n,s.oncontextmenu());if(r.length==0)return;a.SetItems(r);a.BuildItems();var o=jsUtils.GetWindowScrollPos();var l=e.clientX+o.scrollLeft;var h=e.clientY+o.scrollTop;var c={};c["left"]=c["right"]=l;c["top"]=c["bottom"]=h;a.PopupShow(c);e.returnValue=false;if(e.preventDefault)e.preventDefault()};this.ShowActionMenu=function(e,i){t.menu.PopupHide();t.activeRow=jsUtils.FindParentObject(e,"tr");if(t.activeRow)t.activeRow.className+=" bx-active";t.menu.ShowMenu(e,t.oActions[i],false,false,function(){if(t.activeRow){t.activeRow.className=t.activeRow.className.replace(/\s*bx-active/i,"");t.activeRow=null}})};this.HighlightGutter=function(e,t){var i=e.parentNode.parentNode.parentNode;var s=i.rows[0].cells[e.cellIndex];var n=s.className.indexOf("bx-bizproc-sorted")!=-1;if(t){if(n){s.className+=" bx-over-sorted";e.className+=" bx-over-sorted"}else{s.className+=" bx-over";e.className+=" bx-over"}}else{if(n){s.className=s.className.replace(/\s*bx-over-sorted/i,"");e.className=e.className.replace(/\s*bx-over-sorted/i,"")}else{s.className=s.className.replace(/\s*bx-over/i,"");e.className=e.className.replace(/\s*bx-over/i,"")}}};this.HighlightRow=function(e,t){if(t)e.className+=" bx-over";else e.className=e.className.replace(/\s*bx-over/i,"")};this.SelectRow=function(e){var t=e.parentNode.parentNode;var i=t.parentNode.parentNode;var s=document.getElementById(i.id+"_selected_span");var n=parseInt(s.innerHTML);if(e.checked){t.className+=" bx-selected selected";n++}else{t.className=t.className.replace(/\s*bx-selected/gi,"");t.className=t.className.replace(/\s*selected/gi,"");n--}s.innerHTML=n.toString();var a=document.getElementById(i.id+"_check_all");if(n==this.checkBoxCount)a.checked=true;else a.checked=false;if(e.checked){BX.onCustomEvent("onSelectRow",[this,n,e])}else{BX.onCustomEvent("onUnSelectRow",[this,n,e])}};this.OnClickRow=function(e){if(!e)var e=window.event;var i=e.target?e.target:e.srcElement?e.srcElement:null;if(!i)return;if(!i.parentNode.cells)return;var s=i.parentNode.cells[0].childNodes[0];if(s&&s.tagName&&s.tagName.toUpperCase()=="INPUT"&&s.type.toUpperCase()=="CHECKBOX"&&!s.disabled){s.checked=!s.checked;t.SelectRow(s)}else{var n=BX.findParent(i,{tagName:"tr",className:"bx-bizproc-table-body"},this.tableNode);if(n){var a=BX.findChild(n,{tagName:"td",className:"bx-bizproc-checkbox-col"});if(a){s=BX.findChild(a,{tagName:"input",property:{type:"checkbox"}});if(s){s.checked=!s.checked;t.SelectRow(s)}}}}t.EnableActions()};this.SelectAllRows=function(e){var t=document.getElementById(this.table_id);var i=e.checked;var s;var n=t.rows.length;for(s=2;s<n;s++){var a=t.rows[s].cells[0].childNodes[0];if(a&&a.tagName&&a.tagName.toUpperCase()=="INPUT"&&a.type.toUpperCase()=="CHECKBOX"){if(a.checked!=i&&!a.disabled){a.checked=i;this.SelectRow(a)}}}this.EnableActions()};this.EnableActions=function(){var e=document.forms["form_"+this.table_id];if(!e)return;var t=this.IsActionEnabled();var i=this.IsActionEnabled("edit");if(e.apply)e.apply.disabled=!t};this.IsActionEnabled=function(e){var t=document.forms["form_"+this.table_id];if(!t)return;var i=false;var s=document.getElementById(this.table_id+"_selected_span");if(s&&parseInt(s.innerHTML)>0)i=true;var n=t["action_all_rows_"+this.table_id];if(e=="edit")return!(n&&n.checked)&&i;else return n&&n.checked||i};this.SwitchActionButtons=function(e){var t=document.getElementById("bx_grid_"+this.table_id+"_action_buttons");var i=t;while(i=jsUtils.FindNextSibling(i,"td"))i.style.display=e?"none":"";t.style.display=e?"":"none"};this.ActionEdit=function(e){if(this.IsActionEnabled("edit")){var t=document.forms["form_"+this.table_id];if(!t)return;this.SwitchActionButtons(true);var i=t["ID[]"];if(!i.length)i=new Array(i);for(var s=0;s<i.length;s++){var n=i[s];if(n.checked){var a=jsUtils.FindParentObject(n,"tr");BX.denyEvent(a,"dblclick");var r=jsUtils.FindParentObject(n,"td");r=jsUtils.FindNextSibling(r,"td");if(r.className=="bx-bizproc-actions-col")r=jsUtils.FindNextSibling(r,"td");var o=n.value;this.oSaveData[o]={};for(var l in this.oColsMeta){if(this.oColsMeta[l].editable==true&&this.oEditData[o][l]!==false){this.oSaveData[o][l]=r.innerHTML;r.innerHTML="";var h=this.oEditData[o][l];var c="FIELDS["+o+"]["+l+"]";switch(this.oColsMeta[l].type){case"checkbox":r.appendChild(BX.create("INPUT",{props:{type:"hidden",name:c,value:"N"}}));r.appendChild(BX.create("INPUT",{props:{type:"checkbox",name:c,value:"Y",checked:h=="Y",defaultChecked:h=="Y"}}));break;case"list":var d=[];var f,u;for(u=0;u<this.oColsMeta[l].items.length;u++){f=this.oColsMeta[l].items[u].val;d[d.length]=BX.create("OPTION",{props:{value:f,selected:f==h},text:this.oColsMeta[l].items[u].ttl})}r.appendChild(BX.create("SELECT",{props:{name:c},children:d}));break;case"date":var v=BX.create("SPAN",{style:{whiteSpace:"nowrap"}});v.appendChild(BX.create("INPUT",{props:{type:"text",name:c,value:h,size:this.oColsMeta[l].size?this.oColsMeta[l].size:10}}));v.appendChild(BX.create("A",{props:{href:"javascript:void(0);",title:this.vars.mess.calend_title},html:'<img src="'+this.vars.calendar_image+'" alt="'+this.vars.mess.calend_title+'" class="calendar-icon" onclick="BX.calendar({node:this, field:\''+c+"', bTime: true, currentTime: '"+this.vars.server_time+'\'});" onmouseover="this.className+=\' calendar-icon-hover\';" onmouseout="this.className = this.className.replace(/s*calendar-icon-hover/ig, \'\');" border="0"/>'}));r.appendChild(v);break;default:var _={className:"bx-bizproc-folder-title list",type:"text",name:c,value:h,size:this.oColsMeta[l].size?this.oColsMeta[l].size:15};if(this.oColsMeta[l].maxlength)_.maxLength=this.oColsMeta[l].maxlength;r.appendChild(BX.create("INPUT",{props:_}));break}}r=jsUtils.FindNextSibling(r,"td")}}n.disabled=true}t.elements["action_button_"+this.table_id].value="edit"}};this.ActionCancel=function(){var e=document.forms["form_"+this.table_id];if(!e)return;this.SwitchActionButtons(false);var t=e["ID[]"];if(!t.length)t=new Array(t);for(var i=0;i<t.length;i++){var s=t[i];if(s.checked){var n=jsUtils.FindParentObject(s,"tr");BX.allowEvent(n,"dblclick");var a=jsUtils.FindParentObject(s,"td");a=jsUtils.FindNextSibling(a,"td");if(a.className=="bx-bizproc-actions-col")a=jsUtils.FindNextSibling(a,"td");var r=s.value;for(var o in this.oColsMeta){if(this.oColsMeta[o].editable==true&&this.oEditData[r][o]!==false)a.innerHTML=this.oSaveData[r][o];a=jsUtils.FindNextSibling(a,"td")}}s.disabled=false}e.elements["action_button_"+this.table_id].value=""};this.ActionDelete=function(){var e=document.forms["form_"+this.table_id];if(!e)return;e.elements["action_button_"+this.table_id].value="delete";BX.submit(e)};this.SetActionName=function(e){var t=this.GetForm();if(!t)return;t.elements["action_button_"+this.table_id].value=e};this.GetForm=function(){return document.forms["form_"+this.table_id]};this.GetCheckedCheckboxes=function(){var e=[];for(var t=0,i=this.GetForm().elements.length;t<i;t++){var s=this.GetForm().elements[t];if(s.type.toLowerCase()=="checkbox"&&s.checked){e.push(s)}}return e};this.ActionCustom=function(e){this.SetActionName(e);BX.submit(form)};this.DeleteItem=function(e,t){var i=document.getElementById("ID_"+e);if(i){if(confirm(t)){var s=document.forms["form_"+this.table_id];if(!s)return;var n=s["ID[]"];if(!n.length)n=new Array(n);for(var a=0;a<n.length;a++){n[a].checked=false}i.checked=true;this.ActionDelete()}}};this.ForAllClick=function(e){if(e.checked&&!confirm(this.vars.mess.for_all_confirm)){e.checked=false;return}var t=e.form["ID[]"];if(t){if(!t.length)t=new Array(t);for(var i=0;i<t.length;i++)t[i].disabled=e.checked}this.EnableActions()};this.Sort=function(e,t,i,s){if(t==""){var n=null,a=false;if(s.length>0)n=s[0];if(!n)n=window.event;if(n)a=n.ctrlKey;e+=a?i=="asc"?"desc":"asc":i}else if(t=="asc")e+="desc";else e+="asc";this.Reload(e)};this.InitVisCols=function(){if(this.oVisibleCols==null){this.oVisibleCols={};for(var e in this.oColsMeta)this.oVisibleCols[e]=true}};this.CheckColumn=function(e,t){var i=this.menu.GetMenuByItemId(t.id);var s=!(i.GetItemInfo(t).ICON=="checked");i.SetItemIcon(t,s?"checked":"");this.InitVisCols();this.oVisibleCols[e]=s;this.bColsChanged=true};this.HideColumn=function(e){this.InitVisCols();this.oVisibleCols[e]=false;this.bColsChanged=true;this.SaveColumns()};this.ApplySaveColumns=function(){t.menu.PopupHide();t.SaveColumns()};this.SaveColumns=function(e){var i="";if(e){i=e}else{if(!t.bColsChanged)return;for(var s in t.oVisibleCols)if(t.oVisibleCols[s])i+=(i!=""?",":"")+s}BX.ajax.get("/bitrix/components"+t.vars.component_path+"/settings.php?GRID_ID="+t.table_id+"&action=showcolumns&columns="+i+"&sessid="+t.vars.sessid,BX.delegate(t._onColumnsSaved,t))};this._onColumnsSaved=function(){window.setTimeout(BX.delegate(this.Reload,this),500)};this.Reload=function(e){jsDD.Disable();if(!e){e=this.vars.current_url}if(this.vars.ajax.AJAX_ID==""){window.location=e}else{BX.ajax.get(e+(e.indexOf("?")==-1?"?":"&")+"bxajaxid="+this.vars.ajax.AJAX_ID,BX.delegate(this.onAjaxReload,this))}};this.onAjaxReload=function(e){BX("comp_"+this.vars.ajax.AJAX_ID).innerHTML=e;this.InitTable();BX.onCustomEvent(window,"BXInterfaceGridAfterReload",[])};this.SetTheme=function(e,i){BX.loadCSS(this.vars.template_path+"/themes/"+i+"/style.css");BX(t.table_id).className="bx-bizproc-interface-grid bx-bizproc-interface-grid-theme-"+i;var s=this.menu.GetMenuByItemId(e.id);s.SetAllItemsIcon("");s.SetItemIcon(e,"checked");BX.ajax.get("/bitrix/components"+t.vars.component_path+"/settings.php?GRID_ID="+t.table_id+"&action=settheme&theme="+i+"&sessid="+t.vars.sessid)};this.SetView=function(e){var i=t.oOptions.views[e].saved_filter;var s=i&&t.oOptions.filters[i]?function(){t.ApplyFilter(i)}:function(){t.Reload()};BX.ajax.get("/bitrix/components"+t.vars.component_path+"/settings.php?GRID_ID="+t.table_id+"&action=setview&view_id="+e+"&sessid="+t.vars.sessid,s)};this.EditCurrentView=function(){var e=this;this.ShowSettings(this.oOptions.views[this.oOptions.current_view],function(){var t=e.SaveSettings(e.oOptions.current_view,true);e.oOptions.views[e.oOptions.current_view]={name:t.name,columns:t.columns,sort_by:t.sort_by,sort_order:t.sort_order,page_size:t.page_size,saved_filter:t.saved_filter}})};this.AddView=function(){var e="view_"+Math.round(Math.random()*1e6);var i={};for(var s in this.oOptions.views[this.oOptions.current_view])i[s]=this.oOptions.views[this.oOptions.current_view][s];i.name=this.vars.mess.viewsNewView;this.ShowSettings(i,function(){var i=t.SaveSettings(e);t.oOptions.views[e]={name:i.name,columns:i.columns,sort_by:i.sort_by,sort_order:i.sort_order,page_size:i.page_size,saved_filter:i.saved_filter};t.bViewsChanged=true;var s=document["views_"+t.table_id];s.views_list.options[s.views_list.length]=new Option(i.name!=""?i.name:t.vars.mess.viewsNoName,e,true,true)})};this.EditView=function(e){this.ShowSettings(this.oOptions.views[e],function(){var i=t.SaveSettings(e);t.oOptions.views[e]={name:i.name,columns:i.columns,sort_by:i.sort_by,sort_order:i.sort_order,page_size:i.page_size,saved_filter:i.saved_filter};t.bViewsChanged=true;var s=document["views_"+t.table_id];s.views_list.options[s.views_list.selectedIndex].text=i.name!=""?i.name:t.vars.mess.viewsNoName})};this.DeleteView=function(e){if(!confirm(this.vars.mess.viewsDelete))return;var i=document["views_"+this.table_id];var s=i.views_list.selectedIndex;i.views_list.remove(s);i.views_list.selectedIndex=s<i.views_list.length?s:i.views_list.length-1;this.bViewsChanged=true;BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.php?GRID_ID="+this.table_id+"&action=delview&view_id="+e+"&sessid="+t.vars.sessid)};this.ShowSettings=function(e,t){var i=false;if(!window["settingsDialog"+this.table_id]){window["settingsDialog"+this.table_id]=new BX.CDialog({content:'<form name="settings_'+this.table_id+'"></form>',title:this.vars.mess.settingsTitle,width:this.vars.settingWndSize.width,height:this.vars.settingWndSize.height,resize_id:"InterfaceGridSettingWnd"});i=true}window["settingsDialog"+this.table_id].ClearButtons();window["settingsDialog"+this.table_id].SetButtons([{title:this.vars.mess.settingsSave,action:function(){t();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["settingsDialog"+this.table_id].Show();var s=document["settings_"+this.table_id];if(i)s.appendChild(BX("view_settings_"+this.table_id));s.view_name.focus();s.view_name.value=e.name;var n=[];if(e.columns!=""){n=e.columns.split(",")}else{for(var a in this.oColsMeta)n[n.length]=a}var r={};for(var a=0,o=n.length;a<o;a++)r[n[a]]=true;jsSelectUtils.deleteAllOptions(s.view_all_cols);for(var a in this.oColsNames)if(!r[a])s.view_all_cols.options[s.view_all_cols.length]=new Option(this.oColsNames[a],a,false,false);jsSelectUtils.deleteAllOptions(s.view_cols);for(var a in r)s.view_cols.options[s.view_cols.length]=new Option(this.oColsNames[a],a,false,false);jsSelectUtils.selectOption(s.view_sort_by,e.sort_by);jsSelectUtils.selectOption(s.view_sort_order,e.sort_order);jsSelectUtils.selectOption(s.view_page_size,e.page_size);jsSelectUtils.deleteAllOptions(s.view_filters);s.view_filters.options[0]=new Option(this.vars.mess.viewsFilter,"");for(var a in this.oOptions.filters)s.view_filters.options[s.view_filters.length]=new Option(this.oOptions.filters[a].name,a,a==e.saved_filter,a==e.saved_filter);if(s.set_default_settings){s.set_default_settings.checked=false;s.delete_users_settings.disabled=true}};this.SaveSettings=function(e,i){var s=document["settings_"+this.table_id];var n="";var a=s.view_cols.length;for(var r=0;r<a;r++){if(typeof s.view_cols[r]!=="undefined"){n+=(n!=""?",":"")+s.view_cols[r].value}}var o={GRID_ID:this.table_id,view_id:e,action:"savesettings",sessid:this.vars.sessid,name:s.view_name.value,columns:n,sort_by:s.view_sort_by.value,sort_order:s.view_sort_order.value,page_size:s.view_page_size.value,saved_filter:s.view_filters.value};if(s.set_default_settings){o.set_default_settings=s.set_default_settings.checked?"Y":"N";o.delete_users_settings=s.delete_users_settings.checked?"Y":"N"}var l=null;if(i===true){l=function(){if(o.saved_filter&&t.oOptions.filters[o.saved_filter]){t.ApplyFilter(o.saved_filter)}else{t.Reload()}}}BX.ajax.post("/bitrix/components"+t.vars.component_path+"/settings.php",o,l);return o};this.ReloadViews=function(){if(t.bViewsChanged)t.Reload()};this.ShowViews=function(){this.bViewsChanged=false;var e=false;if(!window["viewsDialog"+this.table_id]){var i=new BX.CWindowButton({title:this.vars.mess.viewsApply,hint:this.vars.mess.viewsApplyTitle,action:function(){var e=document["views_"+t.table_id];if(e.views_list.selectedIndex!=-1)t.SetView(e.views_list.value);window["bxGrid_"+t.table_id].bViewsChanged=false;this.parentWindow.Close()}});window["viewsDialog"+this.table_id]=new BX.CDialog({content:'<form name="views_'+this.table_id+'"></form>',title:this.vars.mess.viewsTitle,buttons:[i,BX.CDialog.prototype.btnClose],width:this.vars.viewsWndSize.width,height:this.vars.viewsWndSize.height,resize_id:"InterfaceGridViewsWnd"});BX.addCustomEvent(window["viewsDialog"+this.table_id],"onWindowUnRegister",this.ReloadViews);e=true}window["viewsDialog"+this.table_id].Show();var s=document["views_"+this.table_id];if(e)s.appendChild(BX("views_list_"+this.table_id))};this.DragStart=function(){var e=document.body.appendChild(document.createElement("DIV"));var t=document.body.appendChild(document.createElement("DIV"));e.appendChild(t);e.style.position="absolute";e.style.zIndex=10;e.className="bx-drag-object";e.style.width=this.clientWidth+"px";this.__dragCopyDiv=e;this.className+=" bx-drag-source";t.innerHTML=this.innerHTML;if(t.clientHeight<e.clientHeight){var i=Math.floor((e.clientHeight-t.clientHeight)/2);if(i>0)t.style.marginTop=""+i+"px"}var s=document.body.appendChild(document.createElement("DIV"));s.style.position="absolute";s.style.zIndex=20;s.className="bx-drag-arrow";this.__dragArrowDiv=s;return true};this.Drag=function(e,t){var i=this.__dragCopyDiv;i.style.left=e+"px";i.style.top=t+"px";return true};this.DragStop=function(){this.className=this.className.replace(/\s*bx-grid-drag-source/gi,"");this.__dragCopyDiv.parentNode.removeChild(this.__dragCopyDiv);this.__dragCopyDiv=null;this.__dragArrowDiv.parentNode.removeChild(this.__dragArrowDiv);this.__dragArrowDiv=null;return true};this.DragHover=function(e,i,s){t.HighlightGutter(this,true);this.className+=" bx-drag-over";var n=e.__dragArrowDiv;var a=jsUtils.GetRealPos(this);if(this.cellIndex<=e.cellIndex)n.style.left=a["left"]-6+"px";else n.style.left=a["right"]-6+"px";n.style.top=a["top"]-12+"px";return true};this.DragOut=function(e,i,s){t.HighlightGutter(this,false);this.className=this.className.replace(/\s*bx-drag-over/gi,"");var n=e.__dragArrowDiv;n.style.left="-1000px";return true};this.DragFinish=function(e,i,s,n){t.HighlightGutter(this,false);this.className=this.className.replace(/\s*bx-drag-over/gi,"");if(this==e)return true;var a=BX(t.table_id);var r=0;for(var o=0;o<2;o++){cell=a.rows[1].cells[o];if(cell.className&&(cell.className.indexOf("bx-bizproc-actions-col")!=-1||cell.className.indexOf("bx-bizproc-checkbox-col")!=-1))r++}var l=[];for(var h in t.oColsMeta)l[l.length]=h;var c=e.cellIndex-r;var d=this.cellIndex-r;var f=l[c];if(d<c){for(var o=c;o>d;o--)l[o]=l[o-1]}else{for(var o=c;o<d;o++)l[o]=l[o+1]}l[d]=f;var u="";for(var o=0;o<l.length;o++)u+=(u!=""?",":"")+l[o];t.SaveColumns(u);return true};this.InitFilter=function(){var e=BX("flt_header_"+this.table_id);if(e)jsUtils.addEvent(e,"contextmenu",this.OnRowContext)};this.SwitchFilterRow=function(e,t){if(t){var i=this.menu.GetMenuByItemId(t.id);i.SetItemIcon(t,this.oFilterRows[e]?"":"checked")}else{var s=this.filterMenu[0].MENU;for(var n=0;n<s.length;n++){if(s[n].ID=="flt_"+this.table_id+"_"+e){s[n].ICONCLASS=this.oFilterRows[e]?"":"checked";break}}}var a=BX("flt_row_"+this.table_id+"_"+e);a.style.display=this.oFilterRows[e]?"none":"";this.oFilterRows[e]=this.oFilterRows[e]?false:true;var r=BX("a_minmax_"+this.table_id);if(r&&r.className.indexOf("bx-filter-max")!=-1)this.SwitchFilter(r);this.SaveFilterRows()};this.SwitchFilterRows=function(e){this.menu.PopupHide();var t=0;for(var i in this.oFilterRows){t++;if(t==1&&e==false)continue;this.oFilterRows[i]=e;var s=BX("flt_row_"+this.table_id+"_"+i);s.style.display=e?"":"none"}var n=this.filterMenu[0].MENU;for(var t=0;t<n.length;t++){if(t==0&&e==false)continue;if(n[t].SEPARATOR==true)break;n[t].ICONCLASS=e?"checked":""}var a=BX("a_minmax_"+this.table_id);if(a&&a.className.indexOf("bx-filter-max")!=-1)this.SwitchFilter(a);this.SaveFilterRows()};this.SaveFilterRows=function(){var e="";for(var t in this.oFilterRows)if(this.oFilterRows[t])e+=(e!=""?",":"")+t;BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.php?GRID_ID="+this.table_id+"&action=filterrows&rows="+e+"&sessid="+this.vars.sessid)};this.SwitchFilter=function(e){var t=e.className.indexOf("bx-filter-min")!=-1;e.className=t?"bx-filter-btn bx-filter-max":"bx-filter-btn bx-filter-min";e.title=t?this.vars.mess.filterShow:this.vars.mess.filterHide;var i=BX("flt_content_"+this.table_id);i.style.display=t?"none":"";BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.php?GRID_ID="+this.table_id+"&action=filterswitch&show="+(t?"N":"Y")+"&sessid="+this.vars.sessid)};this.ClearFilter=function(e){if(!BX.type.isDomNode(e)){e=document.forms["filter_"+this.table_id]}for(var t=0,i=e.elements.length;t<i;t++){var s=e.elements[t];switch(s.type.toLowerCase()){case"text":case"textarea":s.value="";break;case"select-one":s.selectedIndex=0;break;case"select-multiple":for(var n=0,a=s.options.length;n<a;n++)s.options[n].selected=false;break;case"checkbox":s.checked=false;break;default:break}if(s.onchange)s.onchange()}var r=BX.findChild(e,{tag:"INPUT",property:{type:"hidden",name:"clear_filter"}},true,false);if(r){r.value="Y"}BX.submit(e)};this.ShowFilters=function(){var e=false;if(!window["filtersDialog"+this.table_id]){var i=new BX.CWindowButton({title:this.vars.mess.filtersApply,hint:this.vars.mess.filtersApplyTitle,action:function(){var e=document["filters_"+t.table_id];if(e.filters_list.value)t.ApplyFilter(e.filters_list.value);this.parentWindow.Close()}});window["filtersDialog"+this.table_id]=new BX.CDialog({content:'<form name="filters_'+this.table_id+'"></form>',title:this.vars.mess.filtersTitle,buttons:[i,BX.CDialog.prototype.btnClose],width:this.vars.filtersWndSize.width,height:this.vars.filtersWndSize.height,resize_id:"InterfaceGridFiltersWnd"});e=true}window["filtersDialog"+this.table_id].Show();var s=document["filters_"+this.table_id];if(e)s.appendChild(BX("filters_list_"+this.table_id))};this.AddFilter=function(e){if(!e)e={};var i="filter_"+Math.round(Math.random()*1e6);var s={name:this.vars.mess.filtersNew,fields:e};this.ShowFilterSettings(s,function(){var e=t.SaveFilter(i);t.oOptions.filters[i]={name:e.name,fields:e.fields};var s=document["filters_"+t.table_id];s.filters_list.options[s.filters_list.length]=new Option(e.name!=""?e.name:t.vars.mess.viewsNoName,i,true,true);if(t.filterMenu.length==4)t.filterMenu=BX.util.insertIntoArray(t.filterMenu,1,{SEPARATOR:true});var n={ID:"mnu_"+t.table_id+"_"+i,TEXT:BX.util.htmlspecialchars(e.name),TITLE:t.vars.mess.ApplyTitle,ONCLICK:"bxGrid_"+t.table_id+".ApplyFilter('"+i+"')"};t.filterMenu=BX.util.insertIntoArray(t.filterMenu,2,n)})};this.AddFilterAs=function(){var e=document.forms["filter_"+this.table_id];var t=this.GetFilterFields(e);this.ShowFilters();this.AddFilter(t)};this.EditFilter=function(e){this.ShowFilterSettings(this.oOptions.filters[e],function(){var i=t.SaveFilter(e);t.oOptions.filters[e]={name:i.name,fields:i.fields};var s=document["filters_"+t.table_id];s.filters_list.options[s.filters_list.selectedIndex].text=i.name!=""?i.name:t.vars.mess.viewsNoName;for(var n=0,a=t.filterMenu.length;n<a;n++){if(t.filterMenu[n].ID&&t.filterMenu[n].ID=="mnu_"+t.table_id+"_"+e){t.filterMenu[n].TEXT=BX.util.htmlspecialchars(i.name);break}}})};this.DeleteFilter=function(e){if(!confirm(this.vars.mess.filtersDelete))return;var i=document["filters_"+this.table_id];var s=i.filters_list.selectedIndex;i.filters_list.remove(s);i.filters_list.selectedIndex=s<i.filters_list.length?s:i.filters_list.length-1;for(var n=0,a=this.filterMenu.length;n<a;n++){if(t.filterMenu[n].ID&&t.filterMenu[n].ID=="mnu_"+t.table_id+"_"+e){this.filterMenu=BX.util.deleteFromArray(this.filterMenu,n);if(this.filterMenu.length==5)this.filterMenu=BX.util.deleteFromArray(this.filterMenu,1);break}}delete this.oOptions.filters[e];BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.php?GRID_ID="+this.table_id+"&action=delfilter&filter_id="+e+"&sessid="+t.vars.sessid)};this.ShowFilterSettings=function(e,t){var i=false;if(!window["filterSettingsDialog"+this.table_id]){window["filterSettingsDialog"+this.table_id]=new BX.CDialog({content:'<form name="flt_settings_'+this.table_id+'"></form>',title:this.vars.mess.filterSettingsTitle,width:this.vars.filterSettingWndSize.width,height:this.vars.filterSettingWndSize.height,resize_id:"InterfaceGridFilterSettingWnd"});i=true}window["filterSettingsDialog"+this.table_id].ClearButtons();window["filterSettingsDialog"+this.table_id].SetButtons([{title:this.vars.mess.settingsSave,action:function(){t();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["filterSettingsDialog"+this.table_id].Show();var s=document["flt_settings_"+this.table_id];if(i)s.appendChild(BX("filter_settings_"+this.table_id));s.filter_name.focus();s.filter_name.value=e.name;this.SetFilterFields(s,e.fields)};this.SetFilterFields=function(e,t){BX.onCustomEvent(this,"BEFORE_SET_FILTER_FIELDS",[this,e,t]);for(var i=0,s=e.elements.length;i<s;i++){var n=e.elements[i];if(n.name=="filter_name"){continue}var a=n.name;var r=t[a]?t[a]:"";switch(n.type.toLowerCase()){case"select-one":case"text":case"textarea":{n.value=r;break}case"radio":case"checkbox":{n.checked=n.value==r;break}case"select-multiple":{a=a.substr(0,a.length-2);r=typeof t[a]==="object"&&t[a]?t[a]:{};var o=false;for(var l=0,h=n.options.length;l<h;l++){var c=n.options[l];var d="sel"+c.value;var f=r[d]?r[d]:null;c.selected=c.value==f;if(c.value==f){o=true}}if(!o&&n.options.length>0&&n.options[0].value==""){n.options[0].selected=true}break}}if(n.onchange)n.onchange()}BX.onCustomEvent(this,"AFTER_SET_FILTER_FIELDS",[this,e,t])};this.GetFilterFields=function(e){var t={};BX.onCustomEvent(this,"BEFORE_GET_FILTER_FIELDS",[this,e,t]);for(var i=0,s=e.elements.length;i<s;i++){var n=e.elements[i];if(n.name=="filter_name")continue;switch(n.type.toLowerCase()){case"select-one":case"text":case"textarea":t[n.name]=n.value;break;case"radio":case"checkbox":if(n.checked)t[n.name]=n.value;break;case"select-multiple":var a=n.name.substr(0,n.name.length-2);t[a]={};for(var r=0,o=n.options.length;r<o;r++)if(n.options[r].selected)t[a]["sel"+n.options[r].value]=n.options[r].value;break;default:break}}BX.onCustomEvent(this,"AFTER_GET_FILTER_FIELDS",[this,e,t]);return t};this.SaveFilter=function(e){var i=document["flt_settings_"+this.table_id];var s={GRID_ID:this.table_id,filter_id:e,action:"savefilter",sessid:this.vars.sessid,name:i.filter_name.value,fields:this.GetFilterFields(i)};BX.ajax.post("/bitrix/components"+t.vars.component_path+"/settings.php",s);return s};this.ApplyFilter=function(e){var t=document.forms["filter_"+this.table_id];this.SetFilterFields(t,this.oOptions.filters[e].fields);t.appendChild(BX.create("INPUT",{attrs:{type:"hidden",name:"grid_filter_id",value:e}}));t.appendChild(BX.create("INPUT",{attrs:{type:"hidden",name:"apply_filter",value:"Y"}}));BX.submit(t)};this.OnDateChange=function(e){var t=false,i=false,s=false,n=false,a=false;if(e.value=="interval")a=t=i=s=true;else if(e.value=="before")i=true;else if(e.value=="after"||e.value=="exact")t=true;else if(e.value=="days")n=true;BX.findNextSibling(e,{tag:"span","class":"bx-filter-from"}).style.display=t?"":"none";BX.findNextSibling(e,{tag:"span","class":"bx-filter-to"}).style.display=i?"":"none";BX.findNextSibling(e,{tag:"span","class":"bx-filter-hellip"}).style.display=s?"":"none";BX.findNextSibling(e,{tag:"span","class":"bx-filter-days"}).style.display=n?"":"none";var r=BX.findNextSibling(e,{tag:"span","class":"bx-filter-br"});if(r)r.style.display=a?"":"none"};this.getRowByCheckBox=function(e){return e.parentNode.parentNode};this.removeRow=function(e,t){var i=this.getRow(e);new BX.easing({duration:600,start:{opacity:100,height:i.scrollHeight},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){i.style.height=e.height+"px";i.style.opacity=e.opacity/10},complete:BX.delegate(function(){var s=this.getCheckbox(e);if(s.checked){s.checked=false;this.SelectRow(s)}BX.remove(i);t&&t()},this)}).animate();var s=BX("bx-disk-total-grid-item");if(s){BX.adjust(s,{text:""+(parseInt(s.textContent||s.innerText,10)-1)})}};this.getRow=function(e){var t=this.getCheckbox(e);return this.getRowByCheckBox(t)};this.getCheckbox=function(e){return BX("ID_"+e)};BX.onCustomEvent(BxInterfaceGrid,"CREATED",[this])}BX.namespace("BX.Bizproc");if(typeof BX.Bizproc.GridPageSizeControl==="undefined"){BX.Bizproc.GridPageSizeControl=function(){var e=function(e){this.grid=e.grid||null;this.gridId=e.gridId||"";this.nodeId=e.nodeId||"";this.node=null;if(this.nodeId){this.node=BX(this.nodeId);if(this.node){BX.bind(this.node,"change",BX.proxy(this.handlePageSizeControlChange,this))}}};e.prototype={handlePageSizeControlChange:function(e){e=e||window.event;var t=e.target||e.srcElement;if(this.grid){this.grid.oOptions.views[this.grid.oOptions.current_view].page_size=parseInt(t.value);this.saveGridSettings(this.grid.oOptions.current_view,true)}},saveGridSettings:function(e,t){var i={GRID_ID:this.grid.table_id,view_id:e,action:"savesettings",sessid:this.grid.vars.sessid,name:this.grid.oOptions.views[e].name,columns:this.grid.oOptions.views[e].columns,sort_by:this.grid.oOptions.views[e].sort_by,sort_order:this.grid.oOptions.views[e].sort_order,page_size:this.grid.oOptions.views[e].page_size,saved_filter:this.grid.oOptions.views[e].saved_filter};var s=null;var n=this;if(t===true){s=function(){if(i.saved_filter&&n.grid.oOptions.filters[i.saved_filter]){n.grid.ApplyFilter(i.saved_filter)}else{n.grid.Reload()}}}BX.ajax.post("/bitrix/components"+n.grid.vars.component_path+"/settings.php",i,s);return i}};return e}()}if(typeof BX.CrmUserSearchPopup==="undefined"){BX.CrmUserSearchPopup=function(){this._id="";this._search_input=null;this._data_input=null;this._componentName="";this._componentContainer=null;this._componentObj=null;this._serviceContainer=null;this._zIndex=0;this._dlg=null;this._dlgDisplayed=false;this._currentUser={};this._searchKeyHandler=BX.delegate(this._handleSearchKey,this);this._searchFocusHandler=BX.delegate(this._handleSearchFocus,this);this._externalClickHandler=BX.delegate(this._handleExternalClick,this);this._clearButtonClickHandler=BX.delegate(this._hadleClearButtonClick,this);this._userSelectorInitCounter=0};BX.CrmUserSearchPopup.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"crm_user_search_popup_"+Math.random();if(!t){t={}}if(!BX.type.isElementNode(t["searchInput"])){throw"BX.CrmUserSearchPopup: 'search_input' is not defined!"}this._search_input=t["searchInput"];this._clearButton=BX.findPreviousSibling(this._search_input,{className:"bizproc-user-search-filter-clean"});if(!BX.type.isElementNode(t["dataInput"])){
throw"BX.CrmUserSearchPopup: 'data_input' is not defined!"}this._data_input=t["dataInput"];if(!BX.type.isNotEmptyString(t["componentName"])){throw"BX.CrmUserSearchPopup: 'componentName' is not defined!"}this._currentUser=t["user"]?t["user"]:{};this._componentName=t["componentName"];this._componentContainer=BX(this._componentName+"_selector_content");this._initializeUserSelector();this._adjustUser();this._serviceContainer=t["serviceContainer"]?t["serviceContainer"]:document.body;this.setZIndex(t["zIndex"])},_initializeUserSelector:function(){var e="O_"+this._componentName;if(!window[e]){if(this._userSelectorInitCounter===10){throw"BX.CrmUserSearchPopup: Could not find '"+e+"' user selector!"}this._userSelectorInitCounter++;window.setTimeout(BX.delegate(this._initializeUserSelector,this),200);return}this._componentObj=window[e];this._componentObj.onSelect=BX.delegate(this._handleUserSelect,this);this._componentObj.searchInput=this._search_input;if(this._currentUser&&this._currentUser["id"]>0){this._componentObj.setSelected([this._currentUser])}BX.bind(this._search_input,"keyup",this._searchKeyHandler);BX.bind(this._search_input,"focus",this._searchFocusHandler);if(BX.type.isElementNode(this._clearButton)){BX.bind(this._clearButton,"click",this._clearButtonClickHandler)}BX.bind(document,"click",this._externalClickHandler)},open:function(){this._componentContainer.style.display="";this._dlg=new BX.PopupWindow(this._id,this._search_input,{autoHide:false,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,zIndex:this._zIndex,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(function(){this._dlgDisplayed=true},this),onPopupClose:BX.delegate(function(){this._dlgDisplayed=false;this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._dlg.destroy()},this),onPopupDestroy:BX.delegate(function(){this._dlg=null},this)}});this._dlg.show()},_adjustUser:function(){if(parseInt(this._currentUser["id"])>0){this._data_input.value=this._currentUser["id"];this._search_input.value=this._currentUser["name"]?this._currentUser.name:this._currentUser["id"]}else{this._data_input.value=this._search_input.value=""}},getZIndex:function(){return this._zIndex},setZIndex:function(e){if(typeof e==="undefined"||e===null){e=0}var t=parseInt(e);this._zIndex=!isNaN(t)?t:0},close:function(){if(this._dlg){this._dlg.close()}},select:function(e){this._currentUser=e;this._adjustUser();if(this._componentObj){this._componentObj.setSelected([e])}},_onBeforeDelete:function(){if(BX.type.isElementNode(this._search_input)){BX.unbind(this._search_input,"keyup",this._searchKeyHandler);BX.unbind(this._search_input,"focus",this._searchFocusHandler)}if(BX.type.isElementNode(this._clearButton)){BX.bind(this._clearButton,"click",this._clearButtonClickHandler)}BX.unbind(document,"click",this._externalClickHandler);if(this._componentContainer){this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._componentContainer=null}},_hadleClearButtonClick:function(e){this._data_input.value=this._search_input.value=""},_handleExternalClick:function(e){if(!e){e=window.event}if(!this._dlgDisplayed){return}var t=null;if(e){if(e.target){t=e.target}else if(e.srcElement){t=e.srcElement}}if(t!==this._search_input&&!BX.findParent(t,{attribute:{id:this._componentName+"_selector_content"}})){this._adjustUser();this.close()}},_handleSearchKey:function(e){if(!this._dlg||!this._dlgDisplayed){this.open()}this._componentObj.search()},_handleSearchFocus:function(e){if(!this._dlg||!this._dlgDisplayed){this.open()}this._componentObj._onFocus(e)},_handleUserSelect:function(e){this._currentUser=e;this._adjustUser();this.close()}};BX.CrmUserSearchPopup.items={};BX.CrmUserSearchPopup.create=function(e,t,i){if(isNaN(i)){i=0}if(i>0){window.setTimeout(function(){BX.CrmUserSearchPopup.create(e,t,0)},i);return null}var s=new BX.CrmUserSearchPopup;s.initialize(e,t);this.items[e]=s;return s};BX.CrmUserSearchPopup.createIfNotExists=function(e,t){var i=this.items[e];if(typeof i!=="undefined"){i.initialize(e,t)}else{i=new BX.CrmUserSearchPopup;i.initialize(e,t);this.items[e]=i}return i};BX.CrmUserSearchPopup.deletePopup=function(e){var t=this.items[e];if(typeof t==="undefined"){return false}t._onBeforeDelete();delete this.items[e];return true}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:137:"/bitrix/components/bitrix/bizproc.interface.filter/templates/.default/bitrix/main.interface.filter/.default/script.min.js?154412738740029";s:6:"source";s:117:"/bitrix/components/bitrix/bizproc.interface.filter/templates/.default/bitrix/main.interface.filter/.default/script.js";s:3:"min";s:121:"/bitrix/components/bitrix/bizproc.interface.filter/templates/.default/bitrix/main.interface.filter/.default/script.min.js";s:3:"map";s:121:"/bitrix/components/bitrix/bizproc.interface.filter/templates/.default/bitrix/main.interface.filter/.default/script.map.js";}"*/
if(typeof BX.BizprocParamBag==="undefined"){BX.BizprocParamBag=function(){this._params={}};BX.BizprocParamBag.prototype={initialize:function(e){this._params=e?e:{}},getParam:function(e,t){var i=this._params;return typeof i[e]!="undefined"?i[e]:t},setParam:function(e,t){this._params[e]=t},clear:function(){this._params={}}};BX.BizprocParamBag.create=function(e){var t=new BX.BizprocParamBag;t.initialize(e);return t}}if(typeof BX.InterfaceGridFilter==="undefined"){BX.InterfaceGridFilter=function(){this._defaultItemId="";this._id="";this._settings=null;this._itemInfos={};this._fieldInfos={};this._visibleFieldCount=0;this._items={};this._fields={};this._addFieldOpener=null;this._settingsOpener=null;this._ignoreFieldVisibilityChange=false;this._isApplied=false;this._currentItemId="";this._activeItemId="";this._saveAsDlg=null;this._manager=null;this._isFolded=false;this._presetsDeleted=[];this._saveVisibleFieldsTimeoutId=null;this._closeOpen=null};BX.InterfaceGridFilter.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"";this._settings=t?t:BX.BizprocParamBag.create(null);this._isApplied=this._settings.getParam("isApplied",false);this._isFolded=this._settings.getParam("isFolded",true);this._presetsDeleted=this._settings.getParam("presetsDeleted",[]);this._defaultItemId=this._settings.getParam("defaultItemId","filter_default");this._currentItemId=this._settings.getParam("currentItemId","");this._activeItemId=this._currentItemId;if(this._activeItemId===""){this._activeItemId=this._defaultItemId}this._itemInfos=this._settings.getParam("itemInfos",{});var i=this._settings.getParam("currentValues",{});if(BX.type.isArray(i)){i={}}var s=this._activeItemId===this._defaultItemId;this._items[this._defaultItemId]=BX.InterfaceGridFilterItem.create(this._defaultItemId,BX.BizprocParamBag.create({filter:this,info:{name:"",fields:s?i:{},filter_rows:this._settings.getParam("defaultVisibleRows","")},isActive:s}));for(var n in this._itemInfos){if(!this._itemInfos.hasOwnProperty(n)||n===this._defaultItemId||this.isDeleletedPreset(n)){continue}this._items[n]=BX.InterfaceGridFilterItem.create(n,BX.BizprocParamBag.create({filter:this,info:this._itemInfos[n],isActive:this._activeItemId===n}))}this._fieldInfos=this._settings.getParam("fieldInfos",{});for(var r in this._fieldInfos){if(!this._fieldInfos.hasOwnProperty(r)){continue}var a=BX.InterfaceGridFilterField.create(r,BX.BizprocParamBag.create({filter:this,info:this._fieldInfos[r]}));this._fields[r]=a;if(a.isVisible()){this._visibleFieldCount++}}BX.bind(this.getAddFieldButton(),"click",BX.delegate(this._handleAddFieldButtonClick,this));BX.bind(this.getSettingsButton(),"click",BX.delegate(this._handleSettingsButtonClick,this));BX.bind(this.getApplyButton(),"click",BX.delegate(this._handleApplyButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._handleCancelButtonClick,this));BX.bind(this.getAddFilterButton(),"click",BX.delegate(this._handleSaveAsMenuItemClick,this));this._closeOpen=new BX.InterfaceGridFilterCloseOpen(this._settings.getParam("innerBlock",""),this._settings.getParam("mainBlock",""),this);this._closeOpen.initialize();var l=this.getSwitchViewButton();if(l){l.title=this.getMessage(this._isFolded?"buttonMaximize":"buttonMinimize");BX.bind(l,"click",BX.delegate(this._handleSwitchViewButtonClick,this))}},_onManagerCreated:function(e){if(e.getId()===this.getGridId()+"_MANAGER"){this._manager=e}this._initializeFieldControllers()},_initializeFieldControllers:function(){for(var e in this._fields){if(this._fields.hasOwnProperty(e)){this._fields[e].initializeController()}}},getMessage:function(e){return BX.InterfaceGridFilter.getMessage(e)},getId:function(){return this._id},isApplied:function(){return this._isApplied},isFolded:function(){return this._isFolded},getCurrentItemId:function(){return this._currentItemId},getGridId:function(){return this._settings.getParam("gridId","")},getFormName:function(){return this._settings.getParam("formName","")},getForm:function(){return document.forms[this.getFormName()]},getCurrentTime:function(){return this._settings.getParam("currentTime","")},getServiceUrl:function(){return this._settings.getParam("serviceUrl","")},getContainerId:function(){return this._settings.getParam("containerId","flt_wrapper")},getItemContainerId:function(e){return this._settings.getParam("itemContainerPrefix","flt_tab_")+e.toString()},getFieldContainerId:function(e){return this._settings.getParam("fieldContainerPrefix","flt_field_")+e.toString()},getFieldDelimiterContainerId:function(e){return this._settings.getParam("fieldDelimiterContainerPrefix","flt_field_delim_")+e.toString()},getVisibleFieldCount:function(){return this._visibleFieldCount},getVisibleFieldIds:function(){var e=[];var t=this._fields;for(var i in t){if(t.hasOwnProperty(i)&&t[i].isVisible()){e.push(i)}}return e},getFieldInfo:function(e){if(!this._manager){return null}var t=this._manager.getSetting("filterFields",null);if(!t){return null}for(var i=0;i<t.length;i++){if(t[i]["id"]===e){return t[i]}}return null},saveVisibleFields:function(){if(this._saveVisibleFieldsTimeoutId!==null){window.clearTimeout(this._saveVisibleFieldsTimeoutId);this._saveVisibleFieldsTimeoutId=null}var e=this;this._saveVisibleFieldsTimeoutId=window.setTimeout(function(){e._doSaveVisibleFields()},100)},_doSaveVisibleFields:function(){this._saveVisibleFieldsTimeoutId=null;BX.ajax.get(this.getServiceUrl(),{GRID_ID:this.getGridId(),action:"filterrows",filter_id:this._activeItemId!==this._defaultItemId?this._activeItemId:"",rows:this.getVisibleFieldIds().join(",")})},saveActiveItem:function(e){var t=this._items[this._activeItemId];if(!t){return}BX.ajax.post(this.getServiceUrl(),{GRID_ID:this.getGridId(),filter_id:t.getId(),action:"savefilter",name:t.getName(),fields:this.getFieldParams(),rows:this.getVisibleFieldIds().join(",")},e)},isDeleletedPreset:function(e){for(var t=0;t<this._presetsDeleted.length;t++){if(this._presetsDeleted[t]===e){return true}}return false},deleteActiveItem:function(){var e=this._items[this._activeItemId];if(!e){return}var t=e.getId();BX.ajax.post(this.getServiceUrl(),{GRID_ID:this.getGridId(),filter_id:t,action:"delfilter"});if(/^filter_[0-9]+$/i.test(t)||this.isDeleletedPreset(t)){return}this._presetsDeleted.push(t);var i=BX.userOptions.delay;BX.userOptions.delay=100;BX.userOptions.save("bizproc.interface.grid.filter",this.getId().toLowerCase(),"presetsDeleted",this._presetsDeleted.join(","));BX.userOptions.delay=i},requireFieldVisibilityChange:function(e){if(this._ignoreFieldVisibilityChange){return true}return!e.isVisible()||this.getVisibleFieldCount()>1},handleFieldVisibilityChange:function(e){if(this._ignoreFieldVisibilityChange){return}if(e.isVisible()){this._visibleFieldCount++}else{this._visibleFieldCount--}this._adjustStyle();this._showDeleteButtons(this._visibleFieldCount>1);this.saveVisibleFields()},requireItemActivityChange:function(e){return true},handleItemActivityChange:function(e){if(!e.isActive()){return}this._setActiveItem(e)},handleSaveAsDialogClose:function(e){if(e.getButtonId()!=="save"){return}var t=e.getValues();var i="filter_"+Math.random().toString().substring(2).toString();var s={name:t["name"]?t["name"]:BX.InterfaceGridFilter.getMessage("defaultFilterName"),fields:this.getFieldParams()};this._itemInfos[i]=s;var n=this._items[i]=BX.InterfaceGridFilterItem.create(i,BX.BizprocParamBag.create({filter:this,info:s,isActive:false}));n.setActive(true);this.saveActiveItem()},getFieldParams:function(){var e={};for(var t in this._fields){if(this._fields.hasOwnProperty(t)){this._fields[t].getParams(e)}}return e},setFieldParams:function(e){for(var t in this._fields){if(this._fields.hasOwnProperty(t)){this._fields[t].setParams(e)}}},_setActiveItem:function(e){var t=null;if(this._activeItemId!==""){t=this._items[this._activeItemId]}if(t){t.setFieldParams(this.getFieldParams());t.setVisibleFieldIds(this.getVisibleFieldIds());t.setActive(false)}this._activeItemId=e.getId();t=this._items[this._activeItemId];var i=this._getWrapper();if(t.isCurrent()){if(this.isApplied())BX.addClass(i,"bx-current-filter")}else{BX.removeClass(i,"bx-current-filter")}this.setFieldParams(t.getFieldParams());this._ignoreFieldVisibilityChange=true;this._visibleFieldCount=0;var s=t.getVisibleFieldIds();if(s.length>0){for(var n in this._fields){if(!this._fields.hasOwnProperty(n)){continue}var r=false;for(var a=0;a<s.length;a++){if(s[a]===n){r=true;break}}this._fields[n].setVisible(r);if(r){this._visibleFieldCount++}}}else{for(var n in this._fieldInfos){if(!this._fieldInfos.hasOwnProperty(n)){continue}var r=this._fieldInfos[n]["isVisible"];this._fields[n].setVisible(r);if(r){this._visibleFieldCount++}}}this._adjustStyle();this._showDeleteButtons(this._visibleFieldCount>1);this._ignoreFieldVisibilityChange=false},apply:function(e){var t=this._items[e];if(t){this._setActiveItem(t);this.applyActive()}},applyActive:function(){var e=this._currentItemId;this._currentItemId=this._activeItemId;if(e!==""){this._items[e].handleCurrentItemChange(this)}this._items[this._currentItemId].handleCurrentItemChange(this);var t=this.getForm();if(!t){return}var i=BX.findChild(t,{tag:"INPUT",property:{type:"hidden",name:"grid_filter_id"}},true,false);if(i){i.value=this._activeItemId!==this._defaultItemId?this._activeItemId:""}var s=BX.findChild(t,{tag:"INPUT",property:{type:"hidden",name:"apply_filter"}},true,false);if(s){s.value="Y"}BX.submit(t)},clear:function(){var e=this.getForm();if(!e){return}var t=BX.findChild(e,{tag:"INPUT",property:{type:"hidden",name:"clear_filter"}},true,false);if(t){t.value="Y"}this.setFieldParams({});BX.submit(e)},_adjustStyle:function(){var e=BX(this.getContainerId());if(!e){return}var t=BX.findChild(e,{"class":"bx-filter-bottom-separate"},true,false);var i=BX.findChild(e,{"class":"bx-filter-content"},true,false);if(this.getVisibleFieldCount()>1){BX.removeClass(i,"bx-filter-content-first");t.style.display=""}else{BX.addClass(i,"bx-filter-content-first");t.style.display="none"}},_getWrapper:function(){return BX.findChild(BX(this.getContainerId()),{tag:"DIV","class":"bx-filter-wrap"},true)},getAddFieldButton:function(){return BX.findChild(BX(this.getContainerId()),{tag:"SPAN","class":"bx-filter-add-button"},true,false)},getAddFilterButton:function(){return BX.findChild(BX(this.getContainerId()),{tag:"SPAN","class":"bx-filter-add-tab"},true,false)},getSettingsButton:function(){return BX.findChild(BX(this.getContainerId()),{tag:"SPAN","class":"bx-filter-setting"},true,false)},getApplyButton:function(){return BX.findChild(BX(this.getContainerId()),{tag:"INPUT",property:{type:"button",name:"set_filter"}},true,false)},getCancelButton:function(){return BX.findChild(BX(this.getContainerId()),{tag:"INPUT",property:{type:"button",name:"reset_filter"}},true,false)},getSwitchViewButton:function(){return BX.findChild(BX(this.getContainerId()),{tag:"SPAN","class":"bx-filter-switcher-tab"},true,false)},setFieldsVisible:function(e,t){this._ignoreFieldVisibilityChange=true;this._visibleFieldCount=0;e=!!e;t=t?t:{};var i=typeof t["skipTop"]!=="undefined"?parseInt(t["skipTop"]):0;var s=this._fields;for(var n in s){if(!s.hasOwnProperty(n)){continue}var r=s[n];if(r.isVisible()!==e){if(i>0){i--}else{r.setVisible(e)}}if(r.isVisible()){this._visibleFieldCount++}}this._adjustStyle();this._showDeleteButtons(this._visibleFieldCount>1);this.saveVisibleFields();this._ignoreFieldVisibilityChange=false},setFolded:function(e){e=!!e;if(e===this._isFolded){return}this._isFolded=e;if(this._closeOpen)this._closeOpen.toggle();var t=BX(this._settings.getParam("mainBlock",""));if(e){BX.addClass(this._getWrapper(),"bx-filter-folded");if(t)t.style.height="0"}else{BX.removeClass(this._getWrapper(),"bx-filter-folded")}if(this._activeItemId!==""){var i=this._items[this._activeItemId];if(i){i.handleFilterFoldingChange(this)}}var s=this.getSwitchViewButton();if(s){s.title=this.getMessage(e?"buttonMaximize":"buttonMinimize")}var n=BX.userOptions.delay;BX.userOptions.delay=100;BX.userOptions.save("bizproc.interface.grid.filter",this.getId().toLowerCase(),"isFolded",e?"Y":"N");BX.userOptions.delay=n},_showDeleteButtons:function(e){e=!!e;var t=this._fields;for(var i in t){if(t.hasOwnProperty(i)){t[i].showDeleteButton(e)}}},_handleAddFieldButtonClick:function(e){var t=[];var i=this._fields;for(var s in i){if(!i.hasOwnProperty(s)){continue}var n=i[s];t.push({id:n.getId(),text:n.getName(),onchange:n.getToggleHandler(),checked:n.isVisible()})}t.push({id:"__showAll",text:this.getMessage("showAll"),onclick:BX.delegate(this._handleShowAllButtonClick,this),checked:false,allowToggle:false,separatorBefore:true});t.push({id:"__hideAll",text:this.getMessage("hideAll"),onclick:BX.delegate(this._handleHideAllButtonClick,this),checked:false,allowToggle:false});var r=this.getAddFieldButton();var a=BX.pos(r);this._addFieldOpener=BX.InterfaceGridFilterCheckListMenu.create(this.getId()+"_ADD_FIELDS",BX.BizprocParamBag.create({allowToggle:true,items:t,anchor:r,offsetTop:Math.round(a.height/4),offsetLeft:Math.round(a.width/2),angle:{position:"top",offset:0}}));this._addFieldOpener.open()},_handleSettingsButtonClick:function(e){var t=[];if(this._activeItemId==this._defaultItemId){t.push({id:"saveAs",text:this.getMessage("saveAs"),onclick:BX.delegate(this._handleSaveAsMenuItemClick,this),checked:false})}else{t.push({id:"save",text:this.getMessage("save"),onclick:BX.delegate(this._handleSaveMenuItemClick,this),checked:false});t.push({id:"saveAs",text:this.getMessage("saveAs"),onclick:BX.delegate(this._handleSaveAsMenuItemClick,this),checked:false});t.push({id:"delete",text:this.getMessage("delete"),onclick:BX.delegate(this._handleDeleteMenuItemClick,this),checked:false})}var i=this.getSettingsButton();var s=BX.pos(i);this._settingsOpener=BX.InterfaceGridFilterCheckListMenu.create(this.getId()+"_SETTINGS_"+this._activeItemId.toUpperCase(),BX.BizprocParamBag.create({allowToggle:false,items:t,anchor:i,closeOnClick:true,offsetTop:Math.round(s.height/4),offsetLeft:Math.round(s.width/2),angle:{position:"top",offset:0}}));this._settingsOpener.open()},_handleApplyButtonClick:function(e){if(this._activeItemId===this._defaultItemId){this.applyActive();return}var t=this;this.saveActiveItem(function(){t.applyActive()})},_handleCancelButtonClick:function(e){this.clear()},_handleShowAllButtonClick:function(e){this.setFieldsVisible(true,{})},_handleHideAllButtonClick:function(e){this.setFieldsVisible(false,{skipTop:1})},_handleSaveMenuItemClick:function(e){if(this._isApplied&&this._currentItemId===this._activeItemId){var t=this;this.saveActiveItem(function(){t.applyActive()})}else{this.saveActiveItem()}},_handleSaveAsMenuItemClick:function(e){if(!this._saveAsDlg){this._saveAsDlg=BX.InterfaceGridFilterSaveAsDialog.create(this.getId()+"_SAVE_AS",BX.BizprocParamBag.create({filter:this}))}this._saveAsDlg.openDialog()},_handleDeleteMenuItemClick:function(e){var t=this._activeItemId;var i=this._items[t];if(t===this._defaultItemId||!i){return}this.deleteActiveItem();if(i.isCurrent()){this.clear()}i.clearLayout();this._items[this._defaultItemId].setActive(true);delete this._items[t]},_handleSwitchViewButtonClick:function(e){this.setFolded(!this.isFolded())}};BX.InterfaceGridFilter.isEmptyObject=function(e){if(e===null||e===undefined){return true}var t=Object.prototype.hasOwnProperty;if(typeof e.length!=="undefined"){return e.length===0}if(typeof e==="object"){for(var i in e){if(t.call(e,i)){return false}}}return true};if(typeof BX.InterfaceGridFilter.messages==="undefined"){BX.InterfaceGridFilter.messages={}}BX.InterfaceGridFilter.getMessage=function(e){return typeof BX.InterfaceGridFilter.messages[e]!=="undefined"?BX.InterfaceGridFilter.messages[e]:""};BX.InterfaceGridFilter.items={};BX.InterfaceGridFilter.create=function(e,t){var i=new BX.InterfaceGridFilter;i.initialize(e,t);this.items[e]=i;return i}}if(typeof BX.InterfaceGridFilterItem==="undefined"){BX.InterfaceGridFilterItem=function(){this._id="";this._settings=null;this._filter=null;this._container=null;this._isActive=false;this._info={};this._fieldParams={};this._visibleFieldIds=[]};BX.InterfaceGridFilterItem.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"";this._settings=t?t:BX.BizprocParamBag.create(null);this._filter=t.getParam("filter",null);this._info=t.getParam("info",{});this._fieldParams=typeof this._info["fields"]!=="undefined"?this._info["fields"]:{};var i=typeof this._info["filter_rows"]!=="undefined"?this._info["filter_rows"]:null;if(BX.type.isString(i)){i=i.split(",")}if(BX.type.isArray(i)){this._visibleFieldIds=i}else{for(var s in this._fieldParams){if(this._fieldParams.hasOwnProperty(s)){this._visibleFieldIds.push(BX.InterfaceGridFilterField.convertParamToFieldId(s))}}}this._isActive=t.getParam("isActive",false);var n=this._filter.getItemContainerId(e);this._container=BX(n);if(!this._container){this.layout()}BX.bind(this._container,"click",BX.delegate(this._onClick,this))},getId:function(){return this._id},getName:function(){return this._info["name"]},getInfo:function(){return this._info},isActive:function(){return this._isActive},isCurrent:function(){return this._filter.getCurrentItemId()===this.getId()},setActive:function(e){e=!!e;if(this._isActive===e){return}if(!this._filter.requireItemActivityChange(this)){return}this._isActive=e;this._filter.handleItemActivityChange(this);this._adjustStyle()},getFieldParams:function(){return this._fieldParams},setFieldParams:function(e){this._fieldParams=e},getVisibleFieldIds:function(){return this._visibleFieldIds},setVisibleFieldIds:function(e){this._visibleFieldIds=e},layout:function(){var e=BX.findChild(BX(this._filter.getContainerId()),{tag:"DIV","class":"bx-filter-tabs-block"},true);if(!e){return}this._container=BX.create("SPAN",{props:{id:this._filter.getItemContainerId(this.getId())},attrs:{"class":"bx-filter-tab"},text:this.getName()});e.insertBefore(this._container,this._filter.getAddFilterButton())},clearLayout:function(){if(!this._container){return}BX.remove(this._container)},_adjustStyle:function(){if(this._filter.isFolded()){if(this.isCurrent()){BX.addClass(this._container,"bx-filter-tab-active")}else{BX.removeClass(this._container,"bx-filter-tab-active")}}else{if(this._isActive){BX.addClass(this._container,"bx-filter-tab-active")}else{BX.removeClass(this._container,"bx-filter-tab-active")}}},handleFilterFoldingChange:function(e){this._adjustStyle()},handleCurrentItemChange:function(e){this._adjustStyle()},_onClick:function(e){if(!this.isActive()){this.setActive(true)}if(this._filter.isFolded()){this._filter.applyActive()}}};BX.InterfaceGridFilterItem.create=function(e,t){var i=new BX.InterfaceGridFilterItem;i.initialize(e,t);return i}}if(typeof BX.InterfaceGridFilterField==="undefined"){BX.InterfaceGridFilterField=function(){this._id="";this._settings=null;this._filter=null;this._info={};this._container=null;this._delimiterContainer=null;this._isVisible=true;this._deleteButton=null;this._controller=null};BX.InterfaceGridFilterField.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"";this._settings=t?t:BX.BizprocParamBag.create(null);this._filter=t.getParam("filter",null);this._container=BX(this._filter.getFieldContainerId(e));this._delimiterContainer=BX(this._filter.getFieldDelimiterContainerId(e));this._info=t.getParam("info",{});this._isVisible=this._info["isVisible"];this._deleteButton=BX.findChild(this._container,{tag:"SPAN","class":"bx-filter-item-delete"},true,false);if(this._deleteButton){this._deleteButton.title=BX.InterfaceGridFilter.getMessage("buttonDeleteField");BX.bind(this._deleteButton,"click",BX.delegate(this._handleDeleteButtonClick,this))}if(this.getType()==="date"){this._controller=BX.InterfaceGridFilterDate.create(BX.BizprocParamBag.create({containerId:this._filter.getFieldContainerId(e),formName:this._filter.getFormName(),currentTime:this._filter.getCurrentTime()}))}if(this._controller){this._controller.layout()}this._handleVisibilityChange()},initializeController:function(){if(this.getType()!=="custom"){return}var e=this._filter.getFieldInfo(this._id);if(e&&e["typeName"]==="USER"){this._controller=BX.InterfaceGridFilterUser.create(BX.BizprocParamBag.create({containerId:this._filter.getFieldContainerId(this._id),info:e}));if(this._controller){this._controller.layout()}}},getId:function(){return this._id},getName:function(){return this._info["name"]},getType:function(){return this._info["type"]},isVisible:function(){return this._isVisible},getToggleHandler:function(){return BX.delegate(this._handleToggleButtonClick,this)},_handleToggleButtonClick:function(e){this.toggle()},_handleDeleteButtonClick:function(e){this.setVisible(false)},_handleVisibilityChange:function(){var e=BX.findChildren(this._container,{tag:/^INPUT|SELECT|TEXTAREA/i},true);if(!BX.type.isArray(e)){return}var t=!this._isVisible;for(var i=0;i<e.length;i++){var s=e[i];var n=s.name;if(n===""){continue}s.disabled=t}},setVisible:function(e){e=!!e;if(this._isVisible===e){return}if(!this._filter.requireFieldVisibilityChange(this)){return}this._container.style.display=e?"":"none";if(this._delimiterContainer){this._delimiterContainer.style.display=e?"":"none"}this._isVisible=e;this._handleVisibilityChange();this._filter.handleFieldVisibilityChange(this)},toggle:function(){this.setVisible(!this._isVisible)},showDeleteButton:function(e){if(this._deleteButton){this._deleteButton.style.display=!!e?"":"none"}},getParams:function(e){if(!this.isVisible()){return}if(this._controller&&this._controller.tryGetParams(e)){return}var t=BX.findChildren(this._container,{tag:/^INPUT|SELECT|TEXTAREA/i},true);for(var i=0;i<t.length;i++){var s=t[i];var n=s.name;if(n===""){continue}switch(s.type.toLowerCase()){case"select-one":case"text":case"textarea":case"hidden":{e[n]=s.value;break}case"radio":{if(s.checked){e[n]=s.value}break}case"checkbox":{e[n]=s.checked?s.value:false;break}case"select-multiple":{n=n.substr(0,n.length-2);e[n]={};for(var r=0;r<s.options.length;r++){if(s.options[r].selected&&s.options[r].value){e[n]["sel"+s.options[r].value]=s.options[r].value}}break}}}},setParams:function(e){if(this._controller&&this._controller.trySetParams(e)){return}var t=BX.findChildren(this._container,{tag:/^INPUT|SELECT|TEXTAREA/i},true);var i=false;for(var s=0;s<t.length;s++){var n=t[s];var r=n.name;if(r===""){continue}var a=false;var l=typeof e[r]!=="undefined"?e[r]:null;switch(n.type.toLowerCase()){case"select-one":case"text":case"textarea":n.value=l!==null?l:"";a=true;break;case"select-multiple":{r=r.substr(0,r.length-2);l=typeof e[r]==="object"&&e[r]?e[r]:{};if(l===null){for(var o=0;o<n.options.length;o++){n.options[o].selected=false}}else{var h=false;for(var d=0;d<n.options.length;d++){var c=n.options[d];var u="sel"+c.value;var f=l[u]?l[u]:null;c.selected=c.value==f;if(c.value==f){h=true}}if(!h&&n.options.length>0&&n.options[0].value==""){n.options[0].selected=true}}a=true;break}case"radio":case"checkbox":{n.checked=l!==null?l:false}a=true;break}if(a){if(!i){i=true}if(BX.type.isFunction(n.onchange)){try{n.onchange()}catch(_){}}}}if(i&&this._controller&&BX.type.isFunction(this._controller.handleParamsChange)){this._controller.handleParamsChange()}}};BX.InterfaceGridFilterField.convertParamToFieldId=function(e){return e.replace(/_[a-z]+$/,"")};BX.InterfaceGridFilterField.create=function(e,t){var i=new BX.InterfaceGridFilterField;i.initialize(e,t);return i}}if(typeof BX.InterfaceGridFilterDate==="undefined"){BX.InterfaceGridFilterDate=function(){this._settings=null;this._container=null};BX.InterfaceGridFilterDate.prototype={initialize:function(e){this._settings=e?e:BX.BizprocParamBag.create(null);this._container=BX(e.getParam("containerId"));var t=BX.findChild(this._container,{tag:"SELECT","class":"bx-filter-date-interval-select"},true,false);if(t){BX.bind(t,"change",BX.delegate(this._onIntervalChange,this))}BX.bind(BX.findChild(BX.findChild(this._container,{tag:"DIV","class":"bx-filter-date-from"},true,false),{tag:"SPAN","class":"bx-calendar-icon"},true,false),"click",BX.delegate(this._onDataFromClick,this));BX.bind(BX.findChild(BX.findChild(this._container,{tag:"DIV","class":"bx-filter-date-to"},true,false),{tag:"SPAN","class":"bx-calendar-icon"},true,false),"click",BX.delegate(this._onDataToClick,this))},_openCalendar:function(e,t){BX.calendar({node:e,field:t,form:this._settings.getParam("formName"),bTime:false,currentTime:this._settings.getParam("currentTime"),bHideTime:false})},_onIntervalChange:function(e){this.layout()},_onDataFromClick:function(e){var t=BX.findChild(this._container,{tag:"DIV","class":"bx-filter-date-from"},true,false);if(!t){return}this._openCalendar(BX.findChild(t,{tag:"SPAN","class":"bx-calendar-icon"},true,false),BX.findChild(t,{tag:"INPUT","class":"bx-input-date"},true,false))},_onDataToClick:function(e){var t=BX.findChild(this._container,{tag:"DIV","class":"bx-filter-date-to"},true,false);if(!t){return}this._openCalendar(BX.findChild(t,{tag:"SPAN","class":"bx-calendar-icon"},true,false),BX.findChild(t,{tag:"INPUT","class":"bx-input-date"},true,false))},_displayNode:function(e,t){var i=BX.findChild(this._container,e,true,false);if(i){i.style.display=t?"":"none"}},layout:function(){var e=BX.findChild(this._container,{tag:"SELECT","class":"bx-filter-date-interval-select"},true,false);if(!e){return}var t,i,s,n;t=i=s=n=false;var r=e.value;if(r==="interval"){t=i=s=true}else if(r==="before"){i=true}else if(r==="after"||r==="exact"){t=true}else if(r==="days"){n=true}this._displayNode({tag:"DIV","class":"bx-filter-date-days"},n);this._displayNode({tag:"DIV","class":"bx-filter-date-from"},t);this._displayNode({tag:"DIV","class":"bx-filter-date-to"},i);this._displayNode({tag:"SPAN","class":"bx-filter-calendar-separate"},s)},tryGetParams:function(e){return false},trySetParams:function(e){return false},handleParamsChange:function(){this.layout()}};BX.InterfaceGridFilterDate.create=function(e){var t=new BX.InterfaceGridFilterDate;t.initialize(e);return t}}if(typeof BX.InterfaceGridFilterUser==="undefined"){BX.InterfaceGridFilterUser=function(){this._settings=null;this._info=null;this._container=null};BX.InterfaceGridFilterUser.prototype={initialize:function(e){this._settings=e?e:BX.BizprocParamBag.create(null);this._container=BX(e.getParam("containerId"));this._info=e.getParam("info",null)},layout:function(){},trySetParams:function(e){if(!this._info){return false}var t=this._info["params"]?this._info["params"]:{};var i=t["data"]?t["data"]:{};this._setElementByParam(i["elementId"],i["paramName"],e);var s=t["search"]?t["search"]:{};this._setElementByParam(s["elementId"],s["paramName"],e);return true},tryGetParams:function(e){return false},_setElementByParam:function(e,t,i){var s=BX.type.isNotEmptyString(e)?BX(e):null;if(BX.type.isElementNode(s)){s.value=BX.type.isNotEmptyString(t)&&i[t]?i[t]:""}}};BX.InterfaceGridFilterUser.create=function(e){var t=new BX.InterfaceGridFilterUser;t.initialize(e);return t}}if(typeof BX.InterfaceGridFilterSaveAsDialog==="undefined"){BX.InterfaceGridFilterSaveAsDialog=function(){this._id="";this._settings=null;this._filter=null;this._dlg=null;this._buttonId="";this._nameInput=null};BX.InterfaceGridFilterSaveAsDialog.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:BX.BizprocParamBag.create(null);this._filter=t.getParam("filter",null)},getId:function(){return this._id},getButtonId:function(){return this._buttonId},getValues:function(){return{name:this._nameInput?this._nameInput.value:""}},openDialog:function(){if(this._dlg){this._dlg.show();return}this._dlg=new BX.PopupWindow(this.getId()+"_SAVE_AS",null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:true,titleBar:BX.InterfaceGridFilter.getMessage("saveAsDialogTitle"),events:{onPopupClose:BX.delegate(this._handleDialogClose,this)},content:this._prepareContent(),buttons:this._prepareButtons()});this._dlg.show()},_prepareContent:function(){var e=BX.create("TABLE",{style:{width:"350px",margin:"5px 0 0 0"}});var t=e.insertRow(-1);var i=t.insertCell(-1);i.align="right";i.innerHTML=BX.InterfaceGridFilter.getMessage("saveAsDialogFieldName")+":";i=t.insertCell(-1);this._nameInput=BX.create("INPUT",{style:{width:"200px"},props:{type:"text",maxlength:"255",size:"30"},text:BX.InterfaceGridFilter.getMessage("defaultFilterName")});i.appendChild(this._nameInput);return e},_prepareButtons:function(){return[new BX.PopupWindowButton({text:BX.InterfaceGridFilter.getMessage("buttonSave"),className:"popup-window-button-accept",events:{click:BX.delegate(this._handleSaveButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.InterfaceGridFilter.getMessage("buttonCancel"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this._handleCancelButtonClick,this)}})]},_handleSaveButtonClick:function(e){this._buttonId="save";this._filter.handleSaveAsDialogClose(this);this._dlg.close()},_handleCancelButtonClick:function(e){this._buttonId="cancel";this._filter.handleSaveAsDialogClose(this);this._dlg.close()},_handleDialogClose:function(e){if(this._dlg){this._dlg.destroy()}this._dlg=null}};BX.InterfaceGridFilterSaveAsDialog.create=function(e,t){var i=new BX.InterfaceGridFilterSaveAsDialog;i.initialize(e,t);return i}}if(typeof BX.InterfaceGridFilterCheckListMenu==="undefined"){BX.InterfaceGridFilterCheckListMenu=function(){this._id="";this._settings=null;this._filter=null;this._allowToggle=true;this._items=[];this._menuId="";this._menu=null};BX.InterfaceGridFilterCheckListMenu.prototype={initialize:function(e,t){this._id=e;this._menuId=this._id.toLowerCase();this._settings=t?t:BX.BizprocParamBag.create(null);this._filter=t.getParam("filter",null);this._allowToggle=this.getSetting("allowToggle",true);this._closeOnClick=this.getSetting("closeOnClick",false);var i=this.getSetting("items");for(var s=0;s<i.length;s++){var n=i[s];this._items.push(BX.InterfaceGridFilterCheckListMenuItem.create(n["id"],BX.BizprocParamBag.create({text:BX.type.isString(n["text"])?n["text"]:"",checked:BX.type.isBoolean(n["checked"])?n["checked"]:false,onchange:BX.type.isFunction(n["onchange"])?n["onchange"]:null,onclick:BX.type.isFunction(n["onclick"])?n["onclick"]:null,allowToggle:BX.type.isBoolean(n["allowToggle"])?n["allowToggle"]:this._allowToggle,closeOnClick:BX.type.isBoolean(n["closeOnClick"])?n["closeOnClick"]:this._closeOnClick,separatorBefore:BX.type.isBoolean(n["separatorBefore"])?n["separatorBefore"]:false,separatorAfter:BX.type.isBoolean(n["separatorAfter"])?n["separatorAfter"]:false,menu:this})))}},getId:function(){return this._id},getSetting:function(e,t){return this._settings.getParam(e,t)},open:function(){var e=[];for(var t=0;t<this._items.length;t++){var i=this._items[t].createPopupMenuItems();for(var s=0;s<i.length;s++){e.push(i[s])}}if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){BX.PopupMenu.Data[this._menuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._menuId]}this._menu=BX.PopupMenu.show(this._menuId,this.getSetting("anchor",null),e,{offsetTop:parseInt(this.getSetting("offsetTop",0)),offsetLeft:parseInt(this.getSetting("offsetLeft",0)),angle:this.getSetting("angle",{})})},close:function(){if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){BX.PopupMenu.Data[this._menuId].popupWindow.close()}},getContainer:function(){return BX("menu-popup-"+this.getId().toLowerCase())}};BX.InterfaceGridFilterCheckListMenu.create=function(e,t){var i=new BX.InterfaceGridFilterCheckListMenu;i.initialize(e,t);return i}}if(typeof BX.InterfaceGridFilterCheckListMenuItem==="undefined"){BX.InterfaceGridFilterCheckListMenuItem=function(){this._id="";this._settings=null;this._menu=null;this._checked=false;this._allowToggle=true;this._closeOnClick=false};BX.InterfaceGridFilterCheckListMenuItem.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:BX.BizprocParamBag.create(null);this._menu=t.getParam("menu",null);this._checked=t.getParam("checked",false);this._allowToggle=this.getSetting("allowToggle",true);this._closeOnClick=this.getSetting("closeOnClick",false);

},getSetting:function(e,t){return this._settings.getParam(e,t)},getId:function(){return this._id},isChecked:function(){return this._checked},setChecked:function(e){e=!!e;if(this._checked===e){return}this._checked=e;var t=this.getSetting("onchange",null);if(BX.type.isFunction(t)){try{t({id:this.getId(),checked:e},this)}catch(i){}}},toggle:function(){if(this._allowToggle){this.setChecked(!this.isChecked())}},createPopupMenuItems:function(){var e=[];if(this.getSetting("separatorBefore",false)){e.push({SEPARATOR:true})}e.push({text:this.getSetting("text",this.getId()),className:"bp-filter-popup-item"+(this.isChecked()?" menu-popup-item-checked":"")+" bp-check-list-menu-item-"+this.getId().toLowerCase(),href:"#",onclick:BX.delegate(this._onClick,this)});if(this.getSetting("separatorAfter",false)){e.push({SEPARATOR:true})}return e},_onClick:function(e){BX.PreventDefault(e);var t=this.getSetting("onclick",null);if(BX.type.isFunction(t)){try{t({id:this.getId(),checked:this.isChecked()},this)}catch(i){}}if(this._closeOnClick){this._menu.close();return}this.toggle();var s=BX.findChild(this._menu.getContainer(),{tag:"A","class":"bp-check-list-menu-item-"+this.getId().toLowerCase()},true,false);if(this.isChecked()){BX.addClass(s,"menu-popup-item-checked")}else{BX.removeClass(s,"menu-popup-item-checked")}}};BX.InterfaceGridFilterCheckListMenuItem.create=function(e,t){var i=new BX.InterfaceGridFilterCheckListMenuItem;i.initialize(e,t);return i}}if(typeof BX.InterfaceGridFilterCloseOpen==="undefined"){BX.InterfaceGridFilterCloseOpen=function(e,t,i){this.filter=i;this.innerBlock=BX(e);this.mainBlock=BX(t);this.isOpen=null};BX.InterfaceGridFilterCloseOpen.prototype={initialize:function(){this.isOpen=!this.filter.isFolded()},_easing:function(e){var t=this;var i=new BX.easing({duration:300,start:{height:e.start},finish:{height:e.finish},transition:BX.easing.makeEaseOut(BX.easing.transitions.circ),step:BX.delegate(this._step,this),complete:BX.proxy(this._complete,this)});i.animate()},toggle:function(){if(this.isOpen){this._easing({start:this.innerBlock.offsetHeight,finish:0});this.isOpen=false}else{this._easing({start:this.mainBlock.offsetHeight,finish:this.innerBlock.offsetHeight});this.isOpen=true}},_step:function(e){this.mainBlock.style.height=e.height+"px"},_complete:function(){if(this.isOpen)this.mainBlock.style.height="auto"}}}if(typeof BX.CrmUserSearchPopup==="undefined"){BX.CrmUserSearchPopup=function(){this._id="";this._search_input=null;this._data_input=null;this._componentName="";this._componentContainer=null;this._componentObj=null;this._serviceContainer=null;this._zIndex=0;this._dlg=null;this._dlgDisplayed=false;this._currentUser={};this._searchKeyHandler=BX.delegate(this._handleSearchKey,this);this._searchFocusHandler=BX.delegate(this._handleSearchFocus,this);this._externalClickHandler=BX.delegate(this._handleExternalClick,this);this._clearButtonClickHandler=BX.delegate(this._hadleClearButtonClick,this);this._userSelectorInitCounter=0};BX.CrmUserSearchPopup.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"crm_user_search_popup_"+Math.random();if(!t){t={}}if(!BX.type.isElementNode(t["searchInput"])){throw"BX.CrmUserSearchPopup: 'search_input' is not defined!"}this._search_input=t["searchInput"];this._clearButton=BX.findPreviousSibling(this._search_input,{className:"bizproc-user-search-filter-clean"});if(!BX.type.isElementNode(t["dataInput"])){throw"BX.CrmUserSearchPopup: 'data_input' is not defined!"}this._data_input=t["dataInput"];if(!BX.type.isNotEmptyString(t["componentName"])){throw"BX.CrmUserSearchPopup: 'componentName' is not defined!"}this._currentUser=t["user"]?t["user"]:{};this._componentName=t["componentName"];this._componentContainer=BX(this._componentName+"_selector_content");this._initializeUserSelector();this._adjustUser();this._serviceContainer=t["serviceContainer"]?t["serviceContainer"]:document.body;this.setZIndex(t["zIndex"])},_initializeUserSelector:function(){var e="O_"+this._componentName;if(!window[e]){if(this._userSelectorInitCounter===10){throw"BX.CrmUserSearchPopup: Could not find '"+e+"' user selector!"}this._userSelectorInitCounter++;window.setTimeout(BX.delegate(this._initializeUserSelector,this),200);return}this._componentObj=window[e];this._componentObj.onSelect=BX.delegate(this._handleUserSelect,this);this._componentObj.searchInput=this._search_input;if(this._currentUser&&this._currentUser["id"]>0){this._componentObj.setSelected([this._currentUser])}BX.bind(this._search_input,"keyup",this._searchKeyHandler);BX.bind(this._search_input,"focus",this._searchFocusHandler);if(BX.type.isElementNode(this._clearButton)){BX.bind(this._clearButton,"click",this._clearButtonClickHandler)}BX.bind(document,"click",this._externalClickHandler)},open:function(){this._componentContainer.style.display="";this._dlg=new BX.PopupWindow(this._id,this._search_input,{autoHide:false,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,zIndex:this._zIndex,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(function(){this._dlgDisplayed=true},this),onPopupClose:BX.delegate(function(){this._dlgDisplayed=false;this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._dlg.destroy()},this),onPopupDestroy:BX.delegate(function(){this._dlg=null},this)}});this._dlg.show()},_adjustUser:function(){if(parseInt(this._currentUser["id"])>0){this._data_input.value=this._currentUser["id"];this._search_input.value=this._currentUser["name"]?this._currentUser.name:this._currentUser["id"]}else{this._data_input.value=this._search_input.value=""}},getZIndex:function(){return this._zIndex},setZIndex:function(e){if(typeof e==="undefined"||e===null){e=0}var t=parseInt(e);this._zIndex=!isNaN(t)?t:0},close:function(){if(this._dlg){this._dlg.close()}},select:function(e){this._currentUser=e;this._adjustUser();if(this._componentObj){this._componentObj.setSelected([e])}},_onBeforeDelete:function(){if(BX.type.isElementNode(this._search_input)){BX.unbind(this._search_input,"keyup",this._searchKeyHandler);BX.unbind(this._search_input,"focus",this._searchFocusHandler)}if(BX.type.isElementNode(this._clearButton)){BX.bind(this._clearButton,"click",this._clearButtonClickHandler)}BX.unbind(document,"click",this._externalClickHandler);if(this._componentContainer){this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._componentContainer=null}},_hadleClearButtonClick:function(e){this._data_input.value=this._search_input.value=""},_handleExternalClick:function(e){if(!e){e=window.event}if(!this._dlgDisplayed){return}var t=null;if(e){if(e.target){t=e.target}else if(e.srcElement){t=e.srcElement}}if(t!==this._search_input&&!BX.findParent(t,{attribute:{id:this._componentName+"_selector_content"}})){this._adjustUser();this.close()}},_handleSearchKey:function(e){if(!this._dlg||!this._dlgDisplayed){this.open()}this._componentObj.search()},_handleSearchFocus:function(e){if(!this._dlg||!this._dlgDisplayed){this.open()}this._componentObj._onFocus(e)},_handleUserSelect:function(e){this._currentUser=e;this._adjustUser();this.close()}};BX.CrmUserSearchPopup.items={};BX.CrmUserSearchPopup.create=function(e,t,i){if(isNaN(i)){i=0}if(i>0){window.setTimeout(function(){BX.CrmUserSearchPopup.create(e,t,0)},i);return null}var s=new BX.CrmUserSearchPopup;s.initialize(e,t);this.items[e]=s;return s};BX.CrmUserSearchPopup.createIfNotExists=function(e,t){var i=this.items[e];if(typeof i!=="undefined"){i.initialize(e,t)}else{i=new BX.CrmUserSearchPopup;i.initialize(e,t);this.items[e]=i}return i};BX.CrmUserSearchPopup.deletePopup=function(e){var t=this.items[e];if(typeof t==="undefined"){return false}t._onBeforeDelete();delete this.items[e];return true}}
/* End */
;; /* /bitrix/components/bitrix/bizproc.interface.grid/templates/.default/bitrix/main.interface.grid/.default/script.min.js?154412738736576*/
; /* /bitrix/components/bitrix/bizproc.interface.filter/templates/.default/bitrix/main.interface.filter/.default/script.min.js?154412738740029*/

//# sourceMappingURL=page_53df453f028164f130f83bb221d9d974.map.js