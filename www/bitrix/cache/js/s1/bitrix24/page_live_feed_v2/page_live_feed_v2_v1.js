
; /* Start:"a:4:{s:4:"full";s:107:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.group_menu/.default/script.min.js?15441276453524";s:6:"source";s:88:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.group_menu/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){if(!!BX.BXSGM24){return}BX.BXSGM24={currentUserId:null,groupdId:null,userIsMember:null,userIsAutoMember:null,userRole:null,isProject:null,favoritesValue:null,canInitiate:null,canModify:null,editFeaturesAllowed:true};BX.BXSGM24.init=function(e){this.currentUserId=parseInt(e.currentUserId);this.groupId=parseInt(e.groupId);this.userIsMember=!!e.userIsMember;this.userIsAutoMember=!!e.userIsAutoMember;this.userRole=e.userRole;this.isProject=!!e.isProject;this.isOpened=!!e.isOpened;this.favoritesValue=!!e.favoritesValue;this.canInitiate=!!e.canInitiate;this.canModify=!!e.canModify;if(typeof e.urls!="undefined"){this.urls=e.urls}this.editFeaturesAllowed=typeof e.editFeaturesAllowed!="undefined"?!!e.editFeaturesAllowed:true;var t=BX.delegate(function(e){if(BX.type.isNotEmptyString(e.code)){if(BX.util.in_array(e.code,["afterJoinRequestSend","afterEdit"])){if(BX("bx-group-menu-join-cont")){BX("bx-group-menu-join-cont").style.display="none"}BX.SocialnetworkUICommon.reload()}else if(BX.util.in_array(e.code,["afterSetFavorites"])){var t=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();var s=t.favoritesValue;t.setItemTitle(!s);t.favoritesValue=!s}}},this);BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var s=e.getData();t(s)}},this));BX.addCustomEvent("sonetGroupEvent",t);if(BX("bx-group-menu-join")){BX.bind(BX("bx-group-menu-join"),"click",BX.delegate(this.sendJoinRequest,this))}if(BX("bx-group-menu-settings")){var s=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();s.favoritesValue=this.favoritesValue;BX.bind(BX("bx-group-menu-settings"),"click",BX.delegate(function(e){BX.SocialnetworkUICommon.showGroupMenuPopup({bindElement:BX.getEventTarget(e),groupId:this.groupId,userIsMember:this.userIsMember,userIsAutoMember:this.userIsAutoMember,userRole:this.userRole,isProject:this.isProject,isOpened:this.isOpened,editFeaturesAllowed:this.editFeaturesAllowed,perms:{canInitiate:this.canInitiate,canProcessRequestsIn:this.canProcessRequestsIn,canModify:this.canModify},urls:{requestUser:BX.message("SGMPathToRequestUser"),edit:BX.message("SGMPathToEdit"),delete:BX.message("SGMPathToDelete"),features:BX.message("SGMPathToFeatures"),members:BX.message("SGMPathToMembers"),requests:BX.message("SGMPathToRequests"),requestsOut:BX.message("SGMPathToRequestsOut"),userRequestGroup:BX.message("SGMPathToUserRequestGroup"),userLeaveGroup:BX.message("SGMPathToUserLeaveGroup")}});e.preventDefault()},this))}BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var t=e.getData();if(BX.type.isNotEmptyString(t.code)&&typeof t.data!="undefined"&&BX.util.in_array(t.code,["afterDelete","afterLeave"])&&typeof t.data.groupId!="undefined"&&parseInt(t.data.groupId)==this.groupId){top.location.href=this.urls.groupsList}}},this))};BX.BXSGM24.sendJoinRequest=function(e){var t=e.currentTarget;BX.SocialnetworkUICommon.showButtonWait(t);BX.ajax({url:t.getAttribute("bx-request-url"),method:"POST",dataType:"json",data:{groupID:this.groupId,MESSAGE:"",ajax_request:"Y",save:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.SocialnetworkUICommon.hideButtonWait(t);if(typeof e.MESSAGE!="undefined"&&e.MESSAGE=="SUCCESS"&&typeof e.URL!="undefined"){BX.onCustomEvent(window.top,"sonetGroupEvent",[{code:"afterJoinRequestSend",data:{groupId:this.groupId}}]);top.location.href=e.URL}},this),onfailure:BX.delegate(function(){BX.SocialnetworkUICommon.hideButtonWait(t)},this)})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.group/.default/script.min.js?15441276457606";s:6:"source";s:83:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.group/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Bitrix24");if(window["B24SGControl"]){return}window.B24SGControl=function(){this.instance=null;this.groupId=null;this.groupOpened=false;this.waitPopup=null;this.waitTimeout=null;this.notifyHintPopup=null;this.notifyHintTimeout=null;this.notifyHintTime=3e3;this.favoritesValue=null;this.newValue=null};window.B24SGControl.getInstance=function(){if(window.B24SGControl.instance==null){window.B24SGControl.instance=new B24SGControl}return window.B24SGControl.instance};window.B24SGControl.prototype={init:function(e){if(typeof e=="undefined"||typeof e.groupId=="undefined"||parseInt(e.groupId)<=0){return}this.groupId=parseInt(e.groupId);this.favoritesValue=!!e.favoritesValue;this.groupOpened=!!e.groupOpened;if(BX("bx-group-join-submit")){BX.bind(BX("bx-group-join-submit"),"click",BX.delegate(this.sendJoinRequest,this))}BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",BX.delegate(function(){this.favoritesValue=true},this));BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",BX.delegate(function(){this.favoritesValue=false},this));BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var t=e.getData();if(t.code=="afterSetFavorites"&&typeof t.data!="undefined"&&parseInt(t.data.groupId)>0&&parseInt(t.data.groupId)==this.groupId&&typeof t.data.value!="undefined"){this.favoritesValue=!!t.data.value}if(t.code=="afterSetSubscribe"&&typeof t.data!="undefined"&&parseInt(t.data.groupId)>0&&parseInt(t.data.groupId)==this.groupId&&typeof t.data.value!="undefined"){this.setNotifyButton(t.data.value,false)}if(e.slider===top.BX.SidePanel.Instance.getSliderByWindow(window)&&BX("socialnetwork-group-sidebar-block")&&BX.util.in_array(t.code,["afterModeratorAdd","afterModeratorRemove","afterOwnerSet","afterUserExclude"])&&typeof t.data!="undefined"&&parseInt(t.data.groupId)>0&&parseInt(t.data.groupId)==this.groupId){BX.SocialnetworkUICommon.reloadBlock({blockId:"socialnetwork-group-sidebar-block"})}}},this))},setSubscribe:function(e){var t=this;t.showWait();var o=!BX.hasClass(BX("group_menu_subscribe_button"),"webform-button-active")?"set":"unset";BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.group_menu/ajax.php",method:"POST",dataType:"json",data:{groupID:t.groupId,action:o=="set"?"set":"unset",sessid:BX.bitrix_sessid()},onsuccess:function(e){t.processSubscribeAJAXResponse(e)}});BX.PreventDefault(e)},sendJoinRequest:function(e){BX.SocialnetworkUICommon.hideError(BX("bx-group-join-error"));BX.SocialnetworkUICommon.showButtonWait(BX("bx-group-join-submit"));BX.ajax({url:BX("bx-group-join-submit").getAttribute("bx-request-url"),method:"POST",dataType:"json",data:{groupID:this.groupId,MESSAGE:BX("bx-group-join-message")?BX("bx-group-join-message").value:"",ajax_request:"Y",save:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.SocialnetworkUICommon.hideButtonWait(BX("bx-group-join-submit"));if(typeof e.MESSAGE!="undefined"&&e.MESSAGE=="SUCCESS"&&typeof e.URL!="undefined"){BX.addClass(BX("bx-group-join-form"),"sonet-group-user-request-form-invisible");BX.onCustomEvent(window.top,"sonetGroupEvent",[{code:"afterJoinRequestSend",data:{groupId:this.groupId}}]);top.location.href=e.URL}else if(typeof e.MESSAGE!="undefined"&&e.MESSAGE=="ERROR"&&typeof e.ERROR_MESSAGE!="undefined"&&e.ERROR_MESSAGE.length>0){BX.SocialnetworkUICommon.showError(e.ERROR_MESSAGE,BX("bx-group-join-error"))}},this),onfailure:BX.delegate(function(){BX.SocialnetworkUICommon.showError(BX.message("SONET_C6_T_AJAX_ERROR"),BX("bx-group-join-error"));BX.SocialnetworkUICommon.hideButtonWait(BX("bx-group-join-submit"))},this)})},setFavorites:function(e){var t=this;t.showWait();t.newValue=!t.favoritesValue;BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.group_menu/ajax.php",method:"POST",dataType:"json",data:{groupID:t.groupId,action:t.favoritesValue?"fav_unset":"fav_set",sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID")},onsuccess:function(e){t.processFavoritesAJAXResponse(e);if(typeof e.NAME!="undefined"&&typeof e.URL!="undefined"){BX.onCustomEvent(window,"BX.Socialnetwork.WorkgroupFavorites:onSet",[{id:t.groupId,name:e.NAME,url:e.URL,extranet:typeof e.EXTRANET!="undefined"?e.EXTRANET:"N"},t.newValue])}},onfailure:function(e){}});BX.PreventDefault(e)},setNotifyButton:function(e,t){t=!!t;var o=BX("group_menu_subscribe_button",true);if(o){if(e){if(t){this.showNotifyHint(o,BX.message("SGMSubscribeButtonHintOn"))}BX.adjust(o,{attrs:{title:BX.message("SGMSubscribeButtonTitleOn")}});BX.addClass(o,"webform-button-active")}else{if(t){this.showNotifyHint(o,BX.message("SGMSubscribeButtonHintOff"))}BX.adjust(o,{attrs:{title:BX.message("SGMSubscribeButtonTitleOff")}});BX.removeClass(o,"webform-button-active")}}},processSubscribeAJAXResponse:function(e){var t=this;if(typeof e.SUCCESS!="undefined"&&e.SUCCESS=="Y"){t.closeWait();var o=BX("group_menu_subscribe_button");if(o){BX.delegate(function(){this.setNotifyButton(typeof e.RESULT=="undefined"||e.RESULT!="N",true)},t)()}return false}else if(BX.type.isNotEmptyString(e.ERROR)){t.processAJAXError(e["ERROR"]);return false}},processFavoritesAJAXResponse:function(e){var t=this;t.closeWait();if(typeof e["SUCCESS"]!="undefined"&&e["SUCCESS"]=="Y"){t.favoritesValue=t.newValue}else if(typeof e["ERROR"]!="undefined"&&e["ERROR"].length>0){t.processAJAXError(e["ERROR"])}return false},processAJAXError:function(e){var t=this;if(e.indexOf("SESSION_ERROR",0)===0){t.showErrorPopup(BX.message("SGMErrorSessionWrong"));return false}else if(e.indexOf("CURRENT_USER_NOT_AUTH",0)===0){t.showErrorPopup(BX.message("SGMErrorCurrentUserNotAuthorized"));return false}else if(e.indexOf("SONET_MODULE_NOT_INSTALLED",0)===0){t.showErrorPopup(BX.message("SGMErrorModuleNotInstalled"));return false}else{t.showErrorPopup(e);return false}},showWait:function(e){var t=this;if(e!==0){return t.waitTimeout=setTimeout(function(){t.showWait(0)},300)}if(!t.waitPopup){t.waitPopup=new BX.PopupWindow("sgm_wait",window,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-wait-cont"},children:[BX.create("DIV",{props:{className:"sonet-sgm-wait-icon"}}),BX.create("DIV",{props:{className:"sonet-sgm-wait-text"},html:BX.message("SGMWaitTitle")})]})})}else{t.waitPopup.setBindElement(window)}t.waitPopup.show()},closeWait:function(){if(this.waitTimeout){clearTimeout(this.waitTimeout);this.waitTimeout=null}if(this.waitPopup){this.waitPopup.close()}},showNotifyHint:function(e,t){var o=this;if(o.notifyHintTimeout){clearTimeout(o.notifyHintTimeout);o.notifyHintTimeout=null}if(o.notifyHintPopup==null){o.notifyHintPopup=new BX.PopupWindow("sgm_notify_hint",e,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-notify-hint-content"},style:{display:"none"},children:[BX.create("SPAN",{props:{id:"sgm_notify_hint_text"},html:t})]}),closeByEsc:true,closeIcon:false,offsetLeft:19,offsetTop:2});o.notifyHintPopup.TEXT=BX("sgm_notify_hint_text");o.notifyHintPopup.setBindElement(e)}else{o.notifyHintPopup.TEXT.innerHTML=t;o.notifyHintPopup.setBindElement(e)}o.notifyHintPopup.setAngle({});o.notifyHintPopup.show();o.notifyHintTimeout=setTimeout(function(){o.notifyHintPopup.close()},o.notifyHintTime)},showErrorPopup:function(e){this.closeWait();var t=new BX.PopupWindow("sgm-error"+Math.random(),window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-error-text-block"},html:e}),closeByEsc:true,closeIcon:true});t.show()}};window.BX.SGMSetSubscribe=window.B24SGControl.getInstance().setSubscribe})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:117:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.user_groups.link.add/.default/script.min.js?15441276456393";s:6:"source";s:98:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.user_groups.link.add/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Bitrix24");BX.Bitrix24.SonetGroupFilter=function(){this.actualSearchString="";this.minSearchStringLength=2};BX.Bitrix24.SonetGroupFilter.prototype.init=function(t){var e=typeof t!="undefined"&&typeof t.filterId!="undefined"?t.filterId:"SONET_GROUP_LIST";if(typeof t!="undefined"&&typeof t.minSearchStringLength!="undefined"&&parseInt(t.minSearchStringLength)>0){this.minSearchStringLength=parseInt(t.minSearchStringLength)}BX.addCustomEvent("BX.SonetGroupList:refresh",BX.delegate(function(){BX.Main.filterManager.getById(e).getPreset().resetPreset(true);BX.Main.filterManager.getById(e).getSearch().clearForm()},this));BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate(function(t,i,n,o){if(t!=e||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.SonetGroupList.Filter:beforeApply",[i,o])},this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(function(t,i,n,o,r){if(t!=e||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.SonetGroupList.Filter:apply",[i,o,r])},this));BX.addCustomEvent("BX.Filter.Search:input",BX.delegate(function(t,i){if(t==e){this.actualSearchString=typeof i!="undefined"?BX.util.trim(i):"";if(this.actualSearchString.length>0&&this.actualSearchString.length>=this.minSearchStringLength){BX.onCustomEvent(window,"BX.SonetGroupList.Filter:searchInput",[i])}}},this));BX.addCustomEvent("BX.Main.Filter:blur",BX.delegate(function(t){if(t.getParam("FILTER_ID")==e&&t.getSearch().getSquares().length<=0&&t.getSearch().getSearchString().length<=0){var i=BX.findParent(BX(e+"_filter_container"),{className:"pagetitle-wrap"});if(i){BX.removeClass(i,"pagetitle-wrap-filter-opened")}}},this))}})();(function(){BitrixSGFilterDestinationSelectorManager={controls:{},onSelect:function(t,e,i,n,o,r){BX.SocNetLogDestination.obItemsSelected[o]={};BX.SocNetLogDestination.obItemsSelected[o][t.id]=e;var s=BitrixSGFilterDestinationSelectorManager.controls[o];if(s){s.setData(BX.util.htmlspecialcharsback(t.name),t.id);s.getLabelNode().value="";s.getLabelNode().blur();if(BX.SocNetLogDestination.popupWindow!=null){BX.SocNetLogDestination.popupWindow.close()}if(BX.SocNetLogDestination.popupSearchWindow!=null){BX.SocNetLogDestination.popupSearchWindow.close()}}}};BitrixSGFilterDestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BitrixSGFilterDestinationSelector.create=function(t,e){var i=new BitrixSGFilterDestinationSelector(t,e);i.initialize(t,e);BX.onCustomEvent(window,"BX.SonetGroupList.Filter:create",[t]);return i};BitrixSGFilterDestinationSelector.prototype.getSetting=function(t,e){return this.settings.hasOwnProperty(t)?this.settings[t]:e};BitrixSGFilterDestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BitrixSGFilterDestinationSelector.prototype.initialize=function(t,e){this.id=t;this.settings=e?e:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;this.closed=null;var i=this.getSetting("initialValue",false);if(!!i){var n={};n[this.fieldId]=i.itemId;n[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(n)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.Selector:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSwitchTabFocus",BX.delegate(this.onBeforeSwitchTabFocus,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.delegate(this.onBeforeSelectItemFocus,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BitrixSGFilterDestinationSelector.prototype.open=function(){var t=this.id;if(!this.inited){var e=this.getSearchInput();e.id=e.name;BX.addCustomEvent(window,"BX.Main.Selector:afterInitDialog",BX.delegate(function(t){if(typeof t.id!="undefined"||t.id!=this.id){return}this.opened=true;this.closed=false},this));BX.onCustomEvent(window,"BX.SonetGroupList.Filter:openInit",[{id:this.id,inputId:e.id,containerId:e.id}]);this.inited=true}else{BX.onCustomEvent(window,"BX.SonetGroupList.Filter:open",[{id:this.id,bindNode:this.control.getField()}]);this.opened=true;this.closed=false}};BitrixSGFilterDestinationSelector.prototype.close=function(){BX.SocNetLogDestination.closeDialog();this.opened=false;this.closed=true};BitrixSGFilterDestinationSelector.prototype.onCustomEntitySelectorOpen=function(t){var e=t.getId();if(this.fieldId!==e){this.control=null}else{this.control=t;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BitrixSGFilterDestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BitrixSGFilterDestinationSelector.prototype.onCustomEntitySelectorClose=function(t){if(this.fieldId===t.getId()&&this.inited===true){this.control=null;this.close()}};BitrixSGFilterDestinationSelector.prototype.onGetStopBlur=function(t,e){if(BX.findParent(t.target,{className:"bx-lm-box"})){e.stopBlur=true}};BitrixSGFilterDestinationSelector.prototype.onCustomEntityRemove=function(t){if(this.fieldId===t.getId()){if(typeof t.hiddenInput!="undefined"&&typeof t.hiddenInput.value!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id]!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]!="undefined"){delete BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]}}};BitrixSGFilterDestinationSelector.prototype.onBeforeSwitchTabFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BitrixSGFilterDestinationSelector.prototype.onBeforeSelectItemFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BitrixSGFilterDestinationSelector.prototype.onBeforeInitDialog=function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}if(this.closed){t.blockInit=true}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.min.js?15441273847363";s:6:"source";s:85:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.js";s:3:"min";s:89:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.min.js";s:3:"map";s:89:"/bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.map.js";}"*/
(function(){function t(t){this.caller=t.caller;this.formNode=t.formNode;this.controlNode=t.controlNode;this.inputNode=t.inputNode;this.config=t.config}t.prototype={};BX.UserConsent={msg:{title:"MAIN_USER_CONSENT_REQUEST_TITLE",btnAccept:"MAIN_USER_CONSENT_REQUEST_BTN_ACCEPT",btnReject:"MAIN_USER_CONSENT_REQUEST_BTN_REJECT",loading:"MAIN_USER_CONSENT_REQUEST_LOADING",errTextLoad:"MAIN_USER_CONSENT_REQUEST_ERR_TEXT_LOAD"},events:{save:"main-user-consent-request-save",refused:"main-user-consent-request-refused",accepted:"main-user-consent-request-accepted"},current:null,autoSave:false,isFormSubmitted:false,isConsentSaved:false,attributeControl:"data-bx-user-consent",load:function(t){var e=this.find(t)[0];if(!e){return null}this.bind(e);return e},loadAll:function(t,e){this.find(t,e).forEach(this.bind,this)},loadFromForms:function(){var t=document.getElementsByTagName("FORM");t=BX.convert.nodeListToArray(t);t.forEach(this.loadAll,this)},find:function(t){if(!t){return[]}var e=t.querySelectorAll("["+this.attributeControl+"]");e=BX.convert.nodeListToArray(e);return e.map(this.createItem.bind(this,t)).filter(function(t){return!!t})},bind:function(t){if(t.config.submitEventName){BX.addCustomEvent(t.config.submitEventName,this.onSubmit.bind(this,t))}else if(t.formNode){BX.bind(t.formNode,"submit",this.onSubmit.bind(this,t))}BX.bind(t.controlNode,"click",this.onClick.bind(this,t))},createItem:function(e,n){var i=n.querySelector('input[type="checkbox"]');if(!i){return}try{var s=JSON.parse(n.getAttribute(this.attributeControl));var o={formNode:null,controlNode:n,inputNode:i,config:s};if(e.tagName=="FORM"){o.formNode=e}else{o.formNode=BX.findParent(i,{tagName:"FORM"})}o.caller=this;return new t(o)}catch(r){return null}},onClick:function(t,e){this.requestForItem(t);e.preventDefault()},onSubmit:function(t,e){this.isFormSubmitted=true;if(this.check(t)){return true}else{if(e){e.preventDefault()}return false}},check:function(t){if(t.inputNode.checked){this.saveConsent(t);return true}this.requestForItem(t);return false},requestForItem:function(t){this.setCurrent(t);this.requestConsent(t.config.id,{sec:t.config.sec,replace:t.config.replace},this.onAccepted,this.onRefused)},setCurrent:function(t){this.current=t;this.autoSave=t.config.autoSave;this.actionRequestUrl=t.config.actionUrl},onAccepted:function(){if(!this.current){return}var t=this.current;this.saveConsent(this.current,function(){BX.onCustomEvent(t,this.events.accepted,[]);BX.onCustomEvent(this,this.events.accepted,[t]);this.isConsentSaved=true;if(this.isFormSubmitted&&t.formNode&&!t.config.submitEventName){BX.submit(t.formNode)}});this.current.inputNode.checked=true;this.current=null},onRefused:function(){BX.onCustomEvent(this.current,this.events.refused,[]);BX.onCustomEvent(this,this.events.refused,[this.current]);this.current.inputNode.checked=false;this.current=null;this.isFormSubmitted=false},initPopup:function(){if(this.popup){return}this.popup={}},popup:{isInit:false,caller:null,nodes:{container:null,shadow:null,head:null,loader:null,content:null,textarea:null,buttonAccept:null,buttonReject:null},onAccept:function(){this.hide();BX.onCustomEvent(this,"accept",[])},onReject:function(){this.hide();BX.onCustomEvent(this,"reject",[])},init:function(){if(this.isInit){return true}var t=document.querySelector("script[data-bx-template]");if(!t){return false}var e=document.createElement("DIV");e.innerHTML=t.innerHTML;e=e.children[0];if(!e){return false}document.body.insertBefore(e,document.body.children[0]);this.isInit=true;this.nodes.container=e;this.nodes.shadow=this.nodes.container.querySelector("[data-bx-shadow]");this.nodes.head=this.nodes.container.querySelector("[data-bx-head]");this.nodes.loader=this.nodes.container.querySelector("[data-bx-loader]");this.nodes.content=this.nodes.container.querySelector("[data-bx-content]");this.nodes.textarea=this.nodes.container.querySelector("[data-bx-textarea]");this.nodes.buttonAccept=this.nodes.container.querySelector("[data-bx-btn-accept]");this.nodes.buttonReject=this.nodes.container.querySelector("[data-bx-btn-reject]");this.nodes.buttonAccept.textContent=BX.message(this.caller.msg.btnAccept);this.nodes.buttonReject.textContent=BX.message(this.caller.msg.btnReject);BX.bind(this.nodes.buttonAccept,"click",this.onAccept.bind(this));BX.bind(this.nodes.buttonReject,"click",this.onReject.bind(this));return true},setTitle:function(t){if(!this.nodes.head){return}this.nodes.head.textContent=t},setContent:function(t){if(!this.nodes.textarea){return}this.nodes.textarea.textContent=t},show:function(t){if(typeof t=="boolean"){this.nodes.loader.style.display=!t?"":"none";this.nodes.content.style.display=t?"":"none"}this.nodes.container.style.display=""},hide:function(){this.nodes.container.style.display="none"}},cache:{list:[],stringifyKey:function(t){return BX.type.isString(t)?t:JSON.stringify({key:t})},set:function(t,e){var n=this.get(t);if(n){n.data=e}else{this.list.push({key:this.stringifyKey(t),data:e})}},getData:function(t){var e=this.get(t);return e?e.data:null},get:function(t){t=this.stringifyKey(t);var e=this.list.filter(function(e){return e.key==t});return e.length>0?e[0]:null},has:function(t){return!!this.get(t)}},requestConsent:function(t,e,n,i){e=e||{};e.id=t;var s=this.cache.stringifyKey(e);if(!this.popup.isInit){this.popup.caller=this;if(!this.popup.init()){return}BX.addCustomEvent(this.popup,"accept",n.bind(this));BX.addCustomEvent(this.popup,"reject",i.bind(this))}if(this.current&&this.current.config.text){this.cache.set(s,this.current.config.text)}if(this.cache.has(s)){this.setTextToPopup(this.cache.getData(s))}else{this.popup.setTitle(BX.message(this.msg.loading));this.popup.show(false);this.sendActionRequest("getText",e,function(t){this.cache.set(s,t.text||"");this.setTextToPopup(this.cache.getData(s))},function(){this.popup.hide();alert(BX.message(this.msg.errTextLoad))})}},setTextToPopup:function(t){var e="";var n=t.indexOf("\n");var i=t.indexOf(".");n=n<i?n:i;if(n>=0&&n<=100){e=t.substr(0,n).trim();e=e.split(".").map(Function.prototype.call,String.prototype.trim).filter(String)[0]}this.popup.setTitle(e?e:BX.message(this.msg.title));this.popup.setContent(t);this.popup.show(true)},saveConsent:function(t,e){this.setCurrent(t);var n={id:t.config.id,sec:t.config.sec,url:window.location.href};if(t.config.originId){var i=t.config.originId;if(t.formNode&&i.indexOf("%")>=0){var s=t.formNode.querySelectorAll('input[type="text"], input[type="hidden"]');s=BX.convert.nodeListToArray(s);s.forEach(function(t){if(!t.name){return}i=i.replace("%"+t.name+"%",t.value?t.value:"")})}n.originId=i}if(t.config.originatorId){n.originatorId=t.config.originatorId}BX.onCustomEvent(t,this.events.save,[n]);BX.onCustomEvent(this,this.events.save,[t,n]);if(this.isConsentSaved||!t.config.autoSave){if(e){e.apply(this,[])}}else{this.sendActionRequest("saveConsent",n,e,e)}},sendActionRequest:function(t,e,n,i){n=n||null;i=i||null;e.action=t;e.sessid=BX.bitrix_sessid();e.action=t;BX.ajax({url:this.actionRequestUrl,method:"POST",data:e,timeout:10,dataType:"json",processData:true,onsuccess:BX.proxy(function(t){t=t||{};if(t.error){i.apply(this,[t])}else if(n){n.apply(this,[t])}},this),onfailure:BX.proxy(function(){var t={error:true,text:""};if(i){i.apply(this,[t])}},this)})}};BX.ready(function(){BX.UserConsent.loadFromForms()})})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.urlpreview/templates/.default/script.min.js?15441273844554";s:6:"source";s:70:"/bitrix/components/bitrix/main.urlpreview/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var BXUrlPreview=function(e){this.element=e;this.inputElement=null;this.id=this.element.id;this.carouselElement=null;this.carouselImages=[];this.currentImageId=null;this.init()};BXUrlPreview.prototype.init=function(){this.inputElement=this.element.querySelector(".urlpreview__ufvalue");this.initCarousel();this.bindEventHandlers()};BXUrlPreview.prototype.detachUrlPreview=function(){if(this.inputElement){this.inputElement.value=""}this.element.style.display="none"};BXUrlPreview.prototype.attachUrlPreview=function(e){var t,i;if(this.element.style.display!=="none"){return}i=this.element.getAttribute("data-field-id");requestParams={action:"attachUrlPreview",userFieldId:i,elementId:this.id,sessid:BX.bitrix_sessid()};if(e.hasOwnProperty("url"))requestParams.url=e.url;else if(e.hasOwnProperty("id"))requestParams.id=e.id;else return;BX.ajax({url:"/bitrix/components/bitrix/main.urlpreview/ajax.php",method:"POST",data:requestParams,onsuccess:function(e){if(e.length>0){var t=document.createElement("div");var i=this.element.style.cssText;t.innerHTML=e;var r=t.firstElementChild;this.element.parentNode.replaceChild(r,this.element);this.element=r;this.element.style.cssText=i;this.element.style.removeProperty("display");this.init()}}.bind(this)})};BXUrlPreview.prototype.bindEventHandlers=function(){var e=this;var t=this.element.querySelector(".urlpreview__detach");if(t){t.addEventListener("click",e.detachUrlPreview.bind(e))}var i=this.element.querySelector(".urlpreview__container-switchable");if(i){i.addEventListener("click",BXUrlPreview.showEmbed)}if(this.carouselElement){var r=this.carouselElement.querySelector(".urlpreview__button-prev");var s=this.carouselElement.querySelector(".urlpreview__button-next");if(r)r.addEventListener("click",e.previousImage.bind(e));if(s)s.addEventListener("click",e.nextImage.bind(e))}};BXUrlPreview.prototype.initCarousel=function(){var e;var t;var i;var r;if(e=this.element.querySelector(".urlpreview__carousel")){this.carouselElement=e;t=e.querySelectorAll(".urlpreview__image");for(i=0;i<t.length;i++){t[i].dataset.imageId=i;this.carouselImages[i]=t[i]}r=this.element.dataset.imageId?parseInt(this.element.dataset.imageId):0;this.setCarouselImage(r);this.carouselElement.style.removeProperty("display")}};BXUrlPreview.prototype.setCarouselImage=function(e){var t;var i;var r;if(!(e>=0||e<=this.carouselImages.length-1))return null;this.carouselImages.map(function(e){e.style.display="none"});this.carouselImages[e].style.removeProperty("display");if(i=this.carouselImages[e].querySelector("img")){t=i.getAttribute("src");if(this.inputElement){r=this.inputElement.value.split(";");this.inputElement.value=r[0]+";"+t}}this.currentImageId=e};BXUrlPreview.prototype.nextImage=function(){var e=this.currentImageId+1;if(e>this.carouselImages.length-1)e=0;this.setCarouselImage(e)};BXUrlPreview.prototype.previousImage=function(){var e=this.currentImageId-1;if(e<0)e=this.carouselImages.length-1;this.setCarouselImage(e)};BXUrlPreview.showEmbed=function(){if(BX.hasClass(this,"urlpreview__container-hide-embed")){BX.addClass(this,"urlpreview__container-hide-image");BX.removeClass(this,"urlpreview__container-hide-embed");var e=BX.findChildByClassName(this,"video-js");if(e){if(BX.getClass("BX.Fileman.PlayerManager")){var t=BX.Fileman.PlayerManager.getPlayerById(e.getAttribute("id"));if(t){t.play()}}}else{var i=BX.findChildByClassName(this,"urlpreview-iframe-html-embed");if(i){BXUrlPreview.adjustFrameHeight(i,5)}}}};BXUrlPreview.bindEmbedHandler=function(){var e=document.querySelectorAll(".urlpreview__container-switchable");var t;for(t=0;t<e.length;t++){e.item(t).addEventListener("click",BXUrlPreview.showEmbed)}};BXUrlPreview.adjustFrameHeight=function(e,t){if(BX.hasClass(e,"urlpreview-iframe-html-embed-adjusted")){return}t=t||0;if(t>10){return}var i=50;if(e.contentWindow.document.body.scrollHeight>e.height){e.height=e.contentWindow.document.body.scrollHeight+i+"px";BX.addClass(e,"urlpreview-iframe-html-embed-adjusted");return}var r=e.contentWindow.document.getElementsByTagName("video");if(r[0]){e.height=e.contentWindow.document.body.scrollHeight+i+"px";BX.addClass(e,"urlpreview-iframe-html-embed-adjusted");return}else{var s=e.contentWindow.document.getElementsByTagName("iframe");var l=0;for(var a=0;a<s.length;a++){if(s[a]&&s[a].height>0){l=parseInt(s[a].height)}else if(s[a]&&s[a].style.height){l=parseInt(s[a].style.height)}if(l!==0){e.height=l+i+"px";BX.addClass(e,"urlpreview-iframe-html-embed-adjusted")}}if(l===0){setTimeout(function(){t++;BXUrlPreview.adjustFrameHeight(e,t)},500)}}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js?154412745416315";s:6:"source";s:79:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
__logOnDateChange=function(e){var t=false,i=false,n=false,o=false;if(e.value=="interval")t=i=n=true;else if(e.value=="before")i=true;else if(e.value=="after"||e.value=="exact")t=true;else if(e.value=="days")o=true;BX("flt_date_from_span").style.display=t?"":"none";BX("flt_date_to_span").style.display=i?"":"none";BX("flt_date_hellip_span").style.display=n?"":"none";BX("flt_date_day_span").style.display=o?"inline-block":"none";BX("flt_date_day_text_span").style.display=o?"inline-block":"none"};function __logOnReload(e){if(BX("menu-popup-lenta-sort-popup")){var t=BX.findChildren(BX("menu-popup-lenta-sort-popup"),{className:"lenta-sort-item"},true);if(!BX.hasClass(t[0],"lenta-sort-item-selected")){for(var i=0;i<t.length;i++){if(i==0)BX.addClass(t[i],"lenta-sort-item-selected");else if(i!=t.length-1)BX.removeClass(t[i],"lenta-sort-item-selected")}}}if(BX("lenta-sort-button")){var n=BX.findChild(BX("lenta-sort-button"),{className:"lenta-sort-button-text-internal"},true,false);if(n)n.innerHTML=BX.message("sonetLFAllMessages")}var o=BX("sonet_log_counter_preset",true);if(o){if(parseInt(e)>0){o.style.display="inline-block";o.innerHTML=e}else{o.innerHTML="";o.style.display="none"}}}BitrixLFFilter=function(){this.id=null;this.filterPopup=false;this.currentName=null;this.obInputName={};this.obSearchInput={};this.obInputContainerName={};this.obContainerInput={};this.popupMenu=null;this.menuItems=[];this.actualSearchString="";this.minSearchStringLength=2};BitrixLFFilter.prototype.initLentaMenu=function(e){if(typeof e.menuItems!="undefined"){this.menuItems=e.menuItems}};BitrixLFFilter.prototype.showLentaMenu=function(e){var t=typeof e.short!="undefined"&&e.short,i=typeof e.bindElement!="undefined"?BX(e.bindElement):null;if(!i){return false}if(typeof e.siteTemplateId=="undefined"||e.siteTemplateId!="bitrix24"){BX.addClass(i,"lenta-sort-button-active")}this.popupMenu=BX.PopupMenu.create("lenta-sort-popup",i,BX.util.array_merge(!t?BX.util.array_merge(this.menuItems.preset,this.menuItems.filter):[],this.menuItems.actions),{offsetTop:e.siteTemplateId=="bitrix24"?-5:2,offsetLeft:e.siteTemplateId=="bitrix24"?17:43,angle:true,events:{onPopupClose:function(){if(typeof e.siteTemplateId!="undefined"||e.siteTemplateId!="bitrix24"){BX.removeClass(i,"lenta-sort-button-active")}}}});this.popupMenu.show();return false};BitrixLFFilter.prototype.initFilter=function(e){var t=typeof e!="undefined"&&typeof e.version!="undefined"?parseInt(e.version):0;var i=typeof e!="undefined"&&typeof e.filterId!="undefined"?e.filterId:"LIVEFEED";this.id=i;if(t>=2){if(typeof e!="undefined"&&typeof e.minSearchStringLength!="undefined"&&parseInt(e.minSearchStringLength)>0){this.minSearchStringLength=parseInt(e.minSearchStringLength)}var n=BX.Main.filterManager.getById(i);if(n&&(n.getSearch().getSquares().length>0||n.getSearch().getSearchString().length>0)){var o=BX.findParent(BX(i+"_filter_container"),{className:"pagetitle-wrap"});if(o){BX.addClass(o,"pagetitle-wrap-filter-opened")}}BX.addCustomEvent("BX.Livefeed:refresh",BX.delegate(function(){var e=BX.Main.filterManager.getById(i);if(e){e.getPreset().resetPreset(true);e.getSearch().clearForm()}},this));BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate(function(e,t,n,o){if(e!=i||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:beforeApply",[t,o])},this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(function(e,t,n,o,a){if(e!=i||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:apply",[t,o,a])},this));BX.addCustomEvent("BX.Filter.Search:input",BX.delegate(function(e,t){if(e==i){this.actualSearchString=typeof t!="undefined"?BX.util.trim(t):"";if(this.actualSearchString.length>0&&this.actualSearchString.length>=this.minSearchStringLength){BX.onCustomEvent(window,"BX.Livefeed.Filter:searchInput",[t])}}},this));BX.addCustomEvent("BX.Main.Filter:blur",BX.delegate(function(e){if(e.getParam("FILTER_ID")==i&&e.getSearch().getSquares().length<=0&&e.getSearch().getSearchString().length<=0){var t=BX.findParent(BX(i+"_filter_container"),{className:"pagetitle-wrap"});if(t){BX.removeClass(t,"pagetitle-wrap-filter-opened")}}}));if(BX(this.id+"_filter_container")){var a=BX.delegate(function(e){var t=BX.findParent(e.target,{className:"pagetitle-wrap"});if(t&&!BX.hasClass(t,"pagetitle-wrap-filter-opened")){BX.addClass(t,"pagetitle-wrap-filter-opened")}},this);BX.bind(BX(this.id+"_search_container"),"click",a)}}else{__logOnDateChange(document.forms["log_filter"].flt_date_datesel);BX("flt_date_from_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_from"),bTime:false})};BX("flt_date_to_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_to"),bTime:false})}}};BitrixLFFilter.prototype.initDestination=function(e){this.obInputName[e.name]=e.inputName;this.obSearchInput[e.name]=BX(e.inputName);this.obInputContainerName[e.name]=e.inputContainerName;this.obContainerInput[e.name]=BX(e.inputContainerName);if(typeof e.items!="undefined"&&typeof e.items.department!="undefined"){if(typeof e.items.extranetRoot!="undefined"){for(var t in e.items.extranetRoot){if(e.items.extranetRoot.hasOwnProperty(t)){e.items.department[t]=e.items.extranetRoot[t]}}}if(!e.items.departmentRelation){e.items.departmentRelation=BX.SocNetLogDestination.buildDepartmentRelation(e.items.department)}}BX.SocNetLogDestination.init({name:e.name,pathToAjax:typeof e.pathToAjax!="undefined"?e.pathToAjax:false,searchInput:this.obSearchInput[e.name],extranetUser:!!e.extranetUser,departmentSelectDisable:!!e.departmentSelectDisable,bindMainPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,{name:e.name,containerInput:BX(e.inputContainerName),inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName),resultFieldName:e.resultFieldName}),unSelect:BX.proxy(this.onUnSelectDestination,{name:e.name,inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName)})},items:e.items,itemsLast:e.itemsLast,itemsSelected:e.itemsSelected,itemsSelectedUndeleted:typeof e.itemsSelectedUndeleted!="undefined"?e.itemsSelectedUndeleted:{},isCrmFeed:false,useClientDatabase:true,destSort:e.destSort,allowAddUser:false,allowSearchEmailUsers:!e.extranetUser,userNameTemplate:e.userNameTemplate});BX.bind(this.obSearchInput[e.name],"click",function(t){oLFFilter.currentName=e.name;BX.SocNetLogDestination.openDialog(e.name);return BX.PreventDefault(t)});BX.bind(this.obSearchInput[e.name],"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}));BX.bind(this.obSearchInput[e.name],"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}))};BitrixLFFilter.prototype.clearInput=function(){if(this.obContainerInput[this.currentName]){var e=BX.findChildren(this.obContainerInput[this.currentName],{className:"feed-add-post-destination"},false);for(var t=0;t<e.length;t++){BX.SocNetLogDestination.deleteItem(e[t].attributes["data-id"].value,e[t].attributes["data-type"].value,this.currentName)}}};BitrixLFFilter.prototype.onSelectDestination=function(e,t,i,n){oLFFilter.clearInput();BX.SocNetLogDestination.BXfpSelectCallback({formName:this.name,item:e,type:t,search:i,bUndeleted:n,containerInput:this.containerInput,valueInput:this.searchInput,varName:this.resultFieldName});this.searchInput.style.display="none";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="block"}BX.SocNetLogDestination.closeDialog();BX.SocNetLogDestination.closeSearch()};BitrixLFFilter.prototype.onUnSelectDestination=function(e){var t=BX.findChildren(BX(this.inputContainerName),{attribute:{"data-id":""+e.id+""}},true);if(t!==null){for(var i=0;i<t.length;i++){BX.remove(t[i])}}BX(this.inputName).value="";this.searchInput.style.display="inline-block";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="none"}};BitrixLFFilter.prototype.ShowFilterPopup=function(e){if(!oLFFilter.filterPopup){BX.ajax.get(BX.message("sonetLFAjaxPath"),function(t){BX.closeWait(e);oLFFilter.filterPopup=new BX.PopupWindow("bx_log_filter_popup",e,{closeIcon:false,offsetTop:5,autoHide:true,zIndex:-100,className:"sonet-log-filter-popup-window",events:{onPopupClose:function(){if(!BX.hasClass(this.bindElement,"pagetitle-menu-filter-set"))BX.removeClass(this.bindElement,"pagetitle-menu-filter-selected")},onPopupShow:function(){BX.addClass(this.bindElement,"pagetitle-menu-filter-selected")}}});var i=BX.create("DIV",{html:BX.util.trim(t)});oLFFilter.filterPopup.setContent(i.firstChild);oLFFilter.filterPopup.show()})}else{oLFFilter.filterPopup.show()}};BitrixLFFilter.prototype.__SLFShowInfoPopup=function(e){var t=[BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-success"},text:BX.message("sonetLFDialogRead"),events:{click:function(){BX.ajax({method:"POST",dataType:"json",url:BX.message("ajaxControllerURL"),data:{sessid:BX.bitrix_sessid(),popupType:e.type,closePopup:"Y"},onsuccess:function(t){if(typeof t!="undefined"&&typeof t.SUCCESS!="undefined"&&t.SUCCESS=="Y"){o.close();if(e.reload){top.location=top.location.href}}}})}}})];if(BX.type.isArray(e.buttonsAdd)){var i=0;for(var n=0;n<e.buttonsAdd.length;n++){i=e.buttonsAdd[n];t.push(BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-"+i.type},text:i.title,events:{click:i.click}}))}}var o=new BX.PopupWindow(e.name,e.bindObj,{closeByEsc:false,closeIcon:false,autoHide:false,overlay:true,events:{},buttons:[],zIndex:0,content:BX.create("DIV",{children:[BX.create("DIV",{props:{className:"bx-slf-popup-title"},text:e.title}),BX.create("DIV",{props:{className:"bx-slf-popup-content"},children:[BX.create("DIV",{props:{className:"bx-slf-popup-cont-title"},html:e.description1}),BX.create("DIV",{props:{className:"bx-slf-popup-descript"},children:[BX.type.isNotEmptyString(e.description2)?BX.create("DIV",{html:e.description2}):null,BX.type.isPlainObject(e.descriptionImage)&&BX.type.isNotEmptyString(e.descriptionImage.src)?BX.create("IMG",{props:{className:"bx-slf-popup-descript-img"},attrs:{src:e.descriptionImage.src,width:e.descriptionImage.width,height:e.descriptionImage.height}}):null]})]}),BX.create("DIV",{props:{className:"popup-window-buttons"},children:t})]})});o.show();return o};BitrixLFFilter.prototype.onClickMenuItem=function(e){if(typeof e.menuItem!="undefined"){BX.toggleClass(e.menuItem,"lenta-sort-item-selected")}this.popupMenu.close();if(typeof e.href!="undefined"){top.location.href=e.href}};BitrixLFFilter.prototype.closeHint=function(e){};BitrixLFFilterDestinationSelectorManager={controls:{},onSelect:function(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.name)||typeof e.item=="undefined"||!BX.type.isNotEmptyString(e.type)){return}var t=e.name,i=e.type,n=e.item;BX.SocNetLogDestination.obItemsSelected[t]={};BX.SocNetLogDestination.obItemsSelected[t][n.id]=i;var o=BitrixLFFilterDestinationSelectorManager.controls[t];if(o){o.setData(BX.util.htmlspecialcharsback(n.name),n.id);o.getLabelNode().value="";o.getLabelNode().blur();if(BX.SocNetLogDestination.popupWindow!=null){BX.SocNetLogDestination.popupWindow.close()}if(BX.SocNetLogDestination.popupSearchWindow!=null){BX.SocNetLogDestination.popupSearchWindow.close()}}},onDialogOpen:function(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.name)){return}var t=e.name;var i=BitrixLFFilterDestinationSelector.items[t];if(i){i.onDialogOpen()}},onDialogClose:function(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.name)){return}var t=e.name;var i=BitrixLFFilterDestinationSelector.items[t];if(i){i.onDialogClose()}}};BitrixLFFilterDestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BitrixLFFilterDestinationSelector.items={};BitrixLFFilterDestinationSelector.create=function(e,t){var i=new BitrixLFFilterDestinationSelector(e,t);i.initialize(e,t);this.items[e]=i;BX.onCustomEvent(window,"BX.Livefeed.Filter:create",[e]);return i};BitrixLFFilterDestinationSelector.prototype.getSetting=function(e,t){return this.settings.hasOwnProperty(e)?this.settings[e]:t};BitrixLFFilterDestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BitrixLFFilterDestinationSelector.prototype.initialize=function(e,t){this.id=e;this.settings=t?t:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var n={};n[this.fieldId]=i.itemId;n[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(n)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.Selector:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSwitchTabFocus",BX.delegate(this.onBeforeSwitchTabFocus,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.delegate(this.onBeforeSelectItemFocus,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BitrixLFFilterDestinationSelector.prototype.open=function(){var e=this.id;if(!this.inited){var t=this.getSearchInput();t.id=t.name;BX.addCustomEvent(window,"BX.Main.Selector:afterInitDialog",BX.delegate(function(e){if(typeof e.id!="undefined"||e.id!=this.id){return}this.opened=true},this));BX.onCustomEvent(window,"BX.Livefeed.Filter:openInit",[{id:this.id,inputId:t.id,containerId:t.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Livefeed.Filter:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BitrixLFFilterDestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManager.controls[this.id]!=="undefined"){BX.Main.selectorManager.controls[this.id].closeDialog()}};BitrixLFFilterDestinationSelector.prototype.onCustomEntitySelectorOpen=function(e){var t=e.getId();if(this.fieldId!==t){this.control=null}else{this.control=e;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BitrixLFFilterDestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BitrixLFFilterDestinationSelector.prototype.onCustomEntitySelectorClose=function(e){if(this.fieldId===e.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BitrixLFFilterDestinationSelector.prototype.onGetStopBlur=function(e,t){if(BX.findParent(e.target,{className:"bx-lm-box"})){t.stopBlur=true}};BitrixLFFilterDestinationSelector.prototype.onCustomEntityRemove=function(e){if(this.fieldId===e.getId()){if(typeof e.hiddenInput!="undefined"&&typeof e.hiddenInput.value!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id]!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id][e.hiddenInput.value]!="undefined"){delete BX.SocNetLogDestination.obItemsSelected[this.id][e.hiddenInput.value]}}};BitrixLFFilterDestinationSelector.prototype.onBeforeSwitchTabFocus=function(e){if(this.id===e.id){e.blockFocus=true}};BitrixLFFilterDestinationSelector.prototype.onBeforeSelectItemFocus=function(e){if(this.id===e.id){e.blockFocus=true}};BitrixLFFilterDestinationSelector.prototype.onBeforeInitDialog=function(e){if(typeof e.id=="undefined"||e.id!=this.id){return}this.inited=true;if(!this.control){e.blockInit=true}};BitrixLFFilterDestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BitrixLFFilterDestinationSelector.prototype.onDialogClose=function(){this.opened=false};oLFFilter=new BitrixLFFilter;window.oLFFilter=oLFFilter;
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?154412738446925";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.Filter=function(t,e,s,i,r,a){this.params=t;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=s;this.dateTypes=i;this.additionalDateTypes=a;this.numberTypes=r;this.settings=new BX.Filter.Settings(e,this);this.filter=null;this.api=null;this.isAddPresetModeState=false;this.firstInit=true;this.init()};function t(t){if(BX.type.isString(t)){t=t.toLowerCase();t=t.replace(/[\-_\s]+(.)?/g,function(t,e){return e?e.toUpperCase():""});return t.substr(0,1).toLowerCase()+t.substr(1)}return t}BX.Main.Filter.prototype={init:function(){BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));BX.bind(window,"load",BX.delegate(this.onWindowLoad,this));BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"))},onWindowLoad:function(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},clearGet:function(){if("history"in window){var t=window.location.toString();var e=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",e)}},adjustFocus:function(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function(t){if(BX.Filter.Utils.isKey(t,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}}},getApi:function(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function(t,e,s){var i=this.getPreset();var r=i.getContainer();var a=i.createSidebarItem(t,e,s);var n=i.getPresetNodeById(t);if(BX.type.isDomNode(n)){BX.remove(n);BX.prepend(a,r)}else{r&&r.insertBefore(a,i.getAddPresetField())}BX.bind(a,"click",BX.delegate(i._onPresetClick,i))},saveUserSettings:function(t){var e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var i=s.getCurrentPresetId();var r={};this.params["PRESETS"]=BX.clone(this.editablePresets);r.current_preset=i;s.getPresets().forEach(function(e,i){var a=s.getPresetId(e);if(a&&a!=="tmp_filter"){var n=s.getPreset(a);n.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(n.TITLE));n.SORT=i;s.updatePresetName(e,n.TITLE);r[a]={sort:i,name:n.TITLE,fields:this.preparePresetSettingsFields(n.FIELDS),for_all:t&&!BX.type.isBoolean(n.FOR_ALL)||t&&n.FOR_ALL===true}}},this);this.saveOptions(r,e,null,t)},isForAll:function(t){var e=this.getForAllCheckbox();return BX.type.isBoolean(t)&&t||!!e&&!!e.checked},getForAllCheckbox:function(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function(t){var e={};var s;(t||[]).forEach(function(t){switch(t.TYPE){case this.types.STRING:{e[t.NAME]=t.VALUE;break}case this.types.SELECT:{e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.DATE:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_datesel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_numsel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.DEST_SELECTOR:{if(BX.type.isPlainObject(t.VALUES)){e[t.NAME]=t.VALUES._value;e[t.NAME+"_label"]=t.VALUES._label}break}case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(t.VALUES)){e[t.NAME]=t.VALUES._value;e[t.NAME+"_label"]=t.VALUES._label}break}default:{break}}},this);return e},savePreset:function(){var t="filter_"+ +new Date;var e=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(t,e,null,true,null,null,true);this.addSidebarItem(t,e);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function(t,e,s,i,r,a,n){var l=this.getFilterFieldsValues();var o=this.getPreset().getFields().map(function(t){return BX.data(t,"name")});var h=this.getPreset().getCurrentPresetData();var d={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var u,c,f,p,g;var B={};B.additional={};if(t!=="tmp_filter"&&t!=="default_filter"&&!n){var E=BX.type.isArray(h.ADDITIONAL)?h.ADDITIONAL:[];E.forEach(function(t){Object.keys(l).forEach(function(e){if(e.indexOf(t.NAME)!==-1){B.additional[e]=l[e];delete l[e]}})})}u=Object.keys(l);if(!s){B.apply_filter="Y"}else{B.clear_filter="Y"}B.save="Y";B.fields=l;B.rows=o.join(",");B.preset_id=t||h.ID;if(BX.type.isNotEmptyString(e)){B.name=BX.util.htmlspecialchars(e)}else{f=this.getPreset().getPresetNodeById(B.preset_id);p=this.getPreset().getPresetInput(f);if(BX.type.isDomNode(p)&&BX.type.isNotEmptyString(p.value)){B.name=p.value}else{B.name=h.TITLE}}if((!("sort"in B)||!BX.type.isNumber(B.sort))&&i){g=this.getParam("PRESETS");B.sort=g.length+2}if(!s){u.forEach(function(t){if(BX.type.isArray(B.fields[t])){c=B.fields[t].length?{}:"";B.fields[t].forEach(function(t,e){c[e]=t},this);if(c||BX.type.isNumber(c)||BX.type.isBoolean(c)){B.fields[t]=c}}},this)}if(B.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(B)}if(BX.type.isFunction(r)){r()}var m=new BX.Promise(null,this);m.setAutoResolve("fulfill",0);m.then(function(){var t=new BX.Promise(null,this);this.saveOptions(B,d,BX.proxy(t.fulfill,t));return t}).then(function(){!!a&&a()});return m},saveFieldsSort:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var e=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(e)){s.rows=e.map(function(t){return BX.data(t,"name")});s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,t)},updateParams:function(t){var e,s;var i=[];if(BX.type.isPlainObject(t)&&"preset_id"in t){e=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(e)){if("name"in t&&BX.type.isNotEmptyString(t.name)){e.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach(function(e){t.fields[e]=""})}if("fields"in t){e.FIELDS=this.preparePresetFields(t.fields,t.rows)}if("additional"in t&&e.ID!=="tmp_filter"){e.ADDITIONAL=this.preparePresetFields(t.additional,t.rows)}}else{s=this.getParam("PRESETS");e={ID:t.preset_id,TITLE:t.name,SORT:s.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};s.push(e)}}},preparePresetFields:function(t,e){var s,i;var r=[];if(BX.type.isPlainObject(t)){e=BX.type.isNotEmptyString(e)?e.split(","):[];s=e.length?e:Object.keys(t);s.forEach(function(e){e=e.replace("_datesel","").replace("_numsel","");i=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(i)){if(i.TYPE===this.types.STRING){i.VALUE=t[e]}if(i.TYPE===this.types.MULTI_SELECT){i.VALUE=this.prepareMultiSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.SELECT||i.TYPE===this.types.CHECKBOX){i.VALUE=this.prepareSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.DATE){i.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_month"],_quarter:t[e+"_quarter"],_year:t[e+"_year"],_allow_year:t[e+"_allow_year"]}}if(i.TYPE===this.types.CUSTOM_DATE){i.VALUE={days:Object.keys(t[e+"_days"]||{}).map(function(s){return t[e+"_days"][s]}),months:Object.keys(t[e+"_months"]||{}).map(function(s){return t[e+"_months"][s]}),years:Object.keys(t[e+"_years"]||{}).map(function(s){return t[e+"_years"][s]})}}if(i.TYPE===this.types.NUMBER){i.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(i.TYPE===this.types.DEST_SELECTOR){if(typeof t[e+"_label"]!=="undefined"){i.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){i.VALUES._value=t[e]}}if(i.TYPE===this.types.CUSTOM_ENTITY){if(typeof t[e+"_label"]!=="undefined"){i.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){i.VALUES._value=t[e]}}if(i.TYPE===this.types.CUSTOM){i._VALUE=t[e]}r.push(i)}},this)}return r},prepareSelectValue:function(t,e){var s={};var i;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(e)){i=this.prepareMultiSelectValue({0:t},e);s=i.length>0?i[0]:{}}else{s=e[0]}return s},prepareMultiSelectValue:function(t,e){var s=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(e)){var i=Object.keys(t);var r=i.map(function(e){return t[e]});s=e.filter(function(t){return r.some(function(e){return e===t.VALUE})},this)}return s},getFieldByName:function(t){var e=this.getParam("FIELDS");e=e.filter(function(e){return e.NAME===t},this);return e.length>0?e[0]:null},confirmSaveForAll:function(){return new Promise(function(t){var e={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(e,t)}.bind(this))},saveOptions:function(e,s,i,r){s.action=t(s.action);s.forAll=this.isForAll(r);s.commonPresetsId=this.getParam("COMMON_PRESETS_ID");s.apply_filter=e.apply_filter||"N";s.clear_filter=e.clear_filter||"N";s.with_preset=e.with_preset||"N";s.save=e.save||"N";var a={params:s,data:e};delete e.apply_filter;delete e.save;delete e.clear_filter;delete e.with_preset;if(s.forAll&&s.action==="setFilterArray"){return this.confirmSaveForAll().then(function(){return this.backend(s.action,a)}.bind(this)).then(function(){this.disableEdit();this.disableAddPreset()}.bind(this))}return this.backend(s.action,a).then(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(i)&&i()}.bind(this))},backend:function(t,e){return BX.ajax.runComponentAction("bitrix:main.ui.filter",t,{mode:"ajax",data:e})},prepareEvent:function(t){var e,s;if(!("path"in t)||!t.path.length){t.path=[t.target];e=0;while((s=t.path[e++].parentNode)!==null){t.path.push(s)}}return t},restoreRemovedPreset:function(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var e=t.ID;var s=this.getPreset().getPresetNodeById(e);this.getPreset().applyPreset(e);this.getPreset().activatePreset(s)}}},hasScrollClick:function(t){var e="clientX"in t?t.clientX:"x"in t?t.x:0;return e>=document.documentElement.offsetWidth},isUseCommonPresets:function(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function(t){t=this.prepareEvent(t);return(t.path||[]).some(function(t){return BX.type.isDomNode(t)&&(BX.hasClass(t,this.settings.classFilterContainer)||BX.hasClass(t,this.settings.classSearchContainer)||BX.hasClass(t,this.settings.classDefaultPopup)||BX.hasClass(t,this.settings.classPopupOverlay))},this)},_onDocumentClick:function(t){var e=this.getPopup();if(!this.isInsideFilterEvent(t)&&!this.hasScrollClick(t)){if(e&&e.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function(t){var e=this.getFieldsPopup();t.stopPropagation();t.preventDefault();if(e&&!e.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function(t){if(BX.type.isPlainObject(t)){if(t.cache===false){this.fieldsPopupItems=null}}var e=this.getPreset().getFields();var s=this.getFieldsPopupItems();var i,r;if(BX.type.isArray(s)&&s.length){s.forEach(function(t){i=BX.data(t,"name").replace("_datesel","").replace("_numsel","");r=e.some(function(t){return BX.data(t,"name")===i});if(r){BX.addClass(t,this.settings.classMenuItemChecked)}else{BX.removeClass(t,this.settings.classMenuItemChecked)}},this)}},getFieldsPopupItems:function(){if(!BX.type.isArray(this.fieldsPopupItems)){var t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}}return this.fieldsPopupItems},getFieldListContainerClassName:function(t){var e=this.settings.classPopupFieldList1Column;if(t>6&&t<12){e=this.settings.classPopupFieldList2Column}if(t>12){e=this.settings.classPopupFieldList3Column}return e},prepareFieldsDecl:function(t){return(t||[]).map(function(t){return{block:"main-ui-filter-field-list-item",label:"LABEL"in t?t.LABEL:"",id:"ID"in t?t.ID:"",name:"NAME"in t?t.NAME:"",item:t,onClick:BX.delegate(this._clickOnFieldListItem,this)}},this)},getLazyLoadFields:function(){var t=new BX.Promise;BX.ajax({method:"GET",url:this.getParam("LAZY_LOAD")["GET_LIST"],dataType:"json",onsuccess:function(e){t.fulfill(e)}});return t},getFieldsListPopupContent:function(){var t=new BX.Promise;var e=this.getParam("FIELDS");var s=BX.type.isArray(e)?e.length:0;if(this.getParam("LAZY_LOAD")){this.getLazyLoadFields().then(function(e){var s={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(e.length),content:this.prepareFieldsDecl(e)};t.fulfill(BX.decl(s))}.bind(this));return t}var i={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(s),content:this.prepareFieldsDecl(e)};t.fulfill(BX.decl(i));return t},getFieldLoader:function(){if(!this.fieldLoader){this.fieldLoader=new BX.Loader({mode:"custom",size:18,offset:{left:"5px",top:"5px"}})}return this.fieldLoader},_clickOnFieldListItem:function(t){var e=t.target;var s;if(!BX.hasClass(e,this.settings.classFieldListItem)){e=BX.findParent(e,{className:this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(e)){try{s=JSON.parse(BX.data(e,"item"))}catch(t){}var i=new BX.Promise;if(this.getParam("LAZY_LOAD")){this.getFieldLoader().show(e);var r=e.querySelector(".main-ui-select-inner-label");if(r){r.classList.add("main-ui-no-before")}this.getLazyLoadField(s.NAME).then(function(t){i.fulfill(t);this.getFieldLoader().hide();if(r){r.classList.remove("main-ui-no-before")}}.bind(this))}else{i.fulfill(s)}i.then(function(t){this.params.FIELDS.push(t);if(BX.hasClass(e,this.settings.classMenuItemChecked)){BX.removeClass(e,this.settings.classMenuItemChecked);this.getPreset().removeField(t)}else{if(BX.type.isPlainObject(t)){this.getPreset().addField(t);BX.addClass(e,this.settings.classMenuItemChecked);if(BX.type.isString(t.HTML)){var s=BX.create("div");this.getHiddenElement().appendChild(s);BX.html(s,t.HTML)}}}this.syncFields()}.bind(this))}},getHiddenElement:function(){if(!this.hiddenElement){this.hiddenElement=BX.create("div");document.body.appendChild(this.hiddenElement)}return this.hiddenElement},getLazyLoadField:function(t){var e=new BX.Promise;BX.ajax({method:"get",url:BX.util.add_url_param(this.getParam("LAZY_LOAD")["GET_FIELD"],{id:t}),dataType:"json",onsuccess:function(t){e.fulfill(t)}});return e},showFieldsPopup:function(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function(){var t=this.getFieldsPopup();var e=BX.pos(this.getAddField());e.forceBindPosition=true;t.adjustPosition(e)},getFieldsPopup:function(){var t=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopupLoader=new BX.Loader({target:this.fieldsPopup.contentContainer});this.fieldsPopupLoader.show();this.fieldsPopup.contentContainer.style.width="630px";this.fieldsPopup.contentContainer.style.height="330px";this.getFieldsListPopupContent().then(function(t){this.fieldsPopup.contentContainer.removeAttribute("style");this.fieldsPopupLoader.hide();this.fieldsPopup.setContent(t);this.syncFields({cache:false})}.bind(this))}return this.fieldsPopup},_onAddPresetClick:function(){this.enableAddPreset()},enableWaitSate:function(t){!!t&&BX.addClass(t,this.settings.classWaitButtonClass)},disableWaitState:function(t){!!t&&BX.removeClass(t,this.settings.classWaitButtonClass)},_onSaveButtonClick:function(){var t=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;var e=this.getPreset().getAddPresetFieldInput();var s=e.parentNode.querySelector(".main-ui-filter-edit-mask");var i;function r(t){if(t.animationName==="fieldError"){t.currentTarget.removeEventListener("animationend",r);t.currentTarget.removeEventListener("oAnimationEnd",r);t.currentTarget.removeEventListener("webkitAnimationEnd",r);t.currentTarget.classList.remove("main-ui-filter-error")}}function a(t){t.addEventListener("animationend",r);t.addEventListener("oAnimationEnd",r);t.addEventListener("webkitAnimationEnd",r);t.classList.add("main-ui-filter-error");var e=new BX.Promise;e.fulfill(true);return e}this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!t){i=e.value;if(i.length){this.savePreset();this.disableAddPreset()}else{a(s).then(function(){e.focus()})}}if(this.isEditEnabled()){var n=this.getPreset();var l=n.getPresetNodeById(n.getCurrentPresetId());var o=n.getPresetInput(l);if(o.value.length){n.updateEditablePreset(n.getCurrentPresetId());this.saveUserSettings(t);!t&&this.disableEdit()}else{var h=l.querySelector(".main-ui-filter-edit-mask");a(h).then(function(){o.focus()})}}},_onCancelButtonClick:function(){this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterMousedown:function(t){var e=t.target;if(this.getFields().isDragButton(e)){var s=BX.Filter.Utils.getByTag(e.parentNode,"input",true);(s||[]).forEach(function(t){BX.fireEvent(t,"blur")});BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function(t){var e=this.getFields();var s=this.getPreset();var i;if(e.isFieldDelete(t.target)){i=e.getField(t.target);s.removeField(i)}if(e.isFieldValueDelete(t.target)){i=e.getField(t.target);e.clearFieldValue(i)}},getButtonsContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function(){return this.isAddPresetModeState},enableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=t.getAddPresetFieldInput();var i=this.getButtonsContainer();BX.show(e);BX.show(i);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=this.getButtonsContainer();BX.hide(e);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function(){var t=this.getFieldListContainer();var e=null;if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return e},getFilterFields:function(){var t=this.getFieldListContainer();var e=[];var s=[];if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classField,true);s=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(e)){e=[]}if(BX.type.isArray(s)){s.forEach(function(t){e.push(t)})}}return e},getFilterFieldsValues:function(){var t=this.getPreset().getFields();var e=this.getSearch();var s={};var i,r;s["FIND"]=e.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach(function(t){i=BX.data(t,"type");r=BX.data(t,"name");switch(i){case this.types.STRING:{this.prepareControlStringValue(s,t);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,r,t);break}case this.types.DATE:{this.prepareControlDateValue(s,r,t);break}case this.types.CUSTOM_DATE:{this.prepareControlCustomDateValue(s,r,t);break}case this.types.SELECT:{this.prepareControlSelectValue(s,r,t);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,r,t);break}case this.types.DEST_SELECTOR:{this.prepareControlCustomEntityValue(s,r,t);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,r,t);break}case this.types.CUSTOM_ENTITY:{this.prepareControlCustomEntityValue(s,r,t);break}default:{break}}},this)}return s},prepareControlCustomEntityValue:function(t,e,s){var i=this.fetchSquares(s);var r=this.fetchSquaresData(i);var a=BX.Main.ui.CustomEntity.isMultiple(s);t[e]="";t[e+"_label"]="";if(a){t[e]=[];t[e+"_label"]=[];!!r&&r.forEach(function(s){t[e].push(s._value.toString());t[e+"_label"].push(s._label.toString())})}else{if(r.length){t[e]=r[0]._value.toString();t[e+"_label"]=r[0]._label.toString()}}},fetchSquares:function(t){return!!t?BX.Filter.Utils.getByClass(t,this.settings.classSquare,true):[]},fetchSquaresData:function(t){return t.map(function(t){return JSON.parse(BX.data(t,"item"))},this)},prepareControlCustomValue:function(t,e,s){var i=BX.Filter.Utils.getByTag(s,"input",true);t[e]="";if(BX.type.isArray(i)){i.forEach(function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}})}},prepareControlMultiselectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var r=JSON.parse(BX.data(i,"value"));t[e]="";if(BX.type.isArray(r)&&r.length){t[e]={};r.forEach(function(s,i){t[e][i]=s.VALUE})}},prepareControlSelectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=JSON.parse(BX.data(i,"value"));t[e]=r.VALUE},prepareControlCustomDateValue:function(t,e,s){var i=s.querySelector('[data-name="'+e+"_days"+'"]');if(i){var r=JSON.parse(i.dataset.value);t[e+"_days"]=r.map(function(t){return t.VALUE})}var a=s.querySelector('[data-name="'+e+"_months"+'"]');if(a){var n=JSON.parse(a.dataset.value);t[e+"_months"]=n.map(function(t){return t.VALUE})}var l=s.querySelector('[data-name="'+e+"_years"+'"]');if(l){var o=JSON.parse(l.dataset.value);t[e+"_years"]=o.map(function(t){return t.VALUE})}},prepareControlDateValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=s.querySelector('.main-ui-select[data-name*="_allow_year"]');var a=e+this.settings.datePostfix;var n=e+this.settings.fromPostfix;var l=e+this.settings.toPostfix;var o=e+this.settings.daysPostfix;var h=e+this.settings.monthPostfix;var d=e+this.settings.quarterPostfix;var u=e+this.settings.yearPostfix;var c=e+"_allow_year";var f,p,g,B,E;t[a]="";t[n]="";t[l]="";t[o]="";t[h]="";t[d]="";t[u]="";f=JSON.parse(BX.data(i,"value"));t[a]=f.VALUE;if(r){E=JSON.parse(BX.data(r,"value"));t[c]=E.VALUE}switch(f.VALUE){case this.dateTypes.EXACT:{p=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);t[n]=p.value;t[l]=p.value;break}case this.dateTypes.QUARTER:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_quarter")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}if(B&&B.indexOf("_year")!==-1){t[u]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.YEAR:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_year")!==-1){t[u]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.MONTH:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_month")!==-1){t[h]=JSON.parse(BX.data(e,"value")).VALUE}if(B&&B.indexOf("_year")!==-1){t[u]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.additionalDateTypes.PREV_DAY:case this.additionalDateTypes.NEXT_DAY:case this.additionalDateTypes.MORE_THAN_DAYS_AGO:case this.additionalDateTypes.AFTER_DAYS:case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var m=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput);if(!!m&&m.name===o){t[o]=m.value}break}case this.dateTypes.RANGE:{p=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);p.forEach(function(e){if(e.name===n){t[n]=e.value}else if(e.name===l){t[l]=e.value}},this);break}case"CUSTOM_DATE":{var P={};this.prepareControlCustomDateValue(P,e,s);t[e+"_days"]=P[e+"_days"];t[h]=P[e+"_months"];t[u]=P[e+"_years"];break}default:{break}}},prepareControlNumberValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var r=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=e+this.settings.numberPostfix;var n=e+this.settings.fromPostfix;var l=e+this.settings.toPostfix;var o;t[n]="";t[l]="";o=JSON.parse(BX.data(r,"value"));t[a]=o.VALUE;i.forEach(function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[n]=e.value||"";if(t[a]==="exact"){t[l]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[l]=e.value||""}},this)},prepareControlStringValue:function(t,e){var s=BX.Filter.Utils.getByClass(e,this.settings.classStringInput);var i;if(BX.type.isDomNode(s)){i=s.name;t[i]=s.value}},showGridAnimation:function(){this.grid&&this.grid.tableFade()},hideGridAnimation:function(){this.grid&&this.grid.tableUnfade()},getPresetId:function(t,e){var s=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!e||s==="default_filter"&&!t){s="tmp_filter"}return s},applyFilter:function(t,e){var s=this.getPresetId(t,e);var i=this.getParam("FILTER_ID");var r=new BX.Promise(null,this);var a=this.getPreset();var n=this.getSearch();var l={autoResolve:!this.grid};var o=this;this.clearGet();this.showGridAnimation();BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[i,{},this,r]);this.updatePreset(s,null,t,null).then(function(){n.updatePreset(a.getPreset(s));if(o.getParam("VALUE_REQUIRED")){if(!n.getSquares().length){o.lastPromise=a.applyPinnedPreset()}}}).then(function(){var t={apply_filter:"Y",clear_nav:"Y"};var e=BX.delegate(r.fulfill,r);var s=BX.delegate(r.reject,r);o.grid&&o.grid.reloadTable("POST",t,e,s);BX.onCustomEvent(window,"BX.Main.Filter:apply",[i,{},o,r,l]);l.autoResolve&&r.fulfill()});return r},getAddField:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.CUSTOM_DATE:{t.VALUES={days:[],months:[],years:[]};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.DEST_SELECTOR:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function(t){var e=this.getPreset().getField({NAME:t});var s,i;if(BX.type.isDomNode(e)){s=this.getFieldByName(t);s=this.resetControlData(s);i=this.getPreset().createControl(s);BX.insertAfter(i,e);BX.remove(e)}},clearControls:function(t){if(BX.type.isArray(t)){t.forEach(function(t){"name"in t&&this.clearControl(t.name)},this)}else if(BX.type.isPlainObject(t)&&"name"in t){this.clearControl(t.name)}},getTemplate:function(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function(){var t=this.getPopup();var e=t.popupContainer;var s=this.settings.get("FILTER_CLOSE_DELAY");var i;setTimeout(BX.delegate(function(){if(!this.isIe()){BX.removeClass(e,this.settings.classAnimationShow);BX.addClass(e,this.settings.classAnimationClose);i=parseFloat(BX.style(e,"animation-duration"));if(BX.type.isNumber(i)){i=i*1e3}setTimeout(function(){t.close()},i)}else{t.close()}},this),s);this.closeFieldListPopup();this.adjustFocus()},showPopup:function(){var t=this.getPopup();var e;if(!t.isShown()){this.isOpened=true;var s=this.settings.get("FILTER_SHOW_DELAY");setTimeout(BX.delegate(function(){t.show();if(!this.isIe()){e=t.popupContainer;BX.removeClass(e,this.settings.classAnimationClose);BX.addClass(e,this.settings.classAnimationShow);BX.onCustomEvent(window,"BX.Main.Filter:show",[this])}},this),s)}},getSaveForAllCheckbox:function(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function(){if(!this.popupBindElement){var t=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var e=null;if(BX.type.isNotEmptyString(t)){e=BX.Filter.Utils.getBySelector(document,t)}this.popupBindElement=!!e?e:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function(){this.restoreDefaultFields()},restoreDefaultFields:function(){var t=this.getPreset().getPreset("default_filter",true);var e=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var r=t.FIELDS.map(function(t){return t.NAME});var a=r.join(",");e.forEach(function(s,i){if(s.ID==="default_filter"){e[i]=BX.clone(t)}},this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach(function(e,s){if(e.ID==="default_filter"){this.editablePresets[s]=BX.clone(t)}},this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:a,save:"Y",apply_filter:"N"},i)},getRestoreFieldsButton:function(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function(){var t=this.getParam("DEFAULT_PRESETS");var e=this.getParam("PRESETS");var s=false;var i,r,a;if(BX.type.isArray(t)){t.sort(function(t,e){return t.SORT<e.SORT});t.forEach(function(t){s=e.some(function(e,s){if(e.ID===t.ID){i=s;return true}});if(s){e[i]=BX.clone(t)}else{e.push(BX.clone(t))}if(t.ID!=="default_filter"){this.addSidebarItem(t.ID,t.TITLE,t.PINNED);if(t.PINNED){r=t.ID}}},this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!r){r="default_filter"}a=this.getPreset().getPresetNodeById(r);if(a){BX.fireEvent(a,"click")}},saveRestoreFilter:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var e=this.getParam("PRESETS");var s={};var i;if(BX.type.isArray(e)){e.forEach(function(t){i=t.FIELDS.map(function(t){return t.NAME});i=i.join(",");s[t.ID]={name:t.TITLE||null,sort:t.SORT,preset_id:t.ID,fields:this.prepareFields(t.FIELDS),rows:i,for_all:t.FOR_ALL}},this);this.saveOptions(s,t)}},prepareFields:function(t){var e={};var s;if(BX.type.isArray(t)){t.forEach(function(t){if(t.TYPE===this.types.SELECT){e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:""}if(t.TYPE===this.types.MULTI_SELECT){t.VALUE.forEach(function(s,i){e[t.NAME]=e[t.NAME]||{};e[t.NAME][i]=s.VALUE});e[t.NAME]=e[t.NAME]||""}if(t.TYPE===this.types.DATE||t.TYPE===this.types.NUMBER){s=Object.keys(t.VALUES);s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]});if(t.TYPE===this.types.DATE){e[t.NAME+"_datesel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}if(t.TYPE===this.types.NUMBER){e[t.NAME+"_numsel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}}if(t.TYPE===this.types.DEST_SELECTOR){e[t.NAME+"_label"]=t.VALUES._label;e[t.NAME+"_value"]=t.VALUES._value}if(t.TYPE===this.types.CUSTOM_ENTITY){e[t.NAME+"_label"]=t.VALUES._label;e[t.NAME+"_value"]=t.VALUES._value}},this)}return e},getRestoreButton:function(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getFindButton(),"click")}},_onFindButtonClick:function(){var t=this.getPreset();var e=t.getCurrentPresetId();var s;if(e!=="tmp_filter"&&e!=="default_filter"&&!t.isPresetValuesModified(e)){var i=t.getPreset(e);var r=t.getAdditionalValues(e);var a=t.getFields().map(function(t){return BX.data(t,"name")});i.ADDITIONAL=this.preparePresetFields(r,a);i.ADDITIONAL=i.ADDITIONAL.filter(function(t){return!this.getPreset().isEmptyField(t)},this);t.applyPreset(e);s=this.applyFilter(false,e);this.closePopup()}else{t.deactivateAllPresets();s=this.applyFilter();this.closePopup()}return s},_onResetButtonClick:function(){if(this.getParam("VALUE_REQUIRED")){var t=this.getPreset().getCurrentPresetData();if(t.ADDITIONAL.length){this.closePopup()}BX.fireEvent(this.getSearch().getClearButton(),"click")}else{if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()}},resetFilter:function(t){var e=this.getSearch();var s=this.getPreset();if(!t){e.clearInput()}e.removePreset();s.deactivateAllPresets();s.resetPreset(true);e.hideClearButton();e.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function(t){var e=this.getDragButton(t);e.onbxdragstart=BX.delegate(this._onFieldDragStart,this);e.onbxdragstop=BX.delegate(this._onFieldDragStop,this);e.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(e);jsDD.registerDest(e);return t},unregisterDragItem:function(t){var e=this.getDragButton(t);jsDD.unregisterObject(e);jsDD.unregisterDest(e)},_onFieldDragStart:function(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onFieldDragStop:function(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},disableFieldsDragAndDrop:function(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function(){var t,e,s,i;t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(e){i=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&i!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}},this)}},getDragButton:function(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},this)}},_onDragStart:function(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function(){var t,e;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)&&!BX.hasClass(t,this.settings.classDefaultFilter)){this.presetsList.push(t)}},this)}},_onDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},getSidebarControlsContainer:function(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function(){var t=this.getPreset();var e=t.getPresets();var s;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}},this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function(){var t=this.getPreset();var e=t.getPresets();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){BX.removeClass(t,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(t)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function(){return this.isEditEnabledState},getEditButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function(t,e){return t in this.params?this.params[t]:e},getFilter:function(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function(t,e,s){if("CONFIRM"in t&&t.CONFIRM){var i=this.getParam("FILTER_ID")+"-confirm-dialog";var r='<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>";var a="CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"";var n=new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy()}}});var l=new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindow(i,null,{content:r,titleBar:a,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[n,l]});BX.addCustomEvent(o,"onPopupClose",BX.delegate(function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},this));if(!o.isShown()){o.show();var h=o.popupContainer;BX.removeClass(h,this.settings.classAnimationShow);BX.addClass(h,this.settings.classAnimationShow)}}else{BX.type.isFunction(e)?e():null}}}})();(function(){BX.Main.filterManager={data:{},push:function(t,e){if(BX.type.isNotEmptyString(t)&&e){this.data[t]=e}},getById:function(t){var e=null;if(t in this.data){e=this.data[t]}return e}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?15441273841650";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Api=function(e){this.parent=e};BX.Filter.Api.prototype={setFields:function(e){var t,i;if(BX.type.isPlainObject(e)){this.parent.getPopup();t=this.parent.getPreset();t.deactivateAllPresets();i={preset_id:"tmp_filter",fields:e};this.parent.updateParams(i);t.applyPreset("tmp_filter")}},setFilter:function(e){if(typeof e==="object"){this.parent.updateParams(e);this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().activatePreset(e.preset_id);this.parent.getPreset().applyPreset(e.preset_id);if(!e.checkFields||!this.parent.getPreset().isPresetValuesModified(e.preset_id)){this.parent.applyFilter(false,e.preset_id)}else{var t={};if(BX.type.isPlainObject(e.fields)){t=Object.assign({},e.fields)}if(BX.type.isPlainObject(e.additional)){t=Object.assign({},e.additional)}this.parent.getPreset().deactivateAllPresets();this.setFields(t);this.apply()}}},extendFilter:function(e){if(!!e&&typeof e==="object"){Object.keys(e).forEach(function(t){if(BX.type.isNumber(e[t])){e[t]=""+e[t]}});var t=this.parent.getPreset().getCurrentPresetId();if(t==="tmp_filter"||t==="default_filter"){var i=Object.assign({},this.parent.getFilterFieldsValues(),e);this.setFields(i);this.apply();return}var s=this.parent.getPreset().getAdditionalValues(t);if(BX.type.isPlainObject(s)&&Object.keys(s).length){e=Object.assign({},s,e)}this.setFilter({preset_id:t,additional:e,checkFields:true})}},apply:function(){if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){this.parent.applyFilter()}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/destination-selector.min.js?15441273845460";s:6:"source";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/destination-selector.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.DestinationSelectorManager={fields:[],controls:{},onSelect:function(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.name)||typeof t.item=="undefined"||!BX.type.isNotEmptyString(t.type)){return}var e=t.name,i=t.type,o=t.item;BX.SocNetLogDestination.obItemsSelected[e]={};BX.SocNetLogDestination.obItemsSelected[e][o.id]=i;var n=BX.Filter.DestinationSelectorManager.controls[e];if(n){n.setData(BX.util.htmlspecialcharsback(o.name),o.id);n.getLabelNode().value="";n.getLabelNode().blur();if(BX.SocNetLogDestination.popupWindow!=null){BX.SocNetLogDestination.popupWindow.close()}if(BX.SocNetLogDestination.popupSearchWindow!=null){BX.SocNetLogDestination.popupSearchWindow.close()}}},onDialogOpen:function(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.name)){return}var e=t.name;var i=BX.Filter.DestinationSelector.items[e];if(i){i.onDialogOpen()}},onDialogClose:function(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.name)){return}var e=t.name;var i=BX.Filter.DestinationSelector.items[e];if(i){i.onDialogClose()}}};BX.Filter.DestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BX.Filter.DestinationSelector.items={};BX.Filter.DestinationSelector.create=function(t,e){if(typeof this.items[t]!="undefined"){return this.items[t]}var i=new BX.Filter.DestinationSelector(t,e);i.initialize(t,e);this.items[t]=i;BX.onCustomEvent(window,"BX.Filter.DestinationSelector:create",[t]);return i};BX.Filter.DestinationSelector.prototype.getSetting=function(t,e){return this.settings.hasOwnProperty(t)?this.settings[t]:e};BX.Filter.DestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BX.Filter.DestinationSelector.prototype.initialize=function(t,e){this.id=t;this.settings=e?e:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var o={};o[this.fieldId]=i.itemId;o[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(o)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.Selector:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSwitchTabFocus",BX.delegate(this.onBeforeSwitchTabFocus,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.delegate(this.onBeforeSelectItemFocus,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BX.Filter.DestinationSelector.prototype.open=function(){var t=this.id;if(!this.inited){var e=this.getSearchInput();e.id=e.name;BX.addCustomEvent(window,"BX.Main.Selector:afterInitDialog",BX.delegate(function(t){if(typeof t.id!="undefined"||t.id!=this.id){return}this.opened=true},this));BX.onCustomEvent(window,"BX.Filter.DestinationSelector:openInit",[{id:this.id,inputId:e.id,containerId:e.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Filter.DestinationSelector:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BX.Filter.DestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManager.controls[this.id]!=="undefined"){BX.Main.selectorManager.controls[this.id].closeDialog()}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorOpen=function(t){var e=t.getId();if(this.fieldId!==e){this.control=null}else{this.control=t;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BX.Filter.DestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorClose=function(t){if(this.fieldId===t.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BX.Filter.DestinationSelector.prototype.onGetStopBlur=function(t,e){if(BX.findParent(t.target,{className:"bx-lm-box"})){e.stopBlur=true}};BX.Filter.DestinationSelector.prototype.onCustomEntityRemove=function(t){if(this.fieldId===t.getId()){if(typeof t.hiddenInput!="undefined"&&typeof t.hiddenInput.value!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id]!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]!="undefined"){delete BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]}}};BX.Filter.DestinationSelector.prototype.onBeforeSwitchTabFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BX.Filter.DestinationSelector.prototype.onBeforeSelectItemFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BX.Filter.DestinationSelector.prototype.onBeforeInitDialog=function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}this.inited=true;if(!this.control){t.blockInit=true}};BX.Filter.DestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BX.Filter.DestinationSelector.prototype.onDialogClose=function(){this.opened=false}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15441273842703";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.FieldController=function(t,e){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(t,e)};BX.Filter.FieldController.prototype={init:function(t,e){if(!BX.type.isDomNode(t)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(e instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=t;this.parent=e;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function(){var t=this.getSquares();return this.getInputValue()||BX.type.isArray(t)&&t.length},getField:function(){return this.field},getInput:function(){var t,e;if(!BX.type.isDomNode(this.input)){t=this.getType();e=this.parent.types;if(t===e.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(t===e.NUMBER||t==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(t===e.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(t===e.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=""}},hideDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.parent.settings.classHide)}},showDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.parent.settings.classHide)}},removeSquares:function(){var t=this.getSquares();if(BX.type.isArray(t)&&t.length){t.forEach(function(t){BX.remove(t)})}},_onDeleteClick:function(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function(){var t="";var e=this.getInput();if(BX.type.isDomNode(e)){t=e.value}return t},getType:function(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?154412738423035";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Fields=function(t){this.parent=null;this.init(t)};BX.Filter.Fields.prototype={init:function(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",BX.delegate(this._onDateTypeChange,this))},deleteField:function(t){BX.remove(t)},isFieldDelete:function(t){return BX.hasClass(t,this.parent.settings.classFieldDelete)},isFieldValueDelete:function(t){return BX.hasClass(t,this.parent.settings.classValueDelete)||BX.hasClass(t.parentNode,this.parent.settings.classValueDelete)},isDragButton:function(t){return t&&BX.hasClass(t,this.parent.settings.classPresetDragButton)},clearFieldValue:function(t){if(t){var e=BX.Filter.Utils.getByClass(t,this.parent.settings.classControl,true);var n=BX.Filter.Utils.getByClass(t,this.parent.settings.classSquare,true);(n||[]).forEach(BX.remove);(e||[]).forEach(function(t){t&&"value"in t&&(t.value="")},this)}},getField:function(t){var e;if(BX.type.isDomNode(t)){e=BX.findParent(t,{class:this.parent.settings.classField},true,false);if(!BX.type.isDomNode(e)){e=BX.findParent(t,{class:this.parent.settings.classFieldGroup},true,false)}}return e},render:function(t,e){var n,i,a,r;if(BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(t)){n=Object.keys(e);n.forEach(function(n){r="{{"+n+"}}";t=t.replace(new RegExp(r,"g"),e[n])});a=BX.create("div",{html:t});i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldGroup);if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classField)}if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLine)}}return i},createInputText:function(t){var e={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:BX.type.isNotEmptyString(t.VALUE)||BX.type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]};return BX.decl(e)},createDestSelector:function(t){var e,n;var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var a=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}if(!BX.type.isArray(a)){a=[a]}var r=!!t.VALUES._value?t.VALUES._value:[];if(BX.type.isPlainObject(r)){r=Object.keys(r).map(function(t){return r[t]})}if(!BX.type.isArray(r)){r=[r]}a.forEach(function(t,e){i.content.content.push({block:"main-ui-square",tag:"span",name:t,item:{_label:t,_value:r[e]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES["_label"]:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:t.NAME+"_label",tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES["_value"]:"",tabindex:t.TABINDEX});i=BX.decl(i);e=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(e,"main-ui-square-search-item");BX.bind(e,"focus",function(t){BX.fireEvent(t.currentTarget,"click")});BX.bind(e,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){BX.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}BX.bind(e,"keydown",BX.proxy(this._onCustomEntityKeydown,this));BX.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));BX.ready(BX.proxy(function(){BX.Filter.DestinationSelector.create(t.NAME,{filterId:this.parent.getParam("FILTER_ID"),fieldId:t.NAME})},this));return i},createCustomEntity:function(t){var e,n;var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var a=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}if(!BX.type.isArray(a)){a=[a]}var r=!!t.VALUES._value?t.VALUES._value:[];if(BX.type.isPlainObject(r)){r=Object.keys(r).map(function(t){return r[t]})}if(!BX.type.isArray(r)){r=[r]}a.forEach(function(t,e){i.content.content.push({block:"main-ui-square",tag:"span",name:t,item:{_label:t,_value:r[e]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES["_label"]:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:t.NAME+"_label",tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES["_value"]:"",tabindex:t.TABINDEX});i=BX.decl(i);e=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(e,"main-ui-square-search-item");BX.bind(e,"focus",BX.proxy(this._onCustomEntityInputFocus,this));BX.bind(e,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){BX.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}BX.bind(e,"keydown",BX.proxy(this._onCustomEntityKeydown,this));BX.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i},_onCustomEntityInputFocus:function(t){BX.fireEvent(t.currentTarget,"click")},_onCustomEntityInputClick:function(t){var e,n,i,a;t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}e=new Date(this.trustTimestamp);n=new Date(this.notTrustTimestamp);i=e.getMinutes()+":"+e.getSeconds();a=n.getMinutes()+":"+n.getSeconds();if(i!==a){this._onCustomEntityFocus(t)}},_onDocumentFocus:function(t){var e=this.getCustomEntityInstance();var n=e.getPopupContainer();var i=e.getLabelNode()===t.target;var a=!!n&&n.contains(t.target);if(!i&&!a){this._onCustomEntityBlur(t)}},_onCustomEntityKeydown:function(t){var e=BX.Filter.Utils.getByClass(t.target.parentNode.parentNode,this.parent.settings.classSquare,true);var n=null;if(e.length){n=e[e.length-1]}if(BX.Filter.Utils.isKey(t,"backspace")&&t.currentTarget.selectionStart===0){if(BX.type.isDomNode(n)){if(BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.remove(n);var i=BX.Filter.Utils.getBySelector(t.target.parentNode.parentNode,'input[type="hidden"]');i.value="";BX.fireEvent(i,"input")}else{BX.addClass(n,this.parent.settings.classSquareSelected)}}}else if(BX.type.isDomNode(n)&&BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.removeClass(n,this.parent.settings.classSquareSelected)}},_onCustomEntityFieldClick:function(t){var e;if(BX.hasClass(t.target,this.parent.settings.classSquareDelete)){e=BX.findParent(t.target,{className:this.parent.settings.classSquare},true,false);if(BX.type.isDomNode(e)){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[n]);BX.remove(e)}}else{var i=BX.Filter.Utils.getBySelector(t.target,'input[type="text"]');BX.fireEvent(i,"focus")}},_onCustomEntityBlur:function(t){var e={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,e]);if(typeof e.stopBlur=="undefined"||!e.stopBlur){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);BX.unbind(n.getPopupContainer(),"click",this._stopPropagation);BX.removeClass(n.getField(),this.parent.settings.classFocus)}},_stopPropagation:function(t){t.stopPropagation()},getCustomEntityInstance:function(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance},_onCustomEntityFocus:function(t){var e=BX.findParent(t.currentTarget,{className:"main-ui-control-entity"},true,false);var n=this.getCustomEntityInstance();t.stopPropagation();n.setField(e);BX.onCustomEvent(window,"BX.Main.Filter:customEntityFocus",[n]);var i=n.getPopupContainer();if(BX.type.isElementNode(i)){BX.bind(i,"click",this._stopPropagation)}BX.addClass(e,this.parent.settings.classFocus)},createCustom:function(t){var e,n,i;var a=[];t.VALUE=BX.util.htmlspecialcharsback(t.VALUE);a.push("main-ui-control");a.push("main-ui-custom-style");i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:a,attrs:{"data-name":t.NAME},content:""}});n='name="'+t.NAME+'" value="'+("_VALUE"in t?t._VALUE:"")+'"';e=BX.Filter.Utils.getByClass(i,"main-ui-custom");try{t.VALUE=t.VALUE.replace('name="'+t.NAME+'"',n)}catch(t){}BX.html(e,t.VALUE);return i},createSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}})},createMultiSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}})},createCustomDate:function(t){var e={block:"main-ui-control-field-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(BX.type.isPlainObject(t.VALUE.days)){t.VALUE.days=Object.keys(t.VALUE.days).map(function(e){return t.VALUE.days[e]})}var n=t.DAYS.filter(function(e){return t.VALUE.days.some(function(t){return t===e.VALUE})});var i={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],placeholder:t.DAYS_PLACEHOLDER,dragButton:false,content:{block:"main-ui-multi-select",name:t.NAME+"_days",tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.DAYS,value:n,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.DAYS_PLACEHOLDER}}};if(BX.type.isPlainObject(t.VALUE.months)){t.VALUE.months=Object.keys(t.VALUE.months).map(function(e){return t.VALUE.months[e]})}var a=t.MONTHS.filter(function(e){return t.VALUE.months.some(function(t){return t===e.VALUE})});var r={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:t.NAME+"_months",tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.MONTHS,value:a,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.MONTHS_PLACEHOLDER}}};if(BX.type.isPlainObject(t.VALUE.years)){t.VALUE.years=Object.keys(t.VALUE.years).map(function(e){return t.VALUE.years[e]})}var l=t.YEARS.filter(function(e){return t.VALUE.years.some(function(t){return t===e.VALUE})});var s={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:t.NAME+"_years",tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.YEARS,value:l,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.YEARS_PLACEHOLDER}}};e.content.push(i);e.content.push(r);e.content.push(s);return BX.decl(e)},_onDateTypeChange:function(t,e){if(this.parent.getPopup().contentContainer.contains(t.node)){var n={};var i=null;var a,r,l,s,o,E,u,c;if(BX.type.isPlainObject(e)&&"VALUE"in e){s=BX.data(t.getNode(),"name");r=t.getParams();if(!BX.type.isPlainObject(r)&&(s.indexOf("_datesel")!==-1||s.indexOf("_numsel")!==-1)){a=t.getNode().parentNode.parentNode;n.TABINDEX=t.getInput().getAttribute("tabindex");n.SUB_TYPES=t.getItems();n.SUB_TYPE=e;n.NAME=BX.data(a,"name");n.TYPE=BX.data(a,"type");E=this.parent.getPreset().getCurrentPresetData();if("FIELDS"in E&&E.FIELDS.length){u=E.FIELDS.filter(function(t){return t.NAME===n.NAME},this);if(u.length){u=u[0];if(s.indexOf("_datesel")!==-1){n.MONTHS=u.MONTHS;n.MONTH=u.MONTH;n.YEARS=u.YEARS;n.YEAR=u.YEAR;n.QUARTERS=u.QUARTERS;n.QUARTER=u.QUARTER;n.ENABLE_TIME=u.ENABLE_TIME;n.YEARS_SWITCHER=u.YEARS_SWITCHER}n.VALUES=u.VALUES}}if(this.parent.getParam("ENABLE_LABEL")){l=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLabel);n.LABEL=l.innerText}if(s.indexOf("_datesel")!==-1){i=this.createDate(n)}else{i=this.createNumber(n)}if(BX.type.isArray(this.parent.fieldsList)){c=this.parent.fieldsList.indexOf(a);if(c!==-1){this.parent.fieldsList[c]=i;this.parent.registerDragItem(i)}}this.parent.unregisterDragItem(a);o=BX.Filter.Utils.getByClass(i,this.parent.settings.classField,true);if(BX.type.isArray(o)&&o.length){o.forEach(function(t){t.FieldController=new BX.Filter.FieldController(t,this.parent)},this)}BX.insertAfter(i,a);BX.remove(a)}}}},createNumber:function(t){var e,n,i,a,r,l;var s=this.parent.numberTypes;var o=s.SINGLE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){o=t.SUB_TYPE.VALUE;i="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_numsel","");e={block:"number-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-number-group"]:["main-ui-filter-number-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(o!==s.LESS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:i,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:""}};e.content.push(a)}if(o===s.RANGE){r={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};e.content.push(r)}if(o===s.RANGE||o===s.LESS){l={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:""}}}e.content.push(l);return BX.decl(e)},createDate:function(t){var e,n,i,a,r,l,s,o,E;var u=this.parent.dateTypes;var c=this.parent.additionalDateTypes;var A=u.NONE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){A=t.SUB_TYPE.VALUE;l="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_datesel","");if("VALUES"in t&&BX.type.isPlainObject(t.VALUES)){var m=Object.keys(t.VALUES);m.forEach(function(e){if(!t.VALUES[e]){t.VALUES[e]=""}})}e={block:"date-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",enableTime:"ENABLE_TIME"in t?t.ENABLE_TIME:false,deleteButton:true,content:[]};t.NAME=t.NAME.replace("_datesel","");if(A===u.EXACT){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:l,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",enableTime:t.ENABLE_TIME}};e.content.push(a)}if(A===u.NEXT_DAYS||A===u.PREV_DAYS||A===c.PREV_DAY||A===c.NEXT_DAY||A===c.MORE_THAN_DAYS_AGO||A===c.AFTER_DAYS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:l,name:"NAME"in t?t.NAME+"_days":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._days:""}};e.content.push(a)}if(A===u.RANGE){var d={block:"main-ui-filter-range-group",content:[]};n={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",placeholder:l,enableTime:t.ENABLE_TIME}};r={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};i={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:"",placeholder:l,enableTime:t.ENABLE_TIME}};d.content.push(n);d.content.push(r);d.content.push(i);e.content.push(d)}if(A===u.MONTH){if("_month"in t.VALUES&&t.VALUES._month){t.MONTH=t.MONTHS.filter(function(e){return e.VALUE===t.VALUES._month});t.MONTH=t.MONTH.length?t.MONTH[0]:null}if(!t.MONTH){t.MONTH=t.MONTHS[0]}E={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.MONTH,items:t.MONTHS,name:t.NAME+"_month",valueDelete:false}};if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}s={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(E);e.content.push(s)}if(A===u.QUARTER){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}s={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};if("_quarter"in t.VALUES&&t.VALUES._quarter){t.QUARTER=t.QUARTERS.filter(function(e){return e.VALUE===t.VALUES._quarter});t.QUARTER=t.QUARTER.length?t.QUARTER[0]:null}if(!t.QUARTER){t.QUARTER=t.QUARTERS[0]}o={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.QUARTER,items:t.QUARTERS,name:t.NAME+"_quarter",params:t.PARAMS,valueDelete:false}};e.content.push(o);e.content.push(s)}if(A===u.YEAR){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}s={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(s)}if(A==="CUSTOM_DATE"){var p=t.SUB_TYPES.filter(function(t){return t.VALUE==="CUSTOM_DATE"});if(p[0]){p=BX.clone(p[0].DECL);if(BX.type.isArray(t.VALUES._days)){p.VALUE.days=t.VALUES._days}if(BX.type.isArray(t.VALUES._month)){p.VALUE.months=t.VALUES._month}if(BX.type.isArray(t.VALUES._year)){p.VALUE.years=t.VALUES._year}var L=this.createCustomDate(p);L.classList.remove("main-ui-filter-wield-with-label");var B=L.querySelector(".main-ui-item-icon-container");if(B){BX.remove(B)}var _=L.querySelector(".main-ui-filter-icon-grab");if(_){BX.remove(_)}e.content.push(L);e.mix.push("main-ui-filter-custom-date-group")}}if(A!==u.NONE&&A!==c.CUSTOM_DATE&&t["YEARS_SWITCHER"]){if("_allow_year"in t.VALUES&&t.VALUES._allow_year){var f=t.YEARS_SWITCHER.ITEMS.filter(function(e){return e.VALUE===t.VALUES._allow_year});f=f.length?f[0]:null;if(f){t.YEARS_SWITCHER.VALUE=f}}var h=this.createSelect(t["YEARS_SWITCHER"]);h.classList.add("main-ui-filter-year-switcher");h.classList.add("main-ui-filter-with-padding");h.classList.remove("main-ui-filter-wield-with-label");B=h.querySelector(".main-ui-item-icon-container");if(B){BX.remove(B)}_=h.querySelector(".main-ui-filter-icon-grab");if(_){BX.remove(_)}if(e.content[e.content.length-1]){if(BX.type.isPlainObject(e.content[e.content.length-1])){if(!BX.type.isArray(e.content[e.content.length-1].mix)){e.content[e.content.length-1].mix=[]}e.content[e.content.length-1].mix.push("main-ui-filter-remove-margin-right")}if(BX.type.isDomNode(e.content[e.content.length-1])){e.content[e.content.length-1].classList.add("main-ui-filter-remove-margin-right")}}requestAnimationFrame(function(){h.previousElementSibling.classList.add("main-ui-filter-remove-margin-right")});e.content.push(h);e.mix.push("main-ui-filter-date-with-years-switcher")}return BX.decl(e)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:114:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15441273843115";s:6:"source";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(t){if(!!t&&!BX.hasClass(t,"main-ui-control-entity")){t=BX.Filter.Utils.getByClass(t,"main-ui-control-entity")}return!!t&&JSON.parse(BX.data(t,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function(t){if(this.field!==t){this.field=t;this.reset()}},isMultiple:function(){return BX.Main.ui.CustomEntity.isMultiple(this.getField())},reset:function(){this.labelInput=null;this.hiddenInput=null},getField:function(){return this.field},getId:function(){var t=this.getHiddenNode();var e=null;if(BX.type.isDomNode(t)){e=t.name}return e},getLabelNode:function(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function(t){return BX.Filter.Utils.getBySelector(this.getField(),['[data-item*=":'+BX.util.jsencode(t)+'}"]','[data-item*=":\\"'+BX.util.jsencode(t)+'\\"}"]'].join(", "))},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function(){this.getSquares().forEach(BX.remove)},setSquare:function(t,e){var i=this.getField();var n={block:"main-ui-square",name:t,item:{_label:t,_value:e}};var s=BX.decl(n);var l=this.getSquares();if(!l.length){BX.prepend(s,i)}else{BX.insertAfter(s,l[l.length-1])}},getCurrentValues:function(){var t=this.getSquares();var e,i;if(this.isMultiple()){i=[];for(var n=0,s=t.length;n<s;n++){try{e=JSON.parse(BX.data(t[n],"item"));i.push({label:e._label,value:e._value})}catch(t){}}}else{if(t.length===0){i={label:"",value:""}}else{try{e=JSON.parse(BX.data(t[0],"item"));i={label:e._label,value:e._value}}catch(t){i={label:"",value:""}}}}return i},setData:function(t,e){return this.isMultiple()?this.setMultipleData(t,e):this.setSingleData(t,e)},setSingleData:function(t,e){var i=this.getHiddenNode();this.removeSquares();this.setSquare(t,e);if(BX.type.isDomNode(i)){i.value=e;BX.fireEvent(i,"input")}},setMultipleData:function(t,e){var i=[];var n=this.getHiddenNode();if(BX.type.isArray(t)){this.removeSquares();if(BX.type.isArray(t)){t.forEach(function(t){i.push(t.value);this.setSquare(t.label,t.value)},this);if(BX.type.isDomNode(n)){n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}}if(!BX.type.isArray(t)&&e!==null){if(!this.getSquareByValue(e)){this.setSquare(t,e);this.getSquares().forEach(function(t){var e=JSON.parse(BX.data(t,"item"));if(BX.type.isPlainObject(e)){i.push(e._value)}});n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}},setPopupContainer:function(t){if(BX.type.isDomNode(t)){this.popupContainer=t}},getPopupContainer:function(){return this.popupContainer}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?154412738417210";s:6:"source";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Presets=function(e){this.parent=null;this.presets=null;this.container=null;this.init(e)};BX.Filter.Presets.prototype={init:function(e){this.parent=e},bindOnPresetClick:function(){(this.getPresets()||[]).forEach(function(e){BX.bind(e,"click",BX.delegate(this._onPresetClick,this))},this)},getAddPresetField:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classAddPresetField)},getAddPresetFieldInput:function(){return BX.Filter.Utils.getByClass(this.getAddPresetField(),this.parent.settings.classAddPresetFieldInput)},clearAddPresetFieldInput:function(){var e=this.getAddPresetFieldInput();e&&(e.value="")},normalizePreset:function(e){if(!BX.hasClass(e,this.parent.settings.classPreset)){e=BX.findParent(e,{className:this.parent.settings.classPreset},true,false)}return e},deactivateAllPresets:function(){var e=this.getPresets();var t=this;(e||[]).forEach(function(e){if(BX.hasClass(e,t.parent.settings.classPresetCurrent)){BX.removeClass(e,t.parent.settings.classPresetCurrent)}})},createSidebarItem:function(e,t,s){return BX.decl({block:"sidebar-item",text:BX.util.htmlspecialcharsback(t),id:e,pinned:s,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})},activatePreset:function(e){this.deactivateAllPresets();if(BX.type.isNotEmptyString(e)){e=this.getPresetNodeById(e)}if(e&&!BX.hasClass(e,this.parent.settings.classPresetCurrent)){BX.addClass(e,this.parent.settings.classPresetCurrent)}},getPresetNodeById:function(e){var t=this.getPresets();var s=t.filter(function(t){return BX.data(t,"id")===e},this);return s.length>0?s[0]:null},getPresetId:function(e){return BX.data(e,"id")},updatePresetName:function(e,t){var s;if(BX.type.isDomNode(e)&&BX.type.isNotEmptyString(t)){s=this.getPresetNameNode(e);if(BX.type.isDomNode(s)){BX.html(s,t)}}},removePreset:function(e,t,s){var i=this.getCurrentPresetId();var r=[];var a={preset_id:t,is_default:s};var n={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(a,n);BX.remove(e);if(BX.type.isArray(this.parent.params["PRESETS"])){r=this.parent.params["PRESETS"].filter(function(e){return e.ID!==t},this);this.parent.params["PRESETS"]=r}if(BX.type.isArray(this.parent.editablePresets)){r=this.parent.editablePresets.filter(function(e){return e.ID!==t},this);this.parent.editablePresets=r}if(t===i){this.parent.getSearch().removePreset();this.resetPreset()}},pinPreset:function(e){if(!BX.type.isNotEmptyString(e)){e="default_filter"}var t=this.getPresetNodeById(e);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(e==="default_filter"){return}}var s={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var i={preset_id:e};this.getPresets().forEach(function(e){BX.removeClass(e,this.parent.settings.classPinnedPreset)},this);BX.addClass(t,this.parent.settings.classPinnedPreset);this.parent.saveOptions(i,s)},_onPresetClick:function(e){var t,s,i,r,a,n,l;e.preventDefault();l=this.parent;n=l.settings;a=e.target;t=e.currentTarget;s=this.getPresetId(t);i=this.getPreset(s);if(BX.hasClass(a,n.classPinButton)){if(this.parent.isEditEnabled()){if(BX.hasClass(t,n.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(s)}}}if(BX.hasClass(a,n.classPresetEditButton)){this.enableEditPresetName(t)}if(BX.hasClass(a,n.classPresetDeleteButton)){r="IS_DEFAULT"in i?i.IS_DEFAULT:false;this.removePreset(t,s,r);return false}if(!BX.hasClass(a,n.classPresetDragButton)&&!BX.hasClass(a,n.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}var p=this.getPreset(this.getCurrentPresetId());var h=this.getPreset(s);p.ADDITIONAL=[];h.ADDITIONAL=[];this.activatePreset(t);this.applyPreset(s);if(!this.parent.isEditEnabled()){l.applyFilter(null,true);if(e.isTrusted){l.closePopup()}if(l.isAddPresetEnabled()){l.disableAddPreset()}}}},applyPinnedPreset:function(){var e=this.parent;var t=this.isPinned(this.getCurrentPresetId());var s;if(this.parent.getParam("VALUE_REQUIRED")&&this.getPinnedPresetId()==="default_filter"){this.applyPreset("default_filter");this.deactivateAllPresets();s=this.parent.applyFilter()}else{if(!t){var i=this.getPinnedPresetId();var r=this.getPinnedPresetNode();var a=false;var n=true;this.deactivateAllPresets();this.activatePreset(r);this.applyPreset(i);s=e.applyFilter(a,n);e.closePopup()}else{s=e.resetFilter()}}return s},updateEditablePreset:function(e){var t=this.parent.getFilterFieldsValues();var s=this.getFields().map(function(e){return BX.data(e,"name")});var i=this.parent.preparePresetFields(t,s);var r=this.getPreset(e);r.FIELDS=i;r.TITLE=this.getPresetInput(this.getPresetNodeById(e)).value;r.ROWS=s},getPresetInput:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetEditInput)},enableEditPresetName:function(e){var t=this.getPresetInput(e);BX.addClass(e,this.parent.settings.classPresetNameEdit);t.focus();t.value=BX.util.htmlspecialcharsback(t.value);BX.bind(t,"input",BX.delegate(this._onPresetNameInput,this))},_onPresetNameInput:function(e){var t=this.parent.getSearch();var s=e.currentTarget.value;var i=BX.findParent(e.currentTarget,{className:this.parent.settings.classPreset},true,false);var r=this.getPresetId(i);var a=this.getCurrentPresetId();var n={ID:r,TITLE:s};if(r===a){t.updatePreset(n)}},getPresetNameNode:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetName)},disableEditPresetName:function(e){var t=this.getPresetInput(e);BX.removeClass(e,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(t)){t.blur();BX.unbind(t,"input",BX.delegate(this._onPresetNameInput,this))}},getPreset:function(e,t){var s=this.parent.getParam(t?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!t){s=this.parent.editablePresets}var i=s.filter(function(t){return t.ID===e});if(e==="tmp_filter"&&!i.length){var r=BX.clone(this.getPreset("default_filter"));r.ID="tmp_filter";s.push(r);i.push(r)}return i.length!==0?i[0]:null},getPresetField:function(e,t){var s=this.getPreset(e);var i=null;if(BX.type.isPlainObject(s)&&"FIELDS"in s&&BX.type.isArray(s.FIELDS)){i=s.FIELDS.filter(function(e){return e.NAME===t});i=i.length?i[0]:null}return i},applyPreset:function(e,t){e=t?"default_filter":e||"default_filter";var s=this.getPreset(e);if(e!=="default_preset"){s=this.extendPreset(s)}this.parent.getSearch().updatePreset(s);this.updatePresetFields(s,t)},extendPreset:function(e){var t=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(e)){e=BX.clone(e);e.FIELDS.forEach(function(e){var s;var i=t.FIELDS.some(function(t,i){var r=false;if(t.NAME===e.NAME){s=i;r=true}return r},this);if(i&&s||i&&s===0){t.FIELDS[s]=e}else{if(!this.isEmptyField(e)){t.FIELDS.push(e)}}},this);e.FIELDS=t.FIELDS}return e},isEmptyField:function(e){var t=true;if(e.TYPE===this.parent.types.STRING){if(e.VALUE&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(e.VALUE)&&"VALUE"in e.VALUE&&e.VALUE.VALUE){t=false}}if(e.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(e.VALUE)&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.CUSTOM_DATE){if(BX.type.isArray(e.VALUE.days)&&e.VALUE.days.length||BX.type.isArray(e.VALUE.months)&&e.VALUE.months.length||BX.type.isArray(e.VALUE.years)&&e.VALUE.years.length){t=false}}if(e.TYPE===this.parent.types.CUSTOM_ENTITY||e.TYPE===this.parent.types.DEST_SELECTOR){if(BX.type.isPlainObject(e.VALUES)){if(BX.type.isNotEmptyString(e.VALUES._label)&&BX.type.isNotEmptyString(e.VALUES._value)){t=false}if(BX.type.isPlainObject(e.VALUES._label)&&BX.type.isPlainObject(e.VALUES._value)&&Object.keys(e.VALUES._label).length&&Object.keys(e.VALUES._value).length){t=false}if(BX.type.isArray(e.VALUES._label)&&BX.type.isArray(e.VALUES._value)&&e.VALUES._label.length&&e.VALUES._value.length){t=false}if((BX.type.isArray(e.VALUES._label)&&e.VALUES._label.length||BX.type.isPlainObject(e.VALUES._label)&&Object.keys(e.VALUES._label).length)&&(BX.type.isArray(e.VALUES._value)&&e.VALUES._value.length||BX.type.isPlainObject(e.VALUES._value)&&Object.keys(e.VALUES._value).length)){t=false}}}if(e.TYPE===this.parent.types.DATE){var s="_datesel"in e.VALUES?e.VALUES._datesel:e.SUB_TYPE.VALUE;if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to||e.VALUES._quarter||e.VALUES._month&&!BX.type.isArray(e.VALUES._month)||e.VALUES._year&&!BX.type.isArray(e.VALUES._year)||e.VALUES._days&&!BX.type.isArray(e.VALUES._days))||BX.type.isArray(e.VALUES._days)&&e.VALUES._days.length||BX.type.isArray(e.VALUES._month)&&e.VALUES._month.length||BX.type.isArray(e.VALUES._year)&&e.VALUES._year.length||(s===this.parent.dateTypes.CURRENT_DAY||s===this.parent.dateTypes.CURRENT_WEEK||s===this.parent.dateTypes.CURRENT_MONTH||s===this.parent.dateTypes.CURRENT_QUARTER||s===this.parent.dateTypes.LAST_7_DAYS||s===this.parent.dateTypes.LAST_30_DAYS||s===this.parent.dateTypes.LAST_60_DAYS||s===this.parent.dateTypes.LAST_90_DAYS||s===this.parent.dateTypes.LAST_WEEK||s===this.parent.dateTypes.LAST_MONTH||s===this.parent.dateTypes.TOMORROW||s===this.parent.dateTypes.YESTERDAY||s===this.parent.dateTypes.NEXT_WEEK||s===this.parent.dateTypes.NEXT_MONTH)){t=false}}if(e.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to)){t=false}}if(e.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE){t=false}}return t},resetPreset:function(e){this.applyPreset("",e)},getFields:function(){var e=this.parent.getFieldListContainer();var t=null;if(BX.type.isDomNode(e)){t=BX.Filter.Utils.getBySelector(e.parentNode,"."+this.parent.settings.classFileldControlList+" > div",true)}return t},getField:function(e){var t=this.getFields();var s=null;var i,r;if(BX.type.isArray(t)&&t.length){r=t.filter(function(t){if(BX.type.isDomNode(t)){i=BX.data(t,"name")}return i===e.NAME},this);s=r.length>0?r[0]:null}return s},removeField:function(e,t){var s,i;t=t||false;if(BX.type.isPlainObject(e)){i=e.NAME;e=this.getField(e);if(BX.type.isArray(this.parent.fieldsList)){s=this.parent.fieldsList.indexOf(e);if(s!==-1){delete this.parent.fieldsList[s]}}this.parent.unregisterDragItem(e)}if(BX.type.isDomNode(e)){i=BX.data(e,"name");this.parent.getFields().deleteField(e)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var r=this.getCurrentPresetId();var a=this.getPresetField(r,i);if(a&&!this.isEmptyField(a)){this.deactivateAllPresets();this.parent.applyFilter()}}if(!t){this.parent.saveFieldsSort()}},removeFields:function(e){e.forEach(function(e){this.removeField(e,true)},this);this.parent.saveFieldsSort()},addField:function(e){var t,s,i;if(BX.type.isPlainObject(e)){t=this.parent.getFieldListContainer();i=this.parent.getControls();s=BX.type.isArray(i)?i[i.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){e.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{e.TABINDEX=2}if(BX.type.isDomNode(t)){s=this.createControl(e);if(BX.type.isDomNode(s)){BX.append(s,t);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var r=this.getCurrentPresetId();var a=this.getPresetField(r,e.NAME);if(a&&!this.isEmptyField(a)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}this.parent.saveFieldsSort()},createControl:function(e){var t;switch(e.TYPE){case this.parent.types.STRING:{t=this.parent.getFields().createInputText(e);break}case this.parent.types.SELECT:{t=this.parent.getFields().createSelect(e);break}case this.parent.types.MULTI_SELECT:{t=this.parent.getFields().createMultiSelect(e);break}case this.parent.types.NUMBER:{t=this.parent.getFields().createNumber(e);break}case this.parent.types.DATE:{t=this.parent.getFields().createDate(e);break}case this.parent.types.CUSTOM_DATE:{t=this.parent.getFields().createCustomDate(e);break}case this.parent.types.DEST_SELECTOR:{t=this.parent.getFields().createDestSelector(e);break}case this.parent.types.CUSTOM:{t=this.parent.getFields().createCustom(e);break}case this.parent.types.CUSTOM_ENTITY:{t=this.parent.getFields().createCustomEntity(e);break}default:{break}}if(BX.type.isDomNode(t)){t.dataset.name=e.NAME;t.FieldController=new BX.Filter.FieldController(t,this.parent)}return t},removeNotCompareVariables:function(e,t){if(BX.type.isPlainObject(e)){var s=this.parent.dateTypes;var i=this.parent.additionalDateTypes;if("FIND"in e){delete e.FIND}if(!t){Object.keys(e).forEach(function(t){if(t.indexOf("_numsel")!==-1){delete e[t]}if(t.indexOf("_datesel")!==-1){var r=e[t];if(r===s.EXACT||r===s.RANGE||r===i.PREV_DAY||r===i.NEXT_DAY||r===i.MORE_THAN_DAYS_AGO||r===i.AFTER_DAYS||r===s.PREV_DAYS||r===s.NEXT_DAYS||r===s.YEAR||r===s.MONTH||r===s.QUARTER||r===s.NONE||r===s.CUSTOM_DATE){delete e[t]}}var a=this.parent.getFieldByName(t);if(e[t]===""&&(!a||!a["STRICT"])){delete e[t]}},this)}}},isPresetValuesModified:function(e){var t=this.getPreset(e);var s=this.parent.preparePresetSettingsFields(t.FIELDS);var i=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(i);var r=BX.Filter.Utils.sortObject(s);var a=BX.Filter.Utils.sortObject(i);return!Object.keys(r).every(function(e){return r[e]===a[e]||(BX.type.isPlainObject(r[e])||BX.type.isArray(r[e]))&&BX.Filter.Utils.objectsIsEquals(r[e],a[e])})},getAdditionalValues:function(e){var t=this.getPreset(e);var s=t.FIELDS.filter(function(e){return!this.isEmptyField(e)},this);var i=this.parent.preparePresetSettingsFields(s);var r=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(i,true);this.removeNotCompareVariables(r,true);this.removeSameProperties(r,i);return r},removeSameProperties:function(e,t){if(BX.type.isPlainObject(e)&&BX.type.isPlainObject(t)){Object.keys(t).forEach(function(t){if(t in e){delete e[t]}})}},removeAdditionalField:function(e){var t=this.getPreset(this.getCurrentPresetId());if(BX.type.isArray(t.ADDITIONAL)){t.ADDITIONAL=t.ADDITIONAL.filter(function(t){return t.NAME!==e})}},updatePresetFields:function(e,t){var s,i;var r=[];if(BX.type.isPlainObject(e)&&"FIELDS"in e){s=e.FIELDS;if(BX.type.isArray(e.ADDITIONAL)){e.ADDITIONAL.forEach(function(e){var t=false;e.IS_PRESET_FIELD=true;s.forEach(function(i,r){if(e.NAME===i.NAME){s[r]=e;t=true}});if(!t){s.push(e)}})}(s||[]).forEach(function(e,s){e.TABINDEX=s+1;if(t){switch(e.TYPE){case this.parent.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{e.VALUE=[];break}case this.parent.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.CUSTOM_DATE:{e.VALUE={days:[],months:[],years:[]};break}case this.parent.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{e._VALUE="";break}default:{if("VALUE"in e){if(BX.type.isArray(e.VALUE)){e.VALUE=[]}else{e.VALUE=""}}break}}}r.push(this.createControl(e))},this);this.parent.disableFieldsDragAndDrop();i=this.parent.getFieldListContainer();BX.cleanNode(i);if(r.length){r.forEach(function(t,r){if(BX.type.isDomNode(t)){if(e.ID!=="tmp_filter"&&e.ID!=="default_filter"&&!("IS_PRESET_FIELD"in s[r])&&!this.isEmptyField(s[r])){BX.addClass(t,this.parent.settings.classPresetField)}BX.append(t,i);if(BX.type.isString(s[r].HTML)){var a=BX.create("div");this.parent.getHiddenElement().appendChild(a);BX.html(a,s[r].HTML)}}},this);this.parent.enableFieldsDragAndDrop()}}},showCurrentPresetFields:function(){var e=this.getCurrentPresetData();this.updatePresetFields(e)},getCurrentPreset:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)},getCurrentPresetId:function(){var e=this.getCurrentPreset();var t=null;if(BX.type.isDomNode(e)){t=this.getPresetId(e)}else{t="tmp_filter"}return t},getCurrentPresetData:function(){var e=this.getCurrentPresetId();var t=null;if(BX.type.isNotEmptyString(e)){t=this.getPreset(e);t=this.extendPreset(t)}return t},getContainer:function(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)},getPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)},getDefaultPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)},getPinnedPresetNode:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)},isPinned:function(e){return this.getPinnedPresetId()===e},getPinnedPresetId:function(){var e=this.getPinnedPresetNode();var t="default_filter";if(!!e){var s=BX.data(e,"id");t=!!s?s:t}return t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?154412738418784";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Search=function(t){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(t)};BX.Filter.Search.prototype={init:function(t){this.parent=t;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.removeAutofocus();this.firstInit=true},removeAutofocus:function(){var t=this.getInput();if(!!t){t.blur();t.autofocus=null}},getFindButton:function(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function(){this.apply()},selectSquare:function(t){!!t&&BX.addClass(t,this.parent.settings.classSquareSelected)},selectSquares:function(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function(t){!!t&&BX.removeClass(t,this.parent.settings.classSquareSelected)},unselectSquares:function(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function(){var t=this.getSquares();return t.length&&t.every(this.isSquareSelected,this)},isSquareSelected:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareSelected)},getLastSquare:function(){var t=this.getSquares();return!!t?t[t.length-1]:null},isTextSelected:function(){var t=this.getSearchString().length;var e=this.getInput();var s=e.selectionStart;var i=e.selectionEnd;return s===0&&i!==0&&i===t},isSelectionStart:function(){var t=this.getInput();var e=t.selectionStart;var s=t.selectionEnd;return e===0&&s===0},isSquareRemoveButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareDelete)},isClearButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classClearSearchValueButton)},getClearButton:function(){return this.getContainer().querySelector("."+this.parent.settings.classClearSearchValueButton)},isSearchButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSearchButton)},adjustFocus:function(){if(!BX.browser.IsMobile()){var t=this.getInput();if(document.activeElement!==t&&window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}}},findSquareByChild:function(t){return BX.findParent(t,{className:this.parent.settings.classSquare},true,false)},getSquareData:function(t){var e=BX.data(t,"item");return!!t&&!!e?JSON.parse(e):null},isSquareControl:function(t){var e=this.getSquareData(t);return!!e&&(e.type==="control"||BX.type.isArray(e))},onPresetSquareRemove:function(){var t=this.parent;var e=t.getPreset();var s=e.getCurrentPresetId();var i=t.getParam("RESET_TO_DEFAULT_MODE");var r=t.getParam("VALUE_REQUIRED");var a=e.isPinned(s);var n=this.getSquares();if(n.length===1){if(r&&a){this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{if(i&&a||!i){var o=true;this.lastPromise=t.resetFilter(o);t.closePopup()}}if(i&&!a){this.lastPromise=t.getPreset().applyPinnedPreset()}}if(n.length>1){var h=e.getPreset(e.getCurrentPresetId());var l=e.getPreset("tmp_filter");l.FIELDS=BX.clone(h.ADDITIONAL);h.ADDITIONAL=[];e.deactivateAllPresets();e.applyPreset("tmp_filter");t.applyFilter()}},onControlSquareRemove:function(t){var e=this.parent;var s=e.getPreset();var i=e.getParam("RESET_TO_DEFAULT_MODE");var r=e.getParam("VALUE_REQUIRED");var a;if(i&&this.getSquares().length===1){if(r){a=this.getSquareData(t);e.clearControls(a);this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{this.lastPromise=e.getPreset().applyPinnedPreset()}}else{a=this.getSquareData(t);e.clearControls(a);e.closePopup();if(BX.type.isArray(a)){a.forEach(function(t){s.removeAdditionalField(t.name)})}if(BX.type.isPlainObject(a)){s.removeAdditionalField(a.name)}this.apply()}},onValueRequiredSquareRemove:function(){var t=this.parent;t.getPreset().deactivateAllPresets();t.showPopup();this.adjustPlaceholder()},complexSquareRemove:function(t){var e=this.parent.getParam("VALUE_REQUIRED_MODE");var s=!this.isSquareControl(t);if(e){this.onValueRequiredSquareRemove()}else{if(s){this.onPresetSquareRemove()}else{this.onControlSquareRemove(t)}}this.removeSquare(t);this.adjustClearButton()},adjustClearButton:function(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function(t){!!t&&BX.remove(t)},_onSearchContainerClick:function(t){var e=this.parent;if(this.isClearButton(t.target)){if(!e.getParam("VALUE_REQUIRED")){if(!e.getParam("VALUE_REQUIRED_MODE")){if(e.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.resetFilter()}e.closePopup();this.adjustFocus()}else{this.removeSquares();e.showPopup();this.adjustPlaceholder();this.hideClearButton();e.getPreset().deactivateAllPresets()}}else{var s=e.getPreset().isPinned(e.getPreset().getCurrentPresetId());if(s||e.getPreset().getCurrentPresetId()==="tmp_filter"){var i=e.getPreset().getPreset(e.getPreset().getCurrentPresetId());if(i.ADDITIONAL.length){i.ADDITIONAL=[];this.lastPromise=e.getPreset().applyPreset(e.getPreset().getCurrentPresetId());this.apply()}else{this.removeSquares();e.showPopup();this.adjustPlaceholder();this.hideClearButton();e.getPreset().deactivateAllPresets()}}else{if(e.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.resetFilter()}e.closePopup();this.adjustFocus()}this.clearInput()}}else if(this.isSearchButton(t.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(t.target)){var r=this.findSquareByChild(t.target);this.complexSquareRemove(r);this.adjustFocus()}else{if(!e.getPopup().isShown()){e.showPopup()}else{var a=this.getInput();var n=a.selectionStart;var o=a.selectionEnd;var h=this.getSearchString().length;if(!(h&&n===0&&o===h)){if(e.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.closePopup()}}else{e.closePopup();if(e.getParam("VALUE_REQUIRED_MODE")){e.restoreRemovedPreset()}}}}}},_onKeyDown:function(t){var e=BX.Filter.Utils;var s=this.parent;if(e.isKey(t,"enter")){if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}s.closePopup()}if(e.isKey(t,"tab")||e.isKey(t,"downArrow")){s.showPopup();s.adjustFocus();this.unselectSquares()}if(e.isKey(t,"upArrow")){s.closePopup();if(s.getParam("VALUE_REQUIRED_MODE")){this.parent.restoreRemovedPreset()}if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}}}if(e.isKey(t,"a")&&t.metaKey||e.isKey(t,"a")&&t.ctrlKey){this.selectSquares()}if(e.isKey(t,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("VALUE_REQUIRED")){var i=this.parent.getPreset().isPinned(this.parent.getPreset().getCurrentPresetId());if(i){this.removeSquares();this.parent.showPopup();this.adjustPlaceholder();this.hideClearButton();this.parent.getPreset().deactivateAllPresets()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.parent.resetFilter()}this.parent.closePopup();this.adjustFocus()}this.clearInput()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}}if(e.isKey(t,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var r=this.getLastSquare();this.isSquareSelected(r)?this.complexSquareRemove(r):this.selectSquare(r)}if(!e.isKey(t,"backspace")&&!t.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function(){var t=this.getInput();return!!t?t.value:""},getSquares:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function(){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"+(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")?"":"_DEFAULT")))},isResolvedRequest:function(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function(){if(this.isResolvedRequest()){this.lastPromise=this.parent._onFindButtonClick()}return this.lastPromise},reset:function(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate(function(){this.lastPromise=this.parent.resetFilter()},this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function(){clearTimeout(this.timeout);var t=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:t;if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,t])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(t){this.showClearButton()}else{if(!this.getSquares().length&&this.lastSearchString!==t){this.hideClearButton();this.adjustPlaceholder()}}},_onInput:function(){var t=this.getSearchString();if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=t},getButtonsContainer:function(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},setInputPlaceholder:function(t){var e=this.getInput();e.placeholder=t},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function(){this.clearInput();this.removePreset()},makeSquares:function(t,e,s){var i;var r=null;var a=this.getContainer();var n={squares:[],moreSquares:[]};t.forEach(function(t,o){if(o<e){i=BX.decl(t);r=r||i;if(!s){if(o===0){BX.prepend(i,a)}else{BX.insertAfter(i,r)}}else{var h=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(h){BX.insertAfter(i,h)}else{BX.prepend(i,a)}}r=i;n.squares.push(i)}else{n.moreSquares.push({type:"control",name:t.value,title:t.title})}},this);return n},squares:function(t,e,s){var i,r,a,n,o;var h=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(s){h.forEach(function(t){var e=BX.data(t,"item");if(e){BX.remove(t)}})}else{h.forEach(BX.remove)}i=this.prepareSquaresData(t);r=this.makeSquares(i,e,s);n=0;o={squaresData:i,width:0};if(r.moreSquares.length){a={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+r.moreSquares.length,item:r.moreSquares,title:r.moreSquares.map(function(t){return t.title}).join(", \n")};a=BX.decl(a);r.squares.push(a);BX.insertAfter(a,r.squares[r.squares.length-2]);n=r.squares.reduce(function(t,e){return t+BX.width(e)+(parseFloat(BX.style(e,"margin-right"))||0)},0)}o.width=n;return o},setPreset:function(t){var e=this.getContainer();var s,i;var r;if(BX.type.isPlainObject(t)){i=BX.Filter.Utils.getByClass(e,this.parent.settings.classSquare,true);i.forEach(BX.remove);t=BX.clone(t);t.ADDITIONAL=t.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[t,this]);if(t.ID!=="default_filter"&&t.ID!=="tmp_filter"){s=BX.decl({block:"main-ui-search-square",name:t.TITLE,value:t.ID,isPreset:true});BX.prepend(s,e);if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){r=this.squares(t.ADDITIONAL,1,true);if(BX.width(e)-r.width<100){r=this.squares(t.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){t.ADDITIONAL.forEach(function(e,s){if(!("ID"in e)){e.ID="ADDITIONAL_ID_"+s}if(!("NAME"in e)){e.NAME="ADDITIONAL_NAME_"+s}if(!("TYPE"in e)){e.TYPE="STRING"}if("LABEL"in e&&"LABEL"in e){t.FIELDS.push(e)}})}if(BX.type.isArray(t.FIELDS)&&t.FIELDS.length){r=this.squares(t.FIELDS,2);if(BX.width(e)-r.width<100){r=this.squares(t.FIELDS,1)}}}if(r&&BX.type.isArray(r.squaresData)&&r.squaresData.length||t.ID!=="default_filter"&&t.ID!=="tmp_filter"){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"));this.showClearButton()}else{if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function(t){var e,s,i,r;var a=[];t.map(function(t){e=null;switch(t.TYPE){case this.parent.types.DATE:{e=t.LABEL+": "+t.SUB_TYPE.NAME;if(t.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(t.VALUES._quarter)){var r=t.QUARTERS.filter(function(e){return e.VALUE==t.VALUES._quarter}).map(function(t){return t.NAME});r=r.length?r.join(""):"";e=t.LABEL+": "+r+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(t.VALUES._year)){e=t.LABEL+": "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(t.VALUES._month)){var n=t.MONTHS.filter(function(e){return e.VALUE==t.VALUES._month}).map(function(t){return t.NAME});n=n.length?n.join(""):"";e=t.LABEL+": "+n+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+t.VALUES._from}}if((t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(t.VALUES._days))){e=null}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){e=null}break}case this.parent.types.CUSTOM_DATE:{if(BX.type.isArray(t.VALUE.days)&&t.VALUE.days.length||BX.type.isArray(t.VALUE.months)&&t.VALUE.months.length||BX.type.isArray(t.VALUE.years)&&t.VALUE.years.length){e=t.LABEL}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE||t.STRICT){e=t.LABEL+": "+t.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){s=[];e=t.LABEL+": ";t.VALUE.forEach(function(t,e){if(e<2){s.push(t.NAME)}});e+=s.join(", ");if(t.VALUE.length>2){i=[];t.VALUE.forEach(function(t){i.push(t.NAME)});e=i.join(", ")}}break}case this.parent.types.NUMBER:{if(t.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": > ";e+=t.VALUES._from}}if(t.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": < ";e+=t.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:case this.parent.types.DEST_SELECTOR:{if(t.MULTIPLE){var o=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(o)){o=Object.keys(o).map(function(t){return o[t]})}if(!BX.type.isArray(o)){o=[o]}if(o.length>0){e=t.LABEL+": ";e+=o.join(", ")}}else{if(BX.type.isNotEmptyString(t.VALUES._value)&&BX.type.isNotEmptyString(t.VALUES._label)){e=t.LABEL+": ";e+=t.VALUES._label}}break}case this.parent.types.CUSTOM:{e="_VALUE"in t&&BX.type.isNotEmptyString(t._VALUE)?t.LABEL:null;break}default:{if(BX.type.isNotEmptyString(t.VALUE)){e=t.LABEL+": "+t.VALUE}break}}if(e!==null){a.push({block:"main-ui-search-square",name:e,value:t.NAME,item:{type:"control",name:t.NAME},title:e})}},this);return a},getPreset:function(){var t=this.getContainer();var e=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(t)){s=BX.Filter.Utils.getByClass(t,e)}return s},removePreset:function(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}this.hideClearButton()},updatePreset:function(t){this.removePreset();this.setPreset(t)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15441273844327";s:6:"source";s:74:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Settings=function(i,t){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="ui-btn-clock";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.classPresetField="main-ui-filter-preset-field";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.init(i,t)};BX.Filter.Settings.prototype={init:function(i,t){this.generalTemplateId=t.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(i)},get:function(i,t){return i&&i in this&&!BX.type.isFunction(this[i])?this[i]:t},mergeSettings:function(i){if(BX.type.isPlainObject(i)){Object.keys(i).forEach(function(t){if(!BX.type.isFunction(this[t])){this[t]=i[t]}},this)}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15441273842208";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function(e,t){var n;t=BX.type.isPlainObject(t)?t:null;n=Object.keys(t);[].forEach.call(e||[],function(e){n.forEach(function(n){BX.style(e,n,t[n])})})},closestParent:function(e,t){if(e){if(!t){return e.parentNode||null}else{return BX.findParent(e,{className:t})}}},closestChilds:function(e){return!!e?e.children:null},getNext:function(e){return!!e?e.nextElementSibling:null},getPrev:function(e){return!!e?e.previousElementSibling:null},collectionSort:function(e,t){var n,i,r,o,l;if(e&&t&&e!==t&&e.parentNode===t.parentNode){n=this.closestParent(t);i=this.closestChilds(n);r=i.length;o=this.getIndex(i,e);l=this.getIndex(i,t);if(r===l){n.appendChild(t)}if(o>l){n.insertBefore(e,t)}if(o<l&&r!==l){n.insertBefore(e,this.getNext(t))}}},getIndex:function(e,t){return[].indexOf.call(e||[],t)},getByClass:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByClassName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getByTag:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByTagName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getBySelector:function(e,t,n){var i=[];if(t){if(!n){i=(e||document.body).querySelector(t)}else{i=(e||document.body).querySelectorAll(t);i=[].slice.call(i)}}return i},requestAnimationFrame:function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};e.apply(window,arguments)},sortObject:function(e){var t={};Object.keys(e).sort().forEach(function(n){t[n]=e[n]});return t},objectsIsEquals:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},isKey:function(e,t){var n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var i=!!e?"keyCode"in e?e.keyCode:"which"in e?e.which:0:0;return i in n&&n[i]===t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15441273841411";s:6:"source";s:80:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(t){var e,n,i,a,l;e={block:"main-ui-control-field-group",name:"name"?t.name+"_datesel":"",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:"","data-time":t.enableTime},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){a={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(a)}n={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_datesel":"",params:"params"in t?t.params:"",valueDelete:false}};e.content.push(n);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){e.content.push(t.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(i);if(!("dragButton"in t)||t.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(l)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:116:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15441273841102";s:6:"source";s:97:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(t){var e,n,i,a;e={block:"main-ui-control-field-group",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){i={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(i)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("deleteButton"in t&&t.deleteButton===true){n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(n)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15441273841258";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(t){var e,n,i,l,a;e={block:"main-ui-control-field",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){l={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(l)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("valueDelete"in t&&t.valueDelete===true){i={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};e.content.push(i)}if("deleteButton"in t&&t.deleteButton===true){n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(n)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1544127384422";s:6:"source";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.js";s:3:"min";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js";s:3:"map";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(n){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in n?n.type:"text",name:"name"in n?n.name:"",placeholder:"placeholder"in n?n.placeholder:"",tabindex:"tabindex"in n?n.tabindex:"",value:"value"in n?n.value:""}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:118:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1544127384490";s:6:"source";s:100:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.js";s:3:"min";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js";s:3:"map";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(i){var e={block:"main-ui-select-inner-label",content:"label"in i?i.label:""};var n={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":i.id,"data-name":i.name,"data-item":"item"in i?JSON.stringify(i.item):{}},events:{click:"onClick"in i?i.onClick:""},content:e};return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:107:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1544127384250";s:6:"source";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.js";s:3:"min";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js";s:3:"map";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(t){return{block:"main-ui-filter-info",tag:"span",content:t.content,attrs:{title:t.title}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1544127384754";s:6:"source";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.js";s:3:"min";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(e){var n,i,t;n={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in e&&BX.type.isArray(e.mix)){e.mix.forEach(function(e){n.mix.push(e)})}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in e?e.name:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",placeholder:"placeholder"in e?e.placeholder:"",autocomplete:"off"}};n.content.push(i);if("valueDelete"in e&&e.valueDelete===true){t={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};n.content.push(t)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:109:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1544127384513";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(i){var e=["main-ui-filter-search-square"];if("isPreset"in i&&i.isPreset){e.push("main-ui-filter-search-square-preset")}return{block:"main-ui-square",mix:e,attrs:{"data-item":"item"in i?JSON.stringify(i.item):"",title:"title"in i?i.title:""},content:[{block:"main-ui-square-item",content:"name"in i?BX.util.htmlspecialcharsback(i.name):""},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15441273841390";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(t){var n,e,i,a,l;n={block:"main-ui-control-field-group",name:"name"in t?t.name+"_numsel":"",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){a={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};n.content.push(a)}e={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_numsel":"",params:"params"in t?t.params:"",valueDelete:false}};n.content.push(e);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){n.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){n.content.push(t.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};n.content.push(i);if(!("dragButton"in t)||t.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};n.content.push(l)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15441273841364";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(i){return{block:"main-ui-filter-sidebar-item"+("pinned"in i&&i.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in i?i.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in i&&i.dragTitle?i.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in i?i.placeholder:"",value:"text"in i?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(i.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in i?i.text:""},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in i&&i.noEditPinTitle?i.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in i&&i.editNameTitle?i.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in i&&i.removeTitle?i.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in i&&i.editPinTitle?i.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?154412738410379";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.selectorManager={getById:function(t){if(typeof this.controls[t]!="undefined"){return this.controls[t]}return null},controls:{}};BX.Main.Selector=function(){this.initialized=false;this.blockInit=false;this.id="";this.inputId=null;this.input=null;this.tagId=null;this.tag=null;this.options=null;this.callback=null;this.items=null;this.entities=null;this.mainPopupWindow=null;this.entitiesSet=["users","emails","crmemails","groups","sonetgroups","department","departmentRelation","contacts","companies","leads","deals"];this.auxObject=null};BX.Main.Selector.controls={};BX.Main.Selector.create=function(t){if(typeof t.id=="undefined"||!t.id){t.id=BX.util.hashCode(Math.random().toString())}else if(typeof BX.Main.selectorManager.controls[t.id]!="undefined"){return BX.Main.selectorManager.controls[t.id]}var e=new BX.Main.Selector;e.init(t);BX.Main.selectorManager.controls[e.getId()]=e;return e};BX.Main.Selector.proxyCallback=function(t,e){t(e)};BX.Main.Selector.prototype={init:function(t){try{if(!("SocNetLogDestination"in BX)){throw new ReferenceError("No BX.SocNetLogDestination detected. Forgot to include socialnetwork module and/or its assets?")}}catch(t){throw t}this.id=t.id;this.inputId=t.inputId?t.inputId:null;this.input=t.inputId&&BX(t.inputId)?BX(t.inputId):null;this.containerNode=t.containerId&&BX(t.containerId)?BX(t.containerId):null;this.bindNode=t.bindId&&BX(t.bindId)?BX(t.bindId):this.containerNode;this.tagId=t.tagId?t.tagId:null;this.tag=t.tagId&&BX(t.tagId)?BX(t.tagId):null;this.openDialogWhenInit=typeof t.openDialogWhenInit=="undefined"||!!t.openDialogWhenInit;this.options=t.options||{};this.callback=t.callback||null;this.items=t.items||null;this.entities=t.entities||null;var e={name:this.id,pathToAjax:t.pathToAjax?t.pathToAjax:null,searchInput:this.input||null,bindMainPopup:{node:this.bindNode,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:this.bindNode,offsetTop:"5px",offsetLeft:"15px"},userSearchArea:this.getOption("userSearchArea"),lazyLoad:this.getOption("lazyLoad")=="Y",useClientDatabase:this.getOption("useClientDatabase")=="Y",sendAjaxSearch:this.getOption("sendAjaxSearch")!="N",showSearchInput:this.getOption("useSearch")=="Y",allowAddUser:this.getOption("allowAddUser")=="Y",allowAddCrmContact:this.getOption("allowAddCrmContact")=="Y",allowAddSocNetGroup:this.getOption("allowAddSocNetGroup")=="Y",allowSearchEmailUsers:this.getOption("allowSearchEmailUsers")=="Y",allowSearchCrmEmailUsers:this.getOption("allowSearchCrmEmailUsers")=="Y",allowSearchNetworkUsers:this.getOption("allowSearchNetworkUsers")=="Y",enableDepartments:this.getOption("enableDepartments")=="Y",departmentSelectDisable:this.getOption("departmentSelectDisable")=="Y",enableSonetgroups:this.getOption("enableSonetgroups")=="Y",enableProjects:this.getOption("enableProjects")=="Y",isCrmFeed:this.getOption("isCrmFeed")=="Y",callback:{select:this.callback.select!=null?BX.delegate(function(t,e,i,n,o,a){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.select,{name:o,item:t,type:e,search:i,bUndeleted:n,state:a}):this.callback.select(t,e,i,n,o,a)},this):null,unSelect:this.callback.unSelect!=null?BX.delegate(function(t,e,i,n){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.unSelect,{name:n,item:t,type:e,search:i}):this.callback.unSelect(t,e,i,n)},this):null,openDialog:this.callback.openDialog!=null?BX.delegate(function(t){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.openDialog,{name:t}):this.callback.openDialog(t)},this):null,closeDialog:this.callback.closeDialog!=null?BX.delegate(function(t){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.closeDialog,{name:t}):this.callback.closeDialog(t)},this):null,openSearch:this.callback.openSearch!=null?BX.delegate(function(t){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.openSearch,{name:t}):this.callback.openSearch(t)},this):null,closeSearch:this.callback.closeSearch!=null?BX.delegate(function(t){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.closeSearch,{name:t}):this.callback.closeSearch(t)},this):null,openEmailAdd:this.callback.openEmailAdd!=null?BX.delegate(function(t){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.openEmailAdd,{name:t}):this.callback.openEmailAdd(t)},this):null,closeEmailAdd:this.callback.closeEmailAdd!=null?BX.delegate(function(t){this.getOption("useNewCallback")=="Y"?BX.Main.Selector.proxyCallback(this.callback.closeEmailAdd,{name:t}):this.callback.closeEmailAdd(t)},this):null},allowSonetGroupsAjaxSearchFeatures:this.getOption("allowSonetGroupsAjaxSearchFeatures")};var i=null;e.items={};for(var n=0;n<this.entitiesSet.length;n++){i=this.entitiesSet[n];e.items[i]=this.entities[i]||{}}e.itemsLast={};e.itemsSelected=this.items.selected||{};BX.SocNetLogDestination.init(e);if(this.input){if(!this.options.lazyLoad){this.initDialog()}if(this.tag){BX.bind(this.tag,"focus",BX.delegate(function(t){this.initDialog({realParams:true,bByFocusEvent:true});return BX.PreventDefault(t)},this));BX.SocNetLogDestination.BXfpSetLinkName({formName:this.id,tagInputName:t.tagId,tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")})}BX.bind(this.input,"keydown",BX.proxy(BX.SocNetLogDestination.BXfpSearchBefore,{formName:this.id,inputName:t.inputId}));this.auxObject={formName:this.id,inputNode:BX(t.inputId),tagInputName:t.tagId};BX.bind(this.input,"bxchange",BX.proxy(BX.SocNetLogDestination.BXfpSearch,this.auxObject));this.input.setAttribute("data-bxchangehandler","Y")}else if(e.showSearchInput){if(!this.options.lazyLoad){this.initDialog()}}if(this.items.hidden){for(var o in this.items.hidden){if(this.items.hidden.hasOwnProperty(o)){this.callback.select.apply({id:(typeof this.items.hidden[o]["PREFIX"]!="undefined"?this.items.hidden[o]["PREFIX"]:"SG")+this.items.hidden[o]["ID"],name:this.items.hidden[o]["NAME"]},typeof this.items.hidden[o]["TYPE"]!="undefined"?this.items.hidden[o]["TYPE"]:"sonetgroups","",true,"","init")}}}},show:function(){this.initDialog()},initDialog:function(t){if(typeof t=="undefined"||typeof t.realParams=="undefined"){t=null}if(this.blockInit){return}var e={id:this.id};if(!this.initialized){BX.onCustomEvent(window,"BX.Main.Selector:beforeInitDialog",[e])}setTimeout(BX.delegate(function(){if(typeof e.blockInit=="undefined"||e.blockInit!==true){if(this.initialized){if(!this.mainPopupWindow||!this.mainPopupWindow.isShown()){this.openDialog(t)}}else{this.getData(BX.delegate(function(e){if(!!this.openDialogWhenInit){this.openDialog(t)}BX.onCustomEvent(window,"BX.Main.Selector:afterInitDialog",[{id:this.id}]);if(typeof this.options.eventOpen!="undefined"){BX.addCustomEvent(window,this.options.eventOpen,BX.delegate(function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}if(t.bindNode){var e=BX.findChild(t.bindNode,{tagName:"input",attr:{type:"text"}},true);if(e){BX.bind(e,"keydown",BX.proxy(BX.SocNetLogDestination.BXfpSearchBefore,{formName:this.id,inputName:null,inputNode:e}));this.auxObject={formName:this.id,inputNode:e,tagInputName:t.tagId};BX.SocNetLogDestination.obElementBindMainPopup[this.id].node=e;BX.SocNetLogDestination.obElementBindSearchPopup[this.id].node=e;if(e.getAttribute("data-bxchangehandler")!=="Y"){BX.bind(e,"bxchange",BX.proxy(BX.SocNetLogDestination.BXfpSearch,this.auxObject));BX.SocNetLogDestination.obItemsSelected[this.id]={};e.setAttribute("data-bxchangehandler","Y")}if(typeof t.value!="undefined"){BX.SocNetLogDestination.obItemsSelected[this.id]=t.value}}this.openDialog({bindNode:t.bindNode})}},this))}},this))}}},this),1)},openDialog:function(t){BX.SocNetLogDestination.openDialog(this.id,t);this.mainPopupWindow=BX.SocNetLogDestination.popupWindow},closeDialog:function(){BX.SocNetLogDestination.closeDialog()},getData:function(t){this.blockInit=true;BX.ajax({url:"/bitrix/components/bitrix/main.ui.selector/ajax.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),options:this.options,action:"getData"},onsuccess:BX.delegate(function(e){this.blockInit=false;if(!!e.SUCCESS){this.addData(e.DATA,t);this.initialized=true}},this),onfailure:BX.delegate(function(t){this.blockInit=false},this)})},addData:function(t,e){function i(t,e){if(typeof e!="undefined"){if(typeof t=="undefined"){t={}}for(var i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}}}i(BX.SocNetLogDestination.obItems[this.id]["groups"],t.ITEMS.GROUPS);i(BX.SocNetLogDestination.obItems[this.id]["users"],t.ITEMS.USERS);i(BX.SocNetLogDestination.obItems[this.id]["emails"],t.ITEMS.EMAILS);i(BX.SocNetLogDestination.obItems[this.id]["crmemails"],t.ITEMS.CRMEMAILS);i(BX.SocNetLogDestination.obItems[this.id]["sonetgroups"],t.ITEMS.SONETGROUPS);i(BX.SocNetLogDestination.obItems[this.id]["department"],t.ITEMS.DEPARTMENT);BX.SocNetLogDestination.obItems[this.id]["departmentRelation"]=BX.SocNetLogDestination.buildDepartmentRelation(BX.SocNetLogDestination.obItems[this.id]["department"]);BX.SocNetLogDestination.obItemsLast[this.id]["users"]=typeof t["ITEMS_LAST"]["USERS"]!="undefined"?t["ITEMS_LAST"]["USERS"]:{};BX.SocNetLogDestination.obItemsLast[this.id]["emails"]=typeof t["ITEMS_LAST"]["EMAILS"]!="undefined"?t["ITEMS_LAST"]["EMAILS"]:{};BX.SocNetLogDestination.obItemsLast[this.id]["crmemails"]=typeof t["ITEMS_LAST"]["CRMEMAILS"]!="undefined"?t["ITEMS_LAST"]["CRMEMAILS"]:{};BX.SocNetLogDestination.obItemsLast[this.id]["sonetgroups"]=typeof t["ITEMS_LAST"]["SONETGROUPS"]!="undefined"?t["ITEMS_LAST"]["SONETGROUPS"]:{};BX.SocNetLogDestination.obItemsLast[this.id]["department"]=typeof t["ITEMS_LAST"]["DEPARTMENT"]!="undefined"?t["ITEMS_LAST"]["DEPARTMENT"]:{};BX.SocNetLogDestination.obItemsLast[this.id]["groups"]=typeof t["ITEMS_LAST"]["GROUPS"]!="undefined"?t["ITEMS_LAST"]["GROUPS"]:{};if(typeof t.ITEMS_LAST.CRM!="undefined"&&t.ITEMS_LAST.CRM.length>0){BX.SocNetLogDestination.obCrmFeed[this.id]=true}if(typeof t.SONETGROUPS_LIMITED!="undefined"&&t.SONETGROUPS_LIMITED=="Y"){BX.SocNetLogDestination.obAllowSonetGroupsAjaxSearch[this.id]=true}BX.SocNetLogDestination.obDestSort[this.id]=t.DEST_SORT;e.apply(this,t)},getId:function(){return this.id},getOption:function(t){return typeof this.options[t]!="undefined"?this.options[t]:null}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?154412738438643";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.list/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(window["FCList"])return;var safeEditing=true,safeEditingCurrentObj=null,quoteData=null,repo={commentExemplarId:{}};window.FCList=function(e,t){this.CID=e["CID"];this.ENTITY_XML_ID=e["ENTITY_XML_ID"];this.container=e["container"];this.nav=e["nav"];this.mid=e["mid"];this.order=e["order"];this.status="ready";this.msg=!!this.nav?this.nav.innerHTML:"";this.params=t||{};this.pullNewRecords={};this.rights=e["rights"];this.DATE_TIME_FORMAT=this.params["DATE_TIME_FORMAT"]||null;this.comments={};this.bindEvents=[[this.nav,"click",BX.proxy(function(e){BX.eventCancelBubble(e);e.preventDefault();this.get();return false},this)]];this.exemplarId=BX.util.getRandomString(20);this.windowEvents={OnUCUserIsWriting:BX.delegate(function(t,i,s){if(this.ENTITY_XML_ID==t){BX.ajax({url:this.url.activity,method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,COMMENT_EXEMPLAR_ID:s,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),sign:e["sign"],PATH_TO_USER:this.params["PATH_TO_USER"],AVATAR_SIZE:this.params["AVATAR_SIZE"],NAME_TEMPLATE:this.params["NAME_TEMPLATE"],SHOW_LOGIN:this.params["SHOW_LOGIN"]}})}},this),OnUCAfterRecordAdd:BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e){this.add(t["messageId"],t,true,"simple")}},this),OnUCFormSubmit:BX.delegate(function(e,t,i,s){if(this.ENTITY_XML_ID==e){s["EXEMPLAR_ID"]=this.exemplarId;this.pullNewRecords[e+"-0"]="busy"}},this),OnUCFormResponse:BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e){this.pullNewRecords[e+"-0"]="ready";this.pullNewRecords[e+"-"+t]="done"}},this),OnUCFormAfterShow:BX.delegate(function(e){if(typeof e.id!="undefined"&&this.ENTITY_XML_ID==e.id[0]){if(BX("record-"+this.ENTITY_XML_ID+"-new")){var t=BX.findParent(BX("record-"+this.ENTITY_XML_ID+"-new"),{className:"feed-comments-block"});if(t){BX.addClass(t,"feed-comments-block-editor-shown");var i=BX.findChild(t,{className:"feed-com-add-box-outer"},true);if(i){i.style.display=e.id[1]==0?"block":"none"}}}}},this),OnUCFormAfterHide:BX.delegate(function(e){if(this.ENTITY_XML_ID==e.id[0]){if(BX("record-"+this.ENTITY_XML_ID+"-new")){var t=BX.findParent(BX("record-"+this.ENTITY_XML_ID+"-new"),{className:"feed-comments-block"});if(t){BX.removeClass(t,"feed-comments-block-editor-shown");var i=BX.findChild(t,{className:"feed-com-add-box-outer"},true);if(i){i.style.display="block"}}}}},this),OnUCUserQuote:BX.delegate(function(e){if(this.ENTITY_XML_ID==e&&this.quote&&this.quote.popup){this.quote.popup.hide()}},this),"onPullEvent-unicomments":BX.delegate(function(e,t){if(this.ENTITY_XML_ID==t["ENTITY_XML_ID"]&&(t["USER_ID"]+""!=BX.message("USER_ID")+""||t["EXEMPLAR_ID"]&&t["EXEMPLAR_ID"]!=this.exemplarId||typeof t["AUX"]!="undefined"&&BX.util.in_array(t["AUX"],["createtask","fileversion"]))){if(e==="comment"&&t["ID"]){if(t["COMMENT_EXEMPLAR_ID"])repo.commentExemplarId[t["ENTITY_XML_ID"]+"_"+t["COMMENT_EXEMPLAR_ID"]]=true;this.pullNewRecord(t)}else if(e==="answer"&&t["USER_ID"]+""!==BX.message("USER_ID")+""&&(!t["COMMENT_EXEMPLAR_ID"]||repo.commentExemplarId[t["ENTITY_XML_ID"]+"_"+t["COMMENT_EXEMPLAR_ID"]]!==true)){this.pullNewAuthor(t["USER_ID"],t["NAME"],t["AVATAR"])}}},this)};if(this.params&&this.params["NOTIFY_TAG"]&&!!this.params["NOTIFY_TEXT"]&&!!window["UC"]["Informer"]){this.windowEvents["OnUCCommentWasPulled"]=BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e[0]){window["UC"]["Informer"].check(e,t,this.params["NOTIFY_TAG"],this.params["NOTIFY_TEXT"])}},this);window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]=window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]||[]}var i;for(i=0;i<this.bindEvents.length;i++){BX.bind(this.bindEvents[i][0],this.bindEvents[i][1],this.bindEvents[i][2])}for(i in this.windowEvents){if(this.windowEvents.hasOwnProperty(i)){BX.addCustomEvent(window,i,this.windowEvents[i])}}var s=/%23com(\d+)/gi.exec(location.href),n=parseInt(location.hash&&location.hash.indexOf("#com")>=0?location.hash.replace("#com",""):s?s[1]:0);if(n>0)this.checkHash(n);if(this.params["BIND_VIEWER"]=="Y"&&BX["viewElementBind"]&&BX("record-"+this.ENTITY_XML_ID+"-new")){BX.viewElementBind(BX("record-"+this.ENTITY_XML_ID+"-new").parentNode,{},function(e){return BX.type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))})}this.init(e);if(this.mid>0&&BX("record-"+[this.ENTITY_XML_ID,this.mid].join("-")+"-cover")){var o=BX("record-"+[this.ENTITY_XML_ID,this.mid].join("-")+"-cover").parentNode.firstChild,a=new RegExp("record-("+this.ENTITY_XML_ID+")-([0-9]+)-cover","gi");while(BX(o)){if(o["hasAttribute"]&&o.hasAttribute("id")&&a.test(o.getAttribute("id"))){(o.getAttribute("id")+"").replace(a,function(e,t,i){traceForReading([t,i])})}o=o.nextSibling}}if(repo[this.ENTITY_XML_ID])repo[this.ENTITY_XML_ID].destroy();repo[this.ENTITY_XML_ID]=this;BX.ready(function(){setTimeout(BX.delegate(function(){BX.onCustomEvent(window,"OnUCHasBeenInitialized",[this.ENTITY_XML_ID,this])},this),100)});return this};window.FCList.prototype={url:{activity:"/bitrix/components/bitrix/main.post.list/activity.php"},destroy:function(){var e,t;while((t=this.bindEvents.pop())&&t){BX.unbindAll(t[0]);t[0]=null;t[2]=null}for(e in this.windowEvents){if(this.windowEvents.hasOwnProperty(e)){BX.removeCustomEvent(window,e,this.windowEvents[e]);this.windowEvents[e]=null}}this.windowEvents=null;delete repo[this.ENTITY_XML_ID];BX.onCustomEvent(window,"OnUCHasBeenDestroyed",[this.ENTITY_XML_ID,this])},init:function(){if(this.params["SHOW_POST_FORM"]=="Y"){this.quote.show=BX.delegate(function(e,t){setTimeout(BX.delegate(function(){this.quoteShow(e,t)},this),50)},this);var e=BX("record-"+this.ENTITY_XML_ID+"-new"),t=BX.findChildren(e.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);t=!!t?t:[];t.push(e);if(!!this.container)t.push(this.container);for(var i=0;i<t.length;i++){BX.bind(t[i],"mouseup",this.quote.show)}var s=BX("record-"+this.ENTITY_XML_ID+"-switcher");if(s&&!s.bxDndIsBound){s.bxDndIsBound="Y";BX.bind(s,"dragenter",BX.delegate(this.reply,this))}BX.addCustomEvent(window,"onQuote"+this.ENTITY_XML_ID,this.quote.show)}},quote:{show:BX.DoNothing(),popup:null},quoteCheck:function(){var e="",t,i=null;if(window.getSelection){t=window.getSelection();e=t.toString()}else if(document.selection){t=document.selection;e=t.createRange().text}if(e!=""){var s=BX("record-"+this.ENTITY_XML_ID+"-new"),n=BX.findParent(t.focusNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode),o=BX.findParent(t.anchorNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode);if(n!=o||BX(n)&&!n.hasAttribute("id")){e=""}else if(BX(n)){var a=BX(n.getAttribute("id").replace(/\-cover$/,"-actions-reply"));if(a){i={id:parseInt(a.getAttribute("bx-mpl-author-id")),name:a.getAttribute("bx-mpl-author-name"),gender:a.getAttribute("bx-mpl-author-gender")}}}}if(e==""){if(!!this.quote.popup)this.quote.popup.hide();return false}return{text:e,author:i}},quoteShow:function(e,t){t=t||this.quoteCheck();if(!t||!t["text"]){quoteData=null;return}quoteData=t;if(this.quote.popup==null){this.quote.popup=new MPLQuote({id:this.ENTITY_XML_ID,closeByEsc:true,autoHide:true,autoHideTimeout:2500,events:{click:BX.delegate(function(e){e.preventDefault();BX.eventCancelBubble(e);safeEditingCurrentObj=safeEditing;BX.onCustomEvent(window,"OnUCUserQuote",[this.ENTITY_XML_ID,t["author"],t["text"],safeEditingCurrentObj]);this.quote.popup.hide();return false},this)},classEvents:{onQuoteHide:BX.proxy(function(){quoteData=null;this.quote.popup=null},this)}})}this.quote.popup.show(e)},display:function(e,t){var i=0,s=0,n=0,o=this.container;e=e=="hide"?"hide":"show";if(e=="hide"){i=parseInt(this.container.offsetHeight);n=i/2e3;n=n<.3?.3:n>.5?.5:n;o.style.overflow="hidden";new BX["easing"]({duration:n*1e3,start:{height:i,opacity:100},finish:{height:s,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){o.style.maxHeight=e.height+"px";o.style.opacity=e.opacity/100},complete:BX.proxy(function(){o.style.cssText="";o.style.display="none";BX.onCustomEvent(this,"OnUCListWasHidden",[this,[],o])},this)}).animate()}else{i=parseInt(t||20);o.style.display="block";o.style.overflow="hidden";o.style.maxHeight=i;s=parseInt(this.container.offsetHeight);n=(s-i)/(2e3-i);n=n<.3?.3:n>.8?.8:n;new BX["easing"]({duration:n*1e3,start:{height:i,opacity:i>0?100:0},finish:{height:s,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){o.style.maxHeight=e.height+"px";o.style.opacity=e.opacity/100},complete:BX.proxy(function(){o.style.cssText="";o.style.maxHeight="none";BX.onCustomEvent(this,"OnUCListWasShown",[this,[],o])},this)}).animate()}},get:function(){if(this.status=="done"){if(this.nav.getAttribute("bx-visibility-status")=="visible"){this.display("hide");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"none"},html:this.msg})}else{this.display("show");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")})}}else if(this.status=="ready"){this.send()}return false},send:function(){this.status="busy";BX.addClass(this.nav,"feed-com-all-hover");var e=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"LIST",FILTER:this.order=="ASC"?{">ID":this.mid}:{"<ID":this.mid},sessid:BX.bitrix_sessid()}),t=BX.util.htmlspecialcharsback(this.nav.getAttribute("href"));t=t.indexOf("#")!==-1?t.substr(0,t.indexOf("#")):t;var i={url:t,data:e};BX.onCustomEvent(this,"OnUCListHasToBeEnlarged",[this,i]);t=i.url;e=i.data;BX.ajax({url:t+(t.indexOf("?")!==-1?"&":"?")+e,method:"GET",dataType:"json",data:"",onsuccess:BX.proxy(this.build,this),onfailure:BX.proxy(this.complete,this)})},build:function(e){this.status="ready";this.wait("hide");BX.removeClass(this.nav,"feed-com-all-hover");if(!!e&&e["status"]=="success"){var t=!!e["navigation"]?BX.create("DIV",{html:e["navigation"]}):null,i=BX.processHTML(e["messageList"],false);var s=this.container.offsetHeight,n=BX.create("DIV",{html:i.HTML});if(this.order=="ASC"||!this.container.firstChild){this.container.appendChild(n)}else{this.container.insertBefore(n,this.container.firstChild)}BX.onCustomEvent(window,"OnUCFeedChanged",[[this.ENTITY_XML_ID,this.mid]]);this.display("show",s);if(!!t)t=t.firstChild;if(!!t)BX.adjust(this.nav,{attrs:{href:t.getAttribute("href")},html:t.innerHTML});else{BX.adjust(this.nav,{attrs:{href:"#","bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE"),events:{click:function(e){BX.eventCancelBubble(e);e.preventDefault();return false}}});this.status="done"}var o=0,a=BX.delegate(function(){o++;if(o<100){if(this.container.childNodes.length>0){BX.ajax.processScripts(i.SCRIPT);var t=n.firstChild,s=n.lastChild,r=0,d=0;if(t&&t.hasAttribute("id")){r=parseInt(t.getAttribute("id").replace("record-"+this.ENTITY_XML_ID+"-","").replace("-cover",""));r=r>0?r:0}if(s&&s.hasAttribute("id")){d=parseInt(s.getAttribute("id").replace("record-"+this.ENTITY_XML_ID+"-","").replace("-cover",""));d=d>0?d:0}if(r>d){d=d+r;r=d-r;d=d-r}n.setAttribute("bx-mpl-min",r+"");n.setAttribute("bx-mpl-max",d+"");n.setAttribute("bx-mpl-loaded","Y");this.recalcMoreButtonsList(n);BX.onCustomEvent(this,"OnUCListWasBuilt",[this,e,n])}else BX.defer(a)()}},this);BX.defer(a)()}},complete:function(){this.status="done";BX.removeClass(this.nav,"feed-com-all-hover");this.wait("hide")},wait:function(e){e=e=="show"?"show":"hide";return e},reply:function(e){safeEditingCurrentObj=safeEditing;if(BX.type.isElementNode(e))BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,e.getAttribute("bx-mpl-author-id"),e.getAttribute("bx-mpl-author-name"),safeEditingCurrentObj]);else BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,undefined,undefined,safeEditingCurrentObj])},add:function(e,t,i,s){if(!(!!t&&!!e&&parseInt(e[1])>0))return false;var n=BX("record-"+e.join("-")+"-cover"),o=!!t["message"]?t["message"]:window.fcParseTemplate({messageFields:t["messageFields"]},{RIGHTS:this.rights,DATE_TIME_FORMAT:this.DATE_TIME_FORMAT,VIEW_URL:this.params.VIEW_URL,EDIT_URL:this.params.EDIT_URL,MODERATE_URL:this.params.MODERATE_URL,DELETE_URL:this.params.DELETE_URL,AUTHOR_URL:this.params.AUTHOR_URL,AUTHOR_URL_PARAMS:this.params.AUTHOR_URL_PARAMS,NAME_TEMPLATE:this.params.NAME_TEMPLATE,SHOW_LOGIN:this.params.SHOW_LOGIN},this.getTemplate()),a=BX.processHTML(o,false),r,d=BX("record-"+e[0]+"-new"),l=["MODERATE","EDIT","DELETE"],c=false,h=0;for(var u in l){if(l.hasOwnProperty(u)){if(this.rights[l[u]]=="OWNLAST"){c=true;break}}}if(c){r=!!d.lastChild&&d.lastChild.className=="feed-com-block-cover"?[d.lastChild]:[];var T,E;if(this.addCheckPreviousNodes!==true){r=BX.findChildren(d.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);var m=BX.findChildren(d,{tagName:"DIV",className:"feed-com-block-cover"},false);r=!!r?r:[];m=!!m?m:[];while(m.length>0&&(T=m.pop())&&!!T)r.push(T);this.addCheckPreviousNodes=true}while((T=r.pop())&&T){E=BX(T.id.replace("-cover","-actions"));if(!!E){if(this.rights["EDIT"]=="OWNLAST")E.setAttribute("bx-mpl-edit-show","N");if(this.rights["MODERATE"]=="OWNLAST")E.setAttribute("bx-mpl-moderate-show","N");if(this.rights["DELETE"]=="OWNLAST")E.setAttribute("bx-mpl-delete-show","N")}}}var p=false;if(!n){n=BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},style:{opacity:0,height:0,overflow:"hidden"},html:a.HTML});d.appendChild(n);p=true}else{var f=BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},style:{display:"none"},html:a.HTML}),_=n,X=BX.findChild(_,{tag:"div",className:"feed-com-text-inner"},true),I=X&&X.classList.contains("feed-com-text-inner-expanded");if(I){X=BX.findChild(f,{tag:"div",className:"feed-com-text-inner"},true);if(X){X.classList.add("feed-com-text-inner-expanded")}}n.parentNode.insertBefore(f,n);n.removeAttribute("id");h=n.scrollHeight;BX.hide(n);BX.show(f);n=f;setTimeout(function(){BX.remove(_)},1e3)}if(s!=="simple"&&typeof BXMobileApp=="undefined"){var B=BX.pos(n),A=BX.GetWindowScrollPos(),R=BX.GetWindowInnerSize();new BX["easing"]({duration:1e3,start:{opacity:p?0:100,height:h},finish:{opacity:100,height:n.scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){n.style.height=e.height+"px";n.style.opacity=e.opacity/100;if(A.scrollTop>0&&B.top<A.scrollTop+R.innerHeight){window.scrollTo(0,A.scrollTop+e.height)}},complete:function(){n.style.cssText=""}}).animate()}else{new BX["easing"]({duration:500,start:{opacity:p?0:100,height:h},finish:{opacity:100,height:n.scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.cubic),step:function(e){n.style.height=e.height+"px";n.style.opacity=e.opacity/100},complete:BX.proxy(function(){n.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,e,n])},this)}).animate()}var w=0,g=function(){w++;if(w<100){var i=BX("record-"+e.join("-")+"-cover");if(i&&i.childNodes.length>0){BX.ajax.processScripts(a.SCRIPT);if(this.params["BIND_VIEWER"]=="Y"&&BX["viewElementBind"]){BX.viewElementBind(i,{},function(e){return BX.type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))})}this.recalcMoreButton(this.findMoreButton(i))}else{BX.defer(g,this)()}}BX.onCustomEvent(window,"OnUCRecordHasDrawn",[this.ENTITY_XML_ID,e,t["messageFields"]]);BX.onCustomEvent(window,"OnUCFeedChanged",[e])};BX.defer(g,this)();return true},findMoreButton:function(e){return false},recalcMoreButton:function(e){return false},recalcMoreButtonsList:function(e){return false},pullNewAuthor:function(e,t,i){BX.onCustomEvent(window,"OnUCUsersAreWriting",[this.ENTITY_XML_ID,e,t,i])},pullNewRecord:function(e){var t=[this.ENTITY_XML_ID,parseInt(e["ID"])];if(!!this.pullNewRecords[t.join("-")]&&this.pullNewRecords[t.join("-")]=="busy")return true;else if(!!this.pullNewRecords[t[0]+"-0"]&&this.pullNewRecords[t[0]+"-0"]=="busy")return setTimeout(BX.proxy(function(){this.pullNewRecord(e)},this),100);BX.onCustomEvent(window,"OnUCBeforeCommentWillBePulled",[t,e]);if(e["NEED_REQUEST"]=="Y"){if(e["URL"]["LINK"].indexOf("#GROUPS_PATH#")>=0&&!!BX.message("MPL_WORKGROUPS_PATH"))e["URL"]["LINK"]=e["URL"]["LINK"].replace("#GROUPS_PATH#",BX.message("MPL_WORKGROUPS_PATH"));this.pullNewRecords[t.join("-")]="busy";var i=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"RECORD",FILTER:{ID:e["ID"]},sessid:BX.bitrix_sessid()}),s=e["URL"]["LINK"];s=s.indexOf("#")!==-1?s.substr(0,s.indexOf("#")):s;BX.ajax({url:s+(s.indexOf("?")!==-1?"&":"?")+i,method:"GET",dataType:"json",data:"",onsuccess:BX.delegate(function(i){if(!!BX("record-"+t.join("-")+"-cover"))return;this.add([this.ENTITY_XML_ID,parseInt(e["ID"])],i);var s=BX("record-"+t.join("-")+"-cover"),n=BX.findChild(s,{className:"feed-com-main-content"},true,false);BX.addClass(s,"comment-new-answer");BX.addClass(n,"feed-com-block-pointer-to-new feed-com-block-new");this.pullNewRecords[t.join("-")]="done";if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),BX.hasClass(n,"feed-com-block-new")?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,i])},this)})}else if(e["ACTION"]=="DELETE"){if(BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]))BX.fx.hide(BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]),"scroll",{time:.2});BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else if(e["ACTION"]=="HIDE"){var n=BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]),o=n?BX.findChild(n,{tagName:"DIV",className:"feed-com-block"},true):null;if(BX(o)){if(BX.hasClass(o,"blog-comment-user-"+BX.message("USER_ID"))){BX.removeClass(o,"feed-com-block-approved");BX.addClass(o,"feed-com-block-hidden")}else{BX.fx.hide(n,"scroll",{time:.2});BX.onCustomEvent(window,"OnUCommentWasHidden",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}}}else if(e["ACTION"]=="EDIT"&&!BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"])){BX.DoNothing()}else{if(e&&!(e["AUTHOR"]&&e["AUTHOR"]["ID"]+""==BX.message("USER_ID")+""))e["NEW"]="Y";this.add(t,{messageFields:e});var a=BX("record-"+t.join("-")+"-cover"),r=BX.findChild(a,{className:"feed-com-main-content"},true,false);if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),e["NEW"]=="Y"?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.addClass(a,"comment-new-answer");if(e["NEW"]=="Y"){BX.addClass(r,"feed-com-block-pointer-to-new feed-com-block-new")}this.pullNewRecords[t.join("-")]="done";BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,{messageFields:e}])}return true},act:function(url,id,act){if(url.substr(0,1)!="/"){try{eval(url);return false}catch(e){}if(BX.type.isFunction(url)){url(this,id,act);return false}}this.showWait(id);act=act==="EDIT"?"EDIT":act==="DELETE"?"DELETE":"MODERATE";id=parseInt(id);var data=BX.ajax.prepareData({sessid:BX.bitrix_sessid(),MODE:"RECORD",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:id},ENTITY_XML_ID:this.ENTITY_XML_ID});url=url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url;BX.ajax({method:"GET",url:url+(url.indexOf("?")!==-1?"&":"?")+data,data:"",dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait(id);if(e["status"]=="error"){this.showError(id,e["message"]||"Unknown error.")}else{if(act!=="EDIT"){var t=BX("record-"+this.ENTITY_XML_ID+"-"+id+"-cover");if(!!e["message"]&&!!t){var i=BX.processHTML(e["message"],false);t.innerHTML=i.HTML;var s=0,n=function(){s++;if(s<100){if(t.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(n)()}};BX.defer(n)();e["okMessage"]=""}else if(act=="DELETE"&&!!e["okMessage"]){BX.hide(BX("record-"+this.ENTITY_XML_ID+"-"+id));BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,id]])}}BX.onCustomEvent(window,"OnUCAfterRecordEdit",[this.ENTITY_XML_ID,id,e,act]);BX.onCustomEvent(window,"OnUCFeedChanged",[id])}this.busy=false},this),onfailure:BX.delegate(function(e){this.closeWait(id);this.showError(id,e)},this)});return false},showError:function(e,t){if(this.errorWindow)this.errorWindow.close();this.errorWindow=new BX.PopupWindow("bx-comments-error",null,{autoHide:false,zIndex:200,overlay:{opacity:50,backgroundColor:"#000000"},buttons:[new BX.PopupWindowButton({text:BX.message("MPL_CLOSE"),events:{click:BX.delegate(function(){if(this.errorWindow)this.errorWindow.close()},this)}})],closeByEsc:true,titleBar:{content:BX.create("span",{props:{className:"popup-window-titlebar-text feed-error-title"},html:'<div class="feed-error-icon"></div>'+BX.message("MPL_ERROR_OCCURRED")})},closeIcon:true,contentColor:"white",content:'<div class="feed-error-block">'+t+"</div>"});this.errorWindow.show()},checkHash:function(e){var t=[this.ENTITY_XML_ID,e],i=BX("record-"+t.join("-")+"-cover");if(!!i){var s=BX.pos(i);window.scrollTo(0,s["top"]);i=BX.findChild(i,{className:"feed-com-main-content"},true,false);BX.removeClass(i,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(i,"feed-com-block-pointer")}},getTemplate:function(){return BX.message("MPL_RECORD_TEMPLATE")},showWait:function(e){window.fcShowWait(BX("record-"+this.ENTITY_XML_ID+"-"+e+"-actions"))},closeWait:function(e){window.fcCloseWait(BX("record-"+this.ENTITY_XML_ID+"-"+e+"-actions")||null)}};window.FCList.getQuoteData=function(){return quoteData};window.FCList.getInstance=function(e,t){if(!repo[e["ENTITY_XML_ID"]])new window.FCList(e,t);return repo[e["ENTITY_XML_ID"]]};var lastWaitElement=null;window["fcShowWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;if(BX.type.isElementNode(e)){BX.defer(function(){e.disabled=true})();var t=BX.findParent(e,BX.is_relative);e.bxwaiter=(t||document.body).appendChild(BX.create("DIV",{props:{className:"feed-com-loader"},style:{position:"absolute"}}));lastWaitElement=e;return e.bxwaiter}return true};window["fcCloseWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||lastWaitElement||this;if(BX.type.isElementNode(e)){if(e.bxwaiter&&e.bxwaiter.parentNode){e.bxwaiter.parentNode.removeChild(e.bxwaiter);e.bxwaiter=null}e.disabled=false;if(lastWaitElement==e)lastWaitElement=null}};window["fcShowActions"]=function(e,t,i){var s=[];if(i.getAttribute("bx-mpl-view-show")=="Y"){s.push({text:BX.message("MPL_MES_HREF"),href:i.getAttribute("bx-mpl-view-url").replace(/\\#(.+)$/gi,"")+"#com"+t});s.push({text:'<span id="record-popup-'+e+"-"+t+'-link-text">'+BX.message("B_B_MS_LINK")+"</span>"+'<span id="record-popup-'+e+"-"+t+'-link-icon-animate" class="comment-menu-link-icon-wrap">'+'<span class="comment-menu-link-icon" id="record-popup-'+e+"-"+t+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(){var s="record-popup-"+e+"-"+t+"-link",n=i.getAttribute("bx-mpl-view-url").replace(/#(.+)$/gi,"")+"#com"+t,o=BX(s+"-text"),a=BX(s+"-icon-done");n=(n.indexOf("http")<0?location.protocol+"//"+location.host:"")+n;if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(n);if(o&&a){a.style.display="inline-block";BX.removeClass(BX(s+"-icon-animate"),"comment-menu-link-icon-animate");BX.adjust(BX(s+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(s+"-icon-animate"),"comment-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(BX(s+"-text"),{attrs:{"data-block-click":"N"}})},500)}return}var r=BX.proxy_context,d=parseInt(!!r.getAttribute("bx-height")?r.getAttribute("bx-height"):r.offsetHeight);if(r.getAttribute("bx-status")!="shown"){r.setAttribute("bx-status","shown");if(!BX(s)&&!!BX(s+"-text")){var l=BX(s+"-text"),c=BX.pos(l),h=BX.pos(l.parentNode),u=BX.findChildren(l.parentNode.parentNode.parentNode,{className:"menu-popup-item-text"},true);c["height"]=h["height"]-1;if(u){var T=0,E;for(var m=0;m<u.length;m++){E=BX.pos(u[m]);T=Math.max(T,E["width"])}h["width"]=T}BX.adjust(r,{attrs:{"bx-height":r.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:s},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:s+"-input",type:"text",value:n},style:{height:h["height"]+"px",width:h["width"]+"px"},events:{click:function(e){this.select();e.preventDefault()}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX["fx"]({time:.2,step:.05,type:"linear",start:d,finish:d*2,callback:BX.delegate(function(e){this.style.height=e+"px"},r)}).start();BX.fx.show(BX(s),.2);BX(s+"-input").select()}else{r.setAttribute("bx-status","hidden");new BX["fx"]({time:.2,step:.05,type:"linear",start:r.offsetHeight,finish:d,callback:BX.delegate(function(e){this.style.height=e+"px"},r)}).start();BX.fx.hide(BX(s),.2)}}})}if(i.getAttribute("bx-mpl-edit-show")=="Y")s.push({text:BX.message("BPC_MES_EDIT"),onclick:function(){window["UC"][e].act(i.getAttribute("bx-mpl-edit-url"),t,"EDIT");this.popupWindow.close();return false}});if(i.getAttribute("bx-mpl-moderate-show")=="Y"){var n=i.getAttribute("bx-mpl-moderate-approved")=="hidden";s.push({text:n?BX.message("BPC_MES_SHOW"):BX.message("BPC_MES_HIDE"),onclick:function(){var s=i.getAttribute("bx-mpl-moderate-url").replace("#action#",n?"show":"hide").replace("#ACTION#",n?"SHOW":"HIDE");if(BX.type.isNotEmptyString(s)){s=BX.util.add_url_param(s,{b24statAction:n?"showComment":"hideComment"})}window["UC"][e].act(s,t,"MODERATE");this.popupWindow.close()}})}if(i.getAttribute("bx-mpl-delete-show")=="Y"){s.push({text:BX.message("BPC_MES_DELETE"),onclick:function(){if(window.confirm(BX.message("BPC_MES_DELETE_POST_CONFIRM")))window["UC"][e].act(i.getAttribute("bx-mpl-delete-url"),t,"DELETE");this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-createtask-show")=="Y"&&typeof oLF!="undefined"){var o=i.getAttribute("bx-mpl-comment-entity-type"),a=i.getAttribute("bx-mpl-post-entity-type");s.push({text:BX.message("BPC_MES_CREATE_TASK"),onclick:function(){oLF.createTask({postEntityType:BX.type.isNotEmptyString(a)?a:"BLOG_POST",entityType:BX.type.isNotEmptyString(o)?o:"BLOG_COMMENT",entityId:t});this.popupWindow.close();return false}})}if(s.length>0){for(var r in s){if(s.hasOwnProperty(r)){s[r]["className"]="blog-comment-popup-menu"}}BX.PopupMenu.show("action-"+e+"-"+t,i,s,{offsetLeft:-18,offsetTop:2,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupClose:function(){this.destroy();BX.PopupMenu.Data["action-"+e+"-"+t]=null}}})}};window["fcCommentExpand"]=function(e){BX.UI.Animations.expand({moreButtonNode:e,type:"comment",classBlock:"feed-com-block",classOuter:"feed-com-text-inner",classInner:"feed-com-text-inner-inner",heightLimit:200,callback:function(e){BX.onCustomEvent(window,"OnUCRecordWasExpanded",[e]);e.classList.add("feed-com-text-inner-expanded");var t=e.getAttribute("bx-content-view-xml-id");if(BX.type.isNotEmptyString(t)){BX.onCustomEvent(window,"OnUCFeedChanged",[t.split("-")])}}})};window["fcParseTemplate"]=function(e,t,i){t=t||{};t["RIGHTS"]=t["RIGHTS"]||{};for(var s=0,n=["MODERATE","EDIT","DELETE"];s<n.length;s++){t["RIGHTS"][n[s]]=BX.util.in_array(t["RIGHTS"][n[s]],["Y","ALL","OWN","OWNLAST"])?t["RIGHTS"][n[s]]:"N"}t["DATE_TIME_FORMAT"]=!!t["DATE_TIME_FORMAT"]?t["DATE_TIME_FORMAT"]:"d F Y G:i";t["TIME_FORMAT"]=!!t["DATE_TIME_FORMAT"]&&t["DATE_TIME_FORMAT"].indexOf("a")>=0?"g:i a":"G:i";t["VIEW_URL"]=t["VIEW_URL"]||"";t["EDIT_URL"]=t["EDIT_URL"]||"";t["MODERATE_URL"]=t["MODERATE_URL"]||"";t["DELETE_URL"]=t["DELETE_URL"]||"";t["AUTHOR_URL"]=t["AUTHOR_URL"]||"";t["NAME_TEMPLATE"]=t["NAME_TEMPLATE"]||"";t["SHOW_LOGIN"]=t["SHOW_LOGIN"]||"";var o=e&&e["messageFields"]?e["messageFields"]:e,a={ID:"",FULL_ID:"",CONTENT_ID:"",ENTITY_XML_ID:"",NEW:"old",APPROVED:"Y",DATE:"",TEXT:"",CLASSNAME:"",VIEW_URL:"",VIEW_SHOW:"N",EDIT_URL:"",EDIT_SHOW:"N",MODERATE_URL:"",MODERATE_SHOW:"N",DELETE_URL:"",DELETE_SHOW:"N",CREATETASK_SHOW:"N",BEFORE_HEADER:"",BEFORE_ACTIONS:"",AFTER_ACTIONS:"",AFTER_HEADER:"",BEFORE:"",AFTER:"",BEFORE_RECORD:"",AFTER_RECORD:"",AUTHOR_ID:0,AUTHOR_AVATAR_IS:"N",AUTHOR_AVATAR:"",AUTHOR_URL:"",AUTHOR_NAME:"",AUTHOR_EXTRANET_STYLE:"",SHOW_POST_FORM:"Y",VOTE_ID:"",AUTHOR_TOOLTIP_PARAMS:"","background:url('') no-repeat center;":"",LIKE_REACT:""};if(!!o&&!!e["messageFields"]){o["AUTHOR"]=!!o["AUTHOR"]?o["AUTHOR"]:{};var r=parseInt(o["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));var d=[["today",t["TIME_FORMAT"]],["yesterday",t["TIME_FORMAT"].indexOf("yesterday")<0?"yesterday, "+t["TIME_FORMAT"]:t["TIME_FORMAT"]],["",t["DATE_TIME_FORMAT"]]];var l="";if(typeof o["AUTHOR"]["TYPE"]!="undefined"){if(o["AUTHOR"]["TYPE"]=="EMAIL"){l=" feed-com-name-email"}else if(o["AUTHOR"]["TYPE"]=="EXTRANET"){l=" feed-com-name-extranet"}}else if(o["AUTHOR"]["IS_EXTRANET"]=="Y"){l=" feed-com-name-extranet"}var c=!!o.AUX&&o.AUX.length>0?BX.CommentAux.getLiveText(o.AUX,!!o.AUX_LIVE_PARAMS?o.AUX_LIVE_PARAMS:{}):o["POST_MESSAGE_TEXT"].replace(/\001/gi,"").replace(/#/gi,"");a={ID:o["ID"],FULL_ID:o["FULL_ID"].join("-"),CONTENT_ID:o["RATING"]&&o["RATING"]["ENTITY_TYPE_ID"]&&o["RATING"]["ENTITY_ID"]?o["RATING"]["ENTITY_TYPE_ID"]+"-"+o["RATING"]["ENTITY_ID"]:"",ENTITY_XML_ID:o["ENTITY_XML_ID"],NEW:o["NEW"]=="Y"?"new":"old",APPROVED:o["APPROVED"]!="Y"?"hidden":"approved",DATE:BX.date.format(d,r,parseInt(Date.now()/1e3)+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET")),true),TEXT:c,CLASSNAME:o["CLASSNAME"]?" "+o["CLASSNAME"]:"",VIEW_URL:t["VIEW_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),VIEW_SHOW:t["VIEW_URL"]!==""?"Y":"N",EDIT_URL:t["EDIT_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),EDIT_SHOW:(!o.AUX||o.AUX.length<=0)&&(t["RIGHTS"]["EDIT"]=="Y"||t["RIGHTS"]["EDIT"]=="ALL"||t["RIGHTS"]["EDIT"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"])?"Y":"N",MODERATE_URL:t["MODERATE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),MODERATE_SHOW:t["RIGHTS"]["MODERATE"]=="Y"||t["RIGHTS"]["MODERATE"]=="ALL"||t["RIGHTS"]["MODERATE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",DELETE_URL:t["DELETE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),DELETE_SHOW:t["RIGHTS"]["DELETE"]=="Y"||t["RIGHTS"]["DELETE"]=="ALL"||t["RIGHTS"]["DELETE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",CREATETASK_SHOW:(!o.AUX||o.AUX.length<=0)&&t["RIGHTS"]["CREATETASK"]=="Y"?"Y":"N",BEFORE_HEADER:o["BEFORE_HEADER"],BEFORE_ACTIONS:o["BEFORE_ACTIONS"],AFTER_ACTIONS:o["AFTER_ACTIONS"],AFTER_HEADER:o["AFTER_HEADER"],BEFORE:o["BEFORE"],AFTER:o["AFTER"],BEFORE_RECORD:o["BEFORE_RECORD"],AFTER_RECORD:o["AFTER_RECORD"],AUTHOR_ID:o["AUTHOR"]["ID"],AUTHOR_AVATAR_IS:!!o["AUTHOR"]["AVATAR"]?"Y":"N",AUTHOR_AVATAR:!!o["AUTHOR"]["AVATAR"]?o["AUTHOR"]["AVATAR"]:"/bitrix/images/1.gif",AUTHOR_AVATAR_BG:!!o["AUTHOR"]["AVATAR"]?"background-image:url('"+o["AUTHOR"]["AVATAR"]+"')":"",AUTHOR_URL:t["AUTHOR_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]).replace("#USER_ID#",o["AUTHOR"]["ID"]).replace("#user_id#",o["AUTHOR"]["ID"])+(typeof o["AUTHOR"]["EXTERNAL_AUTH_ID"]!="undefined"&&o["AUTHOR"]["EXTERNAL_AUTH_ID"]=="email"&&typeof t["AUTHOR_URL_PARAMS"]!="undefined"?(t["AUTHOR_URL"].indexOf("?")>=0?"&":"?")+"entityType="+t["AUTHOR_URL_PARAMS"]["entityType"]+"&entityId="+t["AUTHOR_URL_PARAMS"]["entityId"]:""),AUTHOR_NAME:BX.formatName(o["AUTHOR"],t["NAME_TEMPLATE"],t["SHOW_LOGIN"]),AUTHOR_EXTRANET_STYLE:l,VOTE_ID:o["RATING"]&&o["RATING"]["VOTE_ID"]?o["RATING"]["VOTE_ID"]:"",AUTHOR_PERSONAL_GENDER:BX.type.isNotEmptyString(o["AUTHOR"]["PERSONAL_GENDER"])?o["AUTHOR"]["PERSONAL_GENDER"]:"",AUTHOR_TOOLTIP_PARAMS:typeof o["AUTHOR_TOOLTIP_PARAMS"]!="undefined"?o["AUTHOR_TOOLTIP_PARAMS"]:"{}","background:url('') no-repeat center;":"",LIKE_REACT:!!o["LIKE_REACT"]?o["LIKE_REACT"]:"",POST_ENTITY_TYPE:!!o["POST_CONTENT_TYPE_ID"]?o["POST_CONTENT_TYPE_ID"]:"",COMMENT_ENTITY_TYPE:!!o["COMMENT_CONTENT_TYPE_ID"]?o["COMMENT_CONTENT_TYPE_ID"]:""}}else{for(s in a){if(a.hasOwnProperty(s)){a[s]=!!e[s]?e[s]:a[s]}}}for(s in a){if(a.hasOwnProperty(s)){a[s]=!!a[s]?a[s]:""}}a["SHOW_POST_FORM"]=BX("record-"+a["ENTITY_XML_ID"]+"-0-placeholder")?"Y":"N";for(var h in a){if(a.hasOwnProperty(h)){i=i.replace(new RegExp("#"+h+"#","g"),a[h])}}return i.replace("background:url('') no-repeat center;","").replace(/\001/gi,"#")};window["fcPull"]=function(e,t){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/component_epilog.php",method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:e,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),DATA:t}})};var newCommentsToCheckForReading={data:[],screen:{},timeout:0},traceForReading=function(e){newCommentsToCheckForReading.data.push(e);newCommentsToCheckForReading.screen=newCommentsToCheckForReading.screen||{scrollTop:BX.GetWindowScrollPos().scrollTop,time:(new Date).getTime()};newCommentsToCheckForReading.screen["checked"]=false;newCommentsToCheckForReading.timeout=newCommentsToCheckForReading.timeout||setTimeout(markReadComments,1e3)};BX.addCustomEvent(window,"OnUCRecordHasDrawn",function(e,t){traceForReading(t)});var markReadComments=function(){var e=BX.GetWindowScrollPos();if(e.scrollTop!=newCommentsToCheckForReading.screen["scrollTop"]){newCommentsToCheckForReading.screen["time"]=(new Date).getTime();newCommentsToCheckForReading.screen["scrollTop"]=e.scrollTop;newCommentsToCheckForReading.screen["checked"]=false}else if(!newCommentsToCheckForReading.screen["checked"]&&(new Date).getTime()-newCommentsToCheckForReading.screen["time"]>3e3){newCommentsToCheckForReading.screen["time"]=(new Date).getTime();newCommentsToCheckForReading.screen["checked"]=true;var t=0,i=BX.GetWindowInnerSize(),s=[],n,o,a,r,d,l;for(r=0;r<newCommentsToCheckForReading.data.length;r++){n=BX("record-"+newCommentsToCheckForReading.data[r].join("-")+"-cover");if(n){o=BX.pos(n);if(o.top>=e.scrollTop&&o.top<=e.scrollTop+i.innerHeight-20){BX.onCustomEvent(window,"OnUCCommentWasRead",[newCommentsToCheckForReading.data[r],n]);BX.removeClass(n,"comment-new-answer");d=BX.findParent(n,{className:"feed-comments-block"});if(d){l=BX.findChild(d,{className:"feed-com-corner"});if(l){BX.addClass(l,"feed-post-block-corner-fade")}}a=BX.findChild(n,{className:"feed-com-main-content"},true,false);BX.removeClass(a,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(a,"feed-com-block-read");t++}else{s.push(newCommentsToCheckForReading.data[r])}}}newCommentsToCheckForReading.data=s;if(t>0)BX.onCustomEvent(window,"onCounterDecrement",[t])}if(newCommentsToCheckForReading.data.length>0)newCommentsToCheckForReading.timeout=setTimeout(markReadComments,1e3);else{newCommentsToCheckForReading.timeout=0}};var MPLQuote=function(e){this.params=e;this.id=e["id"];this.closeByEsc=!!e["closeByEsc"];this.autoHide=!!e["autoHide"];this.autoHideTimeout=!!e["autoHideTimeout"]?parseInt(e["autoHideTimeout"]):0;if(this.params.classEvents){for(var t in this.params.classEvents)if(this.params.classEvents.hasOwnProperty(t))BX.addCustomEvent(this,t,this.params.classEvents[t])}this.node=document.createElement("A");BX.adjust(this.node,{props:{id:this.id},style:{zIndex:BX.PopupWindow.getOption("popupZindex")+this.params.zIndex,position:"absolute",display:"none",top:"0px",left:"0px"},attrs:{className:"mpl-quote-block",href:"#"},events:this.params.events});document.body.appendChild(this.node)};MPLQuote.prototype={show:function(e){var t=this.getPosition(this.node,e);BX.adjust(this.node,{style:{top:t.y+"px",left:t.x+"px",display:"block"}});BX.addClass(this.node,"mpl-quote-block-show");if(this.closeByEsc&&!this.isCloseByEscBinded){this.isCloseByEscBinded=BX.delegate(this._onKeyUp,this);BX.bind(document,"keyup",this.isCloseByEscBinded)}if(this.params.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){BX.bind(this.node,"click",this.cancelBubble);this.isAutoHideBinded=BX.delegate(this.hide,this);BX.bind(document,"click",this.isAutoHideBinded)},this),0)}if(this.autoHideTimeout>0&&this.autoHideTimeoutInt<=0){if(!this.autoHideTimeoutBinded)this.autoHideTimeoutBinded=BX.delegate(this.hide,this);this.autoHideTimeoutInt=setTimeout(this.autoHideTimeoutBinded,this.autoHideTimeout)}},hide:function(e){if(!this.isShown())return;if(e&&!(BX.getEventButton(e)&BX.MSLEFT))return;this.node.style.display="none";if(this.isCloseByEscBinded){BX.unbind(document,"keyup",this.isCloseByEscBinded);this.isCloseByEscBinded=false}if(this.autoHideTimeout>0){clearTimeout(this.autoHideTimeoutInt);this.autoHideTimeoutInt=0}setTimeout(BX.proxy(this._hide,this),0)},_hide:function(){BX.onCustomEvent(this,"onQuoteHide",[this]);if(this.params.autoHide&&this.isAutoHideBinded){BX.unbind(this.node,"click",this.cancelBubble);BX.unbind(document,"click",this.isAutoHideBinded);this.isAutoHideBinded=false}BX.remove(this.node)},getPosition:function(e,t){var i;if(t.pageX==null){var s=document.documentElement,n=document.body;var o=t.clientX+(s&&s.scrollLeft||n&&n.scrollLeft||0)-(s.clientLeft||0);var a=t.clientY+(s&&s.scrollTop||n&&n.scrollTop||0)-(s.clientTop||0);i={x:o,y:a}}else{i={x:t.pageX,y:t.pageY}}return{x:i.x+5,y:i.y-16}},isShown:function(){return this.node.style.display=="block"},cancelBubble:function(e){if(!e)e=window.event;if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true},_onKeyUp:function(e){e=e||window.event;if(e.keyCode==27)this.hide(e)}};window.mplCheckForQuote=function(e,t,i,s){e=document.all?window.event:e;var n="",o,a=null;if(window.getSelection){o=window.getSelection();n=o.toString()}else if(document.selection){o=document.selection;n=o.createRange().text}if(n!=""){var r=BX.findParent(o.focusNode,{tagName:t.tagName,className:t.className},t),d=BX.findParent(o.anchorNode,{tagName:t.tagName,className:t.className},t);if(r!=d||r!=t){n=""}else{if(!!s&&BX(s,true)){var l=BX(s,true);if(!!l&&l.hasAttribute("bx-post-author-id")){a={id:parseInt(l.getAttribute("bx-post-author-id")),gender:l.getAttribute("bx-post-author-gender"),name:l.innerHTML}}}}}if(n!=""){BX.onCustomEvent(window,"onQuote"+i,[e,{text:n,author:a}]);return true}return false};window.mplReplaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return""}if(BX("MPL_IS_EXTRANET_SITE")=="Y"){e=e.replace("/company/personal/user/","/extranet/contacts/personal/user/")}else{e=e.replace("/extranet/contacts/personal/user/","/company/personal/user/")}e=e.replace(new RegExp("[\\w/]*/mobile/users/\\?user_id=(\\d+)","igm"),BX("MPL_IS_EXTRANET_SITE")=="Y"?"/extranet/contacts/personal/user/$1/":"/company/personal/user/$1/");return e};BX.onCustomEvent("main.post.list/default",["script.js"])})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?154412738415646";s:6:"source";s:79:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){window["UC"]=window["UC"]||{};if(!!window["FCForm"])return;window.FCForm=function(e){this.url="";this.lhe="";this.entitiesId={};this.form=BX(e["formId"]);this.handler=window.LHEPostForm.getHandler(e["editorId"]);this.editorName=e["editorName"];this.editorId=e["editorId"];this.windowEvents={OnUCUnlinkForm:BX.delegate(function(e){if(!!e&&!!this.entitiesId[e]){var t={},i=true;for(var s in this.entitiesId){if(this.entitiesId.hasOwnProperty(s)&&s!=e){i=false;t[s]=this.entitiesId[s]}}this.entitiesId=t;if(i&&!!this.windowEvents){for(s in this.windowEvents){if(this.windowEvents.hasOwnProperty(s)&&s)BX.removeCustomEvent(window,s,this.windowEvents[s])}this.windowEventsSet=false}}},this),OnUCUserQuote:BX.delegate(function(e,t,i,s,n){var o=BX.util.htmlspecialchars(i);if(this.entitiesId[e]){if(!this._checkTextSafety([e,0],s))return;this.show([e,0]);if(n!==true){this.handler.exec(this.windowEvents.OnUCUserQuote,[e,t,i,s,true])}else if(!this.handler.oEditor.toolbar.controls.Quote){BX.DoNothing()}else if(!t&&!i){this.handler.oEditor.action.Exec("quote")}else{i=o;var r=t.gender?BX.message("MPL_HAVE_WRITTEN_"+t.gender):BX.message("MPL_HAVE_WRITTEN");if(this.handler.oEditor.GetViewMode()=="wysiwyg"){i=i.replace(/\n/g,"<br/>");if(t){if(t.id>0){t='<span id="'+this.handler.oEditor.SetBxTag(false,{tag:"postuser",params:{value:t.id}})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}else{t="<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}t=t!==""?t+r+"<br/>":"";i=t+i}}else if(this.handler.oEditor.bbCode){if(t){if(t.id>0){t="[USER="+t.id+"]"+t.name+"[/USER]"}else{t=t.name}t=t!==""?t+r+"\n":"";i=t+i}}if(this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange){this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange();var a=this.handler.oEditor.action.actions.quote.getExternalSelection();if(a===""&&o!==""){a=o}a=(BX.type.isNotEmptyString(t)?t:"")+a;if(BX.type.isNotEmptyString(a))this.handler.oEditor.action.actions.quote.setExternalSelection(a)}else{this.handler.oEditor.action.actions.quote.setExternalSelection(i)}this.handler.oEditor.action.Exec("quote")}}},this),OnUCUserReply:BX.delegate(function(e,t,i,s){if(!this._checkTextSafety([e,0],s))return;if(this.entitiesId[e]){this.show([e,0]);if(t>0){this.handler.exec(window.BxInsertMention,[{item:{entityId:t,name:i},type:"users",formID:this.form.id,editorId:this.editorId,bNeedComa:true,insertHtml:true}])}}},this),OnUCAfterRecordEdit:BX.delegate(function(e,t,i,s){if(!!this.entitiesId[e]){if(s==="EDIT"){this.show([e,t],i["messageBBCode"],i["messageFields"]);this.editing=true}else{this.hide(true);if(!!i["errorMessage"]){this.id=[e,t];this.showError(i["errorMessage"])}else if(!!i["okMessage"]){this.id=[e,t];this.showNote(i["okMessage"]);this.id=null}}}},this),OnUCUsersAreWriting:BX.delegate(function(e,t,i,s,n){if(!!this.entitiesId[e]){this.showAnswering([e,0],t,i,s,n)}},this),OnUCRecordHasDrawn:BX.delegate(function(e,t,i){if(!!this.entitiesId[e]){var s=parseInt(i&&i["AUTHOR"]?i["AUTHOR"]["ID"]:0);if(s>0)this.hideAnswering([e,0],s)}},this)};this.linkEntity(e["entitiesId"]);BX.remove(BX("micro"+e["editorName"]));BX.remove(BX("micro"+e["editorId"]));this.eventNode=this.handler.eventNode;if(this.eventNode){BX.addCustomEvent(this.eventNode,"OnBeforeHideLHE",BX.delegate(function(){BX.removeClass(document.documentElement,"bx-ios-fix-frame-focus");if(top&&top["document"])BX.removeClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus");if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]))BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]))},this));BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",BX.delegate(function(){var e=this._getPlacehoder();if(e){BX.hide(e)}e=this._getSwitcher();if(e){BX.show(e);BX.focus(e.firstChild)}this.__content_length=0;if(!!this.id){BX.onCustomEvent(this.eventNode,"OnUCFormAfterHide",[this]);this.showAnswering(this.id)}clearTimeout(this._checkWriteTimeout);this._checkWriteTimeout=0;this.clear();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnBeforeShowLHE",BX.delegate(function(){if(BX.browser.IsIOS()&&BX.browser.IsMobile()){BX.addClass(window["document"]["documentElement"],"bx-ios-fix-frame-focus");if(top&&top["document"])BX.addClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}var e=this._getPlacehoder();if(e){BX.removeClass(e,"feed-com-add-box-no-form");BX.removeClass(e,"feed-com-add-box-header");BX.show(e)}e=this._getSwitcher();if(e){BX.hide(e)}if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]))BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]))},this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",BX.delegate(function(e,t){this._checkWrite(e,t);if(!!this.id)this.showAnswering(this.id);BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnClickSubmit",BX.delegate(this.submit,this));BX.addCustomEvent(this.eventNode,"OnClickCancel",BX.delegate(this.cancel,this));BX.onCustomEvent(this.eventNode,"OnUCFormInit",[this])}this.id=null;this.jsCommentId=null;BX.addCustomEvent(window,"OnImageDataUriHandle",BX.delegate(this.showWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtUploaded",BX.delegate(this.closeWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtFailed",BX.delegate(this.closeWait,this))};window.FCForm.prototype={linkEntity:function(e){if(!!e){for(var t in e){if(e.hasOwnProperty(t)){BX.onCustomEvent(window,"OnUCUnlinkForm",[t]);this.entitiesId[t]=e[t]}}}if(!this.windowEventsSet&&!!this.entitiesId){BX.addCustomEvent(window,"OnUCUnlinkForm",this.windowEvents.OnUCUnlinkForm);BX.addCustomEvent(window,"OnUCUserReply",this.windowEvents.OnUCUserReply);BX.addCustomEvent(window,"OnUCUserQuote",this.windowEvents.OnUCUserQuote);BX.addCustomEvent(window,"OnUCAfterRecordEdit",this.windowEvents.OnUCAfterRecordEdit);BX.addCustomEvent(window,"OnUCUsersAreWriting",this.windowEvents.OnUCUsersAreWriting);BX.addCustomEvent(window,"OnUCRecordHasDrawn",this.windowEvents.OnUCRecordHasDrawn);this.windowEventsSet=true}},_checkTextSafety:function(e,t){if(t===true){t=e;if(this.id&&this.id.join("-")!=e.join("-")&&this.handler.editorIsLoaded&&this.handler.oEditor.IsContentChanged())return window.confirm(BX.message("MPL_SAFE_EDIT"));return true}return t===false},_checkWrite:function(e,t){if(this.handler.editorIsLoaded&&this._checkWriteTimeout!==false){this.__content_length=this.__content_length>0?this.__content_length:0;var i=this.handler.oEditor.GetContent(),s=BX.delegate(function(){this._checkWrite(e,t)},this),n=2e3;if(i.length>=4&&this.__content_length!=i.length&&!!this.id){BX.onCustomEvent(window,"OnUCUserIsWriting",[this.id[0],this.id[1],this.jsCommentId]);n=3e4}this._checkWriteTimeout=setTimeout(s,n);this.__content_length=i.length}},_getPlacehoder:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e.join("-")+"-placeholder"):null},_getSwitcher:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e[0]+"-switcher"):null},hide:function(e){if(this.eventNode.style.display!="none"){BX.onCustomEvent(this.eventNode,"OnShowLHE",[e===true?false:"hide"])}if(e){document.body.appendChild(this.form)}},clear:function(){this.editing=false;var e=this._getPlacehoder();if(!!e)BX.hide(e);var t=BX.findChildren(e,{tagName:"DIV",className:"feed-add-error"},true);if(!!t){e=t.pop();do{BX.remove(e)}while((e=t.pop())&&e)}BX.onCustomEvent(this.eventNode,"OnUCFormClear",[this]);var i=BX.findChild(this.form,{className:"wduf-placeholder-tbody"},true,false);if(i!==null&&typeof i!="undefined")BX.cleanNode(i,false);i=BX.findChild(this.form,{className:"wduf-selectdialog"},true,false);if(i!==null&&typeof i!="undefined")BX.hide(i);i=BX.findChild(this.form,{className:"file-placeholder-tbody"},true,false);if(i!==null&&typeof i!="undefined")BX.cleanNode(i,false);this.id=null;this.jsCommentId=null},show:function(e,t,i){if(this.id&&!!e&&this.id.join("-")==e.join("-")){var s=this._getPlacehoder(e);this.handler.oEditor.Focus();setTimeout(function(){s.scrollIntoView(false)},100);return true}else{this.hide(true)}this.id=e;this.jsCommentId=BX.util.getRandomString(20);var n=this._getPlacehoder();BX.removeClass(n,"feed-com-add-box-no-form");BX.removeClass(n,"feed-com-add-box-header");n.appendChild(this.form);BX.onCustomEvent(this.eventNode,"OnUCFormBeforeShow",[this,t,i]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["show"]);BX.onCustomEvent(this.eventNode,"OnUCFormAfterShow",[this,t,i]);return true},submit:function(){if(this.busy===true)return"busy";var e=this.handler.editorIsLoaded?this.handler.oEditor.GetContent():"";if(!e){this.showError(BX.message("JERROR_NO_MESSAGE"));return false}this.showWait();this.busy=true;var t={};window.convertFormToArray(this.form,t);t["REVIEW_TEXT"]=e;t["NOREDIRECT"]="Y";t["MODE"]="RECORD";t["AJAX_POST"]="Y";t["id"]=this.id;if(this.jsCommentId!==null)t["COMMENT_EXEMPLAR_ID"]=this.jsCommentId;t["SITE_ID"]=BX.message("SITE_ID");t["LANGUAGE_ID"]=BX.message("LANGUAGE_ID");if(this.editing===true){t["REVIEW_ACTION"]="EDIT";t["FILTER"]={ID:this.id[1]}}BX.onCustomEvent(this.eventNode,"OnUCFormSubmit",[this,t]);BX.onCustomEvent(window,"OnUCFormSubmit",[this.id[0],this.id[1],this,t]);var i=this.form.action;i=BX.util.remove_url_param(i,["b24statAction"]);i=BX.util.add_url_param(i,{b24statAction:this.id[1]>0?"editComment":"addComment"});this.form.action=i;BX.ajax({method:"POST",url:this.form.action,data:t,dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait();var t=e,i=this.id[0];BX.onCustomEvent(this.eventNode,"OnUCFormResponse",[this,e]);if(!!this.OnUCFormResponseData)e=this.OnUCFormResponseData;if(!!e){if(e["errorMessage"]){this.showError(e["errorMessage"])}else if(e["status"]=="error"){this.showError(BX.type.isNotEmptyString(e["message"])?e["message"]:"")}else{BX.onCustomEvent(window,"OnUCAfterRecordAdd",[this.id[0],e,t]);this.hide(true)}}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[i,e["messageId"],this,e])},this),onfailure:BX.delegate(function(){this.closeWait();this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[this.id[0],this.id[1],this,[]])},this)})},cancel:function(){},showError:function(e){if(!e)return;var t=this._getPlacehoder(),i=BX.findChildren(t,{tagName:"DIV",className:"feed-add-error"},true);if(!!i){var s=i.pop();do{BX.remove(s);BX.remove(s)}while((s=i.pop())&&!!s)}BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-error"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+"<b>"+BX.message("FC_ERROR")+"</b><br />"+e+"</span>"}),t.firstChild);BX.show(t)},showNote:function(e){if(!e)return;var t=this._getPlacehoder(),i=BX.findChildren(t,{tagName:"DIV",className:"feed-add-successfully"},true),s=null;if(!!i){while((s=i.pop())&&!!s){BX.remove(s)}}BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-successfully"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+e+"</span>"}),t.firstChild);BX.addClass(t,"comment-deleted");BX.show(t)},showWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=true;if(!!e){BX.addClass(e,"ui-btn-clock");BX.defer(function(){e.disabled=true})()}},closeWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=false;if(!!e){e.disabled=false;BX.removeClass(e,"ui-btn-clock")}},objAnswering:null,showAnswering:function(e,t,i,s,n){t=t>0?t:0;if(t<=0)return;var o="uc-writing-"+this.form.id+"-"+e[0],r=BX(o+"-area"),a=this._getSwitcher(e),d=BX.localStorage.get("ucAnsweringStorage");d=!!d?d:{};if(!r&&a){r=BX.create("DIV",{attrs:{id:o+"-area",className:"feed-com-writers"},html:'<div id="'+o+'-users" class="feed-com-writers-wrap"></div><div class="feed-com-writers-pen"></div>'});a.appendChild(r)}if(!!r){if(t>0){if(!n){d["userId"+t]={id:e[0],userId:t,name:i,avatar:s,time:new Date};BX.localStorage.set("ucAnsweringStorage",d,3e3)}if(!BX(o+"-user-"+t)){BX.adjust(BX(o+"-users"),{children:[BX.create("DIV",{attrs:{className:"feed-com-avatar",id:o+"-user-"+t,title:i},children:s&&s.length>0?[BX.create("IMG",{attrs:{src:s&&s.length>0?s:"/bitrix/images/1.gif"}})]:[]})]})}}if(BX(o+"-users").childNodes.length>0){if(BX(r.parentNode).style.display=="none"){var h=BX("lhe_buttons_"+this.form.id);if(!h||h.style.display=="none")h=this.form;h.appendChild(r)}else if(r.parentNode!=a)a.appendChild(r);if(this.objAnswering&&this.objAnswering.name!="show")this.objAnswering.stop();if(!this.objAnswering||this.objAnswering.name!="show"){r.style.display="inline-block";this.objAnswering=new BX["easing"]({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){r.style.opacity=e.opacity/100}});this.objAnswering.name="show";this.objAnswering.animate()}var l=setTimeout(BX.delegate(function(){this.hideAnswering(e,t)},this),!!n?n:40500);if(BX(o+"-user-"+t)){clearTimeout(BX(o+"-user-"+t).getAttribute("bx-check-timeout"));BX(o+"-user-"+t).setAttribute("bx-check-timeout",l+"")}}}},hideAnswering:function(e,t){var i="uc-writing-"+this.form.id+"-"+e[0],s=BX(i+"-area"),n=BX(i+"-user-"+t,false);if(n&&s){if(BX(i+"-users").childNodes.length>1){new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX["easing"].transitions.quart),step:function(e){n.style.opacity=e.opacity/100},complete:function(){if(!!n&&!!n.parentNode)n.parentNode.removeChild(n)}}).animate()}else{if(this.objAnswering&&this.objAnswering.name!="hide")this.objAnswering.stop();if(!this.objAnswering||this.objAnswering.name!="hide"){this.objAnswering=new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.opacity=e.opacity/100},complete:function(){s.style.display="none";if(!!n&&!!n.parentNode)n.parentNode.removeChild(n)}});this.objAnswering.name="hide";this.objAnswering.animate()}}}}};window.convertFormToArray=function(e,t){t=!!t?t:[];if(!!e){var i,s=[],n=e.elements.length;for(i=0;i<n;i++){var o=e.elements[i];if(o.disabled)continue;switch(o.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":s.push({name:o.name,value:o.value});break;case"radio":case"checkbox":if(o.checked)s.push({name:o.name,value:o.value});break;case"select-multiple":for(var r=0;r<o.options.length;r++){if(o.options[r].selected)s.push({name:o.name,value:o.options[r].value})}break;default:break}}var a=t;i=0;while(i<s.length){var d=s[i].name.indexOf("[");if(d==-1){a[s[i].name]=s[i].value;a=t;i++}else{var h=s[i].name.substring(0,d);var l=s[i].name.substring(d+1);if(!a[h])a[h]=[];var c=l.indexOf("]");if(c==-1){a=t;i++}else if(c===0){a=a[h];s[i].name=""+a.length}else{a=a[h];s[i].name=l.substring(0,c)+l.substring(c+1)}}}}return t};window.FCForm.onUCUsersAreWriting=function(){BX.ready(function(){var e=null,t=null,i=BX.localStorage.get("ucAnsweringStorage");if(!!i){for(var s in i){if(i.hasOwnProperty(s)){e=i[s];if(!!e&&e.userId>0){t=new Date-e.time;if(t<3e4){BX.onCustomEvent(window,"OnUCUsersAreWriting",[e.id,e.userId,e.name,e.avatar,t])}}}}}})};window["fRefreshCaptcha"]=function(e){var t=null,i=BX.findChild(e,{attr:{name:"captcha_code"}},true),s=BX.findChild(e,{attr:{name:"captcha_word"}},true),n=BX.findChild(e,{className:"comments-reply-field-captcha-image"},true);if(n)t=BX.findChild(n,{tag:"img"});if(i&&s&&t){s.value="";BX.ajax.getCaptcha(function(e){i.value=e["captcha_sid"];t.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?15441273848146";s:6:"source";s:77:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){window["UC"]=!!window["UC"]?window["UC"]:{};if(!!window["UC"]["Informer"])return;window.SPC=function(){this.stack=[];this.stackTimeout=null;this.stackPopup={};this.stackPopupTimeout={};this.stackPopupTimeout2={};this.stackPopupId=0;this.stackOverflow=false;this.notifyShow=0;this.notifyHideTime=5e3;this.notifyHeightCurrent=10;this.notifyHeightMax=0;this.notifyGarbageTimeout=null;this.notifyAutoHide=true;this.notifyAutoHideTimeout=null};var t=window.SPC;t.prototype.add=function(t){if(typeof t!="object"||!t.html)return false;if(BX.type.isDomNode(t.html))t.html=t.html.outerHTML;this.stack.push(t);if(!this.stackOverflow)this.setShowTimer(300);return true};t.prototype.remove=function(t){delete this.stack[t]};t.prototype.show=function(){this.notifyHeightMax=document.body.offsetHeight;var t=BX.GetWindowInnerSize();for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]=="undefined")continue;var i=new BX.PopupWindow("bx-sbpc-notify-flash-"+this.stackPopupId,{top:0,left:0},{lightShadow:true,zIndex:200,events:{onPopupClose:BX.delegate(function(){BX.proxy_context.popupContainer.style.opacity=0;this.notifyShow--;this.notifyHeightCurrent-=BX.proxy_context.popupContainer.offsetHeight+10;this.stackOverflow=false;setTimeout(BX.delegate(function(){this.destroy()},BX.proxy_context),1500)},this),onPopupDestroy:BX.delegate(function(){BX.unbindAll(BX.findChild(BX.proxy_context.popupContainer,{className:"bx-spbc-notifier-item-delete"},true));BX.unbindAll(BX.proxy_context.popupContainer);delete this.stackPopup[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout2[BX.proxy_context.uniquePopupId]},this)},bindOnResize:false,content:BX.create("div",{props:{className:"bx-notifyManager-item-sbpc"},html:this.stack[e].html})});i.notifyParams=this.stack[e];i.notifyParams.id=e;i.show();BX.removeClass(i.popupContainer.firstChild,"popup-window");i.popupContainer.style.left=10+"px";i.popupContainer.style.opacity=0;if(this.notifyHeightMax<this.notifyHeightCurrent+i.popupContainer.offsetHeight+10){if(this.notifyShow>0){i.destroy();this.stackOverflow=true;break}}BX.addClass(i.popupContainer,"bx-notifyManager-animation-spbc");new BX.easing({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){i.popupContainer.style.opacity=t.opacity/100}}).animate();i.popupContainer.style.top=t.innerHeight-this.notifyHeightCurrent-i.popupContainer.offsetHeight-10+"px";this.notifyHeightCurrent=this.notifyHeightCurrent+i.popupContainer.offsetHeight+10;this.stackPopupId++;this.notifyShow++;this.remove(e);this.stackPopupTimeout[i.uniquePopupId]=null;BX.bind(i.popupContainer,"mouseover",BX.delegate(function(){this.clearAutoHide()},this));BX.bind(i.popupContainer,"mouseout",BX.delegate(function(){this.setAutoHide(this.notifyHideTime/2)},this));BX.bind(i.popupContainer,"contextmenu",BX.delegate(function(t){if(this.stackPopup[BX.proxy_context.id].notifyParams.tag)this.closeByTag(this.stackPopup[BX.proxy_context.id].notifyParams.tag);else this.stackPopup[BX.proxy_context.id].close();return BX.PreventDefault(t)},this));var o=BX.findChildren(i.popupContainer,{tagName:"a"},true);for(var s=0;s<o.length;s++){if(o[s].href!="#")o[s].target="_blank"}BX.bind(BX.findChild(i.popupContainer,{className:"bx-spbc-notifier-item-delete"},true),"click",BX.delegate(function(t){var e=BX.proxy_context.parentNode.parentNode.parentNode.parentNode.id.replace("popup-window-content-","");if(this.stackPopup[e].notifyParams.close)this.stackPopup[e].notifyParams.close(this.stackPopup[e]);this.stackPopup[e].close();if(this.notifyAutoHide===false){this.clearAutoHide();this.setAutoHide(this.notifyHideTime/2)}return BX.PreventDefault(t)},this));if(i.notifyParams.click){i.popupContainer.style.cursor="pointer";BX.bind(i.popupContainer,"click",BX.delegate(function(t){this.notifyParams.click(this);return BX.PreventDefault(t)},i))}this.stackPopup[i.uniquePopupId]=i}if(this.stack.length>0){this.clearAutoHide(true);this.setAutoHide(this.notifyHideTime)}this.garbage()};t.prototype.closeByTag=function(t){for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined"&&this.stack[e].tag==t){delete this.stack[e]}}for(e in this.stackPopup){if(this.stackPopup.hasOwnProperty(e))if(this.stackPopup[e].notifyParams.tag==t)this.stackPopup[e].close()}};t.prototype.setShowTimer=function(t){clearTimeout(this.stackTimeout);this.stackTimeout=setTimeout(BX.delegate(this.show,this),t)};t.prototype.setAutoHide=function(t){this.notifyAutoHide=true;clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){for(var e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){this.stackPopupTimeout[e]=setTimeout(BX.delegate(function(){this.close()},this.stackPopup[e]),t-1e3);this.stackPopupTimeout2[e]=setTimeout(BX.delegate(function(){this.setShowTimer(300)},this),t-700)}}},this),1e3)};t.prototype.clearAutoHide=function(t){clearTimeout(this.notifyGarbageTimeout);this.notifyAutoHide=false;t=t===true;var e;if(t){clearTimeout(this.stackTimeout);for(e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){clearTimeout(this.stackPopupTimeout[e]);clearTimeout(this.stackPopupTimeout2[e])}}}else{clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){clearTimeout(this.stackTimeout);for(var t in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(t)){clearTimeout(this.stackPopupTimeout[t]);clearTimeout(this.stackPopupTimeout2[t])}}},this),300)}};t.prototype.garbage=function(){clearTimeout(this.notifyGarbageTimeout);this.notifyGarbageTimeout=setTimeout(BX.delegate(function(){var t=[];for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined")t.push(this.stack[e])}this.stack=t},this),1e4)};t.prototype.check=function(t,e,i,o){if(t[1]<=0||!window["UC"]["Informer"]||!BX.type.isNotEmptyString(o))return;var s=/(\d+)/g.exec(t[0]),n=BX("record-"+t.join("-")+"-cover");s=!!s?parseInt(s):0;if(s<=0||!n)return false;else if(BX.util.in_array(s,window["UC"]["InformerTags"][i]))return true;window["UC"]["InformerTags"][i].push(s);var a=!!e&&!!e["messageFields"]?e["messageFields"]:false;if(!a)return;var r=BX.pos(n),p=BX.GetWindowScrollPos(),u=BX.GetWindowInnerSize();if(r.top<p.scrollTop||r.top>p.scrollTop+u.innerHeight-20){setTimeout(function(){if(parseInt(a["AUTHOR"]["ID"])!=parseInt(BX.message("USER_ID"))){var e=BX.create("div",{props:{className:"bx-spbc-notifier-item"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-content"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-avatar"},children:[!!a["AUTHOR"]["AVATAR"]?BX.create("img",{props:{className:"bx-spbc-notifier-item-avatar-img"},attrs:{src:a["AUTHOR"]["AVATAR"]}}):""]}),BX.create("a",{attrs:{href:"#"},props:{className:"bx-spbc-notifier-item-delete"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-name"},html:a["AUTHOR"]["NAME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-time"},html:a["POST_TIME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text2"},html:'"'+o+'"'})]})]}),i=BX.GetWindowScrollPos();window["UC"]["Informer"].add({html:e,tag:"im-record-"+t.join("-"),click:BX.delegate(function(){var e=BX.pos(BX("record-"+t.join("-")));new BX.easing({duration:500,start:{scroll:i.scrollTop},finish:{scroll:e.top-100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){window.scrollTo(0,t.scroll)}}).animate()},this)})}},50)}};t.NativeNotify=function(){return window.webkitNotifications&&window.webkitNotifications.checkPermission()==0};window["UC"]["Informer"]=new t;window["UC"]["InformerTags"]={};t.notifyManagerShow=function(){BX.ready(function(){BX.addCustomEvent("onNotifyManagerShow",function(t){if(t.originalTag){var e=t.originalTag.lastIndexOf("|"),i=t.originalTag.substr(0,e);if(!!window["UC"]["InformerTags"][i]){var o=parseInt(t.originalTag.substr(e+1));window["UC"]["InformerTags"][i].push(o)}}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js?154412745325169";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
function showHiddenDestination(t,e){BX.hide(e);BX("blog-destination-hidden-"+t).style.display="inline"}function showMenuLinkInput(t,e){var s="post-menu-"+t+"-link",o=BX(s+"-text"),i=BX(s+"-icon-done");if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(e);if(o&&i){i.style.display="inline-block";BX.removeClass(BX(s+"-icon-animate"),"post-menu-link-icon-animate");BX.adjust(o,{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(s+"-icon-animate"),"post-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(o,{attrs:{"data-block-click":"N"}})},500)}return}var n=BX.proxy_context,a=parseInt(!!n.getAttribute("bx-height")?n.getAttribute("bx-height"):n.offsetHeight);if(n.getAttribute("bx-status")!="shown"){n.setAttribute("bx-status","shown");if(!BX(s)&&!!BX(s+"-text")){var p=BX(s+"-text"),r=BX.pos(p),d=BX.pos(p.parentNode);pos3=BX.pos(BX.findParent(p,{className:"menu-popup-item"},true));r["height"]=d["height"]-1;BX.adjust(n,{attrs:{"bx-height":n.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:s},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:s+"-input",type:"text",value:e},style:{height:r["height"]+"px",width:pos3["width"]-21+"px"},events:{click:function(t){this.select();BX.PreventDefault(t)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:a,finish:a*2,callback:BX.delegate(function(t){this.style.height=t+"px"},n)}).start();BX.fx.show(BX(s),.2);BX(s+"-input").select()}else{n.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:n.offsetHeight,finish:a,callback:BX.delegate(function(t){this.style.height=t+"px"},n)}).start();BX.fx.hide(BX(s),.2)}}function deleteBlogPost(t){var e=BX("blg-post-"+t);if(BX.findChild(e,{attr:{id:"form_c_del"}},true,false)){BX.hide(BX("form_c_del"));BX(e.parentNode.parentNode).appendChild(BX("form_c_del"))}BX.ajax.get(BX.message("sonetBPDeletePath").replace("#del_post_id#",t),function(s){if(window.deletePostEr&&window.deletePostEr=="Y"){BX.findChild(e,{className:"feed-post-cont-wrap"},true,false).insertBefore(BX.create("SPAN",{html:s}),BX.findChild(e,{className:"feed-user-avatar"},true,false))}else{BX("blg-post-"+t).parentNode.innerHTML=s}});return false}var waitPopupBlogImage=null;function blogShowImagePopup(t){if(!waitPopupBlogImage){waitPopupBlogImage=new BX.PopupWindow("blogwaitPopupBlogImage",window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("IMG",{props:{src:t,id:"blgimgppp"}}),closeByEsc:true,closeIcon:true})}else{BX("blgimgppp").src="/bitrix/images/1.gif";BX("blgimgppp").src=t}waitPopupBlogImage.setOffset({offsetTop:0,offsetLeft:0});setTimeout(function(){waitPopupBlogImage.adjustPosition()},100);waitPopupBlogImage.show()}function __blogPostSetFollow(t){var e=BX("log_entry_follow_"+t,true).getAttribute("data-follow")=="Y"?"Y":"N";var s=e=="Y"?"N":"Y";if(BX("log_entry_follow_"+t,true)){BX.findChild(BX("log_entry_follow_"+t,true),{tagName:"a"}).innerHTML=BX.message("sonetBPFollow"+s);BX("log_entry_follow_"+t,true).setAttribute("data-follow",s)}BX.ajax({url:BX.message("sonetBPSetPath"),method:"POST",dataType:"json",data:{log_id:t,action:"change_follow",follow:s,sessid:BX.bitrix_sessid(),site:BX.message("sonetBPSiteId")},onsuccess:function(s){if(s["SUCCESS"]!="Y"&&BX("log_entry_follow_"+t,true)){BX.findChild(BX("log_entry_follow_"+t,true),{tagName:"a"}).innerHTML=BX.message("sonetBPFollow"+e);BX("log_entry_follow_"+t,true).setAttribute("data-follow",e)}},onfailure:function(s){if(BX("log_entry_follow_"+t,true)){BX.findChild(BX("log_entry_follow_"+t,true),{tagName:"a"}).innerHTML=BX.message("sonetBPFollow"+e);BX("log_entry_follow_"+t,true).setAttribute("data-follow",e)}}});return false}(function(){if(!!BX.SBPostMenu)return false;BX.SBPostMenu=function(t){};BX.SBPostMenu.showMenu=function(params){if(typeof params=="undefined"||typeof params.postId=="undefined"||parseInt(params.postId)<=0||typeof params.bindNode=="undefined"||!BX(params.bindNode)){return false}BX.PopupMenu.destroy("blog-post-"+params.postId);var isPublicPage=typeof params.publicPage!="undefined"&&!!params.publicPage,isTasksAvailable=typeof params.tasksAvailable!="undefined"&&!!params.tasksAvailable,pathToPost=typeof params.pathToPost!="undefined"?params.pathToPost:"",urlToEdit=typeof params.urlToEdit!="undefined"?params.urlToEdit:"",urlToHide=typeof params.urlToHide!="undefined"?params.urlToHide:"",urlToDelete=typeof params.urlToDelete!="undefined"?params.urlToDelete:"",voteId=typeof params.voteId!="undefined"?parseInt(params.voteId):false,postType=typeof params.postType!="undefined"?params.postType:false;if(isPublicPage){return false}var menuWaiterPopup=new BX.PopupWindow("blog-post-"+params.postId+"-waiter",params.bindNode,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});setTimeout(function(){if(menuWaiterPopup){menuWaiterPopup.show()}},300);BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.blog.post/ajax.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),siteId:BX.message("SITE_ID"),action:"get_data",postId:parseInt(params.postId),public:isPublicPage?"Y":"N",mobile:"N",group_readonly:typeof params.group_readonly!="undefined"&&!!params.group_readonly?"Y":"N",pathToPost:pathToPost,voteId:voteId},onsuccess:function(postData){if(typeof postData=="undefined"||typeof postData.perms=="undefined"||postData.perms<="D"&&(typeof params.items=="undefined"||params.items.length<=0)){menuWaiterPopup.destroy();return false}var menuItems=[];if(!BX.util.in_array(postType,["DRAFT","MODERATION"])){if(postData.isGroupReadOnly!="Y"&&parseInt(BX.message("USER_ID"))>0&&parseInt(postData.logId)>0){var isFavorites=parseInt(postData.logFavoritesUserId)>0;menuItems.push({text:BX.message(isFavorites?"sonetLMenuFavoritesTitleY":"sonetLMenuFavoritesTitleN"),onclick:function(t){__logChangeFavorites(parseInt(postData.logId),"log_entry_favorites_"+parseInt(postData.logId),isFavorites?"N":"Y",true);return false}})}var serverName=params.serverName;menuItems.push({text:BX.message("BLOG_HREF"),href:postData.urlToPost,class:"feed-entry-popup-menu-link"});menuItems.push({text:'<span id="post-menu-'+postData.logId+'-link-text">'+BX.message("BLOG_LINK")+"</span>"+'<span id="post-menu-'+postData.logId+'-link-icon-animate" class="post-menu-link-icon-wrap">'+'<span class="post-menu-link-icon" id="post-menu-'+postData.logId+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(t){showMenuLinkInput(parseInt(postData.logId),serverName+postData.urlToPost);return false},class:"feed-entry-popup-menu-link"});if(parseInt(BX.message("USER_ID"))>0&&postData.isGroupReadOnly!="Y"&&postData.isShareForbidden!="Y"){menuItems.push({text:BX.message("BLOG_SHARE"),onclick:function(){showSharing(parseInt(params.postId),parseInt(postData.authorId));this.popupWindow.close()}})}if(postData.perms>="W"||postData.perms>="P"&&postData.authorId==BX.message("USER_ID")){menuItems.push({text:BX.message("BLOG_BLOG_BLOG_EDIT"),href:urlToEdit})}if(postData.perms>="T"){menuItems.push({text:BX.message("BLOG_MES_HIDE"),onclick:function(){if(confirm(BX.message("BLOG_MES_HIDE_POST_CONFIRM"))){window.location=urlToHide;this.popupWindow.close()}}})}if(postData.perms>="W"){menuItems.push({text:BX.message("BLOG_BLOG_BLOG_DELETE"),onclick:function(){if(confirm(BX.message("BLOG_MES_DELETE_POST_CONFIRM"))){if(urlToDelete.length>0){window.location=urlToDelete.replace("#del_post_id#",parseInt(params.postId))}else{window.deleteBlogPost(parseInt(params.postId))}this.popupWindow.close()}}})}if(isTasksAvailable&&postData.perms>"D"){menuItems.push({text:BX.message("BLOG_POST_CREATE_TASK"),onclick:function(t){var e=t.target||t.srcElement;oLF.createTask({entityType:"BLOG_POST",entityId:parseInt(params.postId)});this.popupWindow.close();return t.preventDefault()}})}if(postData.urlToVoteExport.length>0){menuItems.push({text:BX.message("BLOG_POST_VOTE_EXPORT"),href:postData.urlToVoteExport})}}var onclickHandler=null,menuItem=null,item=null;if(typeof params.items!="undefined"){for(var key in params.items){if(params.items.hasOwnProperty(key)){item=params.items[key];menuItem={};if(typeof item.text_php!="undefined"){menuItem.text=item.text_php}if(typeof item.onclick!="undefined"){eval("onclickHandler = "+item.onclick);menuItem.onclick=onclickHandler}else if(typeof item.href!="undefined"){menuItem.href=item.href}menuItems.push(menuItem)}}}var popupEvents=typeof params.logId!="undefined"&&parseInt(params.logId)>0?{onPopupShow:function(t){if(BX("log_entry_favorites_"+parseInt(params.logId))){var e=BX.findChildren(t.contentContainer,{className:"menu-popup-item-text"},true);if(e!=null){for(var s=0;s<e.length;s++){if(e[s].innerHTML==BX.message("sonetLMenuFavoritesTitleY")||e[s].innerHTML==BX.message("sonetLMenuFavoritesTitleN")){var o=e[s];break}}}if(typeof o!="undefined"){BX(o).innerHTML=BX.hasClass(BX("log_entry_favorites_"+parseInt(params.logId)),"feed-post-important-switch-active")?BX.message("sonetLMenuFavoritesTitleY"):BX.message("sonetLMenuFavoritesTitleN")}}if(BX("post-menu-"+parseInt(params.logId)+"-link")){var i=BX.findChild(t.popupContainer,{className:"feed-entry-popup-menu-link"},true,false);if(i){var n=parseInt(!!i.getAttribute("bx-height")?i.getAttribute("bx-height"):0);if(n>0){BX("post-menu-"+parseInt(params.logId)+"-link").style.display="none";i.setAttribute("bx-status","hidden");i.style.height=n+"px"}}}}}:{};menuWaiterPopup.destroy();BX.PopupMenu.show("blog-post-"+params.postId,params.bindNode,menuItems,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:popupEvents});return false},onfailure:function(t){menuWaiterPopup.destroy();return false}})}})();(function(){if(!!window.SBPImpPost)return false;window.SBPImpPost=function(t){if(t.getAttribute("sbpimppost")=="Y")return false;this.CID="sbpimppost"+(new Date).getTime();this.busy=false;this.node=t;this.btn=t.parentNode;this.block=t.parentNode.parentNode;this.postId=t.getAttribute("bx-blog-post-id");t.setAttribute("sbpimppost","Y");BX.onCustomEvent(this.node,"onInit",[this]);if(this.postId>0)this.onclick();return false};window.SBPImpPost.prototype.onclick=function(){this.sendData()};window.SBPImpPost.prototype.showClick=function(){var t=this.btn.offsetWidth,e=BX.message("BLOG_ALREADY_READ"),s=BX.create("span",{props:{className:"have-read-text-block"},html:"<i></i>"+e+'<span class="feed-imp-post-footer-comma">,</span>'});this.block.style.minWidth=this.btn.offsetWidth-27+"px";var o=new BX.easing({duration:250,start:{width:t},finish:{width:1},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate(function(t){this.btn.style.width=t.width+"px"},this),complete:BX.delegate(function(){this.btn.innerHTML="";this.btn.appendChild(s);var t=s.offsetWidth,e=new BX.easing({duration:300,start:{width_2:0},finish:{width_2:t},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate(function(t){this.btn.style.width=t.width_2+"px"},this)});e.animate()},this)});o.animate()};window.SBPImpPost.prototype.wait=function(t){t=t=="show"?"show":"hide";if(t=="show"){this.node.disabled=true;BX.addClass(this.node,"ui-btn-clock")}else{BX.removeClass(this.node,"ui-btn-clock")}};window.SBPImpPost.prototype.sendData=function(){if(this.busy)return false;this.busy=true;window["node"]=this.node;window["obj"]=this;this.wait("show");var t={options:[{post_id:this.postId,name:"BLOG_POST_IMPRTNT",value:"Y"}],sessid:BX.bitrix_sessid()},e=this.node.getAttribute("bx-url");BX.onCustomEvent(this.node,"onSend",[t]);t=BX.ajax.prepareData(t);if(t){e+=(e.indexOf("?")!==-1?"&":"?")+t;t=""}BX.ajax({method:"GET",url:e,dataType:"json",onsuccess:BX.delegate(function(t){this.busy=false;this.wait("hide");this.showClick();BX.onCustomEvent(this.node,"onUserVote",[t]);BX.onCustomEvent("onImportantPostRead",[this.postId,this.CID])},this),onfailure:BX.delegate(function(t){this.busy=false;this.wait("hide")},this)})};top.SBPImpPostCounter=function(t,e,s){this.parentNode=t;this.node=BX.findChild(t,{tagName:"A"});if(!this.node)return false;BX.addCustomEvent(this.node,"onUserVote",BX.delegate(function(t){this.change(t)},this));this.parentNode.SBPImpPostCounter=this;this.node.setAttribute("status","ready");this.node.setAttribute("inumpage",0);this.postId=e;this.popup=null;this.data=[];BX.bind(t,"click",BX.proxy(function(){this.get()},this));BX.bind(t,"mouseover",BX.proxy(function(t){this.init(t)},this));BX.bind(t,"mouseout",BX.proxy(function(t){this.init(t)},this));this.pathToUser=s["pathToUser"];this.nameTemplate=s["nameTemplate"];this.onPullEvent=BX.delegate(function(t,e){if(t=="read"&&!!e&&e["POST_ID"]==this.postId){if(!!e["data"]){this.change(e["data"]);if(this.popup!=null){this.popup.isNew=true}}}},this);BX.addCustomEvent("onPullEvent-socialnetwork",this.onPullEvent)};top.SBPImpPostCounter.prototype.click=function(t){t.uController=this;BX.addCustomEvent(t.node,"onUserVote",BX.proxy(this.change,this));BX.addCustomEvent(t.node,"onSend",BX.proxy(function(t){t["PATH_TO_USER"]=this.pathToUser;t["NAME_TEMPLATE"]=this.nameTemplate;t["iNumPage"]=0;t["ID"]=this.postId;t["post_id"]=this.postId;t["name"]="BLOG_POST_IMPRTNT";t["value"]="Y";t["return"]="users"},this));this.btnObj=t};top.SBPImpPostCounter.prototype.change=function(t){if(!!t&&!!t.items){var e=false;this.data=[];for(var s in t.items){if(t.items.hasOwnProperty(s)){this.data.push(t.items[s])}}if(t["StatusPage"]=="done"){this.node.setAttribute("inumpage","done")}else this.node.setAttribute("inumpage",1);BX.adjust(this.parentNode,{style:{display:"inline-block"}})}else{this.node.setAttribute("inumpage","done");BX.hide(this.parentNode)}this.node.firstChild.innerHTML=t["RecordCount"]};top.SBPImpPostCounter.prototype.init=function(t){if(!!this.node.timeoutOver){clearTimeout(this.node.timeoutOver);this.node.timeoutOver=false}if(t.type=="mouseover"){if(!this.node.mouseoverFunc){this.node.mouseoverFunc=BX.delegate(function(){this.get();if(this.popup){BX.bind(this.popup.popupContainer,"mouseout",BX.proxy(function(){this.popup.timeoutOut=setTimeout(BX.proxy(function(){if(!!this.popup){this.popup.close()}},this),400)},this));BX.bind(this.popup.popupContainer,"mouseover",BX.proxy(function(){if(this.popup.timeoutOut)clearTimeout(this.popup.timeoutOut)},this))}},this)}this.node.timeoutOver=setTimeout(this.node.mouseoverFunc,400)}};top.SBPImpPostCounter.prototype.get=function(){if(this.node.getAttribute("inumpage")!="done")this.node.setAttribute("inumpage",parseInt(this.node.getAttribute("inumpage"))+1);this.show();if(this.data.length>0){this.make(this.node.getAttribute("inumpage")!="done")}if(this.node.getAttribute("inumpage")!="done"){this.node.setAttribute("status","busy");BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.blog.blog/users.php",method:"POST",dataType:"json",data:{ID:this.postId,post_id:this.postId,name:"BLOG_POST_IMPRTNT",value:"Y",iNumPage:this.node.getAttribute("inumpage"),PATH_TO_USER:this.pathToUser,NAME_TEMPLATE:this.nameTemplate,sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID"),site:BX.message("SITE_ID")},onsuccess:BX.proxy(function(t){if(!!t&&!!t.items){var e=false;for(var s in t.items){this.data.push(t.items[s])}if(t.StatusPage=="done"){this.node.setAttribute("inumpage","done")}this.make(this.node.getAttribute("inumpage")!="done")}else{this.node.setAttribute("inumpage","done")}this.node.firstChild.innerHTML=t["RecordCount"];this.node.setAttribute("status","ready")},this),onfailure:BX.proxy(function(t){this.node.setAttribute("status","ready")},this)})}};top.SBPImpPostCounter.prototype.show=function(){if(this.popup==null){this.popup=new BX.PopupWindow("bx-vote-popup-cont-"+this.postId,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});this.popup.isNew=true;this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false};top.SBPImpPostCounter.prototype.make=function(t){if(!this.popup)return true;t=t!==false;var e=this.popup&&this.popup.contentContainer?this.popup.contentContainer:BX("popup-window-content-bx-vote-popup-cont-"+this.postId),s=false,o=false,i=this.data;if(this.popup.isNew){s=BX.create("SPAN",{props:{className:"bx-ilike-popup"},children:[BX.create("SPAN",{props:{className:"bx-ilike-bottom_scroll"}})]});o=BX.create("SPAN",{props:{className:"bx-ilike-wrap-block"},children:[s]})}else{s=BX.findChild(this.popup.contentContainer,{className:"bx-ilike-popup"},true)}if(!!s){var n=null;for(var a in i){if(i.hasOwnProperty(a)){if(!BX.findChild(s,{tag:"A",attr:{id:"u"+i[a]["ID"]}},true)){if(i[a]["PHOTO_SRC"].length>0){n=BX.create("IMG",{attrs:{src:i[a]["PHOTO_SRC"]},props:{className:"bx-ilike-popup-avatar-img"}})}else{n=BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"bx-ilike-popup-avatar-img bx-ilike-popup-avatar-img-default"}})}s.appendChild(BX.create("A",{attrs:{id:"u"+i[a]["ID"]},props:{href:i[a]["URL"].length>0?i[a]["URL"]:"#",target:"_blank",className:"bx-ilike-popup-img"+(!!i[a]["TYPE"]?" bx-ilike-popup-img-"+i[a]["TYPE"]:"")},text:"",children:[BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-new"},children:[n,BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-status-icon"}})]}),BX.create("SPAN",{props:{className:"bx-ilike-popup-name-new"},html:i[a]["FULL_NAME"]})],events:{click:i[a]["URL"].length>0?function(t){return true}:function(t){BX.PreventDefault(t)}}}))}}}if(t){BX.bind(s,"scroll",BX.proxy(this.popupScrollCheck,this))}}if(this.popup.isNew){this.popup.isNew=false;if(!!e){try{e.removeChild(e.firstChild)}catch(t){}e.appendChild(o)}}if(this.popup!=null){this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false}};top.SBPImpPostCounter.prototype.popupScrollCheck=function(){var t=BX.proxy_context;if(t.scrollTop>(t.scrollHeight-t.offsetHeight)/1.5){BX.unbind(t,"scroll",BX.proxy(this.popupScrollCheck,this));this.get()}}})(window);window.BXfpdPostSelectCallback=function(t,e,s){BX.SocNetLogDestination.BXfpSelectCallback({item:t,type:e,bUndeleted:false,containerInput:BX("feed-add-post-destination-item-post"),valueInput:BX("feed-add-post-destination-input-post"),formName:BXSocNetLogDestinationFormNamePost,tagInputName:"bx-destination-tag-post",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")})};window.BXfpdPostClear=function(){var t=BX.findChildren(BX("feed-add-post-destination-item-post"),{className:"feed-add-post-destination"},true);if(t!=null){for(var e=0;e<t.length;e++){BX.remove(t[e])}}BX("feed-add-post-destination-input-post").value="";BX.SocNetLogDestination.BXfpSetLinkName({formName:window.BXSocNetLogDestinationFormNamePost,tagInputName:"bx-destination-tag-post",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")})};window.showSharing=function(t,e){BXfpdPostClear();BX("sharePostId").value=t;BX("shareUserId").value=e;BX.SocNetLogDestination.obItemsSelected[BXSocNetLogDestinationFormNamePost]={};if(window["postDest"+t]){for(var s=0;s<window["postDest"+t].length;s++){if(BX.SocNetLogDestination.obItemsSelected[BXSocNetLogDestinationFormNamePost]){BX.SocNetLogDestination.obItemsSelected[BXSocNetLogDestinationFormNamePost][window["postDest"+t][s].id]=window["postDest"+t][s].type}if(!BX.SocNetLogDestination.obItems[BXSocNetLogDestinationFormNamePost][window["postDest"+t][s].type][window["postDest"+t][s].id]){BX.SocNetLogDestination.obItems[BXSocNetLogDestinationFormNamePost][window["postDest"+t][s].type][window["postDest"+t][s].id]={avatar:"",entityId:window["postDest"+t][s].entityId,id:window["postDest"+t][s].id,name:window["postDest"+t][s].name}}}if(BXSocNetLogDestinationFormNamePost)BX.SocNetLogDestination.reInit(BXSocNetLogDestinationFormNamePost);var o=BX.findChildren(BX("feed-add-post-destination-item-post"),{className:"feed-add-post-destination"},true);if(o!=null){for(var i=0;i<o.length;i++){BX.addClass(o[i],"feed-add-post-destination-undelete");BX.remove(o[i].lastChild)}}var n=BX("destination-sharing");if(BX("blg-post-destcont-"+t)){BX("blg-post-destcont-"+t).appendChild(n)}n.style.height=0;n.style.opacity=0;n.style.overflow="hidden";n.style.display="inline-block";new BX.easing({duration:500,start:{opacity:0,height:0},finish:{opacity:100,height:n.scrollHeight-40},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){n.style.height=t.height+"px";n.style.opacity=t.opacity/100},complete:function(){n.style.cssText="";BX.SocNetLogDestination.openDialog(BXSocNetLogDestinationFormNamePost)}}).animate()}};window.closeSharing=function(){var t=BX("destination-sharing");if(BX("sharePostSubmitButton")){BX.removeClass(BX("sharePostSubmitButton"),"ui-btn-clock")}new BX.easing({duration:500,start:{opacity:100,height:t.scrollHeight-40},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){t.style.height=e.height+"px";t.style.opacity=e.opacity/100},complete:function(){BX.hide(t)}}).animate()};window.sharingPost=function(){var t=BX("sharePostId").value;var e=BX("shareUserId").value;var s=BX("blogShare");var o=socBPDest.shareUrl.replace(/#post_id#/,t).replace(/#user_id#/,e);if(BX("sharePostSubmitButton")){BX.addClass(BX("sharePostSubmitButton"),"ui-btn-clock")}s.action=o;s.target="";var i,n="";var a=s.elements.length;var p="";for(i=0;i<a;i++){if(n!="")p="&";var r=s.elements[i];if(r.disabled)continue;switch(r.type.toLowerCase()){case"text":case"hidden":n+=p+r.name+"="+BX.util.urlencode(r.value);break;default:break}}n+="&save=Y&MODE=RECORD&AJAX_POST=Y&ENTITY_XML_ID=BLOG_"+t;var d=renderSharingPost(t);BX.ajax({method:"POST",dataType:"json",url:o,data:n,onsuccess:function(e){if(typeof e=="undefined"||typeof e.status=="undefined"||e.status!="success"){hideRenderedSharingNodes(d);if(typeof e.status!="undefined"&&e.status=="error"&&typeof e.errorMessage!="undefined"){var s=new BX.PopupWindow("error_popup",BX("blg-post-inform-"+t),{lightShadow:true,offsetTop:-10,offsetLeft:100,autoHide:true,closeByEsc:true,closeIcon:{right:"5px",top:"5px"},draggable:{restrict:true},contentColor:"white",contentNoPaddings:true,bindOptions:{position:"bottom"},content:BX.create("DIV",{props:{className:"feed-create-task-popup-content"},children:[BX.create("DIV",{props:{className:"feed-create-task-popup-description"},text:e.errorMessage})]})});s.show()}}else{var o=e;BX.onCustomEvent(window,"OnUCAfterRecordAdd",["BLOG_"+t,e,o])}},onfailure:function(t){hideRenderedSharingNodes(d)}});closeSharing()};window.renderSharingPost=function(t){var e=[];var s="";var o=BX.findChildren(BX("feed-add-post-destination-item-post"),{className:"feed-add-post-destination"},true);if(o!=null){var i=BX("blog-destination-hidden-"+t);if(!i){var n=BX.findChildren(BX("blg-post-img-"+t),{className:"feed-add-post-destination-new"},true);var a=n[n.length-1]}for(var p=0;p<o.length;p++){if(!BX.hasClass(o[p],"feed-add-post-destination-undelete")){var r=BX.findChild(o[p],{className:"feed-add-post-destination-text"},false,false).innerHTML;var d=BX.findChild(o[p],{tag:"input"},false,false);var l=d.value;var u="feed-add-post-destination-new";if(BX.hasClass(o[p],"feed-add-post-destination-email")){u+=" feed-add-post-destination-new-email"}else if(BX.hasClass(o[p],"feed-add-post-destination-extranet")){u+=" feed-add-post-destination-new-extranet"}var f;if(d.name=="SPERM[SG][]")f="sonetgroups";else if(d.name=="SPERM[DR][]")f="department";else if(d.name=="SPERM[G][]")f="groups";else if(d.name=="SPERM[U][]")f="users";else if(d.name=="SPERM[UE][]")f="users";else if(d.name=="SPERM[UA][]")f="groups";if(f.length>0){window["postDest"+t].push({id:l,name:r,type:f});s="post_"+t+"_dest_"+l;e.push(s);var h=BX.create("span",{props:{id:s},children:[BX.create("span",{html:", "}),BX.create("a",{props:{className:u},href:"",html:r})]});if(i){i.appendChild(h)}else if(a){BX(a.parentNode).insertBefore(h,a.nextSibling)}}}}}return e};window.hideRenderedSharingNodes=function(t){var e=false;for(i=0;i<t.length;i++){e=t[i];if(BX(e)){BX.cleanNode(BX(e),true)}}};(function(){if(!!BX.SBPostManager)return false;BX.SBPostManager=function(){this.inited=false;this.tagLinkPattern=""};BX.SBPostManager.prototype.init=function(t){this.tagLinkPattern=BX.type.isNotEmptyString(t.tagLinkPattern)?t.tagLinkPattern:"";this.inited=true};BX.SBPostManager.prototype.clickTag=function(t){var e=false;if(BX.type.isNotEmptyString(t)&&BX.type.isNotEmptyString(this.tagLinkPattern)){top.location.href=this.tagLinkPattern.replace("#tag#",t);e=true}return e}})();if(typeof oSBPostManager=="undefined"){oSBPostManager=new BX.SBPostManager;window.oSBPostManager=oSBPostManager}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.min.js?15441274534339";s:6:"source";s:86:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){if(!!window.__blogEditComment)return;window.checkForQuote=function(e,i,o,t){if(window.mplCheckForQuote)mplCheckForQuote(e,i,o,t)};window.__blogLinkEntity=function(e,i){if(!!window["UC"]&&!!window["UC"]["f"+i]){window["UC"]["f"+i].linkEntity(e);for(var o in e){if(e.hasOwnProperty(o)){BX.bind(BX("blog-post-addc-add-"+e[o][1]),"click",BX.proxy(window["UC"][o].reply,window["UC"][o]));BX.bind(BX("blg-post-"+e[o][1]),"dragenter",BX.proxy(window["UC"][o].reply,window["UC"][o]));BX.addCustomEvent(window["UC"]["f"+i].eventNode,"OnUCFormBeforeShow",function(i){if(!!i&&!!i.id&&i.id[0]==o){BX.show(BX("blg-comment-"+e[o][1]))}})}}}};window.__blogEditComment=function(e,i){var o={messageBBCode:top["text"+e],messageFields:{arImages:top["arComFiles"+e],arDocs:top["arComDocs"+e],arFiles:top["arComFilesUf"+e],arDFiles:top["arComDFiles"+e],UrlPreview:top["UrlPreview"+e]}};BX.onCustomEvent(window,"OnUCAfterRecordEdit",["BLOG_"+i,e,o,"EDIT"])};window.__blogOnUCFormClear=function(e){LHEPostForm.reinitDataBefore(e.editorId)};window.__blogOnUCFormAfterShow=function(e,i,o){o=!!o?o:{};BX.onCustomEvent(window,"OnBeforeSocialnetworkCommentShowedUp",["socialnetwork_blog"]);var t={ENTITY_XML_ID:e.id[0],ENTITY_TYPE:e.entitiesId[e.id[0]][0],ENTITY_ID:e.entitiesId[e.id[0]][1],parentId:e.id[1],comment_post_id:e.entitiesId[e.id[0]][1],edit_id:e.id[1],act:e.id[1]>0?"edit":"add",logId:e.entitiesId[e.id[0]][2]};for(var n in t){if(!e.form[n])e.form.appendChild(BX.create("INPUT",{attrs:{name:n,type:"hidden"}}));e.form[n].value=t[n]}e.form.action=SBPC.actionUrl.replace(/#source_post_id#/,t["comment_post_id"]);var a=BX("captcha");if(!!a){BX.ajax.getCaptcha(function(e){BX("captcha_word").value="";BX("captcha_code").value=e["captcha_sid"];BX("captcha").src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"];BX("captcha").style.display=""})}onLightEditorShow(i,o)};window.__blogOnUCFormSubmit=function(e,i){i["decode"]="Y"};window.__blogOnUCAfterRecordAdd=function(e,i){if(i.errorMessage.length>0)return;if(BX("blg-post-inform-"+e.substr(5))){var o=BX.findChild(BX("blg-post-inform-"+e.substr(5)),{tag:"span",className:"feed-inform-follow"},true);if(o){var t=o.getAttribute("data-follow")=="Y"?"Y":"N";if(t=="N"){BX.findChild(o,{tagName:"a"}).innerHTML=BX.message("sonetBPFollowY");o.setAttribute("data-follow","Y")}}}};window.onLightEditorShow=function(e,i){var o={};if(i["arFiles"]){var t={},n,a;for(var r=0;r<i["arFiles"].length;r++){n=BX.findChild(BX("wdif-doc-"+i["arFiles"][r]),{className:"feed-com-file-name"},true);a=BX.findChild(BX("wdif-doc-"+i["arFiles"][r]),{className:"feed-con-file-size"},true);t["F"+r]={FILE_ID:i["arFiles"][r],FILE_NAME:n?n.innerHTML:"noname",FILE_SIZE:a?a.innerHTML:"unknown",CONTENT_TYPE:"notimage/xyz"}}o["UF_BLOG_COMMENT_DOC"]={USER_TYPE_ID:"file",FIELD_NAME:"UF_BLOG_COMMENT_DOC[]",VALUE:t}}if(i["arDocs"])o["UF_BLOG_COMMENT_FILE"]={USER_TYPE_ID:"webdav_element",FIELD_NAME:"UF_BLOG_COMMENT_FILE[]",VALUE:BX.clone(i["arDocs"])};if(i["arDFiles"])o["UF_BLOG_COMMENT_FILE"]={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_BLOG_COMMENT_FILE[]",VALUE:BX.clone(i["arDFiles"])};if(i["UrlPreview"])o["UF_BLOG_COMMENT_URL_PRV"]={USER_TYPE_ID:"url_preview",FIELD_NAME:"UF_BLOG_COMMENT_URL_PRV",VALUE:BX.clone(i["UrlPreview"])};LHEPostForm.reinitData(SBPC.editorId,e,o);if(i["arImages"]){var d,l=LHEPostForm.getHandler(SBPC.editorId),s="";for(var m in i["arImages"]){if(i["arImages"].hasOwnProperty(m)){d={id:i["arImages"][m]["id"],element_id:i["arImages"][m]["id"],element_name:i["arImages"][m]["name"],element_size:0,element_content_type:i["arImages"][m]["type"],element_url:i["arImages"][m]["src"],element_thumbnail:i["arImages"][m]["thumbnail"],element_image:i["arImages"][m]["src"],parser:"postimage",storage:"bfile"};var _=l.checkFile(d.id,"common",d,true)}}}};BX.SocialnetworkBlogPostComment={};BX.SocialnetworkBlogPostComment.registerViewAreaList=function(e){if(typeof e=="undefined"||typeof e.containerId=="undefined"||typeof e.className=="undefined"){return}if(BX(e.containerId)){var i=BX.findChildren(BX(e.containerId),{tag:"div",className:e.className},true),o=null;for(var t=0,n=i.length;t<n;t++){if(i[t].id.length>0){o=null;if(BX.type.isNotEmptyString(e.fullContentClassName)){o=BX.findChild(i[t],{className:e.fullContentClassName})}BX.UserContentView.registerViewArea(i[t].id,o?o:null)}}}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:108:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.blog.blog/important/script.min.js?154412764513923";s:6:"source";s:88:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.blog.blog/important/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(window){if(top.BSBBW)return true;function animation(t,e){if(!BX.browser.isPropertySupported("transform"))return false;function s(t){if(BX.browser.isPropertySupported(t))return BX.browser.isPropertySupported(t);else return false}function i(){var t=["moz","webkit","o","ms"],e=t.length,s="";while(e--)if("transform"in document.body.style){return s}else if(t[e]+"Transform"in document.body.style){s="-"+t[e].toLowerCase()+"-"}return s}var a=BX.create("div",{props:{className:"anim-corner-gradient"}});var n=BX.create("div",{props:{className:"anim-corner"},children:[a]}),o=BX.create("div",{props:{className:"anim-corner-wrap"},children:[n]}),r=BX.create("div",{props:{className:"block-distort-shadow-wrap"},children:[BX.create("div",{props:{className:"block-distort-shadow"}})]}),h=BX.create("div",{props:{className:"block-distort"},children:[t,o]}),d=BX.create("div",{props:{className:"main-mes-wrap"},children:[h,r]});e.appendChild(d);h.style[s("transformOrigin")]="180px 130px";h.style[s("transform")]="rotate(42deg)";t.style[s("transformOrigin")]="50% 100%";t.style[s("transformOrigin")]="50% 100%";t.style[s("transform")]="rotate(-42deg)";o.style[s("transform")]="rotate(-42deg)";var l=new BX.easing({duration:100,start:{height:475,bottom:-182,left:-124,shadow_height:0,shadow_bottom:-74,gradient_height:0,gradient_width:0},finish:{height:342,bottom:-50,left:-72,shadow_height:130,shadow_bottom:-52,gradient_height:172,gradient_width:197},transition:BX.easing.transitions.linear(),step:function(t){h.style.height=t.height+"px";o.style.left=t.left+"px";o.style.bottom=t.bottom+"px";r.style.height=t.shadow_height+"px";r.style.bottom=t.shadow_bottom+"px";a.style.height=t.gradient_height+"px";a.style.width=t.gradient_width+"px"},complete:function(){var e;o.style[s("transformOrigin")]="62px 0";o.style.left=-17+"px";o.style.bottom=-183+"px";r.style[s("transformOrigin")]="28px 0";r.style.left="-28px";r.style.bottom="46px";h.style[s("transformOrigin")]="47px 100%";h.style.top=-195+"px";h.style.left=-46+"px";t.style[s("transformOrigin")]="0 0";t.style.top=337+"px";t.style.left=41+"px";var l=new BX.easing({duration:200,start:{distort_rotate:42,shadow_rotate:42,shadow_skew:0,corner_rotate:-42,corner_height:180,corner_bottom:-183,message_rotate:-42,gradient_rotate:42},finish:{distort_rotate:34,shadow_rotate:34,shadow_skew:11,corner_rotate:-50,corner_height:251,corner_bottom:-248,message_rotate:-34,gradient_rotate:48},transition:BX.easing.transitions.linear(),step:function(e){h.style[s("transform")]="rotate("+e.distort_rotate+"deg)";o.style[s("transform")]="rotate("+e.corner_rotate+"deg)";o.style.bottom=e.corner_bottom+"px";n.style.height=e.corner_height+"px";r.style[s("transform")]="rotate("+e.shadow_rotate+"deg)";t.style[s("transform")]="rotate("+e.message_rotate+"deg)";a.style.height=e.corner_height+"px";a.style.backgroundImage=i()+"linear-gradient("+e.gradient_rotate+"deg, #ece297 42%, #e5d38e 57%, #f6e9a3 78%)"},complete:function(){n.style[s("transformOrigin")]="100% 0";n.style.boxShadow="none";if(i()=="-webkit-")e=24;else e=67;var l=new BX.easing({duration:200,start:{distort_rotate:34,corner_rotate:-50,corner_width:260,corner_height:251,corner_skew:0,message_rotate:-34,shadow_rotate:34,shadow_skew:0,shadow_width:340,opacity:10,gradient_rotate:48,gradient_percent:57},finish:{distort_rotate:16,corner_rotate:-60,corner_width:236,corner_height:256,corner_skew:8,message_rotate:-16,shadow_rotate:16,shadow_skew:15,shadow_width:301,opacity:0,gradient_rotate:e,gradient_percent:50},transition:BX.easing.transitions.linear(),step:function(e){h.style[s("transform")]="rotate("+e.distort_rotate+"deg)";h.style.opacity=e.opacity/10;o.style[s("transform")]="rotate("+e.corner_rotate+"deg)";n.style[s("transform")]="skew("+e.corner_skew+"deg, 0deg)";n.style.width=e.corner_width+"px";n.style.height=e.corner_height+"px";a.style.height=e.corner_height+"px";t.style[s("transform")]="rotate("+e.message_rotate+"deg)";r.style[s("transform")]="rotate("+e.shadow_rotate+"deg) skew("+e.shadow_skew+"deg, 0)";r.style.width=e.shadow_width+"px";r.style.opacity=e.opacity/10;a.style.backgroundImage=i()+"linear-gradient("+e.gradient_rotate+"deg, #ece297 42%, #e5d38e "+e.gradient_percent+"%, #f6e9a3 78%)"},complete:function(){d.style.display="none"}});l.animate()}});l.animate()}});l.animate()}top.BSBBW=function(t){this.CID=t["CID"];this.controller=t["controller"];this.nodes=t["nodes"];this.tMessage=this.nodes["template"].innerHTML;this.url=t["url"];this.options=t["options"];this.post_info=t["post_info"];this.post_info["AJAX_POST"]="Y";this.sended=false;this.active=false;this.inited=false;this.busy=false;this.userCounter=0;this.inited=this.init(t);this.show();BX.addCustomEvent(this.controller,"onDataAppeared",BX.delegate(this.onDataAppeared,this));BX.addCustomEvent(this.controller,"onDataRanOut",BX.delegate(this.onDataRanOut,this));BX.addCustomEvent(this.controller,"onReachedLimit",BX.delegate(this.onReachedLimit,this));BX.addCustomEvent(this.controller,"onRequestSend",BX.delegate(this.showWait,this));BX.addCustomEvent(this.controller,"onResponseCame",BX.delegate(this.hideWait,this));BX.addCustomEvent(this.controller,"onResponseFailed",BX.delegate(this.hideWait,this));BX.addCustomEvent(window,"onImUpdateCounter",BX.delegate(this.onImUpdateCounter,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(function(t,e){if(t=="user_counter"&&e[BX.message("SITE_ID")]&&e[BX.message("SITE_ID")]["BLOG_POST_IMPORTANT"]){this.onImUpdateCounter(e[BX.message("SITE_ID")])}},this));BX.addCustomEvent(window,"onSonetLogCounterClear",BX.delegate(function(){this.onImUpdateCounter({BLOG_POST_IMPORTANT:0})},this));BX.addCustomEvent(window,"onImportantPostRead",BX.delegate(this.onImportantPostRead,this))};top.BSBBW.prototype={init:function(t){this.page_settings=t["page_settings"];this.page_settings["NavRecordCount"]=parseInt(this.page_settings["NavRecordCount"]);this.limit=this.page_settings["NavPageCount"]>1?3:0;this.current=0;if(this.active)clearTimeout(this.active);this.active=false;this.data_id={};this.data=t["data"];for(var e in this.data)this.data_id["id"+this.data[e]["id"]]="normal";if(this.data.length<=0)BX.onCustomEvent(this.controller,"onDataRanOut");else BX.onCustomEvent(this.controller,"onDataAppeared");if(!this.inited){BX.bind(this.nodes["right"],"click",BX.delegate(function(){this.onShiftPage("right")},this));BX.bind(this.nodes["left"],"click",BX.delegate(function(){this.onShiftPage("left")},this));BX.adjust(this.nodes["btn"],{attrs:{url:this.url},events:{click:BX.delegate(this.onClickToRead,this)}})}return true},show:function(){var t=this.tMessage,e=this.data[this.current];if(!e)return;for(var s in e)t=t.replace("__"+s+"__",e[s]);this.nodes["leaf"].innerHTML=t;this.nodes["text"].innerHTML=t;this.nodes["counter"].innerHTML=this.current+1;this.nodes["total"].innerHTML=this.page_settings["NavRecordCount"];var i=BX.findChild(this.nodes["text"],{className:"sidebar-imp-mess-text"},true);var a=BX.findChild(this.nodes["text"],{attribute:{"data-bx-author-avatar":true}},true);if(!!i){BX.adjust(i,{attrs:{url:this.url},events:{click:BX.delegate(this.onClickToRead,this)}})}if(e["author_avatar_style"]!==""&&!!a){BX.adjust(a,{style:{backgroundImage:e["author_avatar_style"],backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",backgroundColor:"transparent"}})}i=BX.findChild(this.nodes["leaf"],{className:"sidebar-imp-mess-text"},true);a=BX.findChild(this.nodes["leaf"],{attribute:{"data-bx-author-avatar":true}},true);if(e["author_avatar_style"]!==""&&!!a){BX.adjust(a,{style:{backgroundImage:e["author_avatar_style"],backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",backgroundColor:"transparent"}})}},showWait:function(){},hideWait:function(){},onImUpdateCounter:function(t){var e=parseInt(t["BLOG_POST_IMPORTANT"]);if(this.userCounter!=e){this.userCounter=e;if(this.userCounter>0){this.startCheck()}}},startCheck:function(){if(this.busy!==true){var t=this.post_info;t["sessid"]=BX.bitrix_sessid();t["page_settings"]=this.page_settings;t["page_settings"]["iNumPage"]=null;BX.ajax({method:"POST",processData:false,url:this.url,data:t,onsuccess:BX.delegate(function(t){this.busy=false;this.parseResponse(t,true)},this),onfailure:BX.delegate(function(t){this.busy=false;this.onResponseFailed(t)},this)})}},parseResponse:function(response,fromCheck){var data=false,result=false;try{eval("result="+response+";")}catch(t){}if(!result||!result.data||result.data.length<=0)data=false;else if(fromCheck===true){var dataNew=[],data=result.data;for(var ii in data){if(typeof data[ii]=="object"&&!this.data_id["id"+data[ii]["id"]]){dataNew.push(data[ii])}}result.page_settings["NavRecordCount"]=parseInt(result.page_settings["NavRecordCount"]);this.page_settings["NavRecordCount"]=parseInt(this.page_settings["NavRecordCount"]);if(this.data.length>0&&dataNew.length==result.page_settings["NavRecordCount"]-this.page_settings["NavRecordCount"]){var d=dataNew.pop();while(!!d){this.data_id["id"+d["id"]]="normal";this.data.unshift(d);this.current++;d=dataNew.pop()}this.page_settings["NavPageCount"]=result.page_settings["NavPageCount"];this.page_settings["NavRecordCount"]=result.page_settings["NavRecordCount"];this.show()}else{var current=0,res=this.data[this.current];if(this.data.length>0&&!!res){for(var ii=0;ii<data.length;ii++){if(typeof data[ii]=="object"&&data[ii]["id"]==res["id"]){current=ii;break}}}this.init(result);this.current=current;this.show()}}else{this.page_settings["NavPageNomer"]=result.page_settings["NavPageNomer"];data=result.data;for(var ii in data){if(typeof data[ii]=="object"&&!this.data_id["id"+data[ii]["id"]]){this.data_id["id"+data[ii]["id"]]="normal";this.data.push(data[ii])}}if(this.data.length>0)BX.onCustomEvent(this.controller,"onDataAppeared")}return true},onClickToRead:function(t){var e=this.data[this.current],s=[],i;for(i in this.options)s.push({post_id:e["id"],name:this.options[i]["name"],value:this.options[i]["value"]});var a=this.post_info;a["options"]=s;a["page_settings"]=this.page_settings;a["sessid"]=BX.bitrix_sessid();t=t===false?false:true;a=BX.ajax.prepareData(a);if(t){BX.ajax({method:"GET",url:this.url+(this.url.indexOf("?")!==-1?"&":"?")+a,onsuccess:BX.delegate(this.onAfterClickToRead,this),onfailure:function(t){}})}this.onShiftPage("drop");animation(this.nodes["leaf"],this.nodes["block"])},onAfterClickToRead:function(){},onShiftPage:function(t){if(this.active)clearTimeout(this.active);this.active=setTimeout(BX.delegate(function(){this.active=false},this),12e4);if(t=="drop"){this.page_settings["NavRecordCount"]--;this.data_id["id"+this.data[this.current]["id"]]="readed";this.data=BX.util.deleteFromArray(this.data,this.current);if(!!this.data&&this.data.length>0){this.current=this.current-1;t="left"}else{BX.onCustomEvent(this.controller,"onDataRanOut");return}}if(t=="right"){if(this.current<=0){this.page_settings["NavRecordCount"]=parseInt(this.page_settings["NavRecordCount"]);if(this.data.length<this.page_settings["NavRecordCount"])this.current=1;else this.current=this.data.length}this.current=this.current-1}else{if(this.current>=this.data.length-1)this.current=0;else this.current=this.current+1}if(this.limit>0&&this.current>=this.data.length-1-this.limit)BX.onCustomEvent(this.controller,"onReachedLimit");this.show()},onDataRanOut:function(){if((!this.data||this.data.length<=0)&&this.controller.style.display!="none"){this.bodyAnimationheight=this.controller.offsetHeight;(this.bodyAnimation=new BX.easing({duration:200,start:{height:this.controller.offsetHeight,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:BX.delegate(function(t){BX.adjust(this.controller,{style:{height:t.height+"px",opacity:t.opacity/100}})},this),complete:BX.delegate(function(){this.controller.style.display="none"},this)})).animate()}},onDataAppeared:function(){if(!!this.data&&this.data.length>0&&this.controller.style.display=="none"){var t=!!this.bodyAnimationheight?this.bodyAnimationheight:200;this.controller.style.display="block";(this.bodyAnimation=new BX.easing({duration:200,start:{height:0,opacity:0},finish:{height:t,opacity:100},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:BX.delegate(function(t){BX.adjust(this.controller,{style:{height:t.height+"px",opacity:t.opacity/100}})},this),complete:BX.delegate(function(){BX.adjust(this.controller,{style:{display:"block",height:"auto",opacity:"auto"}})},this)})).animate()}},onReachedLimit:function(){if(this.sended===true)return;var t=this.post_info,e=false;this.page_settings["NavPageNomer"]=parseInt(this.page_settings["NavPageNomer"]);this.page_settings["NavPageCount"]=parseInt(this.page_settings["NavPageCount"]);if(this.page_settings["NavPageCount"]<=1)e=true;else if(this.page_settings["bDescPageNumbering"]==true){if(this.page_settings["NavPageNomer"]>1)this.page_settings["iNumPage"]=parseInt(this.page_settings["NavPageNomer"])-1;else e=true}else if(this.page_settings["NavPageNomer"]<this.page_settings["NavPageCount"])this.page_settings["iNumPage"]=parseInt(this.page_settings["NavPageNomer"])+1;else e=true;if(e===true){BX.removeCustomEvent(this.controller,"onReachedLimit",BX.delegate(this.onReachedLimit,this));return true}BX.onCustomEvent(this.controller,"onRequestSend");this.sended=true;t["page_settings"]=this.page_settings;t["sessid"]=BX.bitrix_sessid();BX.ajax({method:"POST",processData:false,url:this.url,data:t,onsuccess:BX.delegate(this.onResponseCame,this),onfailure:BX.delegate(this.onResponseFailed,this)})},onResponseCame:function(t){this.sended=false;BX.onCustomEvent(this.controller,"onResponseCame");this.parseResponse(t)},onResponseFailed:function(t){this.sended=false;BX.onCustomEvent(this.controller,"onResponseFailed")},onImportantPostRead:function(t,e){if(t>0){for(var s in this.data){if(this.data[s]["id"]==t){this.current=s;this.onClickToRead(e==this.CID);break}}}}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(i);var r={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};s=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a,o={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"]};a=this.getListItems(t,s);if(a.length){o.items=a}i.push(o);delete t[s]}}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var i;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){i=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",i,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{var s="settings";BX.userOptions.save("ui",this.listContainer.id,s,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?154412745438362";s:6:"source";s:75:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.CLBlock=function(e){this.arData=[];this.arData["Subscription"]=[];this.UTPopup=null;this.createTaskPopup=null;this.entity_type=null;this.entity_id=null;this.event_id=null;this.event_id_fullset=false;this.cb_id=null;this.t_val=null;this.ind=null;this.type=null};BX.CLBlock.prototype.DataParser=function(str){str=str.replace(/^\s+|\s+$/g,"");while(str.length>0&&str.charCodeAt(0)==65279)str=str.substring(1);if(str.length<=0)return false;if(str.substring(0,1)!="{"&&str.substring(0,1)!="["&&str.substring(0,1)!="*")str='"*"';eval("arData = "+str);return arData};function __logFilterShow(){if(BX("bx_sl_filter").style.display=="none"){BX("bx_sl_filter").style.display="block";BX("bx_sl_filter_hidden").style.display="none"}else{BX("bx_sl_filter").style.display="none";BX("bx_sl_filter_hidden").style.display="block"}}if(!window.XMLHttpRequest){var XMLHttpRequest=function(){try{return new ActiveXObject("MSXML3.XMLHTTP")}catch(e){}try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}var LBlock=new BX.CLBlock;function __logOnAjaxInsertToNode(e){var t=false,n=null,o=null;if(BX("sonet_log_more_container")){n=BX.findChild(BX("sonet_log_more_container"),{tag:"span",className:"feed-new-message-inf-text"},false);if(n){o=BX.findChild(n,{tag:"span",className:"feed-new-message-icon"},false);if(o){BX.addClass(o,"new-message-balloon-icon-rotating")}}t=BX.pos(BX("sonet_log_more_container"));oLF.nodeTmp1Cap=document.body.appendChild(BX.create("div",{style:{position:"absolute",width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:1e3}}))}if(BX("sonet_log_counter_2_container")){n=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text"},false);if(n){o=BX.findChild(n,{tag:"span",className:"feed-new-message-icon"},false);if(o){BX.addClass(o,"new-message-balloon-icon-rotating")}}t=BX.pos(BX("sonet_log_more_container"));oLF.nodeTmp2Cap=document.body.appendChild(BX.create("div",{style:{position:"absolute",width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:1e3}}))}BX.unbind(BX("sonet_log_counter_2_container"),"click",__logOnAjaxInsertToNode)}function __logChangeCounter(e){var t=parseInt(e)<=0;oCounter={iCommentsRead:0};BX.onCustomEvent(window,"onSonetLogChangeCounter",[oCounter]);e-=oCounter.iCommentsRead;__logChangeCounterAnimate(parseInt(e)>0,e,t)}function __logDecrementCounter(e){if(BX("sonet_log_counter_2")){e=parseInt(e);var t=parseInt(BX("sonet_log_counter_2").innerHTML);var n=t-e;if(n>0)BX("sonet_log_counter_2").innerHTML=n;else __logChangeCounterAnimate(false,0)}}function __logChangeCounterAnimate(e,t,n){var o=null,i=null;if(BX("sonet_log_counter_2_container")){o=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text"},false);i=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text-reload"},false)}n=!!n;if(oLF.bLockCounterAnimate){setTimeout(function(){__logChangeCounterAnimate(e,t)},200);return false}e=!!e;if(e){if(BX("sonet_log_counter_2")){BX("sonet_log_counter_2").innerHTML=t}if(BX("sonet_log_counter_2_wrap")){BX("sonet_log_counter_2_wrap").style.visibility="visible";BX.addClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim")}if(BX("sonet_log_counter_2_plus")&&i&&i.style.display!="none"&&o){i.style.display="none";o.style.display="inline-block";BX.removeClass(BX("sonet_log_counter_2_plus"),"feed-new-message-informer-counter-plus-hidden")}}else if(BX("sonet_log_counter_2_wrap")){if(n&&BX.hasClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim")){if(o&&i){o.style.display="none";i.style.display="inline-block";var s=BX.findChild(o,{tag:"span",className:"feed-new-message-icon"},false);if(s){BX.removeClass(s,"new-message-balloon-icon-rotating")}}}else setTimeout(function(){BX.removeClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim");BX("sonet_log_counter_2_wrap").style.visibility="hidden"},400)}}function __logChangeCounterArray(e){if(typeof e[BX.message("sonetLCounterType")]!="undefined")__logChangeCounter(e[BX.message("sonetLCounterType")])}function __logShowPostMenu(e,t,n,o,i,s,a,r,l,d){BX.PopupMenu.destroy("post-menu-"+t);var f=null;if(BX.message("sonetLbUseFavorites")!="N"){f={text:l?BX.message("sonetLMenuFavoritesTitleY"):BX.message("sonetLMenuFavoritesTitleN"),className:"menu-popup-no-icon",onclick:function(e){__logChangeFavorites(r,"log_entry_favorites_"+r,l?"N":"Y",true);return BX.PreventDefault(e)}}}var c=[e.getAttribute("data-log-entry-url").length>0?{text:'<span id="post-menu-'+t+'-href-text">'+BX.message("sonetLMenuHref")+"</span>",className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-href",href:e.getAttribute("data-log-entry-url")}:null,e.getAttribute("data-log-entry-url").length>0?{text:'<span id="post-menu-'+t+'-link-text">'+BX.message("sonetLMenuLink")+"</span>"+'<span id="post-menu-'+t+'-link-icon-animate" class="post-menu-link-icon-wrap">'+'<span class="post-menu-link-icon" id="post-menu-'+t+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-link",onclick:function(){var n="post-menu-"+t+"-link",o=BX(n+"-text"),i=BX(n+"-icon-done");if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(e.getAttribute("data-log-entry-url"));if(o&&i){i.style.display="inline-block";BX.removeClass(BX(n+"-icon-animate"),"post-menu-link-icon-animate");BX.adjust(BX(n+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(n+"-icon-animate"),"post-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(BX(n+"-text"),{attrs:{"data-block-click":"N"}})},500)}return}var s=BX.proxy_context,a=parseInt(!!s.getAttribute("bx-height")?s.getAttribute("bx-height"):s.offsetHeight);if(s.getAttribute("bx-status")!="shown"){s.setAttribute("bx-status","shown");if(!BX(n)&&!!BX(n+"-text")){var r=BX(n+"-text"),l=BX.pos(r),d=BX.pos(r.parentNode);pos3=BX.pos(BX.findParent(r,{className:"menu-popup-item"},true));l["height"]=d["height"]-1;BX.adjust(s,{attrs:{"bx-height":s.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:n},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:n+"-input",type:"text",value:e.getAttribute("data-log-entry-url")},style:{height:l["height"]+"px",width:pos3["width"]-21+"px"},events:{click:function(e){this.select();BX.PreventDefault(e)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:a,finish:a*2,callback:BX.delegate(function(e){this.style.height=e+"px"},s)}).start();BX.fx.show(BX(n),.2);BX(n+"-input").select()}else{s.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:s.offsetHeight,finish:a,callback:BX.delegate(function(e){this.style.height=e+"px"},s)}).start();BX.fx.hide(BX(n),.2)}}}:null,f,BX.message("sonetLCanDelete")=="Y"?{text:BX.message("sonetLMenuDelete"),className:"menu-popup-no-icon",onclick:function(e){if(confirm(BX.message("sonetLMenuDeleteConfirm"))){__logDelete(r,"log-entry-"+r,t)}return BX.PreventDefault(e)}}:null,e.getAttribute("data-log-entry-createtask")=="Y"?{text:BX.message("sonetLMenuCreateTask"),className:"menu-popup-no-icon",onclick:function(t){oLF.createTask({entryEntityType:e.getAttribute("data-log-entry-entity-type"),entityType:e.getAttribute("data-log-entry-entity-type"),entityId:e.getAttribute("data-log-entry-entity-id")});this.popupWindow.close();return t.preventDefault()}}:null];if(!!d&&BX.type.isArray(d)){for(var p=0;p<d.length;p++)if(typeof d[p].className=="undefined")d[p].className="menu-popup-no-icon";c=BX.util.array_merge(c,d)}var u={offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupShow:function(e){if(BX("log_entry_favorites_"+r)){var n=BX.findChildren(e.contentContainer,{className:"menu-popup-item-text"},true);if(n!=null){for(var o=0;o<n.length;o++){if(n[o].innerHTML==BX.message("sonetLMenuFavoritesTitleY")||n[o].innerHTML==BX.message("sonetLMenuFavoritesTitleN")){var i=n[o];break}}}if(i!=undefined){if(BX.hasClass(BX("log_entry_favorites_"+r),"feed-post-important-switch-active"))BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleY");else BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleN")}}if(BX("post-menu-"+t+"-link")){var s=BX.findChild(e.popupContainer,{className:"feed-entry-popup-menu-link"},true,false);if(s){var a=parseInt(!!s.getAttribute("bx-height")?s.getAttribute("bx-height"):0);if(a>0){BX("post-menu-"+t+"-link").style.display="none";s.setAttribute("bx-status","hidden");s.style.height=a+"px"}}}}}};BX.PopupMenu.show("post-menu-"+t,e,c,u)}function __logGetNextPageLinkEntities(e,t){if(!!window.__logGetNextPageFormName&&!!e&&!!t&&!!window["UC"]&&!!window["UC"][window.__logGetNextPageFormName]&&!!window["UC"][window.__logGetNextPageFormName].linkEntity){window["UC"][window.__logGetNextPageFormName].linkEntity(e);for(var n in t){if(!!n&&!!t[n])window["UC"][window.__logGetNextPageFormName]["entitiesCorrespondence"][n]=t[n]}}}function __logChangeFavorites(e,t,n,o){if(!e||!BX(t)){return}if(!!o){var i=BX.proxy_context;if(!BX.hasClass(BX(i),"menu-popup-item-text")){i=BX.findChild(BX(i),{className:"menu-popup-item-text"},true)}}var s=BX.hasClass(BX(t),"feed-post-important-switch")?BX(t):BX.findChild(BX(t),{className:"feed-post-important-switch"});if(n!=undefined){if(n=="Y"){BX.addClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleY");if(typeof i!="undefined"){BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleY")}}else{BX.removeClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleN");if(typeof i!="undefined"){BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleN")}}}var a=new XMLHttpRequest;a.open("POST",BX.message("sonetLESetPath"),true);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){var e=LBlock.DataParser(a.responseText);if(typeof e=="object"){if(e[0]=="*"){if(sonetLErrorDiv!=null){sonetLErrorDiv.style.display="block";sonetLErrorDiv.innerHTML=a.responseText}return}a.abort();var t="";if(e["bResult"]!=undefined&&(e["bResult"]=="Y"||e["bResult"]=="N")){if(e["bResult"]=="Y"){BX.addClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleY");if(i!=undefined)BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleY")}else{BX.removeClass(BX(s),"feed-post-important-switch-active");BX(s).title=BX.message("sonetLMenuFavoritesTitleN");if(i!=undefined)BX(i).innerHTML=BX.message("sonetLMenuFavoritesTitleN")}}}}else{}}};a.send("r="+Math.floor(Math.random()*1e3)+"&"+BX.message("sonetLSessid")+"&site="+BX.util.urlencode(BX.message("sonetLSiteId"))+"&log_id="+encodeURIComponent(e)+"&action=change_favorites")}function __logDelete(e,t,n){if(!e){return}if(!BX(t)){return}BX.ajax({url:BX.message("sonetLESetPath"),method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),site:BX.message("sonetLSiteId"),log_id:e,action:"delete"},onsuccess:function(e){if(e.bResult!=undefined&&e.bResult=="Y"){if(typeof n!="undefined"){BX.PopupMenu.destroy("post-menu-"+n)}__logDeleteSuccess(BX(t))}else{__logDeleteFailure(BX(t))}},onfailure:function(e){__logDeleteFailure(BX(t))}})}function __logDeleteSuccess(e){if(typeof e=="undefined"||!e||!BX(e)){return}new BX.fx({time:.5,step:.05,type:"linear",start:BX(e).offsetHeight,finish:56,callback:BX.delegate(function(e){this.style.height=e+"px"},BX(e)),callback_start:BX.delegate(function(){this.style.overflow="hidden";this.style.minHeight=0},BX(e)),callback_complete:BX.delegate(function(){this.style.marginBottom=0;BX.cleanNode(this);BX.addClass(this,"feed-post-block-deleted");this.appendChild(BX.create("DIV",{props:{className:"feed-add-successfully"},children:[BX.create("span",{props:{className:"feed-add-info-text"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{html:BX.message("sonetLMenuDeleteSuccess")})]})]}))},BX(e))}).start()}function __logDeleteFailure(e){if(typeof e=="undefined"||!e||!BX(e)){return}e.insertBefore(BX.create("DIV",{props:{className:"feed-add-error"},style:{marginLeft:"84px",marginRight:"37px",marginTop:"18px",marginBottom:"4px"},children:[BX.create("span",{props:{className:"feed-add-info-text"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{html:BX.message("sonetLMenuDeleteFailure")})]})]}),e.firstChild)}window.__socOnUCFormClear=function(e){LHEPostForm.reinitDataBefore(e.editorId)};window.__socOnUCFormAfterShow=function(e,t,n){n=!!n?n:{};var o=e.entitiesCorrespondence[e.id.join("-")][0],i=e.entitiesCorrespondence[e.id.join("-")][1];BX.show(BX("feed_comments_block_"+o));BX.onCustomEvent(window,"OnBeforeSocialnetworkCommentShowedUp",["socialnetwork"]);e.form.action=e.url.replace(/\#eId\#/,o).replace(/\#id\#/,i);var s={ENTITY_XML_ID:e.id[0],ENTITY_TYPE:e.entitiesId[e.id[0]][0],ENTITY_ID:e.entitiesId[e.id[0]][1],parentId:e.id[1],comment_post_id:e.entitiesId[e.id[0]][1],edit_id:e.id[1],act:e.id[1]>0?"edit":"add",logId:e.entitiesId[e.id[0]][2]};for(var a in s){if(!e.form[a]){e.form.appendChild(BX.create("INPUT",{attrs:{name:a,type:"hidden"}}))}e.form[a].value=s[a]}__socOnLightEditorShow(t,n)};window.__socOnUCFormSubmit=function(e,t){t["r"]=Math.floor(Math.random()*1e3);t["sessid"]=BX.bitrix_sessid();t["log_id"]=e.entitiesCorrespondence[e.id.join("-")][0];t["p_smile"]=BX.message("sonetLPathToSmile");t["p_ubp"]=BX.message("sonetLPathToUserBlogPost");t["p_gbp"]=BX.message("sonetLPathToGroupBlogPost");t["p_umbp"]=BX.message("sonetLPathToUserMicroblogPost");t["p_gmbp"]=BX.message("sonetLPathToGroupMicroblogPost");t["p_user"]=BX.message("sonetLPathToUser");t["p_le"]=BX.message("sonetLEPath");t["f_id"]=BX.message("sonetLForumID");t["bapc"]=BX.message("sonetLBlogAllowPostCode");t["site"]=BX.message("sonetLSiteId");t["lang"]=BX.message("sonetLLangId");t["nt"]=BX.message("sonetLNameTemplate");t["sl"]=BX.message("sonetLShowLogin");t["as"]=BX.message("sonetLAvatarSizeComment");t["dtf"]=BX.message("sonetLDateTimeFormat");t["message"]=t["REVIEW_TEXT"];t["action"]="add_comment";t["RATING_TYPE"]=BX.message("sonetRatingType");t["pull"]="Y";t["crm"]=BX.message("sonetLIsCRM");e.form["bx-action"]=e.form.action;e.form.action=BX.message("sonetLESetPath")};window.__socOnUCFormResponse=function(e,t){e.form.action=e.form["bx-action"];var n={errorMessage:t},o=e.entitiesCorrespondence[e.id.join("-")][0],i={};if(!(!!t&&typeof t=="object")){}else if(t[0]=="*"){n={errorMessage:BX.message("sonetLErrorSessid")}}else if(t["status"]=="error")n["errorMessage"]=t["message"];else{if(!(t["commentID"]>0)||!!t["strMessage"]){n["errorMessage"]=t["strMessage"]}else if(t["return_data"]){n=t["return_data"]}else{var s=t["arCommentFormatted"],a=t["arComment"],r=!!window["__logBuildRating"]?window["__logBuildRating"](t["arComment"],t["arCommentFormatted"]):null,l=!!a["SOURCE_ID"]?a["SOURCE_ID"]:a["ID"];i={ID:l,ENTITY_XML_ID:e.id[0],FULL_ID:[e.id[0],l],NEW:"N",APPROVED:"Y",POST_TIMESTAMP:t["timestamp"]-BX.message("USER_TZ_OFFSET"),POST_TIME:s["LOG_TIME_FORMAT"],POST_DATE:s["LOG_TIME_FORMAT"],"~POST_MESSAGE_TEXT":s["MESSAGE"],POST_MESSAGE_TEXT:s["MESSAGE_FORMAT"],PANELS:{MODERATE:false},URL:{LINK:typeof a["URL"]!="undefined"&&a["URL"]!=null&&a["URL"].length>0?a["URL"]:BX.message("sonetLEPath").replace("#log_id#",a["LOG_ID"])+"?commentId="+a["ID"]+"#com"+(parseInt(a["SOURCE_ID"])>0?a["SOURCE_ID"]:a["ID"])},AUTHOR:{ID:s["USER_ID"],NAME:s["CREATED_BY"]["FORMATTED"],URL:s["CREATED_BY"]["URL"],AVATAR:s["AVATAR_SRC"]},BEFORE_ACTIONS:!!r?r:"",AFTER:s["UF"]};if(typeof t["hasEditCallback"]!="undefined"&&t["hasEditCallback"]=="Y"){i["PANELS"]["EDIT"]="Y";i["URL"]["EDIT"]="__logEditComment('"+e.id[0]+"', '"+a["ID"]+"', '"+a["LOG_ID"]+"');"}if(typeof t["hasDeleteCallback"]!="undefined"&&t["hasDeleteCallback"]=="Y"){i["PANELS"]["DELETE"]="Y";i["URL"]["DELETE"]=BX.message("sonetLESetPath")+"?lang="+BX.message("sonetLLangId")+"&action=delete_comment&delete_comment_id="+a["ID"]+"&post_id="+a["LOG_ID"]+"&site="+BX.message("sonetLSiteId")}n={errorMessage:"",okMessage:"",status:true,message:"",messageCode:s["MESSAGE"],messageId:[e.id[0],l],"~message":"",messageFields:i}}var d=BX("log_entry_follow_"+o,true),f=!!d?d.getAttribute("data-follow")=="Y"?"Y":"N":false;if(f=="N"){BX.findChild(d,{tagName:"a"}).innerHTML=BX.message("sonetLFollowY");d.setAttribute("data-follow","Y")}d=BX("feed-comments-all-cnt-"+o,true),val=!!d?d.innerHTML.length>0?parseInt(d.innerHTML):0:false;if(val!==false)d.innerHTML=val+1}e.OnUCFormResponseData=n};window.__socOnLightEditorShow=function(e,t){var n={};if(t["arFiles"]){var o={},i,s;for(var a=0;a<t["arFiles"].length;a++){i=BX.findChild(BX("wdif-doc-"+t["arFiles"][a]),{className:"feed-com-file-name"},true);s=BX.findChild(BX("wdif-doc-"+t["arFiles"][a]),{className:"feed-con-file-size"},true);o["F"+a]={FILE_ID:t["arFiles"][a],FILE_NAME:i?i.innerHTML:"noname",FILE_SIZE:s?s.innerHTML:"unknown",CONTENT_TYPE:"notimage/xyz"}}n["UF_SONET_COM_DOC"]={USER_TYPE_ID:"file",FIELD_NAME:"UF_SONET_COM_FILE[]",VALUE:o}}if(t["arDocs"])n["UF_SONET_COM_FILE"]={USER_TYPE_ID:"webdav_element",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:BX.clone(t["arDocs"])};if(t["arDFiles"])n["UF_SONET_COM_FILE"]={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:BX.clone(t["arDFiles"])};LHEPostForm.reinitData(SLEC.editorId,e,n)};BitrixLF=function(){this.bLoadStarted=null;this.nextURL=null;this.scrollInitialized=null;this.bStopTrackNextPage=null;this.bLockCounterAnimate=null;this.arMoreButtonID=null;this.logAjaxMode=null;this.nodeTmp1Cap=null;this.nodeTmp2Cap=null;this.cmdPressed=null;this.nextPageFirst=null;this.firstPageLastTS=0;this.firstPageLastId=0;this.filterId=null;this.filterApi=null;this.tagEntryIdList=[];this.inlineTagNodeList=[]};BitrixLF.prototype.initOnce=function(e){var t=BX("feed-loader-container");if(t){BX.bind(t,"animationend",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"webkitAnimationEnd",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"oanimationend",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"MSAnimationEnd",BX.proxy(this._onAnimationEnd,this))}BX.addCustomEvent("BX.Livefeed.Filter:beforeApply",BX.delegate(function(e,t){this.showRefreshFade()},this));BX.addCustomEvent("BX.Livefeed.Filter:apply",BX.delegate(function(e,t,n){if(typeof n!="undefined"){n.autoResolve=false}this.refresh({useBXMainFilter:"Y"},t)},this));BX.addCustomEvent("BX.Livefeed.Filter:searchInput",BX.delegate(function(e){if(typeof e!="undefined"&&BX.util.trim(e).length>0){this.showRefreshFade()}else{this.hideRefreshFade()}},this));BX.addCustomEvent(window,"OnUCCommentWasPulled",function(e,t){setTimeout(function(){var t=BX("record-"+e[0]+"-"+ +e[1]);if(t){bodyBlock=BX.findChild(t,{className:"feed-com-text-inner-inner"},true);if(bodyBlock){oLF.recalcMoreButtonComment({bodyBlock:bodyBlock,moreButtonBlock:BX.findChild(t,{className:"feed-post-text-more"},true)})}}},1e3)});BX.addCustomEvent(window,"OnUCListWasBuilt",function(e,t,n){oLF.recalcMoreButtonCommentsList()});if(typeof e!="undefined"&&typeof e.crmEntityTypeName!="undefined"&&e.crmEntityTypeName.length>0&&typeof e.crmEntityId!="undefined"&&parseInt(e.crmEntityId)>0){BX.addCustomEvent("onAfterActivitySave",BX.delegate(function(){this.refresh({sessid:BX.bitrix_sessid(),PARAMS:{ENTITY_TYPE_NAME:e.crmEntityTypeName,ENTITY_ID:parseInt(e.crmEntityId)}})},this))}if(typeof e!="undefined"&&typeof e.filterId!="undefined"&&typeof BX.Main!="undefined"&&typeof BX.Main.filterManager!="undefined"){var n=BX.Main.filterManager.getById(e.filterId);this.filterId=e.filterId;if(n){this.filterApi=n.getApi()}}BX.UserContentView.init();BX("log_internal_container").addEventListener("click",BX.delegate(function(e){var t=BX.getEventTarget(e).getAttribute("bx-tag-value");if(BX.type.isNotEmptyString(t)){if(this.clickTag(t)){e.preventDefault()}}},this),true)};BitrixLF.prototype.init=function(e){this.bLoadStarted=false;this.nextURL=false;this.scrollInitialized=false;this.bStopTrackNextPage=false;this.bLockCounterAnimate=false;this.arMoreButtonID=[];this.logAjaxMode=false;this.nodeTmp1Cap=false;this.nodeTmp2Cap=false;this.cmdPressed=false;this.nextPageFirst=true;if(typeof e!="undefined"){this.firstPageLastTS=typeof e.firstPageLastTS!="undefined"?e.firstPageLastTS:0;this.firstPageLastId=typeof e.firstPageLastId!="undefined"?e.firstPageLastId:0;this.refreshUrl=typeof e.refreshUrl!="undefined"?e.refreshUrl:top.location.href}};BitrixLF.prototype.initScroll=function(){if(this.scrollInitialized){return}this.scrollInitialized=true;BX.bind(window,"scroll",BX.throttle(BX.delegate(this.onFeedScroll,this),100))};BitrixLF.prototype.onFeedScroll=function(){var e=BX.GetWindowSize();if(this.bStopTrackNextPage==false){var t=e.scrollHeight-e.innerHeight-500;if(e.scrollTop>=t&&oLF.nextURL){this.bStopTrackNextPage=true;this.getNextPage()}}var n=BX("sonet_log_counter_2_wrap",true);var o=BX("sonet_log_counter_2_container");if(n&&o){var i=n.parentNode.getBoundingClientRect().top;var s=o.getBoundingClientRect();if(i<=0){if(!BX.hasClass(n,"feed-new-message-informer-fixed")){o.style.left=s.left+s.width/2+"px"}BX.addClass(n,"feed-new-message-informer-fixed feed-new-message-informer-fix-anim")}else{BX.removeClass(n,"feed-new-message-informer-fixed feed-new-message-informer-fix-anim");o.style.left="auto"}}};BitrixLF.prototype.onFeedKeyDown=function(e){if(e==null){e=window.event}if(BX.util.in_array(e.keyCode,[224,91,93])){this.cmdPressed=true}};BitrixLF.prototype.onFeedKeyUp=function(e){if(e==null){e=window.event}if(BX.util.in_array(e.keyCode,[224,91,93])){this.cmdPressed=false}else if(e.keyCode==35||this.cmdPressed&&e.keyCode==39){this.bStopTrackNextPage=true;this.getNextPage()}};BitrixLF.prototype.getNextPage=function(){var e=BX("feed-new-message-inf-wrap");if(this.bLoadStarted){return false}this.bLoadStarted=true;this.bLockCounterAnimate=true;arCommentsMoreButtonID=[];this.arMoreButtonID=[];if(!this.nextPageFirst&&e){e.style.display="block"}var t={method:"GET",url:this.nextURL};BX.onCustomEvent("SonetLogBeforeGetNextPage",[t]);if(BX.type.isNotEmptyString(t.url)){more_url=t.url}BX.ajax({url:more_url,method:"GET",dataType:"json",data:{},onsuccess:function(t){oLF.bLoadStarted=false;if(e){BX.cleanNode(e,true)}oLF.bLockCounterAnimate=false;if(t&&typeof t.PROPS!="undefined"&&typeof t.PROPS.CONTENT!="undefined"&&t.PROPS.CONTENT.length>0&&(typeof t.LAST_TS=="undefined"||parseInt(t.LAST_TS)<=0||parseInt(oLF.firstPageLastTS)<=0||parseInt(t.LAST_TS)<parseInt(oLF.firstPageLastTS)||parseInt(t.LAST_TS)==parseInt(oLF.firstPageLastTS)&&typeof t.LAST_ID!="undefined"&&parseInt(t.LAST_ID)<parseInt(oLF.firstPageLastId))){var n="content_block_"+Math.floor(Math.random()*1e3);oLF.processAjaxBlock(t.PROPS,n,oLF.nextPageFirst);oLF.clearContainerExternal(false);if(oLF.nextPageFirst){BX("feed-new-message-inf-wrap-first").style.display="block";var o=function(){oLF.bStopTrackNextPage=false;if(BX(n)){BX(n).style.display="block"}BX.unbind(BX("sonet_log_more_container_first"),"click",o);BX("feed-new-message-inf-wrap-first").style.display="none";oLF.recalcMoreButton();oLF.registerViewAreaList()};BX.bind(BX("sonet_log_more_container_first"),"click",o)}else{if(BX(n)){BX(n).style.display="block"}setTimeout(function(){oLF.bStopTrackNextPage=false},300);setTimeout(function(){oLF.recalcMoreButton();oLF.registerViewAreaList()},1e3)}oLF.nextPageFirst=false}},onfailure:function(t){oLF.bLoadStarted=false;oLF.bStopTrackNextPage=false;if(e){e.style.display="none"}oLF.bLockCounterAnimate=false;oLF.clearContainerExternal(false)}});return false};BitrixLF.prototype.refresh=function(e,t){if(this.bLoadStarted){return}var n=BX("sonet_log_counter_2_wrap",true);var o=this.refreshUrl;this.bLoadStarted=true;this.showRefreshFade();arCommentsMoreButtonID=[];this.arMoreButtonID=[];if(typeof e=="undefined"||typeof e.useBXMainFilter=="undefined"||e.useBXMainFilter!="Y"){BX.onCustomEvent(window,"BX.Livefeed:refresh",[])}if(typeof e!="undefined"){e=BX.ajax.prepareData(e);if(e){o+=(o.indexOf("?")!==-1?"&":"?")+e}}if(n){var i=BX.findChild(n,{tag:"span",className:"feed-new-message-inf-text-reload"},true);if(i){i.style.display="none"}}this.bLockCounterAnimate=true;oLF.bLoadStarted=false;BX.ajax({url:o,method:"GET",dataType:"json",onsuccess:function(e){oLF.bLoadStarted=false;oLF.hideRefreshFade();if(e&&typeof e.PROPS!="undefined"){if(t){t.fulfill()}var o=null;if(typeof e.PROPS.EMPTY!="undefined"&&e.PROPS.EMPTY=="Y"&&BX("feed-empty-wrap")){o=BX("feed-empty-wrap")}var i=null;if(BX("feed-loader-container")){i=BX("feed-loader-container")}oLF.bLockCounterAnimate=false;BX.cleanNode("log_internal_container",false);if(o){BX("log_internal_container").appendChild(BX.create("DIV",{props:{className:"feed-wrap"},children:[o]}));o.style.display="block";var s=BX.findChild(o,{className:"feed-wrap-empty"});if(s){s.innerHTML=BX.message("SONET_C30_T_EMPTY_SEARCH")}}if(i){BX("log_internal_container").appendChild(i)}if(typeof e.PROPS.CONTENT!="undefined"&&e.PROPS.CONTENT.length>0){oLF.clearContainerExternal(false);oLF.processAjaxBlock(e.PROPS);setTimeout(BX.proxy(oLF.recalcMoreButton,oLF),1);oLF.registerViewAreaList();oLF.bStopTrackNextPage=false;if(typeof arCommentsMoreButtonID!="undefined"){arCommentsMoreButtonID=[]}if(n&&BX.hasClass(n,"feed-new-message-informer-fixed")){var a=BX("feed-up-btn-wrap",true);if(a){a.style.display="none";BX.removeClass(a,"feed-up-btn-wrap-anim")}var r=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:r.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){if(a)a.style.display="block";BX.onCustomEvent(window,"onGoUp")}}).animate()}}}else{if(t){t.reject()}oLF.showRefreshError()}},onfailure:function(e){oLF.bLoadStarted=false;if(t){t.reject()}oLF.hideRefreshFade();oLF.showRefreshError()}});return false};BitrixLF.prototype.showRefreshFade=function(){if(!BX.hasClass(BX("log_internal_container"),"log-internal-mask")){BX.addClass(BX("log_internal_container"),"log-internal-mask");BX.removeClass(BX("log_internal_container"),"log-internal-nomask");var e=BX("feed-loader-container");if(e){BX.style(e,"display","block");BX.removeClass(e,"livefeed-hide-loader");setTimeout(function(){BX.addClass(e,"livefeed-show-loader")},0)}}};BitrixLF.prototype.hideRefreshFade=function(){BX.removeClass(BX("log_internal_container"),"log-internal-mask");BX.addClass(BX("log_internal_container"),"log-internal-nomask");var e=BX("feed-loader-container");if(e){BX.removeClass(e,"livefeed-show-loader");BX.addClass(e,"livefeed-hide-loader")}};BitrixLF.prototype._onAnimationEnd=function(e){if("animationName"in e&&e.animationName&&e.animationName==="hideLoader"){var t=BX("feed-loader-container");BX.removeClass(t,"livefeed-show-loader");BX.removeClass(t,"livefeed-hide-loader");BX.style(t,"display","")}};BitrixLF.prototype.recalcMoreButton=function(){var e=null,t=null;if(typeof this.arMoreButtonID!="undefined"&&this.arMoreButtonID.length>0){var n=false;var o=false;var i=false;for(e=0;e<this.arMoreButtonID.length;e++){t=BX.pos(BX(this.arMoreButtonID[e].bodyBlockID));if(typeof this.arMoreButtonID[e].outerBlockID!="undefined"){o=BX(this.arMoreButtonID[e].outerBlockID);if(o){n=BX.pos(o);if(n.width<t.width){i=BX.findChild(o,{tag:"div",className:"feed-post-text-block-inner"},false);i.style.overflowX="scroll"}}}this.recalcMoreButtonPost({arPos:t,moreButtonBlock:BX(this.arMoreButtonID[e].moreButtonBlockID),informerBlock:typeof this.arMoreButtonID[e].informerBlockID!="undefined"?BX(this.arMoreButtonID[e].informerBlockID):null});delete this.arMoreButtonID[e]}}this.recalcMoreButtonCommentsList();if(BX("log_internal_container")){var s=BX.findChildren(BX("log_internal_container"),{attr:{"data-bx-onload":"Y"}},true);if(s!=null){for(e=0;e<s.length;e++){s[e].addEventListener("load",BX.proxy(function(e){var t=null,n=BX.findParent(e.currentTarget,{className:"feed-com-text"},BX("log_internal_container"));if(n){t=BX.findChild(n,{className:"feed-com-text-inner-inner"},true);if(t){this.recalcMoreButtonComment({bodyBlock:t,moreButtonBlock:BX.findChild(n,{className:"feed-post-text-more"},true)})}}else{n=BX.findParent(e.currentTarget,{className:"feed-post-block"},BX("log_internal_container"));if(n){t=BX.findChild(n,{className:"feed-post-text-block-inner-inner"},true);if(t){this.recalcMoreButtonPost({bodyBlock:t,moreButtonBlock:BX.findChild(n,{className:"feed-post-text-more"},true),informerBlock:BX.findChild(n,{className:"feed-post-text-more"},true)})}}}e.currentTarget.setAttribute("data-bx-onload","N")},this))}}}};BitrixLF.prototype.recalcMoreButtonPost=function(e){var t=typeof e.arPos!="undefined"?e.arPos:BX.pos(e.bodyBlock);var n=BX.findParent(BX(e.informerBlock),{className:"feed-post-block"},BX("log_internal_container"));if(!n){return}if(t.height<=284){BX.addClass(n,"feed-post-block-short");BX.addClass(n,"feed-post-block-separator")}};BitrixLF.prototype.recalcMoreButtonCommentsList=function(){if(typeof arCommentsMoreButtonID!="undefined"){for(i in arCommentsMoreButtonID){arPos=BX.pos(BX(arCommentsMoreButtonID[i].bodyBlockID));this.recalcMoreButtonComment({arPos:arPos,moreButtonBlock:typeof arCommentsMoreButtonID[i].moreButtonBlockID!="undefined"?BX(arCommentsMoreButtonID[i].moreButtonBlockID):null});delete arCommentsMoreButtonID[i]}}};BitrixLF.prototype.recalcMoreButtonComment=function(e){var t=typeof e.arPos!="undefined"?e.arPos:BX.pos(e.bodyBlock);if(t.height<200){if(e.moreButtonBlock){e.moreButtonBlock.style.display="none"}}else{if(e.moreButtonBlock&&e.moreButtonBlock.style.display=="none"){e.moreButtonBlock.style.display="block"}}};BitrixLF.prototype.showRefreshError=function(){this.bLockCounterAnimate=false;this.clearContainerExternal(false)};BitrixLF.prototype.LazyLoadCheckVisibility=function(e){var t=e.node;var n="comment";var o=BX.findParent(t,{className:"feed-com-text"});if(!o){n="post";o=BX.findParent(t,{className:"feed-post-text-block"})}if(o){var i=BX.findChild(o,{tag:"div",className:"feed-post-text-more"},false);if(i&&i.style.display!="none"){return t.parentNode.parentNode.offsetTop<(n=="comment"?220:270)}}return true};BitrixLF.prototype.processAjaxBlock=function(e,t,n){if(!e){return}if(!t){t="content_block_"+Math.floor(Math.random()*1e3)}n=!!n;var o=false;var i=false;s(a);r(l);function s(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function a(){BX("log_internal_container").appendChild(BX.create("DIV",{props:{id:t,className:"feed-wrap"},style:{display:n?"none":"block"},html:e.CONTENT}));o=true;if(i){l()}}function r(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function l(){i=true;if(o){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML"})}}};BitrixLF.prototype.clearContainerExternal=function(e){var t=null,n=null,o=null;if(BX("sonet_log_more_container")){t=BX.findChild(BX("sonet_log_more_container"),{tag:"span",className:"feed-new-message-inf-text"},false);if(t){t.style.display="inline-block";n=BX.findChild(t,{tag:"span",className:"feed-new-message-icon"},false);if(n){BX.removeClass(n,"new-message-balloon-icon-rotating")}}}if(BX("sonet_log_counter_2_wrap")){BX.removeClass(BX("sonet_log_counter_2_wrap"),"feed-new-message-informer-anim");BX("sonet_log_counter_2_wrap").style.visibility="hidden"}if(BX("sonet_log_counter_2_container")){t=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text"},false);o=BX.findChild(BX("sonet_log_counter_2_container"),{tag:"span",className:"feed-new-message-inf-text-reload"},false);if(t&&o){t.style.display="inline-block";o.style.display="none";n=BX.findChild(t,{tag:"span",className:"feed-new-message-icon"},false);if(n){BX.removeClass(n,"new-message-balloon-icon-rotating")}if(BX("sonet_log_counter_2_plus")){BX.addClass(BX("sonet_log_counter_2_plus"),"feed-new-message-informer-counter-plus-hidden")}}}if(this.nodeTmp1Cap&&this.nodeTmp1Cap.parentNode){this.nodeTmp1Cap.parentNode.removeChild(this.nodeTmp1Cap)}if(this.nodeTmp2Cap&&this.nodeTmp2Cap.parentNode){this.nodeTmp2Cap.parentNode.removeChild(this.nodeTmp2Cap)}if(BX("sonet_log_counter_preset")&&this.logAjaxMode=="new"){BX("sonet_log_counter_preset").style.display="none"}};BitrixLF.prototype.clearContainerExternalNew=function(){this.logAjaxMode="new"};BitrixLF.prototype.clearContainerExternalMore=function(){this.logAjaxMode="more"};BitrixLF.prototype.createTask=function(e){this.createTaskPopup=new BX.PopupWindow("BXCTP",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:false,lightShadow:true,closeIcon:{right:"12px",top:"10px"},draggable:{restrict:true},closeByEsc:false,contentColor:"white",contentNoPaddings:true,buttons:[],content:BX.create("DIV",{attrs:{id:"BXCTP_content"},props:{className:"feed-create-task-popup-content"}}),events:{onAfterPopupShow:BX.proxy(function(){oLF.createTaskSetContent(BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_WAIT")}));BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.log.ex/ajax.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),ENTITY_TYPE:e.entityType,ENTITY_ID:e.entityId,action:"get_raw_data",params:{getSonetGroupAvailableList:true,getLivefeedUrl:true,checkParams:{feature:"tasks",operation:"create_tasks"}}},onsuccess:BX.proxy(function(t){if(t&&typeof t.TITLE!="undefined"&&typeof t.DESCRIPTION!="undefined"&&typeof t.DISK_OBJECTS!="undefined"&&typeof t.LIVEFEED_URL!="undefined"&&(BX.type.isNotEmptyString(t.TITLE)||BX.type.isNotEmptyString(t.DESCRIPTION))&&BX.type.isNotEmptyString(t.LIVEFEED_URL)){var n=oLF.formatTaskDescription(t.DESCRIPTION,t.LIVEFEED_URL,e.entityType,BX.type.isNotEmptyString(t.SUFFIX)?t.SUFFIX:"");var o={TITLE:t.TITLE,DESCRIPTION:n,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:t.DISK_OBJECTS};var i=[];if(typeof t.GROUPS_AVAILABLE!="undefined"){for(var s in t.GROUPS_AVAILABLE){if(t.GROUPS_AVAILABLE.hasOwnProperty(s)){i.push(t.GROUPS_AVAILABLE[s])}}}if(i.length==1){o.GROUP_ID=parseInt(i[0])}BX.Tasks.Util.Query.runOnce("task.add",{data:o}).then(BX.proxy(function(t){var n=t.getData();if(typeof n!="undefined"&&typeof n.DATA!="undefined"&&typeof n.DATA.ID!="undefined"&&parseInt(n.DATA.ID)>0){oLF.createTaskSetContentSuccess(n.DATA.ID);BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.log.ex/ajax.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),POST_ENTITY_TYPE:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,ENTITY_TYPE:e.entityType,ENTITY_ID:e.entityId,TASK_ID:n.DATA.ID,action:"create_task_comment",site:BX.message("SITE_ID")}})}else{oLF.createTaskSetContentFailure(t.getErrors().getMessages())}},this))}else{oLF.createTaskSetContentFailure([BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_ERROR_GET_DATA")])}},this),onfailure:function(e){oLF.createTaskSetContentFailure([BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_ERROR_GET_DATA")])}})},this),onPopupClose:BX.proxy(function(){this.createTaskPopup.destroy()},this)}});this.createTaskPopup.params.zIndex=BX.WindowManager?BX.WindowManager.GetZIndex():0;this.createTaskPopup.show()};BitrixLF.prototype.createTaskSetContentSuccess=function(e){var t=this;var n=BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_PATH").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",e);this.createTaskPopup.destroy();window.top.BX.UI.Notification.Center.notify({content:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_SUCCESS_TITLE"),actions:[{title:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_VIEW"),events:{click:function(e,t,o){t.close();window.top.BX.SidePanel.Instance.open(n)}}}]})};BitrixLF.prototype.createTaskSetContentFailure=function(e){oLF.createTaskSetContent(BX.create("DIV",{children:[BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_FAILURE_TITLE")}),BX.create("DIV",{props:{className:"feed-create-task-popup-description"},html:e.join("<br>")})]}))};BitrixLF.prototype.createTaskSetContent=function(e){if(BX("BXCTP_content")){var t=BX("BXCTP_content");BX.cleanNode(t);t.appendChild(e)}};BitrixLF.prototype.formatTaskDescription=function(e,t,n,o){var i=e;o=BX.type.isNotEmptyString(o)?"_"+o:"";if(!!t&&!!n&&t.length>0){i+="\n\n"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+n+o).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return i};BitrixLF.prototype.registerViewAreaList=function(){var e=BX("log_internal_container"),t=null;if(e){var n=BX.findChildren(e,{tag:"div",className:"feed-post-contentview"},true);for(var o=0,i=n.length;o<i;o++){if(n[o].id.length>0){t=BX.findChild(n[o],{tag:"div",className:"feed-post-text-block-inner-inner"});BX.UserContentView.registerViewArea(n[o].id,t?t:null)}}}};BitrixLF.prototype.clickTag=function(e){var t=false;if(BX.type.isNotEmptyString(e)&&this.filterApi){this.filterApi.setFields({TAG:e});this.filterApi.apply();if(this.filterId&&typeof BX.Main!="undefined"&&typeof BX.Main.filterManager!="undefined"&&BX.Main.filterManager.getById(this.filterId)&&(BX.Main.filterManager.getById(this.filterId).getSearch().getSquares().length>0||BX.Main.filterManager.getById(this.filterId).getSearch().getSearchString().length>0)){var n=BX.findParent(BX(this.filterId+"_filter_container"),{className:"pagetitle-wrap"});if(n){BX.addClass(n,"pagetitle-wrap-filter-opened")}}var o=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:o.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){}}).animate();t=true}return t};BitrixLF.prototype.expandPost=function(e){if(BX(e)){var t=BX.findParent(BX(e),{className:"feed-post-block"},BX("log_internal_container"));if(t){BX.addClass(t,"feed-post-block-short");BX.addClass(t,"feed-post-block-separator")}}};if(typeof oLF=="undefined"){oLF=new BitrixLF;window.oLF=oLF}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js?154412745410825";s:6:"source";s:79:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
window["__logCommentsListRedefine"]=function(e,t,n,s){if(window["UC"]&&!!window["UC"][e]){BX.addCustomEvent(window["UC"][e],"OnUCListWasBuilt",function(t,n,a){if(BX(a)&&a.hasChildNodes){var i=a.firstChild,o;do{if(BX(i)&&i["getAttribute"]){o=i.getAttribute("id").replace("record-"+e+"-","").replace("-cover","");BX.onCustomEvent(window,"OnUCAddEntitiesCorrespondence",[e+"-"+o,[s,top["arLogCom"+s+o]]])}}while(i=i.nextSibling)}})}if(!!window.mplCheckForQuote)BX.bind(BX(t),"mouseup",function(t){mplCheckForQuote(t,this,e,n)})};window["__logBuildRating"]=function(e,t,n){var s="";n=!!n?n:Math.floor(Math.random()*1e5)+1;if(BX.message("sonetLShowRating")=="Y"&&!!e["RATING_TYPE_ID"]>0&&e["RATING_ENTITY_ID"]>0&&(BX.message("sonetLRatingType")=="like"&&!!window["RatingLike"]||BX.message("sonetLRatingType")=="standart_text"&&!!window["Rating"])){if(BX.message("sonetLRatingType")=="like"){var a=e["RATING_USER_VOTE_VALUE"]>0?" bx-you-like":"",i=e["RATING_USER_VOTE_VALUE"]>0?BX.message("sonetLTextLikeN"):BX.message("sonetLTextLikeY"),o=null;if(!!t["ALLOW_VOTE"]&&!!t["ALLOW_VOTE"]["RESULT"])o=BX.create("span",{props:{className:"bx-ilike-text"},html:i});s=BX.create("span",{attrs:{id:"sonet-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n},props:{className:"sonet-log-comment-like rating_vote_text"},children:[BX.create("span",{props:{className:"ilike-light"},children:[BX.create("span",{props:{id:"bx-ilike-button-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,className:"bx-ilike-button"},children:[BX.create("span",{props:{className:"bx-ilike-right-wrap"+a},children:[BX.create("span",{props:{className:"bx-ilike-right"},html:e["RATING_TOTAL_POSITIVE_VOTES"]})]}),BX.create("span",{props:{className:"bx-ilike-left-wrap"},children:[o]})]}),BX.create("span",{props:{id:"bx-ilike-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,className:"bx-ilike-wrap-block"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]})]})]})}else if(BX.message("sonetLRatingType")=="standart_text"){s=BX.create("span",{attrs:{id:"sonet-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n},props:{className:"sonet-log-comment-like rating_vote_text"},children:[BX.create("span",{props:{className:"bx-rating"+(!t["ALLOW_VOTE"]["RESULT"]?" bx-rating-disabled":"")+(e["RATING_USER_VOTE_VALUE"]!=0?" bx-rating-active":""),id:"bx-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,title:!t["ALLOW_VOTE"]["RESULT"]?t["ERROR_MSG"]:""},children:[BX.create("span",{props:{className:"bx-rating-absolute"},children:[BX.create("span",{props:{className:"bx-rating-question"},html:!t["ALLOW_VOTE"]["RESULT"]?BX.message("sonetLTextDenied"):BX.message("sonetLTextAvailable")}),BX.create("span",{props:{className:"bx-rating-yes "+(e["RATING_USER_VOTE_VALUE"]>0?"  bx-rating-yes-active":""),title:e["RATING_USER_VOTE_VALUE"]>0?BX.message("sonetLTextCancel"):BX.message("sonetLTextPlus")},children:[BX.create("a",{props:{className:"bx-rating-yes-count",href:"#like"},html:""+parseInt(e["RATING_TOTAL_POSITIVE_VOTES"])}),BX.create("a",{props:{className:"bx-rating-yes-text",href:"#like"},html:BX.message("sonetLTextRatingY")})]}),BX.create("span",{props:{className:"bx-rating-separator"},html:"/"}),BX.create("span",{props:{className:"bx-rating-no "+(e["RATING_USER_VOTE_VALUE"]<0?"  bx-rating-no-active":""),title:e["RATING_USER_VOTE_VALUE"]<0?BX.message("sonetLTextCancel"):BX.message("sonetLTextMinus")},children:[BX.create("a",{props:{className:"bx-rating-no-count",href:"#dislike"},html:""+parseInt(e["RATING_TOTAL_NEGATIVE_VOTES"])}),BX.create("a",{props:{className:"bx-rating-no-text",href:"#dislike"},html:BX.message("sonetLTextRatingN")})]})]})]}),BX.create("span",{props:{id:"bx-rating-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n+"-plus"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup  bx-rating-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]}),BX.create("span",{props:{id:"bx-rating-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n+"-minus"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup  bx-rating-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]})]})}}if(!!s){s=BX.create("span",{children:[s]});s=s.innerHTML+'<script>window["#OBJ#"].Set("#ID#", "#RATING_TYPE_ID#", #RATING_ENTITY_ID#, "#ALLOW_VOTE#", BX.message("sonetLCurrentUserID"), #TEMPLATE#, "light", BX.message("sonetLPathToUser"));<\/script>'.replace("#OBJ#",BX.message("sonetLRatingType")=="like"?"RatingLike":"Rating").replace("#ID#",e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n).replace("#RATING_TYPE_ID#",e["RATING_TYPE_ID"]).replace("#RATING_ENTITY_ID#",e["RATING_ENTITY_ID"]).replace("#ALLOW_VOTE#",!!t["ALLOW_VOTE"]&&!!t["ALLOW_VOTE"]["RESULT"]?"Y":"N").replace("#TEMPLATE#",BX.message("sonetLRatingType")=="like"?'{LIKE_Y:BX.message("sonetLTextLikeN"),LIKE_N:BX.message("sonetLTextLikeY"),LIKE_D:BX.message("sonetLTextLikeD")}':'{PLUS:BX.message("sonetLTextPlus"),MINUS:BX.message("sonetLTextMinus"),CANCEL:BX.message("sonetLTextCancel")}')}return s};window["__logShowCommentForm"]=function(e){if(!!window["UC"][e])window["UC"][e].reply()};var waitTimeout=null;var waitDiv=null;var waitPopup=null;var waitTime=500;function __logShowHiddenDestination(e,t,n){var s=new XMLHttpRequest;s.open("POST",BX.message("sonetLESetPath"),true);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.onreadystatechange=function(){if(s.readyState==4){if(s.status==200){var e=LBlock.DataParser(s.responseText);if(typeof e=="object"){if(e[0]=="*"){if(sonetLErrorDiv!=null){sonetLErrorDiv.style.display="block";sonetLErrorDiv.innerHTML=s.responseText}return}s.abort();var t=e["arDestinations"];if(typeof t=="object"){if(BX(n)){var a=n.parentNode;a.removeChild(n);var i="";for(var o=0;o<t.length;o++){if(typeof t[o]["TITLE"]!="undefined"&&t[o]["TITLE"].length>0){a.appendChild(BX.create("SPAN",{html:",&nbsp;"}));if(typeof t[o]["CRM_PREFIX"]!="undefined"&&t[o]["CRM_PREFIX"].length>0){a.appendChild(BX.create("SPAN",{props:{className:"feed-add-post-destination-prefix"},html:t[o]["CRM_PREFIX"]+":&nbsp;"}))}if(typeof t[o]["URL"]!="undefined"&&t[o]["URL"].length>0){a.appendChild(BX.create("A",{props:{className:"feed-add-post-destination-new"+(typeof t[o]["IS_EXTRANET"]!="undefined"&&t[o]["IS_EXTRANET"]=="Y"?" feed-post-user-name-extranet":""),href:t[o]["URL"]},html:t[o]["TITLE"]}))}else{a.appendChild(BX.create("SPAN",{props:{className:"feed-add-post-destination-new"+(typeof t[o]["IS_EXTRANET"]!="undefined"&&t[o]["IS_EXTRANET"]=="Y"?" feed-post-user-name-extranet":"")},html:t[o]["TITLE"]}))}}}if(e["iDestinationsHidden"]!="undefined"&&parseInt(e["iDestinationsHidden"])>0){e["iDestinationsHidden"]=parseInt(e["iDestinationsHidden"]);var r=e["iDestinationsHidden"]%100>10&&e["iDestinationsHidden"]%100<20?5:e["iDestinationsHidden"]%10;a.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("sonetLDestinationHidden"+r).replace("#COUNT#",e["iDestinationsHidden"])}))}}}}}else{}}};s.send("r="+Math.floor(Math.random()*1e3)+"&"+BX.message("sonetLSessid")+"&site="+BX.util.urlencode(BX.message("SITE_ID"))+"&nt="+BX.util.urlencode(BX.message("sonetLNameTemplate"))+"&log_id="+encodeURIComponent(e)+(t?"&created_by_id="+encodeURIComponent(t):"")+"&p_user="+BX.util.urlencode(BX.message("sonetLPathToUser"))+"&p_group="+BX.util.urlencode(BX.message("sonetLPathToGroup"))+"&p_dep="+BX.util.urlencode(BX.message("sonetLPathToDepartment"))+"&dlim="+BX.util.urlencode(BX.message("sonetLDestinationLimit"))+"&action=get_more_destination")}function __logSetFollow(e){var t=BX("log_entry_follow_"+e,true).getAttribute("data-follow")=="Y"?"Y":"N";var n=t=="Y"?"N":"Y";if(BX("log_entry_follow_"+e,true)){BX.findChild(BX("log_entry_follow_"+e,true),{tagName:"a"}).innerHTML=BX.message("sonetLFollow"+n);BX("log_entry_follow_"+e,true).setAttribute("data-follow",n)}BX.ajax({url:BX.message("sonetLSetPath"),method:"POST",dataType:"json",data:{log_id:e,action:"change_follow",follow:n,sessid:BX.bitrix_sessid(),site:BX.message("sonetLSiteId")},onsuccess:function(n){if(n["SUCCESS"]!="Y"&&BX("log_entry_follow_"+e,true)){BX.findChild(BX("log_entry_follow_"+e,true),{tagName:"a"}).innerHTML=BX.message("sonetLFollow"+t);BX("log_entry_follow_"+e,true).setAttribute("data-follow",t)}},onfailure:function(n){if(BX("log_entry_follow_"+e,true)){BX.findChild(BX("log_entry_follow_"+e,true),{tagName:"a"}).innerHTML=BX.message("sonetLFollow"+t);BX("log_entry_follow_"+e,true).setAttribute("data-follow",t)}}});return false}function __logRefreshEntry(e){var t=e.node!==undefined?BX(e.node):false;var n=e.logId!==undefined?parseInt(e.logId):0;if(!t||n<=0||BX.message("sonetLEPath")===undefined){return}BX.ajax({url:BX.message("sonetLEPath").replace("#log_id#",n),method:"POST",dataType:"json",data:{log_id:n,action:"get_entry"},onsuccess:function(e){if(e["ENTRY_HTML"]!==undefined){BX.cleanNode(t);t.innerHTML=e["ENTRY_HTML"];var n=BX.processHTML(t.innerHTML,true);var s=n.SCRIPT;BX.ajax.processScripts(s,true)}},onfailure:function(e){}});return false}window.__logEditComment=function(e,t,n){BX.ajax({url:BX.message("sonetLESetPath"),method:"POST",dataType:"json",data:{comment_id:t,post_id:n,site:BX.message("sonetLSiteId"),action:"get_comment_src",sessid:BX.bitrix_sessid()},onsuccess:function(t){if(typeof t.message!="undefined"&&typeof t.sourceId!="undefined"){var s={messageBBCode:t.message,messageFields:{arFiles:typeof t["UF"]!="undefined"&&typeof t["UF"]["UF_SONET_COM_FILE"]!="undefined"?t["UF"]["UF_SONET_COM_FILE"]["VALUE"]:[]}};if(typeof t["UF"]!="undefined"&&typeof t["UF"]["UF_SONET_COM_DOC"]!="undefined"&&typeof t["UF"]["UF_SONET_COM_DOC"]["USER_TYPE_ID"]!="undefined"){if(t["UF"]["UF_SONET_COM_DOC"]["USER_TYPE_ID"]=="webdav_element"){s["messageFields"]["arDocs"]=t["UF"]["UF_SONET_COM_DOC"]["VALUE"]}else if(t["UF"]["UF_SONET_COM_DOC"]["USER_TYPE_ID"]=="disk_file"){s["messageFields"]["arDFiles"]=t["UF"]["UF_SONET_COM_DOC"]["VALUE"]}}window["UC"][window.SLEC.formKey]["entitiesCorrespondence"][e+"-"+t.sourceId]=[n,t.id];BX.onCustomEvent(window,"OnUCAfterRecordEdit",[e,t.sourceId,s,"EDIT"])}},onfailure:function(e){}})};(function(){BX.SocialnetworkLogEntry={};BX.SocialnetworkLogEntry.registerViewAreaList=function(e){if(typeof e=="undefined"||typeof e.containerId=="undefined"||typeof e.className=="undefined"){return}if(BX(e.containerId)){var t=BX.findChildren(BX(e.containerId),{tag:"div",className:e.className},true),n=null;for(var s=0,a=t.length;s<a;s++){if(t[s].id.length>0){n=null;if(BX.type.isNotEmptyString(e.fullContentClassName)){n=BX.findChild(t[s],{className:e.fullContentClassName})}BX.UserContentView.registerViewArea(t[s].id,n?n:null)}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js?154412745337676";s:6:"source";s:83:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){if(window["SBPETabs"])return;window.SBPEFullForm=function(){this.lazyLoad=null;this.ajaxUrl="";this.inited=false;this.loaded=false;this.container=null;this.containerMicro=null;this.containerMicroInner=null;this.clickDisabled=false;this.lastWait=[];this.animationStartHeight=0;this.initedEditorsList=[]};window.SBPEFullForm.instance=null;window.SBPEFullForm.getInstance=function(){if(window.SBPEFullForm.instance==null){window.SBPEFullForm.instance=new SBPEFullForm}return window.SBPEFullForm.instance};window.SBPEFullForm.prototype={init:function(t){if(this.inited!==true){this.inited=true;this.lazyLoad=typeof t.lazyLoad!="undefined"?t.lazyLoad:null;this.ajaxUrl=typeof t.ajaxUrl!="undefined"?t.ajaxUrl:"";this.container=typeof t.container!="undefined"?t.container:null;this.containerMicro=typeof t.containerMicro!="undefined"?t.containerMicro:null;this.containerMicroInner=typeof t.containerMicroInner!="undefined"?t.containerMicroInner:null}},get:function(t){var e=this;if(e.clickDisabled){return}if(e.lazyLoad&&!e.loaded){e.clickDisabled=true;e.animationStartHeight=this.containerMicro.offsetHeight;e.containerMicroInner.style.display="none";e.showWait(e.containerMicro);BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"SBPE_get_full_form",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(o){e.loaded=true;e.clickDisabled=false;e.closeWait();if(o.success){e.processAjaxBlock(o.PROPS,t.callback)}else{}}),onfailure:function(t){e.clickDisabled=false;e.closeWait();e.containerMicroInner.style.display="block"}})}else{t.callback()}},processAjaxBlock:function(t,e){if(!t){return}var o=this;var i=false;var s=false;a(n);r(l);function a(e){if(BX.type.isArray(t.CSS)&&t.CSS.length>0){BX.load(t.CSS,e)}else{e()}}function n(){o.container.appendChild(BX.create("DIV",{html:t.CONTENT}));i=true;if(s){l()}}function r(e){if(BX.type.isArray(t.JS)&&t.JS.length>0){BX.load(t.JS,e)}else{e()}}function l(){s=true;if(i){BX.ajax.processRequestData(t.CONTENT,{scriptsRunFirst:false,dataType:"HTML"});e()}}},showWait:function(t){t=BX(t)||document.body||document.documentElement;var e=t.bxmsg=document.body.appendChild(BX.create("DIV",{props:{id:"wait_"+t.id,className:"feed-add-post-loader-cont"},html:'<svg class="feed-add-post-loader" viewBox="25 25 50 50"><circle class="feed-add-post-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle><circle class="feed-add-post-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle></svg>'}));setTimeout(BX.delegate(this.adjustWait,t),10);this.lastWait[this.lastWait.length]=e;return e},adjustWait:function(){if(!this.bxmsg)return;var t=BX.pos(this),e=t.top+15;if(e<BX.GetDocElement().scrollTop)e=BX.GetDocElement().scrollTop+5;this.bxmsg.style.top=e+5+"px";if(this==BX.GetDocElement()){this.bxmsg.style.right="5px"}else{this.bxmsg.style.left=t.left+parseInt((t.width-this.bxmsg.offsetWidth)/2)+"px"}},closeWait:function(){var t=this.containerMicro;obMsg=t.bxmsg;if(obMsg&&obMsg.parentNode){for(var e=0,o=this.lastWait.length;e<o;e++){if(obMsg==this.lastWait[e]){this.lastWait=BX.util.deleteFromArray(this.lastWait,e);break}}obMsg.parentNode.removeChild(obMsg);if(t)t.bxmsg=null;BX.cleanNode(obMsg,true)}},tasksTaskEvent:function(t){this.showTaskPopup(t)},showTaskPopup:function(t){this.createTaskPopup=new BX.PopupWindow("blogPostEditCreateTaskPopup",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:false,lightShadow:true,closeIcon:{right:"12px",top:"10px"},draggable:{restrict:true},closeByEsc:false,contentColor:"white",contentNoPaddings:true,buttons:[],content:BX.create("DIV",{attrs:{id:"blogPostEditCreateTaskPopup_content"},props:{className:"feed-create-task-popup-content"}}),events:{onAfterPopupShow:BX.proxy(function(){this.setTaskPopupContent(BX.create("DIV",{children:[BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("sonetBPECreateTaskSuccessTitle")}),BX.create("DIV",{props:{className:"feed-create-task-popup-description"},html:BX.message("sonetBPECreateTaskSuccessDescription")})]}));this.createTaskPopup.setButtons([new BX.PopupWindowButton({text:BX.message("sonetBPECreateTaskButtonTitle"),events:{click:BX.proxy(function(){this.createTaskPopup.destroy();var e=BX.message("PATH_TO_USER_TASKS_TASK").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",t).replace("#action#","view");if(typeof BX.Bitrix24!="undefined"&&typeof BX.Bitrix24.PageSlider!="undefined"){BX.Bitrix24.PageSlider.open(e)}else{window.open(e,"_blank")}},this)}})])},this),onPopupClose:BX.proxy(function(){this.createTaskPopup.destroy()},this)}});this.createTaskPopup.params.zIndex=BX.WindowManager?BX.WindowManager.GetZIndex():0;this.createTaskPopup.show()},setTaskPopupContent:function(t){if(BX("blogPostEditCreateTaskPopup_content")){var e=BX("blogPostEditCreateTaskPopup_content");BX.cleanNode(e);e.appendChild(t)}}};window.SBPETabs=function(){if(window.SBPETabs.instance!=null){throw"SBPETabs is a singleton. Use SBPETabs.getInstance to get an object."}this.tabs={};this.bodies={};this.active=null;this.animation=null;this.animationStartHeight=0;this.menu=null;this.menuItems=[];this.lastWait=[];this.clickDisabled=false;this.createTaskPopup=null;if(this.inited!==true)this.init();window.SBPETabs.instance=this};window.SBPETabs.instance=null;window.SBPETabs.getInstance=function(){if(window.SBPETabs.instance==null){window.SBPETabs.instance=new SBPETabs}return window.SBPETabs.instance};window.SBPETabs.changePostFormTab=function(t,e){var o=window.SBPETabs.getInstance();if(o.clickDisabled)return false;return o.setActive(t,e)};window.SBPETabs.prototype={_createOnclick:function(t,e,o){return function(){var i=BX("feed-add-post-form-link-more",true);var s=BX("feed-add-post-form-link-text",true);s.innerHTML=e;if(t!="lists"){i.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-link-active feed-add-post-form-"+t+"-link";window.SBPETabs.changePostFormTab(t)}else{i.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-"+t+"-link"}if(BX.type.isNotEmptyString(o)){BX.evalGlobal(o)}this.popupWindow.close()}},init:function(){this.tabContainer=BX("feed-add-post-form-tab");var t=BX.findChildren(this.tabContainer,{tag:"span",className:"feed-add-post-form-link"},true);this.arrow=BX("feed-add-post-form-tab-arrow");this.tabs={};this.bodies={};for(var e=0;e<t.length;e++){var o=t[e].getAttribute("id").replace("feed-add-post-form-tab-","");this.tabs[o]=t[e];if(this.tabs[o].style.display=="none"){this.menuItems.push({tabId:o,text:t[e].getAttribute("data-name"),className:"menu-popup-no-icon feed-add-post-form-"+o+" feed-add-post-form-"+o+"-more",onclick:this._createOnclick(o,t[e].getAttribute("data-name"),t[e].getAttribute("data-onclick"))});this.tabs[o]=this.tabs[o].parentNode}this.bodies[o]=BX("feed-add-post-content-"+o)}if(!!this.tabs["file"])this.bodies["file"]=[this.bodies["message"]];if(!!this.tabs["calendar"])this.bodies["calendar"]=[this.bodies["calendar"]];if(!!this.tabs["vote"])this.bodies["vote"]=[this.bodies["message"],this.bodies["vote"]];if(!!this.tabs["more"])this.bodies["more"]=null;if(!!this.tabs["important"])this.bodies["important"]=[this.bodies["message"],this.bodies["important"]];if(!!this.tabs["grat"])this.bodies["grat"]=[this.bodies["message"],this.bodies["grat"]];if(!!this.tabs["lists"])this.bodies["lists"]=[this.bodies["lists"]];if(!!this.tabs["tasks"])this.bodies["tasks"]=[this.bodies["tasks"]];for(var i in this.bodies){if(this.bodies.hasOwnProperty(i)&&BX.type.isDomNode(this.bodies[i]))this.bodies[i]=[this.bodies[i]]}this.inited=true;this.previousTab=false;if(BX("bx-b-uploadfile-blogPostForm")){BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOut");BX.bind(BX("bx-b-uploadfile-blogPostForm"),"mousedown",BX.delegate(function(){BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press",BX("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")=="pressOut"?"pressOn":"pressOut")},this))}BX.onCustomEvent(this.tabContainer,"onObjectInit",[this]);var s=BX("blogPostForm");if(s){if(!s.changePostFormTab){s.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"changePostFormTab",value:""}}))}BX.addCustomEvent(window,"changePostFormTab",function(t){if(t!="more"){s.changePostFormTab.value=t}});if(s["UF_BLOG_POST_IMPRTNT"]){BX.addCustomEvent(window,"changePostFormTab",function(t){if(t!="more"){s["UF_BLOG_POST_IMPRTNT"].value=t=="important"?1:0}})}}},setActive:function(t,e){if(t==null||this.active==t&&t!="lists")return this.active;else if(!this.tabs[t])return false;var o,i;var s=t!=="tasks"||this.isTaskTabLoaded();if(s){this.startAnimation()}for(o in this.tabs){if(this.tabs.hasOwnProperty(o)&&o!=t){BX.removeClass(this.tabs[o],"feed-add-post-form-link-active");if(this.bodies[o]==null||this.bodies[t]==null)continue;for(i=0;i<this.bodies[o].length;i++){if(this.bodies[t][i]!=this.bodies[o][i])BX.adjust(this.bodies[o][i],{style:{display:"none"}})}}}if(!!this.tabs[t]){this.active=t;var a=BX.pos(this.tabs[t],true);this.arrow.style.display="block";this.arrow.style.top=a.bottom+"px";var n=parseInt(this.arrow.style.left)||0;var r=parseInt(this.arrow.style.width)||0;new BX.easing({duration:200,start:{left:n,width:r},finish:{left:a.left,width:a.width},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:BX.proxy(function(t){this.arrow.style.left=t.left+"px";this.arrow.style.width=t.width+"px"},this),complete:BX.proxy(function(){this.arrow.style.display="none";BX.addClass(this.tabs[t],"feed-add-post-form-link-active")},this)}).animate();if(this.previousTab=="file"||t=="file"){var l=null,d=null,c=false,u=false,f=BX("divoPostFormLHE_blogPostForm");if(!!f&&!!f.childNodes&&f.childNodes.length>0){for(o in f.childNodes){if(f.childNodes.hasOwnProperty(o)&&f.childNodes[o].className=="file-selectdialog"){l=f.childNodes[o];var p=BX.findChild(l,{className:"file-placeholder-tbody"},true),m=BX.findChildren(l,{className:"feed-add-photo-block"},true);if(p.rows>0||!!m&&m.length>1)c=true}else if(BX.type.isNotEmptyString(f.childNodes[o].className)&&(f.childNodes[o].className.indexOf("wduf-selectdialog")>=0||f.childNodes[o].className.indexOf("diskuf-selectdialog")>=0)){d=f.childNodes[o];var h=BX.findChildren(d,{className:"wd-inline-file"},true);u=!!h&&h.length>0}else if(BX.type.isElementNode(f.childNodes[o])&&!BX.hasClass(f.childNodes[o],"urlpreview")){BX.adjust(f.childNodes[o],{style:{display:t=="file"?"none":""}})}}if(t=="file"){if(!!window["PlEditorblogPostForm"]){if(!window["PlEditorblogPostForm"]["SBPEBinded"]){window["PlEditorblogPostForm"].SBPEBinded=true;BX.addCustomEvent(window["PlEditorblogPostForm"].eventNode,"onUploadsHasBeenChanged",function(t){if(t.dialogName=="AttachFileDialog"&&t.urlUpload.indexOf("&dropped=Y")<0){t.urlUpload=t.agent.uploadFileUrl=t.urlUpload.replace("&random_folder=Y","&dropped=Y")}BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOn");if(window.SBPETabs.getInstance().active!="file"){window.SBPETabs.changePostFormTab("message")}})}window["PlEditorblogPostForm"].controllerInit("show")}window["PlEditorblogPostForm"].controllerInit("show");BX.addClass(f,"feed-add-post-form");BX.addClass(f,"feed-add-post-edit-form");BX.addClass(f,"feed-add-post-edit-form-file")}else{BX.removeClass(f,"feed-add-post-form");BX.removeClass(f,"feed-add-post-edit-form");BX.removeClass(f,"feed-add-post-edit-form-file");if(!c&&!u&&BX("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")=="pressOut"&&!!window["PlEditorblogPostForm"]){window["PlEditorblogPostForm"].controllerInit("hide")}}}}if(BX("divoPostFormLHE_blogPostForm")&&BX("divoPostFormLHE_blogPostForm").style.display=="none"){BX.onCustomEvent(BX("divoPostFormLHE_blogPostForm"),"OnShowLHE",["justShow"])}if(t=="lists"){BX.onCustomEvent("onDisplayClaimLiveFeed",[e])}this.previousTab=t;if(!!this.bodies[t]){for(i=0;i<this.bodies[t].length;i++){if(!!this.bodies[t][i]){BX.adjust(this.bodies[t][i],{style:{display:"block"}})}}}}if(s){this.endAnimation()}if(t!="lists")this.restoreMoreMenu();BX.onCustomEvent(window,"changePostFormTab",[t]);return this.active},startAnimation:function(){if(this.animation){this.animation.stop()}var t=BX("microblog-form",true);if(!t){return false}if(window.SBPEFullForm.getInstance().animationStartHeight>0){this.animationStartHeight=window.SBPEFullForm.getInstance().animationStartHeight;window.SBPEFullForm.getInstance().animationStartHeight=0}else{this.animationStartHeight=t.parentNode.offsetHeight}t.parentNode.style.height=this.animationStartHeight+"px";t.parentNode.style.overflowY="hidden";t.parentNode.style.position="relative";t.style.opacity=0},endAnimation:function(){var t=BX("microblog-form",true);if(!t){return false}this.animation=new BX.easing({duration:500,start:{height:this.animationStartHeight,opacity:0},finish:{height:t.offsetHeight+t.offsetTop,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){t.parentNode.style.height=e.height+"px";t.style.opacity=e.opacity/100},complete:BX.proxy(function(){t.style.cssText="";t.parentNode.style.cssText="";this.animation=null},this)});this.animation.animate()},collapse:function(){window.SBPETabs.changePostFormTab("message");if(window.SBPEFullForm.getInstance().containerMicroInner){window.SBPEFullForm.getInstance().containerMicroInner.style.display="block"}this.startAnimation();BX.onCustomEvent(BX("divoPostFormLHE_blogPostForm"),"OnShowLHE",[false]);BX.onCustomEvent(window,"onExtAutoSaveReset_blogPostForm",[]);this.endAnimation();this.active=null},showMoreMenu:function(){if(!this.menu){this.menu=BX.PopupMenu.create("feed-add-post-form-popup",BX("feed-add-post-form-link-text"),this.menuItems,{className:"feed-add-post-form-popup",closeByEsc:true,offsetTop:5,offsetLeft:3,angle:true})}this.menu.popupWindow.show()},restoreMoreMenu:function(){var t=this.menuItems.length;if(t<1){return}for(var e=0;e<t;e++){if(this.active==this.menuItems[e]["tabId"]){return}}var o=BX("feed-add-post-form-link-more",true);var i=BX("feed-add-post-form-link-text",true);o.className="feed-add-post-form-link feed-add-post-form-link-more";i.innerHTML=BX.message("SBPE_MORE")},getLists:function(){var t=BX("feed-add-post-form-tab-lists")&&BX("feed-add-post-form-tab-lists").style.display!="none"?BX("feed-add-post-form-tab-lists"):BX("feed-add-post-form-link-more"),e=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists"},true),o=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists-default"},true),i=[],s=[];if(e.length){s=this.getMenuItems(e,this.createOnclickLists);i=this.getMenuItemsDefault(o);s=s.concat(i);this.showMoreMenuLists(s)}else{var a=this.showMoreMenuLists,n=this.getMenuItems,r=this.getMenuItemsDefault,l=this.createOnclickLists,d=null;if(BX("bx-lists-select-site-id")){d=BX("bx-lists-select-site-id").value}BX.ajax({method:"POST",dataType:"json",url:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/post.ajax.php",data:{bitrix_processes:1,siteId:d,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(d){if(d.success){var c=null;for(c in d.lists){if(d.lists.hasOwnProperty(c)){t.appendChild(BX.create("span",{attrs:{"data-name":d.lists[c].NAME,"data-picture":d.lists[c].PICTURE,"data-description":d.lists[c].DESCRIPTION,"data-picture-small":d.lists[c].PICTURE_SMALL,"data-code":d.lists[c].CODE,iblockId:d.lists[c].ID},props:{className:"feed-add-post-form-link-lists",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}}e=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists"},true);s=n(e,l);if(!o.length){for(c in d.permissions){if(d.permissions.hasOwnProperty(c)){var u;if(c=="new"){u='document.location.href = "'+BX("bx-lists-lists-page").value+'0/edit/"'}else if(c=="market"){if(d.admin&&BX("bx-lists-lists-page")){u='document.location.href = "'+BX("bx-lists-lists-page").value+'?bp_catalog=y"'}else{if(BX("bx-lists-random-string")){u='BX.Lists["LiveFeedClass_'+BX("bx-lists-random-string").value+'"].errorPopup("'+BX.message("LISTS_CATALOG_PROCESSES_ACCESS_DENIED")+'");'}}}else if(c=="settings"){u='document.location.href = "'+BX("bx-lists-lists-page").value+'"'}t.appendChild(BX.create("span",{attrs:{"data-name":d.permissions[c],"data-picture-small":"","data-key":c,"data-onclick":u},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}}o=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists-default"},true)}i=r(o);s=s.concat(i);a(s)}else{t.appendChild(BX.create("span",{attrs:{"data-name":d.error,"data-picture-small":""},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}));e=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists-default"},true);s=n(e,0);a(s)}})})}},isTaskTabLoaded:function(){var t=BX("feed-add-post-content-tasks-container");return t&&t.children.length},getTaskForm:function(){var t=BX("feed-add-post-form-tab-tasks")&&BX("feed-add-post-form-tab-tasks").style.display!="none"?BX("feed-add-post-form-tab-tasks"):BX("feed-add-post-form-link-more"),e=BX("feed-add-post-content-tasks"),o=BX("feed-add-post-content-tasks-container");if(o&&o.innerHTML.length<=0&&!this.clickDisabled){this.clickDisabled=true;window.SBPEFullForm.getInstance().showWait(o);this.startAnimation();var i={GROUP_ID:BX.message("TASK_SOCNET_GROUP_ID"),PATH_TO_USER_TASKS:BX.message("PATH_TO_USER_TASKS"),PATH_TO_USER_TASKS_TASK:BX.message("PATH_TO_USER_TASKS_TASK"),PATH_TO_GROUP_TASKS:BX.message("PATH_TO_GROUP_TASKS"),PATH_TO_GROUP_TASKS_TASK:BX.message("PATH_TO_GROUP_TASKS_TASK"),PATH_TO_USER_PROFILE:BX.message("PATH_TO_USER_PROFILE"),PATH_TO_GROUP:BX.message("PATH_TO_GROUP"),PATH_TO_USER_TASKS_PROJECTS_OVERVIEW:BX.message("PATH_TO_USER_TASKS_PROJECTS_OVERVIEW"),PATH_TO_USER_TASKS_TEMPLATES:BX.message("PATH_TO_USER_TASKS_TEMPLATES"),PATH_TO_USER_TEMPLATES_TEMPLATE:BX.message("PATH_TO_USER_TEMPLATES_TEMPLATE"),ENABLE_FOOTER:"N",TEMPLATE_CONTROLLER_ID:"lifefeed_task_form",ENABLE_FORM:"N",BACKURL:BX.message("TASK_SUBMIT_BACKURL")};BX.Tasks.Util.Query.runOnce("ui.task.edit",{parameters:{COMPONENT_PARAMETERS:i}}).then(BX.proxy(function(t){if(t.isSuccess()){BX.html(o,t.getData());BX.adjust(e,{style:{display:"block"}});return true}else{this.closeWait(o);this.endAnimation();throw new Error}},this),BX.proxy(function(t){this.closeWait(o);this.endAnimation();throw new Error},this)).then(BX.proxy(function(){this.clickDisabled=false;this.closeWait(o);this.endAnimation()},this))}else{this.startAnimation();this.endAnimation()}BX.onCustomEvent(BX("lifefeed_task_form"),"OnShowLHE",["justShow"])},closeWait:function(t){obMsg=t.bxmsg;if(obMsg&&obMsg.parentNode){for(var e=0,o=this.lastWait.length;e<o;e++){if(obMsg==this.lastWait[e]){this.lastWait=BX.util.deleteFromArray(this.lastWait,e);break}}obMsg.parentNode.removeChild(obMsg);if(t)t.bxmsg=null;BX.cleanNode(obMsg,true)}},getMenuItems:function(t,e){var o=[];for(var i=0;i<t.length;i++){var s=t[i].getAttribute("id").replace("feed-add-post-form-tab-","");if(e){o.push({tabId:s,text:BX.util.htmlspecialchars(t[i].getAttribute("data-name")),className:"feed-add-post-form-"+s+"feed-add-post-form-"+s+"-item",onclick:e(s,[t[i].getAttribute("iblockId"),t[i].getAttribute("data-name"),t[i].getAttribute("data-description"),t[i].getAttribute("data-picture"),t[i].getAttribute("data-code")])})}else{o.push({tabId:s,text:t[i].getAttribute("data-name"),className:"feed-add-post-form-"+s,onclick:""})}}return o},getMenuItemsDefault:function(t){var e=[];for(var o=0;o<t.length;o++){e.push({text:BX.util.htmlspecialchars(t[o].getAttribute("data-name")),className:"feed-add-post-form-lists-default-"+t[o].getAttribute("data-key"),onclick:t[o].getAttribute("data-onclick")})}return e},showMoreMenuLists:function(t){var e=BX("feed-add-post-form-tab-lists").style.display!="none"?BX("feed-add-post-form-tab-lists"):BX("feed-add-post-form-link-more");var o=BX.PopupMenu.create("lists",e,t,{closeByEsc:true,offsetTop:5,offsetLeft:12,angle:true});var i=BX.findChildren(BX("popup-window-content-menu-popup-lists"),{tag:"span",className:"menu-popup-item-icon"},true),s=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists"},true),a=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists-default"},true);s=s.concat(a);for(var n=0;n<i.length;n++){if(s[n].getAttribute("data-picture-small")){i[n].innerHTML=s[n].getAttribute("data-picture-small")}}o.popupWindow.show()},createOnclickLists:function(t,e){return function(){window.SBPETabs.changePostFormTab(t,e);this.popupWindow.close()}}};window.BXfpGratSelectCallback=function(t){BXfpGratMedalSelectCallback(t,"grat")};window.BXfpMedalSelectCallback=function(t){BXfpGratMedalSelectCallback(t,"medal")};window.BXfpGratMedalSelectCallback=function(t,e){if(e!="grat")e="medal";var o="U";BX("feed-add-post-"+e+"-item").appendChild(BX.create("span",{attrs:{"data-id":t.id},props:{className:"feed-add-post-"+e+" feed-add-post-destination-users"},children:[BX.create("input",{attrs:{type:"hidden",name:(e=="grat"?"GRAT":"MEDAL")+"["+o+"][]",value:t.id}}),BX.create("span",{props:{className:"feed-add-post-"+e+"-text"},html:t.name}),BX.create("span",{props:{className:"feed-add-post-del-but"},events:{click:function(e){BX.SocNetLogDestination.deleteItem(t.id,"users",window["BXSocNetLogGratFormName"]);BX.PreventDefault(e)},mouseover:function(){BX.addClass(this.parentNode,"feed-add-post-"+e+"-hover")},mouseout:function(){BX.removeClass(this.parentNode,"feed-add-post-"+e+"-hover")}}})]}));BX("feed-add-post-"+e+"-input").value="";BX.SocNetLogDestination.BXfpSetLinkName({formName:e=="grat"?window["BXSocNetLogGratFormName"]:window["BXSocNetLogMedalFormName"],tagInputName:"bx-"+e+"-tag",tagLink1:BX.message("BX_FPGRATMEDAL_LINK_1"),tagLink2:BX.message("BX_FPGRATMEDAL_LINK_2")})};if(!!BX.SocNetGratSelector)return;BX.SocNetPostDateEndData={isInitialized:false,popupShowingPeriods:null,customDateStyleModifier:"feed-add-post-expire-date-customize",popupTriggerSelector:".js-important-till-popup-trigger",customDatePopupOptionClass:"js-custom-date-end",customDateFinalSelector:".js-date-post-showing-custom",postExpireDateBlockSelector:".js-post-expire-date-block"};BX.SocNetGratSelector={popupWindow:null,obWindowCloseIcon:{},sendEvent:true,obCallback:{},gratsContentElement:null,itemSelectedImageItem:{},itemSelectedInput:{},searchTimeout:null,obDepartmentEnable:{},obSonetgroupsEnable:{},obLastEnable:{},obWindowClass:{},obPathToAjax:{},obDepartmentLoad:{},obDepartmentSelectDisable:{},obItems:{},obItemsLast:{},obItemsSelected:{},obElementSearchInput:{},obElementBindMainPopup:{},obElementBindSearchPopup:{}};BX.SocNetPostDateEndData.init=function(){if(this.isInitialized){return}this.addEventHandlers();if(!this.formDateTimeEditing.value){this.customDateSelectedTitle.innerText=this.getCurrentDate()}this.isInitialized=true};BX.SocNetPostDateEndData.addEventHandlers=function(){this.postExpireDateBlock=document.querySelector(this.postExpireDateBlockSelector);this.formUfInputDateCustom=document.querySelector(".js-form-post-end-time");this.formDateDuration=document.querySelector(".js-form-post-end-period");this.formDateTimeEditing=document.querySelector(".js-form-editing-post-end-time");this.popupTrigger=document.querySelector(this.popupTriggerSelector);if(this.popupTrigger){this.popupTrigger.addEventListener("click",function(t){BX.SocNetPostDateEndData.showPostEndPeriodsPopup()})}this.customDateSelectedTitle=document.querySelector(this.customDateFinalSelector);if(this.customDateSelectedTitle){this.customDateSelectedTitle.addEventListener("click",function(t){var e=new Date;var o=Math.round(e/1e3)-e.getTimezoneOffset()*60;if(this.formDateTimeEditing.value){e=BX.parseDate(this.formDateTimeEditing.value);o=BX.date.convertToUTC(e)}BX.calendar({node:this.customDateSelectedTitle,form:"blogPostForm",value:o,bTime:false,callback:function(){return true},callback_after:BX.SocNetPostDateEndData.onEndDateSet.bind(BX.SocNetPostDateEndData)})}.bind(this))}};BX.SocNetPostDateEndData.showPostEndPeriodsPopup=function(){if(!this.popupShowingPeriods){this.createPopupShowingPeriods()}this.popupShowingPeriods.popupWindow.show()};BX.SocNetPostDateEndData.createPopupShowingPeriods=function(){if(!this.menuItems){this.menuItems=this.createPopupItems()}this.popupShowingPeriods=BX.PopupMenu.create("feed-add-post-form-popup42",BX("js-post-expire-date-wrapper"),this.menuItems,{className:"feed-add-post-expire-date-options",closeByEsc:true,angle:true})};BX.SocNetPostDateEndData.createPopupItems=function(){var t=[];var e=BX.findChildren(document.querySelector(".js-post-showing-duration-options-container"),{className:"js-post-showing-duration-option"},true);if(e){e.forEach(function(e){t.push({onclick:this.onPopupItemClick.bind(this),dataset:{value:e.getAttribute("data-value"),class:e.getAttribute("data-class")},text:e.getAttribute("data-text"),className:"menu-popup-item menu-popup-no-icon "+e.getAttribute("data-class")})}.bind(this));return t}return[]};BX.SocNetPostDateEndData.onPopupItemClick=function(t){var e=t.currentTarget;if(e.getAttribute("data-class")==this.customDatePopupOptionClass){this.postExpireDateBlock.classList.add(this.customDateStyleModifier);if(this.formDateTimeEditing.value){this.formUfInputDateCustom.value=this.formDateTimeEditing.value;this.customDateSelectedTitle.innerText=this.formDateTimeEditing.value}else{this.formUfInputDateCustom.value=this.getCurrentDate()}}else{this.postExpireDateBlock.classList.remove(this.customDateStyleModifier);this.formUfInputDateCustom.value=null}this.popupTrigger.innerText=e.innerText.toLowerCase();this.formDateDuration.value=e.getAttribute("data-value").toUpperCase();this.popupShowingPeriods.popupWindow.close()};BX.SocNetPostDateEndData.onEndDateSet=function(t){if(!t){return}this.formDateTimeEditing.value=this.getFormattedDate(t);this.formUfInputDateCustom.value=this.getFormattedDate(t);this.customDateSelectedTitle.innerText=this.getFormattedDate(t)};BX.SocNetPostDateEndData.getFormattedDate=function(t){return BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),t)};BX.SocNetPostDateEndData.getCurrentDate=function(){return BX.SocNetPostDateEndData.getFormattedDate(new Date)};BX.SocNetGratSelector.init=function(t){if(!t.name)t.name="lm";BX.SocNetGratSelector.obCallback[t.name]=t.callback;BX.SocNetGratSelector.obWindowCloseIcon[t.name]=typeof t.obWindowCloseIcon=="undefined"?true:t.obWindowCloseIcon;BX.SocNetGratSelector.itemSelectedImageItem[t.name]=t.itemSelectedImageItem;BX.SocNetGratSelector.itemSelectedInput[t.name]=t.itemSelectedInput};BX.SocNetGratSelector.openDialog=function(t){if(!t)t="lm";if(BX.SocNetGratSelector.popupWindow!=null){BX.SocNetGratSelector.popupWindow.close();return false}var e=[];for(var o=0;o<arGrats.length;o++){e[e.length]=BX.create("span",{props:{className:"feed-add-grat-box "+arGrats[o].style},attrs:{title:arGrats[o].title},events:{click:BX.delegate(function(e){BX.SocNetGratSelector.selectItem(t,this.code,this.style,this.title);BX.PreventDefault(e)},arGrats[o])}})}var i=[];var s=1;for(o=0;o<e.length;o++){if(o>=e.length/2)s=2;if(i[s]==null||i[s]=="undefined")i[s]=BX.create("div",{props:{className:"feed-add-grat-list-row"}});i[s].appendChild(e[o])}BX.SocNetGratSelector.gratsContentElement=BX.create("div",{children:[BX.create("div",{props:{className:"feed-add-grat-list-title"},html:BX.message("BLOG_GRAT_POPUP_TITLE")}),BX.create("div",{props:{className:"feed-add-grat-list"},children:i})]});BX.SocNetGratSelector.popupWindow=new BX.PopupWindow("BXSocNetGratSelector",BX("feed-add-post-grat-type-selected"),{autoHide:true,offsetLeft:25,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:BX.SocNetGratSelector.obWindowCloseIcon[t]?{top:"5px",right:"10px"}:false,events:{onPopupShow:function(){if(BX.SocNetGratSelector.sendEvent&&BX.SocNetGratSelector.obCallback[t]&&BX.SocNetGratSelector.obCallback[t].openDialog)BX.SocNetGratSelector.obCallback[t].openDialog()},onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){BX.SocNetGratSelector.popupWindow=null;if(BX.SocNetGratSelector.sendEvent&&BX.SocNetGratSelector.obCallback[t]&&BX.SocNetGratSelector.obCallback[t].closeDialog)BX.SocNetGratSelector.obCallback[t].closeDialog()},this)},content:BX.SocNetGratSelector.gratsContentElement,angle:{position:"bottom",offset:20},lightShadow:true});BX.SocNetGratSelector.popupWindow.setAngle({});BX.SocNetGratSelector.popupWindow.show();return true};BX.SocNetGratSelector.selectItem=function(t,e,o,i){var s=BX.findChild(BX.SocNetGratSelector.itemSelectedImageItem[t],{tag:"span"},false,false);if(typeof s!="undefined"&&s){s.className="feed-add-grat-box "+o}BX.SocNetGratSelector.itemSelectedImageItem[t].title=i;BX.SocNetGratSelector.itemSelectedInput[t].value=e;BX.SocNetGratSelector.popupWindow.close()};var t=function(t,e){var o="blogPostForm",i=BX(o),s="POST_TITLE",a=BX(s),n=BX(o).TAGS,r=function(t){BX.bind(a,"keydown",BX.proxy(t.Init,t));BX.bind(n,"keydown",BX.proxy(t.Init,t))};if(!i)return;e=typeof e!="undefined"?!!e:true;BX.addCustomEvent(i,"onAutoSavePrepare",function(t){t.DISABLE_STANDARD_NOTIFY=true;var e=t;setTimeout(function(){r(e)},100)});BX.addCustomEvent(i,"onAutoSave",function(t,e){e["TAGS"]=BX(o).TAGS.value;delete e["POST_MESSAGE"]});if(t=="Y"){BX.addCustomEvent(i,"onAutoSaveRestoreFound",function(t,e){var i=BX.util.trim(e["text"+o])||"",a=BX.util.trim(e[s])||"";if(i.length<1&&a.length<1)return;t.Restore()})}else{BX.addCustomEvent(i,"onAutoSaveRestoreFound",BX.delegate(function(t,e){var i=BX.util.trim(e["text"+o])||"",a=BX.util.trim(e[s])||"";if(i.length<1&&a.length<1)return;var n=BX("microoPostFormLHE_blogPostForm"),r=BX.create("DIV",{attrs:{className:"feed-add-successfully"},children:[BX.create("SPAN",{attrs:{className:"feed-add-info-icon"}}),BX.create("A",{attrs:{className:"feed-add-info-text",href:"#"},events:{click:function(){t.Restore();r.parentNode.removeChild(r);return false}},text:BX.message("BLOG_POST_AUTOSAVE2")})]});if(n){n.parentNode.insertBefore(r,n)}},this))}if(e){BX.addCustomEvent(i,"onAutoSaveRestore",function(t,e){BX(s).value=e[s];if(e[s].length>0&&e[s]!=BX(s).getAttribute("placeholder")){if(BX("divoPostFormLHE_blogPostForm").style.display!="none")window["showPanelTitle_"+o](true);else window["bShowTitle"]=true;if(!!BX(s).__onchange)BX(s).__onchange()}var i=window["BXPostFormTags_"+o];if(e["TAGS"].length>0&&i){var a=i.addTag(e["TAGS"]);if(a.length>0){BX.show(i.tagsArea)}}if(BX.SocNetLogDestination){var n,l;if(e["SPERM[DR][]"]){for(n=0;n<e["SPERM[DR][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,e["SPERM[DR][]"][n],"department",false)}}if(e["SPERM[SG][]"]){for(n=0;n<e["SPERM[SG][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,e["SPERM[SG][]"][n],"sonetgroups",false)}}if(e["SPERM[U][]"]){for(n=0;n<e["SPERM[U][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,e["SPERM[U][]"][n],"users",false)}}if(!e["SPERM[UA][]"]){BX.SocNetLogDestination.deleteItem("UA","groups",BXSocNetLogDestinationFormName)}if(e["SPERM[UE][]"]){for(n=0;n<e["SPERM[UE][]"].length;n++){l=e["SPERM[UE][]"][n];BX.SocNetLogDestination.inviteEmailAddUser(BXSocNetLogDestinationFormName,{email:e["SPERM[UE][]"][n],name:BX.type.isNotEmptyString(e["INVITED_USER_NAME["+l+"]"])?e["INVITED_USER_NAME["+l+"]"]:"",lastName:BX.type.isNotEmptyString(e["INVITED_USER_LAST_NAME["+l+"]"])?e["INVITED_USER_LAST_NAME["+l+"]"]:"",createCrmContact:BX.type.isNotEmptyString(e["INVITED_USER_CREATE_CRM_CONTACT["+l+"]"])?e["INVITED_USER_CREATE_CRM_CONTACT["+l+"]"]=="Y":false})}}}r(t)})}},e={},o=function(t){if(e[t]&&e[t]["editorID"]){if(e[t]["editor"])e[t]["editor"](e[t]["text"]);else setTimeout(function(){o(t)},50)}};BX.SocnetBlogPostInit=function(i,s){this.disabled=false;e[i]={editorID:s["editorID"],showTitle:!!s["showTitle"],submitted:false,text:s["text"],autoSave:s["autoSave"],handler:LHEPostForm&&LHEPostForm.getHandler(s["editorID"]),editor:LHEPostForm&&LHEPostForm.getEditor(s["editorID"]),restoreAutosave:!!s["restoreAutosave"]};window["showPanelTitle_"+i]=function(t,o){t=t===true||t===false?t:BX("blog-title").style.display=="none";o=o!==false;var s=e[i]["showTitle"],a=BX("lhe_button_title_"+i),n=BX("feed-add-post-block"+i),r=BX("show_title")||{};if(t){BX.show(BX("blog-title"));BX.focus(BX("POST_TITLE"));e[i]["showTitle"]=true;r.value="Y";if(a){BX.addClass(a,"feed-add-post-form-btn-active")}if(n){BX.addClass(n,"blog-post-edit-open")}}else{BX.hide(BX("blog-title"));e[i]["showTitle"]=false;r.value="N";if(a)BX.removeClass(a,"feed-add-post-form-btn-active")}if(o)BX.userOptions.save("socialnetwork","postEdit","showTitle",e[i]["showTitle"]?"Y":"N");else e[i]["showTitle"]=s};window["setBlogPostFormSubmitted"]=BX.proxy(function(t){if(BX("blog-submit-button-save")){if(t){BX.addClass(BX("blog-submit-button-save"),"ui-btn-clock")}else{BX.removeClass(BX("blog-submit-button-save"),"ui-btn-clock")}}e[i]["submitted"]=t;this.disabled=t},this);window["submitBlogPostForm"]=BX.proxy(function(t,o){if(this.disabled){return}if(typeof t!="object"){o=t;t=LHEPostForm.getEditor(e[i]["editorID"])}if(t&&t.id==e[i]["editorID"]){if(e[i]["submitted"])return false;t.SaveContent();if(!o){o="save"}if(BX("blog-title").style.display=="none"){BX("POST_TITLE").value=""}var s=null;if(o=="save"&&BX("blog-submit-button-save")){s=BX("blog-submit-button-save")}else if(o=="draft"&&BX("blog-submit-button-draft")){s=BX("blog-submit-button-draft")}if(s){BX.addClass(s,"ui-btn-clock");this.disabled=true;window.addEventListener("beforeunload",BX.proxy(function(t){var o=this.submitButton;var s=this.form;setTimeout(function(){BX.removeClass(o,"ui-btn-clock");s.disabled=false;e[i]["submitted"]=false},3e3)},{submitButton:s,form:this}))}BX.submit(BX(i),o);e[i]["submitted"]=true}},this);var a=function(t,o){if(o==i){e[i]["handler"]=t;BX.addCustomEvent(t.eventNode,"OnControlClick",function(){window.SBPETabs.changePostFormTab("message")});var s=function(){var t=[BX("feed-add-post-form-notice-blockblogPostForm"),BX("feed-add-buttons-blockblogPostForm"),BX("feed-add-post-content-message-add-ins")];for(var o=0;o<t.length;o++){if(!!t[o]){BX.adjust(t[o],{style:{display:"block",height:"auto",opacity:1}})}}if(e[i]["showTitle"])window["showPanelTitle_"+i](true,false)},a=function(){var t,o=[BX("feed-add-post-form-notice-blockblogPostForm"),BX("feed-add-buttons-blockblogPostForm"),BX("feed-add-post-content-message-add-ins")];for(t=0;t<o.length;t++){if(!!o[t]){BX.adjust(o[t],{style:{display:"block",height:"0px",opacity:0}})}}if(e[i]["showTitle"])window["showPanelTitle_"+i](false,false)};BX.addCustomEvent(t.eventNode,"OnAfterShowLHE",s);BX.addCustomEvent(t.eventNode,"OnAfterHideLHE",a);if(t.eventNode.style.display=="none")a();else s()}},n=function(o){if(BX.util.in_array(o.id,window.SBPEFullForm.getInstance().initedEditorsList)){return}if(o.id==e[i]["editorID"]){e[i]["editor"]=o;if(e[i]["autoSave"]!="N")new t(e[i]["autoSave"],e[i]["restoreAutosave"]);var s=window[o.id+"Files"],a=LHEPostForm.getHandler(o.id),n,r,l,d=[],c=null;for(r in a["controllers"]){if(a["controllers"].hasOwnProperty(r)){if(a["controllers"][r]["parser"]&&a["controllers"][r]["parser"]["bxTag"]=="postimage"){c=a["controllers"][r];break}}}var u=function(t,e){return function(){t.insertFile(e)}},f=function(t,e,o){return function(){if(c){c.deleteFile(e,{});BX.remove(BX("wd-doc"+e));BX.ajax({method:"GET",url:o})}else{t.deleteFile(e,o,t,{controlID:"common"})}}};for(n in s){if(s.hasOwnProperty(n)){if(c){c.addFile(s[n])}else{r=a.checkFile(n,"common",s[n]);d.push(n);if(!!r&&BX("wd-doc"+n)&&!BX("wd-doc"+n).hasOwnProperty("bx-bound")){BX("wd-doc"+n).setAttribute("bx-bound","Y");if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-img-wrap"},true,false))&&l){BX.bind(l,"click",u(a,r));l.style.cursor="pointer"}if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-img-title"},true,false))&&l){BX.bind(l,"click",u(a,r));l.style.cursor="pointer"}if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-post-del-but"},true,false))&&l){BX.bind(l,"click",f(a,n,s[n]["del_url"]));l.style.cursor="pointer"}}}if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-post-del-but"},true,false))&&l){BX.bind(l,"click",f(a,n,s[n]["del_url"]));l.style.cursor="pointer"}}}if(d.length>0){o.SaveContent();var p=o.GetContent();p=p.replace(new RegExp("\\&\\#91\\;IMG ID=("+d.join("|")+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"[IMG ID=$1$2]");o.SetContent(p);o.Focus()}window.SBPEFullForm.getInstance().initedEditorsList.push(o.id)}};BX.addCustomEvent(window,"onInitialized",a);if(e[i]["handler"])a(e[i]["handler"],i);BX.addCustomEvent(window,"OnEditorInitedAfter",n);if(e[i]["editor"]){n(e[i]["editor"])}BX.addCustomEvent(window,"onSocNetLogMoveBody",function(t){if(t=="sonet_log_microblog_container"){o(i)}});BX.ready(function(){if(BX.browser.IsIE()&&BX("POST_TITLE")){var t=function(t){if(!this.value||this.value==this.getAttribute("placeholder")){this.value=this.getAttribute("placeholder");BX.removeClass(this,"feed-add-post-inp-active")}};BX.bind(BX("POST_TITLE"),"blur",t);t.apply(BX("POST_TITLE"));BX("POST_TITLE").__onchange=BX.delegate(function(t){if(this.value==this.getAttribute("placeholder")){this.value=""}if(this.className.indexOf("feed-add-post-inp-active")<0){BX.addClass(this,"feed-add-post-inp-active")}},BX("POST_TITLE"));BX.bind(BX("POST_TITLE"),"click",BX("POST_TITLE").__onchange);BX.bind(BX("POST_TITLE"),"keydown",BX("POST_TITLE").__onchange);BX.bind(BX("POST_TITLE").form,"submit",function(){if(BX("POST_TITLE").value==BX("POST_TITLE").getAttribute("placeholder")){BX("POST_TITLE").value=""}})}if(s["activeTab"]!=="")window.SBPETabs.changePostFormTab(s["activeTab"])})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?154412738466246";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"])return;var e={controller:{},handler:{}};BX.addCustomEvent(window,"BFileDLoadFormControllerWasBound",function(t){e.controller[t.id]=true});BX.addCustomEvent(window,"WDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"WDLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"DiskDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"DiskLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"OnEditorInitedBefore",function(t){if(e.handler[t.id]){t.__lhe_flags=["OnEditorInitedBefore"];if(e.handler[t.id]["params"]&&e.handler[t.id]["params"]["LHEJsObjName"])window[e.handler[t.id].params["LHEJsObjName"]]=t;e.handler[t.id].OnEditorInitedBefore(t)}});var t=function(t){if(e.handler[t.id]&&e.handler[t.id].editorIsLoaded!==true){e.handler[t.id].editorIsLoaded=true;e.handler[t.id].exec();BX.onCustomEvent(e.handler[t.id],"OnEditorIsLoaded",[e.handler[t.id],t])}};BX.addCustomEvent(window,"OnCreateIframeAfter",t);BX.addCustomEvent(window,"OnEditorInitedAfter",function(i,n){if(e.handler[i.id]){i.__lhe_flags.push("OnEditorInitedAfter");e.handler[i.id].OnEditorInitedAfter(i);if(e.handler[i.id].editorIsLoaded!==true&&n&&i.sandbox&&i.sandbox.inited)t.apply(i,[i])}});BX.util.object_search=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){if(t[i]==e)return true;else if(typeof t[i]=="object"&&t[i]!==null){var n=BX.util.object_search_key(e,t[i]);if(n!==false)return n}}}return false};var i=function(e,t,i){i=i&&i.length>0?i:[];if(typeof t=="object"&&t.length>0){var n;while((n=t.pop())&&n&&t.length>0){i.push(n)}t=n}i.push(t);this.exist=true;this.bxTag=e;this.tag=t;this.tags=i;this.regexp=new RegExp("\\[("+i.join("|")+")=((?:\\s|\\S)*?)(?:\\s*?WIDTH=(\\d+)\\s*?HEIGHT=(\\d+))?\\]","ig");this.code="["+t+"=#ID##ADDITIONAL#]";this.wysiwyg='<span style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;" id="#ID#"#ADDITIONAL#>#NAME#</span>'},n=function(t,i,n){this.CID=this.id=i;this.parser=t.parser["disk_file"]||null;this.params=n;this.node=BX("diskuf-selectdialog-"+i);this.handler=e.controller[i];this.manager=t;this.eventNode=this.manager.eventNode;this.parserName="disk_file";this.prefixNode="disk-edit-attach";this.prefixHTMLNode="disk-attach-";this.props={valueEditClassName:"wd-inline-file",securityCID:"disk-upload-cid"};this.storage="disk";this.fileToAttach={};this.xmlToAttach={};this.events={onInit:"DiskDLoadFormControllerInit",onShow:"DiskLoadFormController",onBound:"DiskLoadFormControllerWasBound"}};n.prototype={parser:false,eventNode:null,values:{},initialized:false,functionsToExec:[],exec:function(e,t){if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.handler&&this.handler!==true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},init:function(){if(this.initialized!==true){this.values={};this.functionsToExec=[];this.initialized=true;this.bindMainEvents(this.manager);if(this.parser!==null){this.bindEvents(this.manager);return this.initValues()}}return false},initValues:function(){var e=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(e&&e.length>0){this.exec(this.runCheckText);return true}return false},bindMainEvents:function(t){var i=null;BX.addCustomEvent(t.eventNode,"onReinitializeBefore",BX.proxy(this.clean,this));BX.addCustomEvent(t.eventNode,"onShowControllers",BX.proxy(function(e){i=e;BX.onCustomEvent(t.eventNode,this.events.onShow,[e])},this));if(!e.controller[this.id]){var o=BX.delegate(function(e){if(e["UID"]==this.id||e["id"]==this.id){if(i==="show"||i==="hide"){BX.onCustomEvent(t.eventNode,this.events.onShow,[i]);i=null}BX.removeCustomEvent(window,this.events.onBound,o)}},this);BX.addCustomEvent(window,this.events.onBound,o)}if(BX["DD"]&&this.storage=="disk"){var a=BX.delegate(function(e){if((e["UID"]==this.id||e["id"]==this.id)&&this.manager["dropZoneExists"]!==true){BX.removeCustomEvent(window,this.events.onBound,a);this.manager["dropZoneExists"]=true;var i=this.eventNode,o=this.id;n.dndCatcher=n.dndCatcher||{};n.dndCatcher[o]={catch:true,files:[],dropZone:null,dropZoneMicro:null,initdrag:BX.delegate(function(){n.dndCatcher[o].dropZone=new BX.DD.dropFiles(t.eventNode);BX.addCustomEvent(t.eventNode,"OnImageDataUriHandle",BX.delegate(function(e,t){if(BX["UploaderUtils"]){var i=BX.UploaderUtils.dataURLToBlob(t.src);if(i&&i.size>0&&i.type.indexOf("image/")==0){i.name=i.name||t.title||"image."+i.type.substr(6);i.referrerToEditor=t;if(n.dndCatcher[o]["catch"]===true)n.dndCatcher[o]["drop"]([i]);else if(this.handler&&this.handler["addFile"])this.handler.addFile(i);BX.onCustomEvent(e,"OnImageDataUriCaught",[t])}}},this));BX.addCustomEvent(n.dndCatcher[o].dropZone,"dropFiles",n.dndCatcher[o]["drop"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragEnter",n.dndCatcher[o]["dragover"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragLeave",n.dndCatcher[o]["dragleave"]);if(BX("micro"+t.__divId)){n.dndCatcher[o].dropZoneMicro=new BX.DD.dropFiles(BX("micro"+t.__divId));BX.addCustomEvent(n.dndCatcher[o].dropZoneMicro,"dragEnter",function(){BX.onCustomEvent(t.eventNode,"OnShowLHE",["justShow"])})}BX.unbind(document,"dragover",n.dndCatcher[o]["initdrag"]);BX.onCustomEvent(t.eventNode,"onDropZoneExists",[])},this),dragover:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragover",[])},this),dragleave:BX.delegate(function(){BX.removeClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragleave",[])},this),dragenterwindow:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.addClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragenterwindow",[])},this),dragleavewindow:BX.delegate(function(e){BX.removeClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.removeClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragleavewindow",[])},this),drop:BX.delegate(function(e){BX.onCustomEvent(t.eventNode,"drop",[]);BX.onCustomEvent(window,"dragWindowLeave");BX.onCustomEvent(window,"__dragWindowLeave");var i=0;if(e&&e.length>0){if(n.dndCatcher[o]["catch"]===true){n.dndCatcher[o].files=e;i=1}else{i=2}BX.onCustomEvent(t.eventNode,this.events.onShow,["show"]);BX.removeClass(t.eventNode,"feed-add-post-dnd-ready feed-add-post-dnd-over")}return i},this)};BX.ready(function(){n.dndCatcher[o]["initdrag"]()});BX.addCustomEvent(i,"OnIframeDrop",BX.delegate(function(e){BX.PreventDefault(e);if(e["dataTransfer"]&&e["dataTransfer"]["files"]){if(n.dndCatcher[o].drop(e["dataTransfer"]["files"])===2){this.handler.agent.onChange(e["dataTransfer"]["files"])}}},this));BX.addCustomEvent(i,"OnIframeDragOver",n.dndCatcher[o].dragover);BX.addCustomEvent(i,"OnIframeDragLeave",n.dndCatcher[o].dragleave);if(!window["bxMpfDndCatcher"]){window["bxMpfDndCatcher"]=true;var s=false,r=function(){if(s===false){s=true;BX.bind(document,"dragleave",l);BX.bind(document,"dragover",l);BX.bind(document,"mouseout",d);BX.onCustomEvent(window,"dragWindowEnter")}},d=function(e){BX.unbind(document,"dragleave",l);BX.unbind(document,"dragover",l);BX.unbind(document,"mouseout",d);s=false;BX.onCustomEvent(window,"dragWindowLeave")},l=function(e){if(h>0){clearTimeout(h);h=0}BX.fixEventPageXY(e);var t=true;if(e.pageX>0&&e.pageY>0){var i=BX.GetWindowSize();if(e.pageY<i.scrollHeight&&e.pageX<i.scrollWidth){var n=e.pageY-i.scrollTop,o=e.pageX-i.scrollLeft;if(0<n&&n<i.innerHeight-20&&0<o&&o<i.innerWidth-20){t=false}}}if(t){d(e)}else{h=setTimeout(function(){l({type:"intervalLimit"})},100)}},h=0;BX.bind(document,"dragenter",function(e){if(window["bxMpfDndCatcher"]>0){clearTimeout(window["bxMpfDndCatcher"])}var t=true;if(e&&e["dataTransfer"]&&e["dataTransfer"]["types"]){for(var i=0;i<e["dataTransfer"]["types"].length;i++){if(e["dataTransfer"]["types"][i]=="Files"){t=true;break}}}if(t){r()}});BX.addCustomEvent(window,"__dragWindowLeave",d);BX.bind(document,"dragover",function(e){return BX.PreventDefault(e)});BX.bind(document,"drop",function(e){d(e);return BX.PreventDefault(e)})}BX.addCustomEvent(window,"dragWindowEnter",n.dndCatcher[o].dragenterwindow);BX.addCustomEvent(window,"dragWindowLeave",n.dndCatcher[o].dragleavewindow);this.__initCatcher=BX.delegate(function(e,i){if(e==this.id){BX.removeCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher);i.agent.initDropZone(t.eventNode);if(n.dndCatcher[e].files.length>0){i.agent.onChange(n.dndCatcher[e].files);n.dndCatcher[e].files=[]}n.dndCatcher[e]["catch"]=false;this.__initCatcher=null}},this);BX.addCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher)}},this);BX.addCustomEvent(window,this.events.onBound,a);if(e.controller[this.id])a(e.controller[this.id])}},bindEvents:function(e){this._catchHandler=BX.delegate(function(t){BX.removeCustomEvent(this.eventNode,this.events.onInit,this._catchHandler);this.handler=t;var i=BX.findChild(BX(e.formID),{attr:{id:this.props.securityCID}},true,false);if(i)i.value=this.handler.CID;this.exec();var n=BX.delegate(function(){BX.onCustomEvent(e.eventNode,"onUploadsHasBeenChanged",arguments)},this);BX.addCustomEvent(this.handler.agent,"onFileIsInited",n);BX.addCustomEvent(this.handler.agent,"ChangeFileInput",n);BX.onCustomEvent(e.eventNode,"onControllerInitialized",[this.id,t])},this);if(typeof this.handler!="object"||!this.handler)BX.addCustomEvent(e.eventNode,this.events.onInit,this._catchHandler);else this._catchHandler(this.handler);BX.addCustomEvent(e.eventNode,"OnFileUploadSuccess",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){i=i||{};i.usePostfix=true;this.addFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadFailed",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){this.failFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadRemove",BX.delegate(function(e,t){if(this.id==t.CID||this.id==t.id){this.deleteFile(e,{usePostfix:true},t)}},this));BX.addCustomEvent(this,"onFileIsInText",BX.proxy(function(e,t){this.adjustFile(this.checkFile(e),t)},this))},addFile:function(e,t,i){var n=this.checkFile(e.element_id,e,t);if(n){setTimeout(BX.proxy(function(){this.bindFile(n);this.adjustFile(n,false)},this),100);BX.onCustomEvent(this.eventNode,"onFileIsAdded",[n,this,i,t])}else{this.failFile(this,t,i)}return true},failFile:function(e,t,i){BX.onCustomEvent(this.eventNode,"onFileIsFailed",[this,i,t])},checkFile:function(e,t){e=""+(typeof e=="object"?e.id:e);if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(t.place)){var i={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(t.place,true),xmlID:BX(t.place,true).getAttribute("bx-attach-xml-id"),fileID:BX(t.place,true).getAttribute("bx-attach-file-id"),fileType:BX(t.place,true).getAttribute("bx-attach-file-type")},n;if(/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name)&&(n=BX.findChild(i.place,{className:"files-preview",tagName:"IMG"},true,false))&&n){i.type="image/xyz";i.lowsrc=n.src;i.element_url=i.src=n.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight=(\d+)/,"");i.isImage=true;i.width=parseInt(n.getAttribute("data-bx-full-width")||n.getAttribute("data-bx-width"));i.height=parseInt(n.getAttribute("data-bx-full-height")||n.getAttribute("data-bx-height"))}if(i.xmlID)this.xmlToAttach[i.xmlID+""]=e;if(i.fileID)this.fileToAttach[i.fileID+""]=e;this.values[e]=i}return this.values[e]||false},bindFile:function(e){var t=e.place;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){var i=BX.findChild(t,{className:"f-wrap"},true,false),n=BX.findChild(t,{className:"files-preview"},true,false);if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e.id)},this));i.style.cursor="pointer";i.title=BX.message("MPF_FILE")}if(n){BX.bind(n,"click",BX.delegate(function(){this.insertFile(e.id)},this))}}},adjustFile:function(e,t){var i=e.place;if(t===true||t===false){if(!e.info)e.info=BX.findChild(e.place,{className:"files-info"},true,false);i=e.info;if(BX.type.isDomNode(i)){var n="check-in-text-"+e.id,o=BX(n),a=t===false?{attrs:{"bx-file-is-in-text":"N"},props:{className:"insert-btn"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_INSERT_IN_TEXT")+"</span>"}:{attrs:{"bx-file-is-in-text":"Y"},props:{className:"insert-text"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_IN_TEXT")+"</span>"};if(!o){a.attrs.id=n;a.events={click:BX.proxy(function(){this.insertFile(e.id)},this)};i.appendChild(BX.create("SPAN",a))}else{BX.adjust(o,a)}}}},insertFile:function(e){BX.onCustomEvent(this.eventNode,"onFileIsInserted",[this.checkFile(e),this])},deleteFile:function(e,t){e=this.checkFile(e,t);if(e){BX.onCustomEvent(this.eventNode,"onFileIsDeleted",[e,this]);this.values[e.id].place=null;delete this.values[e.id].place;this.values[e.id]=null;delete this.values[e.id];e=null;return true}return false},reinitValues:function(e,t){var i,n,o={};while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("data-bx-title")||n.getAttribute("data-title"),size:n.getAttribute("data-bx-size")||"",sizeInt:n.getAttribute("data-bx-size")||"",width:n.getAttribute("data-bx-width"),height:n.getAttribute("data-bx-height"),storage:"disk",previewUrl:n.tagName=="A"?"":n.getAttribute("data-bx-src")||n.getAttribute("data-src"),fileId:n.getAttribute("bx-attach-file-id")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");if(n.hasAttribute("bx-attach-file-type"))o["E"+i]["fileType"]=n.getAttribute("bx-attach-file-type")}}this.handler.selectFile({},{},o);this.runCheckText()},runCheckText:function(){if(!this._checkText)this._checkText=BX.delegate(this.checkText,this);this.manager.exec(this._checkText)},checkText:function(){var e,t=this.manager.getContent(),i=[],n,o;if(t!=""){e=t;for(o in this.xmlToAttach){if(this.xmlToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]").replace(new RegExp("\\[DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]")}}for(o in this.fileToAttach){if(this.fileToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;"+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]").replace(new RegExp("\\["+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]")}}n=new RegExp("(?:\\&\\#91\\;)("+this.parser["tags"].join("|")+")=([a-z=0-9 ]+)(?:\\&\\#93\\;)","gim");if(n.test(t)){for(o in this.values){if(this.values.hasOwnProperty(o)){i.push(o)}}if(i.length>0){n=new RegExp("(?:\\&\\#91\\;|\\[)("+this.parser["tags"].join("|")+")=("+i.join("|")+")([WIDTHHEIGHT=0-9 ]*)(?:\\&\\#93\\;|\\])","gim");if(n.test(t))t=t.replace(n,BX.delegate(function(e,t,i,n){return"["+t+"="+i+n+"]"},this))}}if(e!=t)BX.onCustomEvent(this.eventNode,"onFileIsDetected",[t,this])}return t},clean:function(){if(this.handler&&this.handler.values){var e,t,i,n=BX(this.manager.formID);while((e=this.handler.values.pop())&&e){BX.remove(e)}if(this.handler.params&&this.handler.params.controlName){t=BX.findChildren(n,{tagName:"INPUT",attribute:{name:this.handler.params.controlName}},true)}if(t){for(i=0;i<t.length;i++){BX.remove(t[i])}}}},reinit:function(e,t){var i=[],n,o;for(n in t){if(t.hasOwnProperty(n)){if(t[n]["USER_TYPE_ID"]==this.parserName&&t[n]["VALUE"]){for(o in t[n]["VALUE"]){if(t[n]["VALUE"].hasOwnProperty(o)){i.push(t[n]["VALUE"][o])}}}}}if(i.length>0){this.exec(this.reinitValues,[e,i]);return true}return false}};var o=function(e,t,i){o.superclass.constructor.apply(this,arguments);this.parser=e.parser["webdav_element"]||null;this.node=BX("wduf-selectdialog-"+t);this.manager=e;this.parserName="webdav_element";this.prefixNode="wd-doc";this.prefixHTMLNode="wdif-doc-";this.storage="webdav";this.events={onInit:"WDLoadFormControllerInit",onShow:"WDLoadFormController",onBound:"WDLoadFormControllerWasBound"}};BX.extend(o,n);o.prototype.reinitValues=function(e,t){var i,n,o={};this.waitAnswerFromServer=[];while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("alt"),storage:"webdav",size:n.getAttribute("data-bx-size"),sizeInt:1,ext:"",link:n.getAttribute("data-bx-document")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");this.waitAnswerFromServer.push(i)}}if(this.waitAnswerFromServer.length>0){if(!this._defferCheckText)this._defferCheckText=BX.delegate(this.defferCheckText,this);BX.addCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText);this.handler.WDFD_SelectFile({},{},o)}};o.prototype.defferCheckText=function(e){var t=BX.util.array_search(e.element_id,this.waitAnswerFromServer);if(t>=0){this.runCheckText();this.waitAnswerFromServer=BX.util.deleteFromArray(this.waitAnswerFromServer,t)}if(this.waitAnswerFromServer.length<=0)BX.removeCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText)};var a=function(e,t,i){a.superclass.constructor.apply(this,arguments);this.parser=e.parser["file"]?e.parser["file"]:e.parser["postimage"]["exist"]?e.parser["postimage"]:null;this.postfix=i["postfix"]||"";this.node=BX("file-selectdialog-"+t);this.parserName="file";this.prefixNode="wd-doc";this.prefixHTMLNode="file-doc-";this.props={valueEditClassName:"file-inline-file",securityCID:"upload-cid"};this.storage="bfile";this.events={onInit:"BFileDLoadFormControllerInit",onShow:"BFileDLoadFormController",onBound:"BFileDLoadFormControllerWasBound"}};BX.extend(a,n);a.prototype.initValues=function(e){var t;if(e!==true){t=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(t&&t.length>1){this.exec(this.initValues,[true]);return true}return false}t=this.handler.agent.values||[];var i,n,o,a,s={},r="/bitrix/components/bitrix/main.file.input/file.php?mfi_mode=down&cid="+this.handler.CID+"&sessid="+BX.bitrix_sessid();for(var d=0;d<t.length;d++){a=parseInt(t[d].getAttribute("id").replace(this.prefixNode,""));if(s["id"+a])continue;s["id"+a]="Y";if(a>0){n=BX.findChild(t[d],{className:"f-wrap"},true,false);if(!n)continue;o={element_id:a,element_name:n.innerHTML,parser:this.parser.bxTag,storage:"bfile",element_url:r+"&fileID="+a};i=this.addFile(o,{usePostfix:true,hasPreview:false})}}this.runCheckText();return true};a.prototype.checkFile=function(e,t,i){e=""+(typeof e=="object"?e.id:e);e=e+(i&&i["usePostfix"]===true?this.postfix:"");if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(this.prefixNode+t.element_id,true)){var n={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(this.prefixNode+t.element_id,true)},o;if((t["element_type"]&&t["element_type"].indexOf("image/")===0||/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name))&&((o=BX.findChild(n.place,{tagName:"IMG"},true,false))&&o||i&&i["hasPreview"]===false)){n.type="image/xyz";n.src=t["element_thumbnail"]||t["element_url"];n.isImage=true;n.hasPreview=false;n.lowsrc="";n.width="";n.height="";if(BX(o)){n.hasPreview=true;n.lowsrc=t["element_thumbnail"]||o["src"];n.width=parseInt(o.getAttribute("data-bx-full-width"));n.height=parseInt(o.getAttribute("data-bx-full-height"))}}else if(this.parser.bxTag=="postimage"){return false}if(BX(n.place,true).getAttribute("bx-attach-file-type")){n.fileType=BX(n.place,true).getAttribute("bx-attach-file-type")}this.values[e]=n}return this.values[e]||false};a.prototype.bindFile=function(e){var t=e&&e["place"]?e["place"]:null;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){if(e.isImage&&e.hasPreview){var i=BX.findChild(t,{className:"feed-add-img-title"},true,false),n=BX.findChild(t,{className:"feed-add-img-wrap"},true,false);if(n){BX.bind(n,"click",BX.proxy(function(){this.insertFile(e)},this));n.style.cursor="pointer";n.title=BX.message("MPF_IMAGE")}if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e)},this));i.style.cursor="pointer";i.title=BX.message("MPF_IMAGE")}}else a.superclass.bindFile.apply(this,arguments)}};a.prototype.clean=function(){a.superclass.clean.apply(this,arguments);if(this["handler"]&&this.handler["agent"]&&this.handler.agent["inputName"]){var e,t,i=BX(this.manager.formID);e=BX.findChildren(i,{tagName:"INPUT",attribute:{name:this.handler.agent.inputName+"[]"}},true);if(e){for(t=0;t<e.length;t++){BX.remove(e[t])}}}};var s=function(t,i){this.params=i;this.formID=t;this.showPinButton=!!BX("lhe_button_editor_"+this.formID);if(this.showPinButton){this.params.showPanelEditor=!!this.params.pinEditorPanel}this.oEditorId=i["LHEJsObjId"];this.__divId=i["LHEJsObjName"]||i["LHEJsObjId"];e.handler[this.oEditorId]=this;this.oEditor=s.getEditor(this.oEditorId);this.urlPreview=this.initUrlPreview(i);this.eventNode=BX("div"+this.__divId);BX.addCustomEvent(this.eventNode,"OnShowLHE",BX.delegate(this.OnShowLHE,this));BX.addCustomEvent(this.eventNode,"OnButtonClick",BX.delegate(this.OnButtonClick,this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){if(t.oEditor&&t.oEditor["AllowBeforeUnloadHandler"])t.oEditor.AllowBeforeUnloadHandler();if(t.monitoringWakeUp===true)t.monitoringStart()});BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",function(e,t){t.monitoringWakeUp=t.monitoringStop();if(t.oEditor&&t.oEditor["DenyBeforeUnloadHandler"])t.oEditor.DenyBeforeUnloadHandler()});this.initParsers(i);this.initFiles(t,i);BX.ready(BX.delegate(function(){if(BX("lhe_button_submit_"+t,true)){BX.bind(BX("lhe_button_submit_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["submit"]);return BX.PreventDefault(e)},this))}if(BX("lhe_button_cancel_"+t,true)){BX.bind(BX("lhe_button_cancel_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["cancel"]);return BX.PreventDefault(e)},this))}},this));this.inited=true;BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){e.FORM.setAttribute("bx-lhe-autosave-prepared","Y")});BX.onCustomEvent(this,"onInitialized",[this,t,i,this.parsers]);BX.onCustomEvent(this.eventNode,"onInitialized",[this,t,i,this.parsers]);if(this.oEditor&&this.oEditor.inited&&!this.oEditor["__lhe_flags"]){BX.onCustomEvent(this.oEditor,"OnEditorInitedBefore",[this.oEditor]);BX.onCustomEvent(this.oEditor,"OnEditorInitedAfter",[this.oEditor,true])}};s.prototype={editorIsLoaded:false,arFiles:{},parser:{},controllers:{},exec:function(e,t){this.functionsToExec=this.functionsToExec||[];if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.editorIsLoaded===true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},initParsers:function(e){this.parser={postimage:{exist:false,bxTag:"postimage",tag:"IMG ID",tags:["IMG ID"],regexp:/\[(IMG ID)=((?:\s|\S)*?)(?:\s*?WIDTH=(\d+)\s*?HEIGHT=(\d+))?\]/gi,code:"[IMG ID=#ID##ADDITIONAL#]",wysiwyg:'<img id="#ID#" src="'+'#SRC#" lowsrc="'+'#LOWSRC#" title=""#ADDITIONAL# />'},player:{exist:false,bxTag:"player",tag:"FILE ID",tags:["FILE ID"],regexp:/\[(FILE ID)=((?:\s|\S)*?)?\]/gi,code:"[FILE ID=#ID##ADDITIONAL#]",wysiwyg:'<img class="bxhtmled-player-surrogate" id="#ID#" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" contenteditable="false" title=""#ADDITIONAL# />'}};var t=e["parsers"]?e["parsers"]:{};for(var n in t){if(t.hasOwnProperty(n)&&/[a-z]/gi.test(n+"")){this.parser[n]=new i(n,t[n])}}if(BX.util.object_search("UploadImage",t)){this.parser["postimage"]["exist"]=true}if(typeof e["arSize"]=="object"){var o="";if(e["arSize"]["width"])o+="max-width:"+e["arSize"]["width"]+"px;";if(e["arSize"]["height"])o+="max-height:"+e["arSize"]["height"]+"px;";if(o!=="")this.parser["postimage"]["wysiwyg"]=this.parser["postimage"]["wysiwyg"].replace("#ADDITIONAL#",' style="'+o+'" #ADDITIONAL#')}},initFiles:function(e,t){this.arFiles={};this.controllers={common:{postfix:"",storage:"bfile",parser:"postimage",node:window,obj:null,init:false}};this.monitoring={interval:null,text:"",savedText:"",files:[],savedFiles:[]};if(!t["CID"]||typeof t["CID"]!=="object")return;BX.addCustomEvent(this.eventNode,"onFileIsAdded",BX.delegate(this.OnFileUploadSuccess,this));BX.addCustomEvent(this.eventNode,"onFileIsFailed",BX.delegate(this.OnFileUploadFailed,this));BX.addCustomEvent(this.eventNode,"onFileIsDeleted",BX.delegate(this.OnFileUploadRemove,this));BX.addCustomEvent(this.eventNode,"onFileIsDetected",BX.delegate(this.setContent,this));BX.addCustomEvent(this.eventNode,"onFileIsInserted",BX.delegate(this.insertFile,this));var i,s,r;for(s in t["CID"]){if(t["CID"].hasOwnProperty(s)){i=t["CID"][s]["parser"];if(i=="disk_file")this.controllers[s]=new n(this,s,t["CID"][s]);else if(i=="webdav_element")this.controllers[s]=new o(this,s,t["CID"][s]);else if(i=="file")this.controllers[s]=new a(this,s,t["CID"][s]);if(this.controllers[s]&&this.controllers[s].init()&&!r)r=true}}BX.ready(BX.delegate(function(){BX.bind(BX("bx-b-uploadfile-"+e),"click",BX.proxy(this.controllerInit,this));if(r)this.controllerInit("show")},this))},controllerInit:function(e){this.controllerInitStatus=e=="show"||e=="hide"?e:this.controllerInitStatus=="show"?"hide":"show";BX.onCustomEvent(this.eventNode,"onShowControllers",[this.controllerInitStatus])},initUrlPreview:function(){if(this.params["urlPreviewId"]&&window["BXUrlPreview"]&&BX(this.params["urlPreviewId"])){return new BXUrlPreview(BX(this.params["urlPreviewId"]))}return null},getContent:function(){return this.oEditor?this.oEditor.GetContent():""},setContent:function(e){if(this.oEditor)this.oEditor.SetContent(e)},OnFileUploadSuccess:function(e,t,i,n){if(this.controllers[t.id]){var o=t.parser.bxTag+e.id;this.arFiles[o]=this.arFiles[o]||[];this.arFiles[o].push(t.id);if(n&&n["referrerToEditor"]){var a=this.getFileToInsert(e,t);BX.onCustomEvent(n["referrerToEditor"],"OnImageDataUriCaughtUploaded",[a]);BX.onCustomEvent(this.oEditor,"OnImageDataUriCaughtUploaded",[n["referrerToEditor"],e,a])}else if(i===true&&e.isImage&&this.insertImageAfterUpload){if(!this._insertFile)this._insertFile=BX.delegate(this.insertFile,this);this.exec(this._insertFile,arguments)}}},OnFileUploadFailed:function(e,t,i){if(i&&i["referrerToEditor"]){BX.onCustomEvent(i["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(this.editor,"OnImageDataUriCaughtFailed",[i["referrerToEditor"]])}},OnFileUploadRemove:function(e,t){if(this.controllers[t.id]){var i=t.parser.bxTag+e.id;if(this.arFiles[i]){var n=BX.util.array_search(t.id,this.arFiles[i]);this.arFiles[i]=BX.util.deleteFromArray(this.arFiles[i],n);if(!this.arFiles[i]||this.arFiles[i].length<=0){this.arFiles[i]=null;delete this.arFiles[i];if(!this._deleteFile)this._deleteFile=BX.delegate(this.deleteFile,this);this.exec(this._deleteFile,arguments)}}}},showPanelEditor:function(e,t){if(e==undefined)e=!this.oEditor.toolbar.IsShown();this.params.showPanelEditor=e;var i=BX("lhe_button_editor_"+this.formID),n=BX("panel-close"+this.__divId);if(n){this.oEditor.dom.cont.appendChild(n)}if(e){this.oEditor.dom.toolbarCont.style.opacity="inherit";this.oEditor.toolbar.Show();if(i)BX.addClass(i,"feed-add-post-form-btn-active");if(n)n.style.display=""}else{this.oEditor.toolbar.Hide();if(i)BX.removeClass(i,"feed-add-post-form-btn-active");if(n)n.style.display="none"}if(t!==false)BX.userOptions.save("main.post.form","postEdit","showBBCode",e?"Y":"N")},monitoring:{},monitoringStart:function(){if(this.monitoring.interval===null){if(!this._monitoringStart){this._monitoringStart=BX.delegate(this.checkFilesInText,this);BX.addCustomEvent(this.oEditor,"OnContentChanged",BX.proxy(function(e){this.monitoring.text=e},this))}this.monitoring.interval=setInterval(this._monitoringStart,1e3)}},monitoringStop:function(){var e=this.monitoring.interval!==null;if(this.monitoring.interval!==null)clearInterval(this.monitoring.interval);this.monitoring.interval=null;return e},monitoringSetStatus:function(e,t,i){if(this.arFiles[e+t]){var n;for(var o=0;o<this.arFiles[e+t].length;o++){n=this.arFiles[e+t][o];BX.onCustomEvent(this.controllers[n],"onFileIsInText",[t,i])}}},checkFilesInText:function(){if(this.monitoring.text!==this.monitoring.savedText){this.monitoring.savedText=this.monitoring.text;this.monitoring.files=[];var e=this.monitoring.savedText,t,i=function(e,t){return function(i,n,o){e.monitoring.files.push([t,o].join("/"))}};for(t in this.parser){if(this.parser.hasOwnProperty(t)){if(!this.parser[t]["checkFilesInText"]){this.parser[t]["checkFilesInText"]=i(this,t)}e.replace(this.parser[t]["regexp"],this.parser[t]["checkFilesInText"])}}if(this.monitoring.savedFiles.join(",")!==this.monitoring.files.join(",")){var n={},o;while(o=this.monitoring.savedFiles.pop()){n[o]=null}for(t=0;t<this.monitoring.files.length;t++){o=this.monitoring.files[t];n[o]=n[o]>=0?n[o]+1:1}for(t in n){if(n.hasOwnProperty(t)){o=t.split("/");this.monitoringSetStatus(o[0],o[1],n[t]>0)}}}this.monitoring.savedFiles=this.monitoring.files;if(this.monitoring.savedFiles.length<=0)this.monitoringStop()}},checkFile:function(e,t){var i=false;if(typeof e=="string"){var n=typeof t=="string"?t:t.parser;if(!!this.arFiles[n+e]){var o=this.arFiles[n+e][0];t=this.controllers[o];i={file:t.values[e],controller:t}}}else if(this.controllers[t.id]){i={file:e,controller:t}}return i},insertFile:function(e,t){var i=this.oEditor;if(i&&e){var n=i.GetViewMode(),o=this.getFileToInsert(e,t);if(n=="wysiwyg"){i.InsertHtml(o.replacement);setTimeout(BX.delegate(i.AutoResizeSceleton,i),500);setTimeout(BX.delegate(i.AutoResizeSceleton,i),1e3)}else if(n=="code"){i.textareaView.Focus();if(!i.bbCode){var a=i.GetIframeDoc();var s=a.createElement("DIV");s.style.display="none";s.innerHTML=o.replacement;a.body.appendChild(s);o.replacement=i.Parse(o.replacement,true,false);s.parentNode.removeChild(s)}i.textareaView.WrapWith("","",o.replacement)}else{return}o["callback"]()}},getFileToInsert:function(e,t){var i=this.oEditor;if(i&&e){var n=e["id"],o="",a=t.parser,s=i.bbCode?i.GetViewMode():"wysiwyg",r=this.parser[a.bxTag][s];if(e["fileType"]&&this.parser[e["fileType"]]&&s=="wysiwyg"){r=this.parser[e["fileType"]][s]}if(e["isImage"]){r=s=="wysiwyg"?this.parser["postimage"][s]:r;if(e.width>0&&e.height>0&&i.sEditorMode=="html"){o=' style="width:'+e.width+"px;height:"+e.height+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}if(s=="wysiwyg"){r=r.replace("#ID#",i.SetBxTag(false,{tag:a.bxTag,params:{value:n}})).replace("#SRC#",e.src).replace("#URL#",e.url).replace("#LOWSRC#",e.lowsrc||"").replace("#NAME#",e.name).replace("#ADDITIONAL#",o)+"<span>&nbsp;</span>"}else if(s=="code"&&i.bbCode){r=r.replace("#ID#",n).replace("#ADDITIONAL#","")}return{replacement:r,callback:BX.proxy(function(){this.monitoringSetStatus(t.parser.bxTag,e.id,true);this.monitoringStart()},this)}}return{replacement:"",callback:BX.DoNothing}},deleteFile:function(e,t){var i=this.oEditor,n=t.parser,o=e.id,a=i.GetContent();if(n&&a.indexOf("="+o)>=0){if(i.GetViewMode()=="wysiwyg"){var s=i.GetIframeDoc(),r,d;for(r in i["bxTags"]){if(i["bxTags"].hasOwnProperty(r)){if(typeof i.bxTags[r]=="object"&&i.bxTags[r]["params"]&&i.bxTags[r]["params"]["value"]==e.id){d=s.getElementById(r);if(d)d.parentNode.removeChild(d)}}}i.SaveContent()}else{a=a.replace(n.regexp,function(t,i,n){return n==e.id?"":t});i.SetContent(a);i.Focus()}this.monitoringSetStatus(n.bxTag,e.id,false)}},reinit:function(e,t){BX.onCustomEvent(this.eventNode,"onReinitializeBefore",[this,e,t]);this.arFiles={};delete this.monitoringWakeUp;this.monitoringStop();this.oEditor.CheckAndReInit(e||"");BX.onCustomEvent(this.eventNode,"onReinitialize",[this,e,t]);var i,n=false;for(i in this.controllers){if(this.controllers.hasOwnProperty(i)){if(this.controllers[i]["init"]&&this.controllers[i].reinit(e,t))n=true}}this.controllerInit(n?"show":"hide");if(this.params["~height"]){this.oEditor.SetConfigHeight(this.params["~height"]);this.oEditor.ResizeSceleton()}if(this.urlPreview){this.urlPreview.detachUrlPreview();var o;for(var a in t){if(t.hasOwnProperty(a)&&t[a].hasOwnProperty("USER_TYPE_ID")&&t[a]["USER_TYPE_ID"]==="url_preview"){o=t[a]["VALUE"]}}if(o)this.urlPreview.attachUrlPreview({id:o})}},Parse:function(e,t,i){var n=this.parser[e],o=this;if(n){t=t.replace(n.regexp,function(t,a,s,r,d){var l=o.checkFile(s,e);if(l&&(l=l.file)&&l){var h="",f=l.isImage?o.parser.postimage.wysiwyg:n.wysiwyg;o.monitoringStart();if(l.fileType&&o.parser[l.fileType]&&o.parser[l.fileType].wysiwyg){f=o.parser[l.fileType].wysiwyg}if(l.isImage){r=parseInt(r);d=parseInt(d);h=r&&d?' width="'+r+'" height="'+d+'"':"";if(h===""&&l["width"]>0&&l["height"]>0){h=' style="width:'+l["width"]+"px;height:"+l["height"]+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}return f.replace("#ID#",i.SetBxTag(false,{tag:e,params:{value:s}})).replace("#NAME#",l.name).replace("#SRC#",l.src).replace("#LOWSRC#",l.lowsrc).replace("#ADDITIONAL#",h).replace("#WIDTH#",parseInt(r)).replace("#HEIGHT#",parseInt(d))}return t})}return t},Unparse:function(e,t){var i="",n=e.tag;if(this.parser[n]){var o=parseInt(t.node.hasAttribute("width")?t.node.getAttribute("width"):0),a=parseInt(t.node.hasAttribute("height")?t.node.getAttribute("height"):0),s="";if(o>0&&a>0){s=" WIDTH="+o+" HEIGHT="+a}i=this.parser[n]["code"].replace("#ID#",e.params.value).replace("#ADDITIONAL#",s).replace("#WIDTH#",o).replace("#HEIGHT#",a)}return i},OnShowLHE:function(e,t,i){var n=this.__divId;e=e===false?false:e==="hide"?"hide":e==="justShow"?"justShow":true;this.oEditor=this.oEditor||s.getEditor(this.oEditorId);if(!this.oEditor)return;this.oEditor.Init();var o=BX("micro"+n),a=this.eventNode;if(o){o.style.display=e===true||e==="justShow"?"none":"block"}if(e=="hide"){BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);if(this.eventNode.style.display=="none"){BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.eventNode.scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){a.style.height=e.height+"px";a.style.opacity=e.opacity/100},complete:BX.proxy(function(){this.eventNode.style.cssText="";this.eventNode.style.display="none";BX.onCustomEvent(a,"OnAfterHideLHE",[e,this])},this)}).animate()}}else if(e){BX.onCustomEvent(this.eventNode,"OnBeforeShowLHE",[e,this]);if(e=="justShow"){this.eventNode.style.display="block";BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else if(this.eventNode.style.display=="block"){BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else{BX.adjust(this.eventNode,{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:a.scrollHeight},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quad),step:function(e){a.style.height=e.height+"px";a.style.opacity=e.opacity/100},complete:BX.proxy(function(){BX.onCustomEvent(a,"OnAfterShowLHE",[e,this]);this.oEditor.Focus();this.eventNode.style.cssText=""},this)}).animate()}}else{BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);this.eventNode.style.display="none";BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}},OnButtonClick:function(e){if(e!=="cancel"){var t={result:true};BX.onCustomEvent(this.eventNode,"OnClickBeforeSubmit",[this,t]);if(t["result"]!==false)BX.onCustomEvent(this.eventNode,"OnClickSubmit",[this])}else{BX.onCustomEvent(this.eventNode,"OnClickCancel",[this]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["hide"])}},OnEditorInitedBefore:function(e){var t=this;this.oEditor=e;e.formID=this.formID;if(this.params)this.params["~height"]=e.config["height"];BX.addCustomEvent(e,"OnCtrlEnter",function(){e.SaveContent();if(t.params&&t.params["ctrlEnterHandler"]&&typeof window[t.params["ctrlEnterHandler"]]=="function")window[t.params["ctrlEnterHandler"]]();else BX.submit(BX(t.formID))});var i=this.params.parsers?this.params.parsers:[];if(BX.util.object_search("Spoiler",i)){e.AddButton({id:"spoiler",name:BX.message("spoilerText"),iconClassName:"spoiler",disabledForTextarea:false,src:BX.message("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.png",toolbarSort:205,handler:function(){var e=this,t=false;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){t=e.editor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=e.editor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}});e.AddParser({name:"spoiler",obj:{Parse:function(e,t,i){if(/\[(cut|spoiler)(([^\]])*)\]/gi.test(t)){t=t.replace(/[\001-\006]/gi,"").replace(/\[cut(((?:=)[^\]]*)|)\]/gi,"$1").replace(/\[\/cut]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"$1").replace(/\[\/spoiler]/gi,"");var n=/(?:\001([^\001]*)\001)([^\001-\004]+)\002/gi,o=/(?:\003([^\003]*)\003)([^\001-\004]+)\004/gi,a=function(e,t){e=e.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'+i.SetBxTag(false,{tag:"spoiler"})+'" title="'+e+'">'+t+"</blockquote>"},s=function(e,t,i){return a(t,i)};while(t.match(n)||t.match(o)){t=t.replace(n,s).replace(o,s)}}t=t.replace(/\001([^\001]*)\001/gi,"[cut$1]").replace(/\003([^\003]*)\003/gi,"[spoiler$1]").replace(/\002/gi,"[/cut]").replace(/\004/gi,"[/spoiler]");return t},UnParse:function(t,i){if(t.tag=="spoiler"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}})}if(BX.util.object_search("MentionUser",i)){e.AddParser({name:"postuser",obj:{Parse:function(t,i){i=i.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(t,i,n){n=BX.util.trim(n);if(n=="")return"";return'<span id="'+e.SetBxTag(false,{tag:"postuser",params:{value:parseInt(i)}})+'" class="bxhtmled-metion">'+n+"</span>"});return i},UnParse:function(t,i){if(t.tag=="postuser"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[USER="+t.params.value+"]"+n+"[/USER]"}return""}}})}var n=function(i,n){return t.Parse(i,n,e)},o=function(e,i){return t.Unparse(e,i)};for(var a in this.parser){if(this.parser.hasOwnProperty(a)){e.AddParser({name:a,obj:{Parse:n,UnParse:o}})}}if(this.showPinButton){this.pinEditorPanel=this.params&&this.params.pinEditorPanel===true;var s="toolbar_pin";var r=function(e,i){r.superclass.constructor.apply(this,arguments);this.id=s;this.title=BX.message("MPF_PIN_EDITOR_PANNEL");this.className+=" "+(t.pinEditorPanel?"bxhtmled-button-toolbar-pined":"bxhtmled-button-toolbar-pin");this.Create();if(i)i.appendChild(this.GetCont())};BX.extend(r,window.BXHtmlEditor.Button);r.prototype.OnClick=function(){BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pined");BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pin");if(t.pinEditorPanel){t.pinEditorPanel=false;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pin")}else{t.pinEditorPanel=true;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pined")}BX.userOptions.save("main.post.form","postEdit","pinEditorPanel",t.pinEditorPanel?"Y":"N")};window.BXHtmlEditor.Controls[s]=r;BX.addCustomEvent(e,"GetControlsMap",function(e){e.push({id:s,compact:true,hidden:false,sort:500,checkWidth:true,offsetWidth:32,wrap:"right"})})}},OnEditorInitedAfter:function(t){BX.addCustomEvent(t,"OnIframeDrop",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDrop",arguments)},this));BX.addCustomEvent(t,"OnIframeDragOver",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragOver",arguments)},this));BX.addCustomEvent(t,"OnIframeDragLeave",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragLeave",arguments)},this));BX.addCustomEvent(t,"OnImageDataUriHandle",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnImageDataUriHandle",arguments)},this));BX.addCustomEvent(t,"OnAfterUrlConvert",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(t,"OnBeforeCommandExec",this.OnBeforeCommandExec.bind(this));t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:BX.message("BXEdDelFromText"),bbMode:true,ACTION:function(){var e=t.contextMenu.GetTargetItem("postimage");if(!e)e=t.contextMenu.GetTargetItem("postdocument");if(!e)e=t.contextMenu.GetTargetItem("postfile");if(e&&e.element){t.selection.RemoveNode(e.element)}t.contextMenu.Hide()}}];if(!this.params["lazyLoad"]){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow",t,false])}if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){var i=e;setTimeout(function(){BX.addCustomEvent(t,"OnContentChanged",BX.proxy(function(e){this["mpfTextContent"]=e;this.Init()},i))},1500)});BX.addCustomEvent(BX(this.formID),"onAutoSave",BX.proxy(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"+this.formID]=e["mpfTextContent"]},this));BX.addCustomEvent(BX(this.formID),"onAutoSaveRestore",BX.proxy(function(i,n){if(e.handler[t.id]){for(var o in e.handler[t.id].controllers){if(e.handler[t.id].controllers.hasOwnProperty(o)&&e.handler[t.id].controllers[o].handler&&e.handler[t.id].controllers[o].handler.params&&e.handler[t.id].controllers[o].handler.params.controlName&&e.handler[t.id].controllers[o].handler.params.controlName){delete n[e.handler[t.id].controllers[o].handler.params.controlName]}}}if(n["text"+this.formID]&&/[^\s]+/gi.test(n["text"+this.formID])){t.CheckAndReInit(n["text"+this.formID])}},this));if(BX(this.formID)&&BX(this.formID).hasAttribute("bx-lhe-autosave-prepared")&&BX(this.formID).BXAUTOSAVE){BX(this.formID).removeAttribute("bx-lhe-autosave-prepared");setTimeout(BX.proxy(function(){BX(this.formID).BXAUTOSAVE.Prepare()},this),100)}var i=this.formID,n=this.params;this.showPanelEditor(n.showPanelEditor,false);if(!t.mainPostFormCustomized){t.mainPostFormCustomized=true;BX.addCustomEvent(t,"OnIframeKeydown",function(e){if(window.onKeyDownHandler){window.onKeyDownHandler(e,t,i)}});BX.addCustomEvent(t,"OnIframeKeyup",function(e){if(window.onKeyUpHandler){window.onKeyUpHandler(e,t,i)}});if(window["BXfpdStopMent"+i]){BX.addCustomEvent(t,"OnIframeClick",function(){window["BXfpdStopMent"+i]()})}if(t&&t.textareaView.GetCursorPosition){BX.addCustomEvent(t,"OnTextareaKeyup",function(e){if(window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(e,t,i)}});BX.addCustomEvent(t,"OnTextareaKeydown",function(e){if(window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(e,t,i)}})}}},OnAfterUrlConvert:function(e){if(this.urlPreview){this.urlPreview.attachUrlPreview({url:e})}},OnBeforeCommandExec:function(e,t,i,n){if(this.urlPreview&&t=="createLink"&&BX.type.isPlainObject(n)&&n.hasOwnProperty("href")){this.urlPreview.attachUrlPreview({url:n.href})}}};s.getEditor=function(e){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(typeof e=="object"?e.id:e):null};s.getHandler=function(t){return e.handler[typeof t=="object"?t.id:t]};s.unsetHandler=function(t){var i=typeof t=="object"?t.id:t;if(!e.handler[i])return;if(e.handler[i].oEditor)e.handler[i].oEditor.Destroy();e.handler[i]=null};s.reinitData=function(e,t,i){var n=s.getHandler(e);if(n)n.exec(n.reinit,[t,i]);return false};s.reinitDataBefore=function(e){var t=s.getHandler(e);if(t&&t["eventNode"])BX.onCustomEvent(t.eventNode,"onReinitializeBefore",[t])};window.LHEPostForm=s;window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var o=BX.util.trim(t[n]);if(o.length>0){var a=this.hiddenField.value.split(",");if(!BX.util.in_array(o,a)){var s;var r=BX.create("span",{children:[s=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});r.insertBefore(document.createTextNode(o),s);this.tagsContainer.insertBefore(r,this.addNewLink);BX.bind(s,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:r,tagValue:o}));this.hiddenField.value+=o+",";i.push(o)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy(function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)},this));BX.bind(this.activeBlock,"click",BX.proxy(function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)},this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var r=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");r=e;BX.defer(function(){e.disabled=true})()}};window.MPFbuttonCloseWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||r||this;if(e){e.disabled=false;BX.removeClass(e,"ui-btn-clock");r=null}};window.__mpf_wd_getinfofromnode=function(e,t){var i=BX.findChild(BX((e["prefixNode"]||"wd-doc")+e.element_id),{className:"files-preview",tagName:"IMG"},true,false);if(i){e.lowsrc=i.src;e.element_url=i.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight\=(\d+)/,"");e.width=parseInt(i.getAttribute("data-bx-full-width"));e.height=parseInt(i.getAttribute("data-bx-full-height"))}else if(t.urlGet){e.element_url=t.urlGet.replace("#element_id#",e.element_id).replace("#ELEMENT_ID#",e.element_id).replace("#element_name#",e.element_name).replace("#ELEMENT_NAME#",e.element_name)}};var d={listen:false,plus:false,text:"",bSearch:false};window.BXfpdSelectCallback=function(e,t,i,n,o,a){BX.SocNetLogDestination.BXfpSelectCallback({item:e,type:t,bUndeleted:n,containerInput:BX("feed-add-post-destination-item"),valueInput:BX("feed-add-post-destination-input"),formName:o,tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2"),state:typeof a!="undefined"?a:null})};window.BXfpdUnSelectCallback=function(e,t,i,n){BX.SocNetLogDestination.BXfpUnSelectCallback.call({formName:n,inputContainerName:"feed-add-post-destination-item",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")},e)};window.BXfpdOpenDialogCallback=function(e){BX.SocNetLogDestination.BXfpOpenDialogCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.BXfpdCloseDialogCallback=function(e){BX.SocNetLogDestination.BXfpCloseDialogCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.BXfpdCloseSearchCallback=function(e){BX.SocNetLogDestination.BXfpCloseSearchCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.onKeyDownHandler=function(e,t,i){var n=e.keyCode;if(!window["BXfpdStopMent"+i])return true;if(BX.util.in_array(n,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(n,[50,43,61])||e.altKey&&BX.util.in_array(n,[76])){setTimeout(function(){var e=t.selection.GetRange(),n=t.GetIframeDoc(),o=e?e.endContainer.textContent:"",a=o?o.slice(e.endOffset-1,e.endOffset):"",s=o?o.slice(e.endOffset-2,e.endOffset-1):"";if((a=="@"||a=="+")&&(!s||BX.util.in_array(s,["+","@",",","("])||s.length==1&&BX.util.trim(s)==="")){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=true;e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);var r=BX.create("SPAN",{props:{id:"bx-mention-node"}},n);t.selection.Surround(r,e);e.setStart(r,1);e.setEnd(r,1);t.selection.SetSelection(e);if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i],{bindNode:l(r,t)})}}},10)}if(d.listen){var o=d.bSearch?"search":BX.SocNetLogDestination.obTabSelected[window["BXSocNetLogDestinationFormNameMent"+i]];if(n==t.KEY_CODES["enter"]){BX.SocNetLogDestination.selectCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i]);t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["left"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"left");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["right"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"right");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["up"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"up");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["down"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"down");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}}if(!d.listen&&d.listenFlag&&n===t.KEY_CODES["enter"]){var a=t.selection.GetRange();if(a.collapsed){var s=a.endContainer,r=t.GetIframeDoc();if(s){if(s.className!=="bxhtmled-metion"){s=BX.findParent(s,function(e){return e.className=="bxhtmled-metion"},r.body)}if(s&&s.className=="bxhtmled-metion"){t.selection.SetAfter(s)}}}}};window.onKeyUpHandler=function(e,t,i){var n=e.keyCode,o,a,s;if(!window["BXfpdStopMent"+i])return true;if(d.listen===true){if(n==t.KEY_CODES["escape"]){window["BXfpdStopMent"+i]()}else if(n!==t.KEY_CODES["enter"]&&n!==t.KEY_CODES["left"]&&n!==t.KEY_CODES["right"]&&n!==t.KEY_CODES["up"]&&n!==t.KEY_CODES["down"]){o=t.GetIframeDoc();var r=o.getElementById("bx-mention-node");if(r){s=BX.util.trim(t.util.GetTextContent(r));var h=s;s=s.replace(/^[\+@]*/,"");d.bSearch=s.length>0;BX.SocNetLogDestination.search(s,true,window["BXSocNetLogDestinationFormNameMent"+i],BX.message("MPF_NAME_TEMPLATE"),{bindNode:l(r,t)});if(d.leaveContent&&d._lastText&&h===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&h!==""&&s===""){d.bSearch=false;window["BXfpdStopMent"+i]();BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i],{bindNode:l(r,t)})}d.lastText=s;d._lastText=h}else{window["BXfpdStopMent"+i]()}}}else{if(!e.shiftKey&&(n===t.KEY_CODES["space"]||n===t.KEY_CODES["escape"]||n===188||n===190)){a=t.selection.GetRange();if(a.collapsed){var f=a.endContainer;o=t.GetIframeDoc();if(f){if(f.className!=="bxhtmled-metion"){f=BX.findParent(f,function(e){return e.className=="bxhtmled-metion"},o.body)}if(f&&f.className=="bxhtmled-metion"){s=t.util.GetTextContent(f);var u=s.match(/[\s\.\,]$/);if(u||n===t.KEY_CODES["escape"]){f.innerHTML=s.replace(/[\s\.\,]$/,"");var c=BX.create("SPAN",{html:u||t.INVISIBLE_SPACE},o);t.util.InsertAfter(c,f);t.selection.SetAfter(c)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,i){var n=e.keyCode;if(d.listen&&n==t.KEY_CODES["enter"]){BX.SocNetLogDestination.selectFirstSearchItem(window["BXSocNetLogDestinationFormNameMent"+i]);t.textareaKeyDownPreventDefault=true;BX.PreventDefault(e)}};window.onTextareaKeyUpHandler=function(e,t,i){var n,o,a=e.keyCode;if(d.listen===true){if(a==27){window["BXfpdStopMent"+i]()}else if(a!==13){o=t.textareaView.GetValue(false);n=t.textareaView.GetCursorPosition();if(o.indexOf("+")!==-1||o.indexOf("@")!==-1){var s=o.substr(0,n),r=Math.max(s.lastIndexOf("+"),s.lastIndexOf("@"));if(r>=0){var l=s.substr(r),h=l;l=l.replace(/^[\+@]*/,"");if(BX.SocNetLogDestination&&!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}d.bSearch=l.length>0;if(BX.SocNetLogDestination)BX.SocNetLogDestination.search(l,true,window["BXSocNetLogDestinationFormNameMent"+i],BX.message("MPF_NAME_TEMPLATE"));if(d.leaveContent&&d._lastText&&h===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&h!==""&&l===""){window["BXfpdStopMent"+i]();if(BX.SocNetLogDestination)BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}d.lastText=l;d._lastText=h}}}}else{if(a==16){var f=this;this.shiftPressed=true;if(this.shiftTimeout)this.shiftTimeout=clearTimeout(this.shiftTimeout);this.shiftTimeout=setTimeout(function(){f.shiftPressed=false},100)}if(a==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(a,[187,50,107,43,61])){n=t.textareaView.element.selectionStart;if(n>0){o=t.textareaView.element.value;var u=o.substr(n-1,1);if(u&&(u==="+"||u==="@")){d.listen=true;d.listenFlag=true;d.text="";d.textarea=true;if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}}}}}};var l=function(e,t){var i=BX.pos(e),n=BX.pos(t.dom.areaCont),o=BX.GetWindowScrollPos(t.GetIframeDoc()),a=n.top+i.bottom-o.scrollTop+2,s=n.left+i.right-o.scrollLeft;return{top:a,left:s}};window.BxInsertMention=function(e){var t=e.item,i=e.type,n=e.formID,o=e.editorId,a=e.bNeedComa,r=s.getEditor(o),l;if(i=="users"&&t&&t.entityId>0&&r){if(r.GetViewMode()=="wysiwyg"){var h=r.GetIframeDoc(),f=r.selection.GetRange(),u=h.getElementById("bx-mention-node"),c=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},h);l=BX.create("SPAN",{html:a?",&nbsp;":"&nbsp;"},h);r.SetBxTag(c,{tag:"postuser",params:{value:t.entityId}});if(u){r.util.ReplaceNode(u,c)}else{r.selection.InsertNode(c,f)}if(c&&c.parentNode){var p=BX.findParent(c,{className:"bxhtmled-metion"},h.body);if(p){r.util.InsertAfter(c,p)}}if(c&&c.parentNode){r.util.InsertAfter(l,c);r.selection.SetAfter(l)}}else if(r.GetViewMode()=="code"&&r.bbCode){r.textareaView.Focus();var m=r.textareaView.GetValue(false),B=r.textareaView.GetCursorPosition(),g=m.substr(0,B),X=Math.max(g.lastIndexOf("+"),g.lastIndexOf("@"));if(X>=0&&B>X){r.textareaView.SetValue(m.substr(0,X)+m.substr(B));r.textareaView.element.setSelectionRange(X,X)}r.textareaView.WrapWith(false,false,"[USER="+t.entityId+"]"+t.name+"[/USER]"+(a?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t])}delete BX.SocNetLogDestination.obItemsSelected[window["BXSocNetLogDestinationFormNameMent"+n]][t.id];window["BXfpdStopMent"+n]();d["text"]="";if(r.GetViewMode()=="wysiwyg"){r.Focus();r.selection.SetAfter(l)}}};window.MPFMentionInit=function(e,t){if(!t["items"]["departmentRelation"]){t["items"]["departmentRelation"]=BX.SocNetLogDestination.buildDepartmentRelation(t["items"]["department"])}window["departmentRelation"]=t["items"]["departmentRelation"];if(t.initDestination===true){window.BXSocNetLogDestinationFormName="destination"+(""+(new Date).getTime()).substr(6);window.BXSocNetLogDestinationDisableBackspace=null;BX.SocNetLogDestination.init({name:window.BXSocNetLogDestinationFormName,searchInput:BX("feed-add-post-destination-input"),extranetUser:t["extranetUser"],bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:window.BXfpdSelectCallback,unSelect:BX.delegate(BX.SocNetLogDestination.BXfpUnSelectCallback,{formName:window.BXSocNetLogDestinationFormName,inputContainerName:"feed-add-post-destination-item",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")}),openDialog:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}),closeDialog:BX.delegate(BX.SocNetLogDestination.BXfpCloseDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}),openSearch:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})},items:t["items"],itemsLast:t["itemsLast"],itemsSelected:t["itemsSelected"],isCrmFeed:t["isCrmFeed"],useClientDatabase:!!t["useClientDatabase"],destSort:t["destSort"],allowAddUser:t["allowAddUser"],allowAddCrmContact:t["allowAddCrmContact"],allowSearchCrmEmailUsers:typeof t["allowSearchCrmEmailUsers"]!="undefined"?!!t["allowSearchCrmEmailUsers"]:false,userNameTemplate:typeof t["userNameTemplate"]!="undefined"?t["userNameTemplate"]:"",allowSonetGroupsAjaxSearch:typeof t["allowSonetGroupsAjaxSearch"]!="undefined"?t["allowSonetGroupsAjaxSearch"]:false,allowSonetGroupsAjaxSearchFeatures:typeof t["allowSonetGroupsAjaxSearchFeatures"]!="undefined"?t["allowSonetGroupsAjaxSearchFeatures"]:{},showVacations:true,usersVacation:typeof t["usersVacation"]!="undefined"?t["usersVacation"]:{}});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}));BX.bind(BX("feed-add-post-destination-input"),"paste",BX.defer(BX.SocNetLogDestination.BXfpSearch,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",onPasteEvent:true}));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input"}));BX.bind(BX("feed-add-post-destination-input"),"blur",BX.delegate(BX.SocNetLogDestination.BXfpBlurInput,{inputBoxName:"feed-add-post-destination-input-box",tagInputName:"bx-destination-tag"}));BX.bind(BX("bx-destination-tag"),"focus",function(e){BX.SocNetLogDestination.openDialog(window.BXSocNetLogDestinationFormName,{bByFocusEvent:true});return BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(window.BXSocNetLogDestinationFormName);return BX.PreventDefault(e)});BX.addCustomEvent(window,"onMentionAdd",function(e){if(!BX.type.isPlainObject(BX.SocNetLogDestination.obItems[window.BXSocNetLogDestinationFormName]["users"][e.id])){BX.SocNetLogDestination.obItems[window.BXSocNetLogDestinationFormName]["users"][e.id]=e}BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",function(e){if(e.id==window.BXSocNetLogDestinationFormName){e.blockFocus=true}});if(typeof BX.SocNetLogDestination.obItemsSelected[window.BXSocNetLogDestinationFormName][e.id]=="undefined"||!BX.SocNetLogDestination.obItemsSelected[window.BXSocNetLogDestinationFormName][e.id]){BX.SocNetLogDestination.selectItem(window.BXSocNetLogDestinationFormName,null,null,e.id,"users",false)}});if(t["itemsHidden"]){for(var i in t["itemsHidden"]){if(t["itemsHidden"].hasOwnProperty(i)){window.BXfpdSelectCallback({id:(typeof t["itemsHidden"][i]["PREFIX"]!="undefined"?t["itemsHidden"][i]["PREFIX"]:"SG")+t["itemsHidden"][i]["ID"],name:t["itemsHidden"][i]["NAME"]},typeof t["itemsHidden"][i]["TYPE"]!="undefined"?t["itemsHidden"][i]["TYPE"]:"sonetgroups","",true,"","init")}}}BX.SocNetLogDestination.BXfpSetLinkName({formName:window.BXSocNetLogDestinationFormName,tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")})}window["BXfpdSelectCallbackMent"+e]=function(i,n,o){window.BxInsertMention({item:i,type:n,formID:e,editorId:t.editorId,fireAddEvent:t.initDestination})};window["BXfpdStopMent"+e]=function(){BX.SocNetLogDestination.closeDialog();BX.SocNetLogDestination.closeSearch();clearTimeout(BX.SocNetLogDestination.searchTimeout);BX.SocNetLogDestination.searchOnSuccessHandle=false};window["BXfpdOnDialogOpen"+e]=function(){d.listen=true;d.listenFlag=true};window["BXfpdOnDialogClose"+e]=function(){d.listen=false;setTimeout(function(){d.listenFlag=false;if(!d.listen){var e=s.getEditor(t.editorId);if(e){var i=e.GetIframeDoc(),n=i.getElementById("bx-mention-node");if(n){e.selection.SetAfter(n);if(d.leaveContent){e.util.ReplaceWithOwnChildren(n)}else{BX.remove(n)}}e.Focus()}}},100)};window["BXSocNetLogDestinationFormNameMent"+e]="mention"+(""+(new Date).getTime()).substr(5);window["BXSocNetLogDestinationDisableBackspace"]=null;var n=BX("bx-b-mention-"+e);if(!t.extranetUser&&typeof t.items.extranetRoot!="undefined"){t["items"]["departmentExtranet"]=BX.clone(t["items"]["department"]);for(var o in t["items"]["extranetRoot"]){if(t["items"]["extranetRoot"].hasOwnProperty(o)){t["items"]["departmentExtranet"][o]=t["items"]["extranetRoot"][o]}}t["items"]["departmentRelationExtranet"]=BX.SocNetLogDestination.buildDepartmentRelation(t["items"]["departmentExtranet"])}BX.SocNetLogDestination.init({name:window["BXSocNetLogDestinationFormNameMent"+e],searchInput:n,extranetUser:t.extranetUser,bindMainPopup:{node:n,offsetTop:"1px",offsetLeft:"12px"},bindSearchPopup:{node:n,offsetTop:"1px",offsetLeft:"12px"},callback:{select:window["BXfpdSelectCallbackMent"+e],openDialog:window["BXfpdOnDialogOpen"+e],closeDialog:window["BXfpdOnDialogClose"+e],openSearch:window["BXfpdOnDialogOpen"+e],closeSearch:window["BXfpdOnDialogClose"+e]},items:{users:t["items"]["mentionUsers"],groups:{},sonetgroups:{},department:typeof t["items"]["departmentExtranet"]!="undefined"?t["items"]["departmentExtranet"]:t["items"]["department"],departmentRelation:typeof t["items"]["departmentRelationExtranet"]!="undefined"?t["items"]["departmentRelationExtranet"]:t["items"]["departmentRelation"]},itemsLast:{users:t["itemsLast"]["mentionUsers"],sonetgroups:{},department:{},groups:{}},itemsSelected:{},destSort:typeof t["mentionDestSort"]!="undefined"&&t["mentionDestSort"]?t["mentionDestSort"]:{},departmentSelectDisable:true,obWindowClass:"bx-lm-mention",obWindowCloseIcon:false,useClientDatabase:!!t["useClientDatabase"],userNameTemplate:typeof t["userNameTemplate"]!="undefined"?t["userNameTemplate"]:"",showVacations:false,showSearchInput:BX.browser.IsMobile()});BX.ready(function(){var i=BX("bx-b-mention-"+e);BX.bind(i,"mousedown",function(n){if(d.listen!==true){var o=s.getEditor(t.editorId),a=o.GetIframeDoc();if(o.GetViewMode()=="wysiwyg"&&a){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;var r=o.selection.GetRange(),l=a.getElementById("bx-mention-node");if(l){BX.remove(l)}o.InsertHtml('<span id="bx-mention-node">'+o.INVISIBLE_SPACE+"</span>",r);setTimeout(function(){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+e],{bindNode:i})}var t=a.getElementById("bx-mention-node");if(t){r.setStart(t,0);if(t.firstChild&&t.firstChild.nodeType==3&&t.firstChild.nodeValue.length>0){r.setEnd(t,1)}else{r.setEnd(t,0)}o.selection.SetSelection(r)}o.Focus()},100)}else if(o.GetViewMode()=="code"){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;setTimeout(function(){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+e],{bindNode:i})}},100)}BX.onCustomEvent(i,"mentionClick")}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1544127384814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?154412740428279";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){var t=false,i=false,s=0,o=null,a=null,n={};BX.namespace("BX.Disk");if(BX.Disk.UF)return;BX.Disk.UF=function(){var t=function(t){this.dialogName="DiskFileDialog";this.params=t;this.CID=t["UID"];this.controller=t.controller;this.values=t.values||[];this.prefix="diskuf-doc";this.onUploaderIsAlmostInited=BX.delegate(this.onUploaderIsAlmostInited,this);BX.addCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);this.agent=BX.Uploader.getInstance({id:t["UID"],streams:3,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:t["urlUpload"],showImage:false,sortItems:false,input:t["input"],dropZone:t["dropZone"],placeHolder:t["placeHolder"],queueFields:{thumb:{tagName:"TR",className:"wd-inline-file"}},fields:{thumb:{tagName:"",template:BX.message("DISK_TMPLT_THUMB")}}});this.urlSelect=!!t["urlSelect"]?t["urlSelect"]:null;this.urlRenameFile=!!t["urlRenameFile"]?t["urlRenameFile"]:null;this.urlDeleteFile=!!t["urlDeleteFile"]?t["urlDeleteFile"]:null;this.urlSelect=this._addUrlParam(this.urlSelect,"dialog2=Y&ACTION=SELECT&MULTI=Y");this.urlUpload=!!t["urlUpload"]?t["urlUpload"]:null;this.urlShow=!!t["urlShow"]?t["urlShow"]:null;this.params.controlName=this.params.controlName||"FILES[]";this.init();return this};t.prototype={_addUrlParam:function(e,t){if(!e)return null;if(e.indexOf(t)==-1)e+=(e.indexOf("?")==-1?"?":"&")+t;return e},_camelToSNAKE:function(e){var t={},i,s;for(i in e){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}return t},onUploaderIsAlmostInited:function(t,i){if(this.CID!=i["id"])return;BX.removeCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);var s=BX.findChild(this.controller,{className:"diskuf-simple"},true),o=BX.findChild(this.controller,{className:"diskuf-extended"},true);if(t=="BX.UploaderSimple"){BX.remove(o);BX.show(s)}else{BX.remove(s);BX.show(o)}i.input=BX.findChild(this.controller,{className:"diskuf-fileUploader"},true);i.dropZone=BX.findChild(this.controller,{className:"diskuf-extended"},false);this.params.placeHolder=i["placeHolder"]=BX.findChild(this.controller,{className:"diskuf-placeholder-tbody"},true)},init:function(){this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onFileIsAttached=BX.delegate(this.onFileIsAttached,this);this._onFileIsBound=BX.delegate(this.onFileIsBound,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onError=BX.delegate(this.onError,this);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onError",this._onError);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadRestore=BX.delegate(this.onUploadRestore,this);BX.onCustomEvent(BX(this.controller.parentNode),"DiskDLoadFormControllerInit",[this]);var e=[],t=[],i;for(var s=0;s<this.values.length;s++){i=BX.findChild(this.values[s],{className:"f-wrap"},true);if(!!i){e.push({name:i.innerHTML});t.push(this.values[s])}}this.values=[];this.agent.onAttach(e,t);var o=BX.findChild(this.controller,{className:"diskuf-selector-link"},true);if(!!o){BX.bind(o,"click",BX.proxy(this.showSelectDialog,this))}var a=BX.findChildren(this.controller,{className:"diskuf-selector-link-cloud"},true);if(!!a){for(var n in a){if(!a.hasOwnProperty(n))continue;BX.bind(a[n],"click",BX.proxy(this.showSelectDialogCloudImport,this))}}return false},addFile:function(e){return this.agent&&this.agent.onChange([e])},onItemIsAdded:function(){BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.show(BX.findParent(this.params.placeHolder,{className:"diskuf-files-block"}))},onFileIsInited:function(e,t){BX.addCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.addCustomEvent(t,"onFileIsAfterCreated",function(e,t,i,s){if(t&&!t.sizeInt){e.size=" "}});BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError)},onFileIs:function(e,t,i){this.bindEventsHandlers(e,t,i);var s={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,place:e,storage:"disk"};this.values.push(e);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadSuccess",[s,this,t.file,t]);t.__disk_element_id=i.element_id;BX.onCustomEvent(t,"OnFileUploadSuccess",[s,this])},onFileIsAppended:function(e,t){var i=this.agent.getItem(e),s=i.node;this.bindEventsHandlers(s,t,{})},onFileIsBound:function(e,t){var i=this.agent.getItem(e),s=i.node,o=s.getAttribute("id").replace("disk-edit-attach","");this.onFileIs(s,t,{element_id:o})},onFileIsAttached:function(e,t,i,s){if(!!s["sizeFormatted"])s["size"]=s["sizeFormatted"];if(!s.hasOwnProperty("service")){this.onUploadDone(t,{file:s});return}BX.Disk.ExternalLoader.startLoad({file:{id:s.id,name:s.name,service:s.service},onFinish:BX.delegate(function(e){var i=this.agent.getItem(t.id).node;BX.hide(i);var s={id:e.ufId,name:e.name,storage:e.storage,ext:t.ext,size:e.sizeFormatted,previewUrl:e.previewUrl,preview_url:e.previewUrl,element_url:e.previewUrl,size_int:parseInt(e.size,10)};var o;var a=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName);for(var n in s){o=s[n];if(s.hasOwnProperty(n)){if(n.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0||isNaN(s["size_int"])){o=""}}if(s.hasOwnProperty("SIZE_INT")||isNaN(s["SIZE_INT"])){if(parseInt(s["SIZE_INT"],10)==0){o=""}}}a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),o).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),o)}}var l={id:"disk-edit-attach"+s.id,"bx-agentFileId":t.id},r;r=BX.create("TR",{attrs:l,props:{className:"wd-inline-file"},html:a});var d=BX.findChild(r,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}i.parentNode.insertBefore(r,i);s.element_id=s.id;this.agent.onAttach([s],[r]);t.deleteFile()},this),onProgress:BX.delegate(function(e){this.onUploadProgress(t,e)},this)})},onUploadProgress:function(e,t){t=Math.min(t,98);var i=e.id;if(!e.__progressBarWidth)e.__progressBarWidth=5;if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;if(BX("wdu"+i+"Progressbar"))BX.adjust(BX("wdu"+i+"Progressbar"),{style:{width:e.__progressBarWidth+"%"}});if(BX("wdu"+i+"ProgressbarText"))BX.adjust(BX("wdu"+i+"ProgressbarText"),{text:e.__progressBarWidth+"%"})}},onUploadDone:function(e,t){if(t["file"]&&t["file"]["attachId"]&&t["file"]["attachId"]!=t["file"]["id"]){t["file"]["id"]=t["file"]["attachId"];delete t["file"]["attachId"]}var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var o=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName),a;for(var n in s){if(s.hasOwnProperty(n)){a=s[n];if(n.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0){a=""}}if(s.hasOwnProperty("SIZE_INT")){if(parseInt(s["SIZE_INT"],10)==0){a=""}}}if(n.toLowerCase()=="storage"&&a==="disk"){l(s.id).then(function(e){if(e.crumbs){var t=e.crumbs.join(" / ");var i=BX("disk-edit-attach"+s.id);if(i){var o=BX.findChild(i,{className:"files-placement"},true);if(o){BX.adjust(o,{text:t})}}}})}o=o.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),a).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),a)}}o=o.replace(new RegExp("#(width|height)#","gi"),"0").replace(new RegExp("#preview_url#","gi"),"javascript:void(0);");var r={id:"disk-edit-attach"+s.id,"bx-agentFileId":e.id},d;if(s["XML_ID"])r["bx-attach-xml-id"]=s["XML_ID"];if(s["FILE_ID"])r["bx-attach-file-id"]="n"+s["FILE_ID"];if(s["FILE_TYPE"])r["bx-attach-file-type"]=s["FILE_TYPE"];d=BX.create("TR",{attrs:r,props:{className:"wd-inline-file"},html:o});if(!t.file.canChangeName){var h=BX.findChild(d,{className:"files-name-edit-btn"},true);if(h){BX.remove(h)}}i.parentNode.replaceChild(d,i);s.element_id=s.id;this.onFileIs(d,e,s)}else{this.onUploadError(e,t,this.agent)}},onUploadError:function(e,t,i){var s=this.agent.getItem(e.id);if(!!s&&(s=s.node)&&BX(s)&&(i==true||!BX(s).hasAttribute("bx-disk-error"))){BX(s).setAttribute("bx-disk-error","Y");BX.adjust(s,{props:{className:"error-load"}});var o=t&&t["error"]?t["error"]:"Uploading error";s.cells[1].innerHTML="";s.cells[2].innerHTML='<span class="info-icon"></span><span class="error-text">'+o+"</span>";BX.onCustomEvent(e,"OnFileUploadFailed",[s,this]);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadFailed",[s,this,e.file,e])}},onError:function(e,t,i){var s="Uploading error.",o=s,a,n;if(i){if(i["error"]&&typeof i["error"]=="string")o=i["error"];else if(i["message"]&&typeof i["message"]=="string")o=i["message"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){o=[];for(var l=0;l<i["errors"].length;l++){if(typeof i["errors"][l]=="object"&&i["errors"][l]["message"])o.push(i["errors"][l]["message"])}if(o.length<=0)o.push("Uploading error.");o=o.join(" ")}}e.files=e.files||{};for(n in e.files){if(e.files.hasOwnProperty(n)){a=this.agent.queue.items.getItem(n);this.onUploadError(a,{error:o},o!=s)}}},onBlurRenameInput:function(e){var t=e.target||e.srcElement;var i=BX.findChild(t.parentNode,{className:"files-name-edit-btn"},true);if(!!i)BX.fireEvent(i,"click")},bindEventsHandlers:function(t,i,s){var o=s.element_id,a="file-action-control",n=BX.findChild(t,{className:"files-path"},true),l=BX.findChild(t,{className:"files-name-edit-btn"},true),r=BX.findChild(t,{className:"f-wrap"},true);if(!!l&&!!n&&!!r&&!n.getAttribute(a)){n.setAttribute(a,"enabled");BX.show(n,"inline");BX.hide(BX.findChild(t,{className:"files-placement"},true));BX.bind(n,"click",BX.delegate(function(){this.move(o,r.innerHTML,t)},this))}if(!!l){BX.bind(l,"click",BX.delegate(function(){BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t)},this));var d=BX.findChild(t,{className:"files-name-edit-inp"},true);if(d){BX.bind(d,"keydown",BX.delegate(function(i){var s=(i||e.event).keyCode||(i||e.event).charCode;if(s==13){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t);return BX.PreventDefault(i)}if(s==27){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.revertRename(o,t);return BX.PreventDefault(i)}},this))}}var h=BX.findChild(t,{className:"feed-add-post-loading"},true),u=BX.delegate(function(){this.deleteFile(t,i)},this),c=BX.create("SPAN",{props:{className:"del-but"},events:{click:u}});if(!!h){var m=BX.findChild(h,{className:"del-but"},true);if(!!m)BX.bind(m,"click",u);else h.appendChild(c.cloneNode(true))}if(!BX.findChild(t,{className:"files-info"},true)){t.appendChild(BX.create("TD",{props:{className:"files-info"}}))}if(!BX.findChild(t,{className:"files-del-btn"},true)){t.appendChild(BX.create("TD",{props:{className:"files-del-btn"},children:[c]}))}if(!c.hasAttribute("bx-bound")){c.setAttribute("bx-bound","Y");BX.bind(c,"click",u);BX.onCustomEvent(t,"OnMkClose",[t])}var p=BX.findChild(t,{className:"transformer-upgrade-popup"},true);if(p){BX.show(p.parentNode);BX.bind(p,"click",BX.proxy(BX.Disk.UF.showTransformationUpgradePopup,this))}},deleteFile:function(e,t){if(!!t.__disk_element_id){BX.Disk.ajax({url:this.urlDeleteFile,method:"POST",dataType:"json",data:{attachedId:t.__disk_element_id},onsuccess:function(e){}});BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[t.__disk_element_id,this])}BX.removeCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.removeCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.removeCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.removeCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.removeCustomEvent(t,"onUploadDone",this._onUploadDone);BX.removeCustomEvent(t,"onUploadError",this._onUploadError);delete t.hash;t.deleteFile("deleteFile");BX.remove(e)},move:function(e,t,i){var s=this._addUrlParam(this.urlSelect.replace("ACTION=SELECT","").replace("MULTI=Y",""),"ID=E"+e+"&NAME="+t+"&wish=fakemove");while(s.indexOf("&&")>=0)s=s.replace("&&","&");if(!this._checkFileName){this._checkFileName=BX.proxy(this.checkFileName,this);this._selectFolder=BX.proxy(this.selectFolder,this);this._openSection=BX.proxy(this.openSection,this);this._selectItem=BX.proxy(this.selectItem,this);this._unSelectItem=BX.proxy(this.unSelectItem,this)}var o=i||BX("disk-edit-attach"+e),a=BX.findChild(o,{className:"f-wrap"},true);BX.DiskFileDialog.arParams={};BX.DiskFileDialog.arParams[this.dialogName]={element_id:e,element_name:a.innerHTML};BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.addCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.addCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem);return BX.ajax.get(s,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFolder};BX.DiskFileDialog.openDialog(this.dialogName)},this),100)},this))},rename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var a=o.textContent||o.innerText;var n=a.split(".").pop();var l=s.value+"."+n;if(!!i){BX.focus(s);BX.bind(s,"blur",BX.proxy(this.onBlurRenameInput,this))}else if(s.value&&l!==a){BX.adjust(o,{text:l});var r=t.getAttribute("bx-agentFileId");var d=r?this.agent.getItem(r):null;if(!!d){d.item.file.name=l;d.item.name=l}var h=this.manager?this.manager.checkFile("disk_file"+e):null;if(!!h){h.name=l}BX.Disk.ajax({url:this.urlRenameFile,method:"POST",dataType:"json",data:{newName:l,attachedId:e},onsuccess:function(e){}})}},revertRename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var a=o.textContent||o.innerText;var n=a.split(".");var l=n.pop();s.value=n.join(".")},showMovedFile:function(e,t,i){if(!e)return false;var s,o=e,a=BX("disk-edit-attach"+o),n=BX.findChild(a,{className:"files-path"},true);BX.cleanNode(n);i=i.split("/").join(" / ");n.innerHTML=i;var l=parseInt(n.offsetWidth);var r=parseInt(n.parentNode.offsetWidth)-150,d;s=r/(l/i.length);if(l>r){d=Math.floor(s/2)+1;i=i.substr(0,d)+" ... "+i.substr(i.length-d);n.innerHTML=i}var h=BX("diskuf-doc"+o);if(!!h){var u=this._fileUnserialize(h.value);u.section=t["sectionID"];u.iblock=t["iblockID"];h.value=this._fileSerialize(u)}return true},_fileUnserialize:function(e){if(!BX.type.isString(e))return false;var t=e.split("|");return{id:t[0]||0,section:t[1]||0,iblock:t[2]||0}},_fileSerialize:function(e){var t=[e.id,e.section,e.iblock];return t.join("|")},selectFolder:function(e,t,i,s){var o=false,a=false,n,l,r;if(BX.DiskFileDialog.arParams&&BX.DiskFileDialog.arParams[this.dialogName]&&BX.DiskFileDialog.arParams[this.dialogName]["element_id"])o=BX.DiskFileDialog.arParams[this.dialogName]["element_id"];var d=BX.delegate(function(e,t,i,s){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:e,targetFolderId:t},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.showMovedFile(e,i,s)},this)})},this);for(n in i){if(i.hasOwnProperty(n)&&i[n].type==="folder"){l=e.name+i[n].path;r={sectionID:n,iblockID:e.iblock_id};d(o,i[n].id,r,l);a=true}}if(!a){l=e.name;r={sectionID:e.section_id,iblockID:e.iblock_id};if(!!s&&!!s.path&&s.path!="/"){l+=s.path;r.sectionID=s.id;if(!!s){d(o,s.id,r,l)}}}BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.removeCustomEvent(BX.DiskFileDialog,"loadItemsDone",this._checkFileName);BX.removeCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.removeCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem)},checkFileName:function(e){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}if(!!e&&e!=this.dialogName)return;var t=BX.DiskFileDialog.arParams[this.dialogName]["element_name"];var i=false,s;for(s in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(s)){if(BX.DiskFileDialog.obItems[this.dialogName][s]["name"]==t)i=true;if(i)break}}if(i)BX.DiskFileDialog.showNotice(BX.message("DISK_FILE_EXISTS"),this.dialogName);else BX.DiskFileDialog.closeNotice(this.dialogName)},selectItem:function(e,t,i){if(i!=this.dialogName)return;var s=t.substr(1);var o=BX.DiskFileDialog.obCurrentTab[i].link;o=o.replace("/index.php","")+"/element/upload/"+s+"/?use_light_view=Y&AJAX_CALL=Y&SIMPLE_UPLOAD=Y&IFRAME=Y&sessid="+BX.bitrix_sessid()+"&SECTION_ID="+s+"&CHECK_NAME="+BX.DiskFileDialog.arParams[this.dialogName]["element_name"];o=o.replace("/files/lib/","/files/");BX.ajax.loadJSON(o,BX.delegate(function(e){var t=e.permission===true&&e["okmsg"]!="";if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){if(t){BX.DiskFileDialog.showNotice(this.msg.file_exists,this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}},this),200)},this))},unSelectItem:function(){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){this.checkFileName()},this),200)},openSection:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y")}},openSectionCloud:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y");BX.DiskFileDialog.target[t]=this._addUrlParam(BX.DiskFileDialog.target[t],"cloudImport=1")}},selectFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},selectCloudFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){if(i[o].hasOwnProperty("provider")){i[o].service=i[o].provider}else{i[o].service=a}i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},showSelectDialog:function(){this._openSection=BX.proxy(this.openSection,this);this._selectFile=BX.proxy(this.selectFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))},showSelectDialogCloudImport:function(e){var t=e.target||e.srcElement;if(!BX.hasClass(t,"diskuf-selector-link-cloud")){t=BX.findParent(t,{className:"diskuf-selector-link-cloud"})}if(!t||!t.getAttribute("data-bx-doc-handler"))return;a=t.getAttribute("data-bx-doc-handler");this._openSection=BX.proxy(this.openSectionCloud,this);this._selectFile=BX.proxy(this.selectFile,this);this._selectCloudFile=BX.proxy(this.selectCloudFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"&cloudImport=1&service="+a+"&dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectCloudFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))}};return t}();BX.Disk.UF.dndCatcher={};BX.Disk.UF.add=function(e){e["controller"]=BX("diskuf-selectdialog-"+e["UID"]);if(e["controller"]&&BX.isNodeInDom(e["controller"])){e["values"]=BX.findChildren(e["controller"],{className:"wd-inline-file"},true);var t=BX(e["controller"]).parentNode;BX.onCustomEvent(e["controller"],"DiskLoadFormControllerWasBound",[e,"DiskLoadFormControllerWasBound"]);if(!BX(e["controller"]).hasAttribute("bx-disk-load-is-bound")){BX(e["controller"]).setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(t,"DiskLoadFormController",function(t){BX.Disk.UF.initialize(t,e)})}if(!!e["values"]&&e["values"].length>0&&!e["hideSelectDialog"])BX.onCustomEvent(e["controller"].parentNode,"DiskLoadFormController",["show"])}};BX.Disk.UF.initialize=function(e,t){e=e==="show"||e==="hide"?e:t["controller"].style.display!="none"?"hide":"show";if(!t["controller"].loaded){t["controller"].loaded=true;n[t["UID"]]=new BX.Disk.UF(t)}if(e=="show"){if(t["controller"].style.display!="block"){BX.fx.show(t["controller"],"fade",{time:.2});if(t["switcher"]&&t["switcher"].style.display!="none")BX.fx.hide(t["switcher"],"fade",{time:.1});BX.onCustomEvent(t["controller"],"onControllerIsShown",[t["controller"],n[t["UID"]]]);o=n[t["UID"]]}}else if(t["controller"].style.display!="none"){o=null;BX.fx.hide(t["controller"],"fade",{time:.2});BX.onCustomEvent(t["controller"],"onControllerIsHidden",[t["controller"],n[t["UID"]]])}return n[t["UID"]]};var l=function(e){return BX.Disk.ajaxPromise({url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var r=function(e){if(!BX(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;BX.unbindAll(e);BX.unbindAll(this.node);BX.show(this.node);BX.remove(this.node.nextSibling);this.id="wufdp_"+Math.random();BX.bind(this.node,"mouseover",BX.delegate(function(){this.turnOn()},this));BX.bind(this.node,"mouseout",BX.delegate(function(){this.turnOff()},this))};r.prototype={turnOn:function(){this.timeout=setTimeout(BX.delegate(function(){this.show()},this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(BX["UploaderUtils"]){var t=BX.UploaderUtils.scaleImage(e,{width:parseInt(BX.message("DISK_THUMB_WIDTH")),height:parseInt(BX.message("DISK_THUMB_HEIGHT"))});e=t.destin}this.popup=new BX.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("DIV",{props:e,children:[BX.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};BX.addCustomEvent("onDiskPreviewIsReady",function(e){new r(e)});BX.Disk.UF.runImport=function(e){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});BX.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:BX.delegate(function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}},this),onProgress:BX.delegate(function(e){},this)}).start()};BX.Disk.UF.disableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.enableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};e.DiskCreateDocument=function(e){if(!o){return false}if(!e){return false}var t=new BX.CViewer({createDoc:true});var i=t.createBlankElementByParams({docType:e,editUrl:BX.message("DISK_CREATE_BLANK_URL"),renameUrl:BX.message("DISK_RENAME_FILE_URL")});t.setCurrent(i);i.afterSuccessCreate=function(e){var t={};var i=e.name.split(".");i.pop();t["E"+e.objectId]={type:"file",id:"n"+e.objectId,name:e.name,label:i.join("."),storage:e.folderName,size:e.size,sizeInt:e.sizeInt,ext:e.extension,canChangeName:true,link:e.link};setTimeout(function(){o.selectFile({},{},t)},200)};t.runActionByCurrentElement("create",{obElementViewer:t});try{BX.PreventDefault()}catch(e){}return false};e.DiskOpenMenuCreateService=function(e){var t=new BX.CViewer({});t.openMenu("disk_open_menu_with_services",BX(e),[BX.CViewer.isDisabledLocalEdit?null:{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",href:"#",onclick:BX.delegate(function(t){if(BX.CViewer.isEnableLocalEditInDesktop()){this.setEditService("l");BX.adjust(e,{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")});BX.PopupMenu.destroy("disk_open_menu_with_services")}else{this.helpDiskDialog()}return BX.PreventDefault(t)},t)},{text:t.getNameEditService("google"),className:"bx-viewer-popup-item item-gdocs",href:"#",onclick:BX.delegate(function(t){this.setEditService("google");BX.adjust(e,{text:this.getNameEditService("google")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)},{text:t.getNameEditService("office365"),className:"bx-viewer-popup-item item-office365",href:"#",onclick:BX.delegate(function(t){this.setEditService("office365");BX.adjust(e,{text:this.getNameEditService("office365")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)},{text:t.getNameEditService("skydrive"),className:"bx-viewer-popup-item item-office",href:"#",onclick:BX.delegate(function(t){this.setEditService("skydrive");BX.adjust(e,{text:this.getNameEditService("skydrive")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)}],{offsetTop:0,offsetLeft:25})};e.DiskOpenMenuImportService=function(e,t){var i=[];for(var s in t){if(!t.hasOwnProperty(s))continue;i.push({text:t[s].name,code:t[s].id,href:"#",onclick:function(e,t){var i=t.layout.item;BX.addClass(i,"diskuf-selector-link-cloud");i.setAttribute("data-bx-doc-handler",t.code);BX.onCustomEvent("onManualChooseCloudImport",[{target:i}]);BX.removeClass(i,"diskuf-selector-link-cloud");i.removeAttribute("data-bx-doc-handler");BX.PopupMenu.destroy("disk_open_menu_with_import_services");return BX.PreventDefault(e)}})}var o=new BX.CViewer({});o.openMenu("disk_open_menu_with_import_services",BX(e),i,{offsetTop:0,offsetLeft:25});return BX.PreventDefault()};e.DiskActionFileMenu=function(e,t,i){s++;BX.PopupMenu.show("bx-viewer-wd-popup"+s+"_"+e,BX(t),i,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,t){var i=BX(t);if(i){BX.fireEvent(i,"click")}return false}})(window);
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15441274532527*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?154412738440309*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1544127384575*/
; /* /bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?154412745438362*/
; /* /bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js?154412745410825*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js?154412745337676*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?154412738466246*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1544127384814*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?154412740428279*/
; /* /bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js?154412745416315*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?154412738446925*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?15441273841650*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/destination-selector.min.js?15441273845460*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15441273842703*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?154412738423035*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15441273843115*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?154412738417210*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?154412738418784*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15441273844327*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15441273842208*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15441273841411*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15441273841102*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15441273841258*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1544127384422*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1544127384490*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1544127384250*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1544127384754*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1544127384513*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15441273841390*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15441273841364*/
; /* /bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?154412738410379*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?154412738438643*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?154412738415646*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?15441273848146*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js?154412745325169*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.min.js?15441274534339*/
; /* /bitrix/templates/bitrix24/components/bitrix/socialnetwork.blog.blog/important/script.min.js?154412764513923*/
; /* /bitrix/components/bitrix/main.urlpreview/templates/.default/script.min.js?15441273844554*/
; /* /bitrix/components/bitrix/main.userconsent.request/templates/.default/user_consent.min.js?15441273847363*/
; /* /bitrix/templates/bitrix24/components/bitrix/socialnetwork.group_menu/.default/script.min.js?15441276453524*/
; /* /bitrix/templates/bitrix24/components/bitrix/socialnetwork.group/.default/script.min.js?15441276457606*/
; /* /bitrix/templates/bitrix24/components/bitrix/socialnetwork.user_groups.link.add/.default/script.min.js?15441276456393*/

//# sourceMappingURL=page_live_feed_v2.map.js