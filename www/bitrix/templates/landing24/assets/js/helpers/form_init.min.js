(function(){"use strict";BX.addCustomEvent("BX.Landing.Block:init",function(o){var e=o.makeRelativeSelector(".bitrix24forms");if(o.block.querySelectorAll(e).length>0){if(typeof window["landingForms"]=="undefined"){window["landingForms"]={}}window["landingForms"][o.block.id]=new t(e,o.block);window["landingForms"][o.block.id].initForm()}});BX.addCustomEvent("BX.Landing.Block:updateStyle",function(t){var o=t.makeRelativeSelector(".bitrix24forms");if(t.block.querySelectorAll(o).length>0){var e=window["landingForms"][t.block.id];if(typeof t.node!="undefined"&&typeof t.data!="undefined"&&typeof e!="undefined"){if(e.readFormStylesFromNode(t.node[0])){e.createFormOptions();e.onFormReloadWithDebounce()}}}});BX.addCustomEvent("BX.Landing.Block:Node:updateAttr",function(t){var o=t.makeRelativeSelector(".bitrix24forms");if(t.block.querySelectorAll(o).length>0){var e=window["landingForms"][t.block.id];if(typeof t.data!="undefined"&&typeof e!="undefined"){for(var r in t.data){r=r.replace("data-","");if(r==e.dataFormId){e.onFormRemove();e.initForm()}else if(r==e.dataAttributeShowHeader){if(Object.keys(e.formOptions).length>0){e.formOptions.css.content=e.matchShowHeader(e.formOptions.css.content)}e.onFormReload()}else if(r==e.dataAttributeUseStyle){e.createFormOptions();e.onFormReload()}}}}});BX.addCustomEvent("BX.Landing.Block:remove",function(t){var o=t.makeRelativeSelector(".bitrix24forms");if(document.querySelectorAll(o).length>0){var e=window["landingForms"][t.block.id];if(typeof e!="undefined"){e.onFormRemove()}delete window["landingForms"][t.block.id]}});var t=function(t,o){this.dataFormId="b24form";this.dataAttributeDomain="b24form-original-domain";this.dataAttributePrefix="data-form-style-";this.dataAttributeUseStyle="b24form-use-style";this.dataAttributeShowHeader="b24form-show-header";this.dataAttributeIsConnector="b24form-connector";this.hideHeaderString=".crm-webform-header-container{display:none;}";this.hideBitrixLogoString=".crm-webform-bottom-link{display:none}.crm-webform-bottom-logo-container{height:0;margin:0;}";this.paddingFixesString=".content{min-height:170px;}"+".crm-webform-fieldset-footer{padding-bottom:0;}"+".crm-webform-body{padding-bottom:0;padding-top:0;}"+".content-wrap{padding-bottom:0;}"+".crm-webform-block.crm-webform-default{margin-bottom:0;}";this.block=o;this.selector=t;this.iframe=null;var e=BX.findChild(this.block,{attribute:"data-"+this.dataAttributeDomain},true,false);if(e&&this.isFormChosen()){this.domain=BX.data(e,this.dataAttributeDomain);this.initFormLoader(window,document,this.createFullDomain()+"/bitrix/js/crm/form_loader.js","b24form")}this.styleParams={"wrapper-padding":{params:["padding-top"]},bg:{params:["background-color","background-image"]},"bg-content":{params:["background-color"]},"bg-block":{params:["background-color"]},"main-bg":{params:["background-color"]},"main-border-color":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color"]},"main-font-family":{params:["font-family"]},"main-font-color":{params:["color"]},"main-font-color-hover":{params:["color"]},"main-font-weight":{params:["font-weight"]},"second-font-color":{params:["color"]},"icon-font-color":{params:["color"]},"button-font-color":{params:["color"]},"header-font-size":{params:["font-size"]},"header-font-weight":{params:["font-weight"]},"header-text-font-size":{params:["font-size"]},"label-font-size":{params:["font-size"]},"border-block":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color","border-top-style","border-bottom-style","border-left-style","border-right-style","border-top-width","border-bottom-width","border-left-width","border-right-width"]},"input-bg":{params:["background-color"]},"input-box-shadow":{params:["box-shadow"]},"input-select-bg":{params:["background-color"]},"input-border":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color","border-top-style","border-bottom-style","border-left-style","border-right-style","border-top-width","border-bottom-width","border-left-width","border-right-width","border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"]},"input-border-radius":{params:["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"]},"input-border-color":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color"]},"input-border-hover":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color","border-top-style","border-bottom-style","border-left-style","border-right-style","border-top-width","border-bottom-width","border-left-width","border-right-width"]},"agreement-label-font-size":{params:["font-size"]}};this.styles={};this.selectors={".crm-webform-wrapper, .content-wrap":["wrapper-padding"],"body.crm-webform-iframe":["bg"],".content, .page-theme-transparent .content":["bg-content"],".crm-webform-block, .page-theme-transparent .crm-webform-block":["bg-block","border-block"],".crm-webform-header-container":["bg-block","border-block","main-font-family","main-font-color","main-font-weight","header-text-font-size"],".crm-webform-header-container h2":["main-font-color","bg-block"],".crm-webform-inner-header":["main-font-color","main-font-family"],".crm-webform-mini-cart-title, .crm-webform-mini-cart-services-container":["main-font-color","main-font-family"],".crm-webform-header":["main-font-family","header-font-weight","header-font-size"],".crm-webform-label":["main-font-family","label-font-weight","label-font-size","second-font-color"],"button.crm-webform-submit-button, .crm-webform-file-upload .crm-webform-file-button":["main-bg","main-font-family","button-font-color","input-border-radius"],".crm-webform-label-content, .crm-webform-file-text-field":["input-bg"],".crm-webform-input-label":["input-box-shadow"],".crm-webform-input, .crm-webform-file-text-field":["main-font-family","main-font-weight","input-border","main-font-color"],".crm-webform-icon":["input-border-color","second-font-color","icon-font-color"],".crm-webform-desktop-font-style a":["second-font-color"],".crm-webform-desktop-font-style a:hover":["main-font-color"],".crm-webform-input option":["main-font-family","input-select-bg","main-font-color"],".crm-webform-active .crm-webform-input, .crm-webform-active mark, .crm-webform-input:hover":["input-border-hover"],".crm-webform-checkbox-container:hover i":["main-border-color"],".crm-webform-checkbox-name":["main-font-family"],".crm-webform-input+i:after":["main-font-color-hover"],".crm-webform-agreement-modifier .crm-webform-checkbox-name":["agreement-label-font-size"]};this.formParams={};this.formOptions={}};t.prototype={isFormChosen:function(){var t=document.querySelectorAll(this.selector);if(t.length>0){for(var o=0,e=t.length;o<e;o++){if(BX.data(t[o],this.dataFormId)){return true}}}return false},initFormLoader:function(t,o,e,r){if(typeof t["Bitrix24FormLoaderInitialised"]=="undefined"||t["Bitrix24FormLoaderInitialised"]!=true){t["Bitrix24FormObject"]=r;t[r]=t[r]||function(){arguments[0].ref=e;(t[r].forms=t[r].forms||[]).push(arguments[0])};if(t[r]["forms"])return;var i=o.createElement("script");var a=1*new Date;i.async=1;i.src=e+"?"+a;var n=o.getElementsByTagName("script")[0];n.parentNode.insertBefore(i,n);t["Bitrix24FormLoaderInitialised"]=true}},initForm:function(){if(!this.isFormChosen()){this.createNoFormMessage();return}this.createFormParams();BX.addCustomEvent("onFormFrameLoad",BX.proxy(this.onFormFrameLoad,this));this.addFormInLoader();if(typeof Bitrix24FormLoader!="undefined"){if(typeof Bitrix24FormLoader.forms=="undefined"||Object.keys(Bitrix24FormLoader.forms).length==0){Bitrix24FormLoader.init()}else{Bitrix24FormLoader.preLoad(this.formParams)}}},createNoFormMessage:function(){if(BX.Landing.getMode()=="view"){return}var t=document.querySelector(this.selector);if(t){var o='<h2 class="u-form-alert-title">'+'<i class="fa fa-exclamation-triangle g-mr-15"></i>'+BX.message("LANDING_BLOCK_WEBFORM_NO_FORM")+'</h2><hr class="u-form-alert-divider">';if(typeof BX.data(t,this.dataAttributeIsConnector)!="undefined"&&BX.data(t,this.dataAttributeIsConnector)=="Y"){o+='<p class="u-form-alert-text">'+BX.message("LANDING_BLOCK_WEBFORM_NO_FORM_BUS")+"</p>"}else{o+='<p class="u-form-alert-text">'+BX.message("LANDING_BLOCK_WEBFORM_NO_FORM_CP")+"</p>"}var e=BX.create({tag:"div",props:{className:"u-form-alert"},html:o});BX.adjust(t,{children:[e]})}},createFormParams:function(){var t=document.querySelectorAll(this.selector);if(t.length>0){for(var o=0,e=t.length;o<e;o++){var r=BX.data(t[o],this.dataFormId);var i=r.split("|");var a=window.location.search.match(new RegExp("user_lang"+"=([^&=]+)"));if(i.length===2){this.formParams={id:i[0],lang:a?a[1]:BX.message("LANGUAGE_ID"),sec:i[1],type:"inline"+"_"+this.block.id,node:t[o]};this.createFormOptions()}}}},addFormInLoader:function(){if(Object.keys(this.formParams).length!=0){b24form(this.formParams)}},removeFormFromLoader:function(){if(!window.Bitrix24FormObject||!window[window.Bitrix24FormObject])return;if(!window[window.Bitrix24FormObject].forms)return;window[window.Bitrix24FormObject].forms.forEach(function(t,o){if(t.id==this.formParams.id&&t.node==this.formParams.node&&t.sec==this.formParams.sec){delete window[window.Bitrix24FormObject].forms[o]}},this)},sendFrameMessage:function(t,o){if(!this.iframe){return}var e=0;if(typeof window.postMessage==="function"&&!e){if(typeof t!="object"){t={}}var r=(this.createFullDomain()+"/").match(/((http|https):\/\/[^\/]+?)\//)[1];t.domain=r;if(o===undefined){o=this.type+"_"+this.id}t.uniqueLoadId=o;this.iframe.contentWindow.postMessage(JSON.stringify(t),r)}},onFormFrameLoad:function(t,o){if(t.id==this.formParams.id&&t.sec==this.formParams.sec&&t.type==this.formParams.type){this.iframe=t.iframe;this.sendFrameMessage({options:this.formOptions},o)}},onFormRemove:function(){if(typeof Bitrix24FormLoader!="undefined"){Bitrix24FormLoader.unload(this.formParams)}this.removeFormFromLoader()},onFormReload:function(){if(typeof Bitrix24FormLoader!="undefined"){Bitrix24FormLoader.unload(this.formParams);Bitrix24FormLoader.preLoad(this.formParams)}},onFormReloadWithDebounce:function(){return BX.debounce(this.onFormReload(),1e3,this)},createFullDomain:function(){var t=this.domain;if(!this.domain.match(/(http|https):/)){t="https://"+this.domain}return t},createFormOptions:function(){if(this.isUsingCustomStyle()){var t=this.createFormOptionsCss();var o=this.createFormOptionsCssFiles();if(t.length>0||o.length>0){this.formOptions.css={content:t,file:o}}}else{this.formOptions.css={content:""}}this.formOptions.css.content=this.matchShowHeader(this.formOptions.css.content);this.formOptions.css.content=this.createHideBitrixLabelCss(this.formOptions.css.content);this.formOptions.css.content=this.createPaddingFixesCss(this.formOptions.css.content)},createFormOptionsCssFiles:function(){var t=[];t.push("https://fonts.googleapis.com/css?family=Ek+Mukta:400,600,700");t.push("https://fonts.googleapis.com/css?family=Roboto:300,400,500,700");return t},createFormOptionsCss:function(){if(Object.keys(this.styles).length==0)this.readFormStyles();var t="";for(var o in this.selectors){var e="";this.selectors[o].forEach(function(t){if(typeof this.styles[t]!="undefined"){for(var o in this.styles[t]){e+=this.styles[t][o].param+":"+this.styles[t][o].value+";"}}},this);if(e.length>0){t+=o+"{"+e+"}"}}return t},createHideBitrixLabelCss:function(t){t=typeof t=="undefined"?"":t;return t+this.hideBitrixLogoString},createPaddingFixesCss:function(t){t=typeof t=="undefined"?"":t;return t+this.paddingFixesString},isUsingCustomStyle:function(){var t=BX.findChild(this.block,{attribute:"data-"+this.dataAttributeUseStyle},true,false);if(t&&typeof BX.data(t,this.dataAttributeUseStyle)!="undefined"&&BX.data(t,this.dataAttributeUseStyle)=="N"){return false}else{return true}},matchShowHeader:function(t){t=typeof t=="undefined"?"":t;var o=BX.findChild(this.block,{attribute:"data-"+this.dataAttributeShowHeader},true,false);if(o&&typeof BX.data(o,this.dataAttributeShowHeader)!="undefined"&&BX.data(o,this.dataAttributeShowHeader)=="N"){t+=this.hideHeaderString}else{t=t.replace(this.hideHeaderString,"")}return t},readNodeStyles:function(t,o){this.styleParams[o].params.forEach(BX.delegate(function(e){var r=BX.style(t,e);if(r){if(typeof this.styles[o]=="undefined"){this.styles[o]={}}this.styles[o][e]={param:e,value:r}}}),this)},readFormStyles:function(){for(var t in this.styleParams){var o=BX.findChild(this.block,{attribute:this.dataAttributePrefix+t},true,false);if(o){this.readNodeStyles(o,t)}}},readFormStylesFromNode:function(t){var o=false;var e=t.attributes;for(var r=0;r<e.length;r++){var i=e[r].name.replace(this.dataAttributePrefix,"");if(typeof this.styleParams[i]!=="undefined"){o=true;this.readNodeStyles(t,i)}}return o}}})();