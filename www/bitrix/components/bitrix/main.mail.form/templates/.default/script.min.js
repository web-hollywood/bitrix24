(function(){if(window.BXMainMailForm)return;var e=function(t,i,a){if(e.__forms[t])return e.__forms[t];this.id=t;this.fields=i;this.options=a;e.__forms[this.id]=this};e.quoteNodeId="main-mail-quote-node-content";e.signatureNodeId="main-mail-form-signature";e.__forms={};e.getForm=function(t){return e.__forms[t]};e.prototype.getField=function(e){for(var t=this.fields.length;t-- >0;){if(this.fields[t].params.name==e)return this.fields[t]}return false};e.prototype.onSubmit=function(e){var t=this;var i=BX.findChildByClassName(this.formWrapper,"main-mail-form-footer",false);var a=BX.findChildByClassName(i,"main-mail-form-submit-button",true);if(a.disabled)return BX.PreventDefault();this.editor.OnSubmit();e=e||window.event;BX.onCustomEvent(this,"MailForm:submit",[this,e]);if(!e.defaultPrevented&&e.returnValue!==false){this.hideError();BX.addClass(a,"ui-btn-wait");a.disabled=true;a.offsetHeight;if(this.options.submitAjax){BX.ajax.submitAjax(this.htmlForm,{url:this.htmlForm.getAttribute("action"),method:"POST",dataType:"json",onsuccess:function(e){a.disabled=false;BX.removeClass(a,"ui-btn-wait");BX.onCustomEvent(t,"MailForm:submit:ajaxSuccess",[t,e])},onfailure:function(e){a.disabled=false;BX.removeClass(a,"ui-btn-wait");BX.onCustomEvent(t,"MailForm:submit:ajaxFailure",[t,e])}});return BX.PreventDefault(e)}}};e.prototype.showError=function(e){var t=BX.findChildByClassName(this.formWrapper,"main-mail-form-error",true);BX.adjust(t,{html:e,style:{display:"block"}});this.initScrollable();if(this.__scrollable){var i=BX.pos(this.__scrollable);var a=BX.pos(this.formWrapper);var o=BX.pos(t);if(i.top>o.top-10-this.__scrollable.scrollTop)this.__scrollable.scrollTop=o.top-10;else if(i.bottom<a.bottom-10-this.__scrollable.scrollTop)this.__scrollable.scrollTop=a.bottom-10-i.bottom}};e.prototype.hideError=function(){var e=BX.findChildByClassName(this.formWrapper,"main-mail-form-error",true);BX.adjust(e,{style:{display:"none"}})};e.prototype.init=function(){var t=this;if(this.__inited)return;this.formId="main_mail_form_"+this.id;this.formWrapper=BX(this.formId);this.htmlForm=BX.findParent(this.formWrapper,{tag:"form"});this.postForm=LHEPostForm.getHandler(this.formId+"_editor");this.editor=BXHtmlEditor.Get(this.formId+"_editor");this.editorInited=false;BX.addCustomEvent(this,"MailForm::from::change",BX.proxy(function(e,t){if(!BX.type.isString(t)){t="";var i;var a=BX(e.fieldId+"_value");if(a){i=a.value}if(i&&e.params&&BX.type.isArray(e.params.mailboxes)&&BX.type.isNotEmptyObject(e.params.signatures)){for(var o in e.params.mailboxes){if(e.params.mailboxes.hasOwnProperty(o)){if(e.params.mailboxes[o].formated===i){if(BX.type.isNotEmptyString(e.params.signatures[e.params.mailboxes[o].formated])){t=e.params.signatures[e.params.mailboxes[o].formated]}else if(BX.type.isNotEmptyString(e.params.signatures[e.params.mailboxes[o].email])){t=e.params.signatures[e.params.mailboxes[o].email]}else if(BX.type.isNotEmptyString(e.params.signatures[""])){t=e.params.signatures[""]}break}}}}}this.insertSignature(t)},this));this.initFields();this.initFooter();BX.bind(this.htmlForm,"submit",this.onSubmit.bind(this));this.__inited=true;BX.onCustomEvent(e,"MailForm:init:"+this.id,[this])};e.prototype.initScrollable=function(){if(!this.__scrollable){if(document.scrollingElement)this.__scrollable=document.scrollingElement}if(!this.__scrollable){if(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)this.__scrollable=document.documentElement;else if(document.body.scrollTop>0||document.body.scrollLeft>0)this.__scrollable=document.body}if(!this.__scrollable){window.scrollBy(1,1);if(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)this.__scrollable=document.documentElement;else if(document.body.scrollTop>0||document.body.scrollLeft>0)this.__scrollable=document.body;window.scrollBy(-1,-1)}};e.prototype.initFields=function(){for(var e=0,i;e<this.fields.length;e++){this.fields[e]=new t(this,this.fields[e]);i=this.fields[e].fieldId;this.fields[i]=this.fields[e]}var a=BX(this.formId+"_fields_footer");var o=BX(this.formId+"_fields_ext_footer");var r=[].concat(BX.findChildrenByClassName(a,"main-mail-form-field-button",true)||[]).concat(BX.findChildrenByClassName(o,"main-mail-form-field-button",true)||[]);for(var e=0,i;e<r.length;e++){i=r[e].getAttribute("data-target");if(typeof this.fields[i]!="undefined"){this.fields[i].__switch=r[e];BX.bind(r[e],"click",this.fields[i].unfold.bind(this.fields[i]))}}};e.prototype.initFooter=function(){var e=this;var t=BX.findChildByClassName(this.formWrapper,"main-mail-form-footer-wrapper",true);var i=BX.findChildByClassName(t,"main-mail-form-footer",false);var a=BX.findChildrenByClassName(i,"main-mail-form-footer-button",true);for(var o in a){(function(t){BX.bind(t,"click",function(){BX.onCustomEvent(e,"MailForm:footer:buttonClick",[e,t]);if(BX.hasClass(t,"main-mail-form-submit-button"))BX.submit(e.htmlForm)})})(a[o])}var r=function(){if(BX.hasClass(i,"main-mail-form-footer-fixed")){BX.removeClass(i,"main-mail-form-footer-fixed-hidden");BX.removeClass(i,"main-mail-form-footer-fixed");i.style.left="";i.style.width="";t.style.height=""}};var n=function(){e.initScrollable();if(e.formWrapper.offsetHeight>0&&e.__scrollable){var a=BX.pos(e.__scrollable);var o=BX.pos(e.formWrapper);if(a.bottom<o.bottom-10-e.__scrollable.scrollTop){i.style.left=o.left-a.left-e.__scrollable.scrollLeft+"px";i.style.width=e.formWrapper.offsetWidth+"px";if(!BX.hasClass(i,"main-mail-form-footer-fixed")){if(a.bottom<BX.pos(t).top-e.__scrollable.scrollTop)BX.addClass(i,"main-mail-form-footer-fixed-hidden");t.style.height=t.offsetHeight+"px";BX.addClass(i,"main-mail-form-footer-fixed")}var n=BX.findChildByClassName(e.formWrapper,"main-mail-form-editor-wrapper",true);if(a.bottom<BX.pos(n).top+i.offsetHeight-e.__scrollable.scrollTop)BX.addClass(i,"main-mail-form-footer-fixed-hidden");else BX.removeClass(i,"main-mail-form-footer-fixed-hidden");return}}r()};var s=function(){setTimeout(function(){if(!e.__footerMonitoring){e.__footerMonitoring=true;BX.bind(window,"resize",n);BX.bind(window,"scroll",n);BX.addCustomEvent(window,"AutoResizeFinished",n);n()}},400)};var l=function(){e.__footerMonitoring=false;BX.unbind(window,"resize",n);BX.unbind(window,"scroll",n);BX.removeCustomEvent(window,"AutoResizeFinished",n);r()};BX.addCustomEvent(this,"MailForm:show",s);BX.addCustomEvent(this,"MailForm:hide",l);if(this.formWrapper.offsetHeight>0)s()};e.prototype.insertSignature=function(t){if(this.editorInited){this.editor.synchro.Sync();var i=this.editor.GetIframeDoc().getElementById(e.signatureNodeId);if(!BX.type.isNotEmptyString(t)){if(i){BX.remove(i)}return}var a="<br />--<br />"+t;if(i){i.innerHTML=a}else{i=BX.create("div",{attrs:{id:e.signatureNodeId},html:a});var o=this.editor.GetIframeDoc().getElementById(e.quoteNodeId);if(o){o.parentNode.insertBefore(i,o)}else{BX.append(i,this.editor.GetIframeDoc().body)}}this.editor.synchro.FullSyncFromIframe()}else{BX.addCustomEvent(this,"MailForm::editor::init",BX.proxy(function(){this.insertSignature(t)},this))}};var t=function(e,t){this.form=e;this.params=t;this.fieldId=this.form.formId+"_"+this.params.id;this.init()};t.prototype.init=function(){this.params.__row=BX(this.fieldId);if(t.__types[this.params.type]&&t.__types[this.params.type].init)t.__types[this.params.type].init(this);if(this.params.menu){var e=this;var i=BX.findChildByClassName(this.params.__row,"main-mail-form-field-value-menu-ext-button",true);BX.addCustomEvent(this.form,"MailForm::editor:click",function(){var t=BX.PopupMenu.getMenuById(e.fieldId+"-menu-ext");if(t)t.close()});BX.addCustomEvent("onSubMenuShow",function(){var t=this.menuWindow;while(t.parentMenuWindow)t=t.parentMenuWindow;if(e.fieldId+"-menu-ext"==t.id)BX.addClass(this.subMenuWindow.popupWindow.popupContainer,"main-mail-form-field-value-menu-ext-content")});BX.bind(i,"click",function(){BX.onCustomEvent(e.form,"MailForm:field:setMenuExt",[e.form,e]);BX.PopupMenu.destroy(e.fieldId+"-menu-ext");BX.PopupMenu.show(e.fieldId+"-menu-ext",this,e.__menuExt,{className:"main-mail-form-field-value-menu-ext-content",offsetTop:-8,offsetLeft:13,angle:true,closeByEsc:true})})}};t.prototype.setMenuExt=function(e){this.__menuExt=e};t.prototype.insert=function(e){if(t.__types[this.params.type]&&t.__types[this.params.type].insert)t.__types[this.params.type].insert(this,e)};t.prototype.setValue=function(e,i){if(t.__types[this.params.type]&&t.__types[this.params.type].setValue)t.__types[this.params.type].setValue(this,e,i)};t.prototype.show=function(){this.params.hidden=false;BX.addClass(this.fieldId,"main-mail-form-drop-animation");BX(this.fieldId).style.display=this.params.folded?"none":"";this.__switch.style.display=this.params.folded?"":"none"};t.prototype.hide=function(){this.params.hidden=true;BX(this.fieldId).style.display="none";this.__switch.style.display="none";BX.removeClass(this.fieldId,"main-mail-form-drop-animation")};t.prototype.fold=function(){this.params.folded=true;if(!this.params.hidden)this.__switch.style.display="";BX(this.fieldId).style.display="none";BX.removeClass(this.fieldId,"main-mail-form-drop-animation")};t.prototype.unfold=function(){this.params.folded=false;if(!this.params.hidden){BX.addClass(this.fieldId,"main-mail-form-drop-animation");BX(this.fieldId).style.display=""}this.__switch.style.display="none"};t.__types={list:{},text:{},from:{},rcpt:{},editor:{},files:{}};t.__types["list"].init=function(e){BX.addCustomEvent(e.form,"MailForm::editor:click",function(){var t=BX.PopupMenu.getMenuById(e.fieldId+"-menu");if(t)t.close()});var t=BX.findChildByClassName(e.params.__row,"main-mail-form-field-value-menu",true);BX.bind(t,"click",function(){var i=BX(e.fieldId+"_value");var a=function(e,a){i.value=e;BX.adjust(t,{html:a})};var o=function(e,t){a(t.options.value,t.text);t.menuWindow.close()};var r=[];if(!e.params.required){r.push({text:BX.util.htmlspecialchars(e.params.placeholder),title:e.params.placeholder,value:"",onclick:o});r.push({delimiter:true})}for(var n in e.params.list){r.push({text:BX.util.htmlspecialchars(e.params.list[n]),title:e.params.list[n],value:n,onclick:o})}BX.PopupMenu.show(e.fieldId+"-menu",t,r,{className:"main-mail-form-field-value-menu-content",offsetLeft:40,angle:true,closeByEsc:true})})};t.__types["from"].init=function(e){BX.addCustomEvent(e.form,"MailForm::editor:click",function(){var t=BX.PopupMenu.getMenuById(e.fieldId+"-menu");if(t)t.close()});BX.onCustomEvent(e.form,"MailForm::from::change",[e]);var t=BX.findChildByClassName(e.params.__row,"main-mail-form-field-value-menu",true);BX.bind(t,"click",function(){var i=[];var a=BX(e.fieldId+"_value");var o=function(i,o){a.value=i;BX.adjust(t,{html:BX.util.strip_tags(o)});BX.onCustomEvent(e.form,"MailForm::from::change",[e])};var r=function(e,t){var r="apply";if(e&&e.target){var n="main-mail-form-field-from-menu-delete-icon";if(BX.hasClass(e.target,n)||BX.findParent(e.target,{class:n},t.layout.item)){r="delete"}}if("delete"==r){BXMainMailConfirm.deleteSender(t.id,function(){t.menuWindow.removeMenuItem(t.id);if(a.value==t.title){o(i[0].title,i[0].text)}})}else{o(t.title,t.text);t.menuWindow.close()}};var n,s;if(!e.params.required){i.push({text:BX.util.htmlspecialchars(e.params.placeholder),title:"",onclick:r});i.push({delimiter:true})}if(e.params.mailboxes&&e.params.mailboxes.length>0){for(var l in e.params.mailboxes){s="menu-popup-no-icon";n=BX.util.htmlspecialchars(e.params.mailboxes[l].formated);if(e.params.mailboxes[l]["can_delete"]&&e.params.mailboxes[l].id>0){n+='<span class="main-mail-form-field-from-menu-delete-icon popup-window-close-icon popup-window-titlebar-close-icon"\t\t\t\t\t\t\ttitle="'+BX.util.htmlspecialchars(BX.message("MAIN_MAIL_CONFIRM_DELETE"))+'"></span>';s="menu-popup-no-icon menu-popup-right-icon"}i.push({text:n,title:e.params.mailboxes[l].formated,onclick:r,className:s,id:e.params.mailboxes[l].id})}i.push({delimiter:true})}i.push({text:BX.util.htmlspecialchars(BX.message("MAIN_MAIL_CONFIRM_MENU")),onclick:function(t,i){i.menuWindow.close();BXMainMailConfirm.showForm(function(t,i){e.params.mailboxes.push({email:t.email,name:t.name,id:t.id,formated:i});o(i,BX.util.htmlspecialchars(i));BX.PopupMenu.destroy(e.fieldId+"-menu")})}});BX.PopupMenu.show(e.fieldId+"-menu",t,i,{className:"main-mail-form-field-value-menu-content",offsetLeft:40,angle:true,closeByEsc:true})})};t.__types["rcpt"].init=function(e){var t=BX.findChildByClassName(e.params.__row,"main-mail-form-field-rcpt-item-more",true);var i=BX.findChildByClassName(e.params.__row,"main-mail-form-field-value-wrapper",true);var a=BX.findChildByClassName(e.params.__row,"main-mail-form-field-rcpt-add-link",true);var o=BX(e.fieldId+"_fvalue");e.selector=e.fieldId+"-selector";var r=function(r,n,s,l,m,d){if(!e.params.multiple){var f=BX.SocNetLogDestination.getSelected(e.selector);for(var u in f){if(u!=r.id||f[u]!=n)BX.SocNetLogDestination.deleteItem(u,f[u],e.selector)}}var p=document.createElement("SPAN");p.setAttribute("data-id",r.id);BX.addClass(p,"main-mail-form-field-rcpt-item");i.insertBefore(p,t.parentNode);p.appendChild(BX.create("INPUT",{props:{type:"hidden",name:e.params.name+"[]",value:JSON.stringify(r)}}));r.showEmail="N";if(e.params.email&&r.email&&r.email.length>0&&r.email!=r.name){r=BX.clone(r);r.name=r.name+" &lt;"+r.email+"&gt;"}BX.SocNetLogDestination.BXfpSelectCallback({item:r,type:n,varName:"dummy_"+e.params.name,bUndeleted:false,containerInput:p,valueInput:o,formName:m,tagInputName:a,tagLink1:e.params.placeholder,tagLink2:e.params.placeholder});if("init"==d){var c=9;var h=BX.findChildrenByClassName(i,"main-mail-form-field-rcpt-item",false);if(h.length>c+1){for(var u=c;u<h.length;u++)h[u].style.display="none";t.setAttribute("title",t.getAttribute("title").replace(/-?\d+/,h.length-c));t.parentNode.style.display=""}}};var n=function(r,n,s,l){var m=BX.findChild(i,{attribute:{"data-id":r.id}},false);BX.SocNetLogDestination.BXfpUnSelectCallback.apply({formName:l,inputContainerName:m,inputName:o,tagInputName:a,tagLink1:e.params.placeholder,tagLink2:e.params.placeholder},[r]);if(m&&m.parentNode==i){if(!BX.findChildByClassName(m,"feed-add-post-destination"))i.removeChild(m)}var d=9;var f=0;var u=BX.findChildrenByClassName(i,"main-mail-form-field-rcpt-item",false);for(var p=0;p<u.length;p++){if(u[p].offsetHeight>0)f++}if(f<u.length&&(f<d||u.length<=d+1)){for(var p=0;p<u.length;p++){if(u[p].offsetHeight>0)continue;u[p].style.display="";f++;if(f>=Math.min(d,u.length)&&u.length>d+1)break}t.setAttribute("title",t.getAttribute("title").replace(/-?\d+/,u.length-d));if(f>=u.length)t.parentNode.style.display="none"}};var s={name:e.selector,searchInput:o,bindMainPopup:{node:i,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:i,offsetTop:"5px",offsetLeft:"15px"},callback:{select:r,unSelect:n,openDialog:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:o.parentNode,inputName:o,tagInputName:a}),closeDialog:function(){BX.onCustomEvent(e.form,"MailForm:field:rcptSelectorClose",[e.form,e]);BX.SocNetLogDestination.BXfpCloseDialogCallback.apply({inputBoxName:o.parentNode,inputName:o,tagInputName:a})},openSearch:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:o.parentNode,inputName:o,tagInputName:a})},items:{},itemsLast:{},itemsSelected:{},destSort:{}};if(e.params.selector){for(var l in e.params.selector)s[l]=e.params.selector[l]}BX.SocNetLogDestination.init(s);BX.bind(o,"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:e.selector,inputName:o}));BX.bind(o,"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:e.selector,inputName:o,tagInputName:a}));BX.bind(o,"paste",BX.defer(BX.SocNetLogDestination.BXfpSearch,{formName:e.selector,inputName:o,tagInputName:a,onPasteEvent:true}));BX.bind(o,"blur",BX.delegate(BX.SocNetLogDestination.BXfpBlurInput,{inputBoxName:o.parentNode,tagInputName:a}));BX.bind(i,"click",function(t){BX.SocNetLogDestination.openDialog(e.selector);BX.PreventDefault(t)});BX.bind(t,"click",function(e){var t=BX.findChildrenByClassName(i,"main-mail-form-field-rcpt-item",false);for(var a=0;a<t.length;a++)t[a].style.display="";this.parentNode.style.display="none";BX.PreventDefault(e)})};t.__types["editor"].init=function(t){var a=t.form.postForm;var o=t.form.editor;if(t.params.value===null||t.params.value===undefined)t.params.value="";t.quoteNode=document.createElement("DIV");var r=document.createElement("DIV");r.setAttribute("id",e.quoteNodeId);r.innerHTML=t.params.value;t.quoteNode.appendChild(r);t.quoteNode.__folded=t.form.options.foldQuote;BX.onCustomEvent(a.eventNode,"OnShowLHE",["justShow"]);BX.addClass(o.dom.cont,"main-mail-form-editor");o.dom.toolbarCont.style.opacity="inherit";BX.addCustomEvent(o,"OnIframeClick",function(){BX.SocNetLogDestination.abortSearchRequest();BX.SocNetLogDestination.closeSearch();BX.SocNetLogDestination.closeDialog();BX.onCustomEvent(t.form,"MailForm::editor:click",[])});var n=BX.findChildByClassName(t.params.__row,"feed-add-post-form-editor-btn",true);var s=function(e){e=e?true:false;o.toolbar[e?"Show":"Hide"]();BX[e?"addClass":"removeClass"](n,"feed-add-post-form-btn-active");BX[e?"removeClass":"addClass"](t.params.__row,"main-mail-form-editor-no-toolbar")};s(o.toolbar.shown);BX.bind(n,"click",function(){s(!o.toolbar.shown)});var l=BX.findChildByClassName(t.form.htmlForm,"main-mail-form-quote-button",true);var m=function(){if(t.quoteNode.__folded){t.quoteNode.__folded=false;t.setValue(o.GetContent(),{quote:true,signature:false});o.Focus(false);var e,i;e=l.parentNode.offsetHeight;BX.hide(l,"inline-block");i=l.parentNode.offsetHeight;o.ResizeSceleton(0,o.config.height+e-i)}};BX.bind(l,"click",m);var d=function(){if(o.GetViewMode()!="wysiwyg"){BX.removeCustomEvent(o,"OnSetViewAfter",d);m()}};BX.addCustomEvent(o,"OnSetViewAfter",d);a.parser.disk_file.regexp=/(bxacid):(n?\d+)/gi;o.phpParser.AddBxNode("disk_file",{Parse:function(e,i){var a=o.GetIframeDoc().getElementById(i)||BX.findChild(t.quoteNode,{attr:{id:i}},true);if(a){var r=document.createElement("DIV");a=a.cloneNode(true);r.appendChild(a);if(a.tagName.toUpperCase()=="IMG"){var n="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";a.setAttribute("data-bx-orig-src",a.getAttribute("src"));a.setAttribute("src",n);return r.innerHTML.replace(n,"bxacid:"+e.value)}return r.innerHTML}return"[ "+e.value+" ]"}});BX.addCustomEvent(a.eventNode,"OnFileUploadRemove",function(e){o.synchro.Sync();for(i in o.bxTags){if(o.bxTags[i].params&&o.bxTags[i].params.value==e){var a=o.GetIframeDoc().getElementById(o.bxTags[i].id);if(a&&a.parentNode)a.parentNode.removeChild(a);var a=BX.findChild(t.quoteNode,{attr:{id:o.bxTags[i].id}},true);if(a&&a.parentNode)a.parentNode.removeChild(a);delete o.bxTags[i]}}o.synchro.FullSyncFromIframe()});BX.addCustomEvent(o,"OnCreateIframeAfter",function(){t.setValue("",{quote:true,signature:true});t.form.editorInited=true;BX.onCustomEvent(t.form,"MailForm::editor::init",[t])});BX.addCustomEvent(t.form,"MailForm:show",function(){t.form.editor.CheckAndReInit();t.form.editor.ResizeSceleton()});BX.addCustomEvent(t.form,"MailForm:hide",function(){t.form.editor.SaveContent()});BX.addCustomEvent(t.form,"MailForm:submit",function(){var e=o.GetContent();if(t.quoteNode.__folded)e+=o.Parse(t.quoteNode.innerHTML,true,false);BX(t.fieldId+"_value").value=e})};t.__types["from"].setValue=function(e,t){var i=BX(e.fieldId+"_value");var a=BX.findChildByClassName(e.params.__row,"main-mail-form-field-value-menu",true);if(!t.trim()){if(!e.params.required){i.value="";BX.adjust(a,{html:""})}BX.onCustomEvent(e.form,"MailForm::from::change",[e,""]);return}if(e.params.mailboxes&&e.params.mailboxes.length>0){var o=new RegExp("[-/\\^$*+?.()|[]{}]","g");for(var r in e.params.mailboxes){var n=new RegExp("(^|<)"+e.params.mailboxes[r].email.replace(o,"\\$&")+"(>|$)","i");if(t.trim().match(n)){i.value=t;BX.adjust(a,{html:BX.util.htmlspecialchars(t)});BX.onCustomEvent(e.form,"MailForm::from::change",[e]);break}}}};t.__types["rcpt"].setValue=function(e,t){var i=BX.SocNetLogDestination.getSelected(e.selector);for(var a in i)BX.SocNetLogDestination.deleteItem(a,i[a],e.selector);if(t&&BX.type.isPlainObject(t)){for(var a in t){if(t.hasOwnProperty(a)){BX.SocNetLogDestination.obItemsSelected[e.selector][a]=t[a];BX.SocNetLogDestination.runSelectCallback(a,t[a],e.selector,false,"init")}}}};t.__types["text"].insert=function(e,t){var i=BX(e.fieldId+"_value");if(typeof i.selectionStart!="undefined"){var a={start:i.selectionStart,end:i.selectionEnd};i.value=i.value.substr(0,a.start)+t+i.value.substr(a.end);i.selectionStart=i.selectionEnd=a.start+t.length}else{i.value=i.value+t}i.focus()};t.__types["text"].setValue=function(e,t){var i=BX(e.fieldId+"_value");i.value=t};t.__types["editor"].insert=function(e,t){var i=e.form.editor;if(i.synchro.IsFocusedOnTextarea()){i.textareaView.WrapWith("","",t);if(i.textareaView.element&&typeof i.textareaView.element.selectionStart!="undefined")i.textareaView.element.selectionStart=i.textareaView.element.selectionEnd}else{i.selection.GetRange().deleteContents();i.InsertHtml(t)}i.Focus()};t.__types["editor"].setValue=function(t,i,a){var o=t.form.postForm;var r=t.form.editor;if(i.length>0){for(var n in o.controllers){if(!o.controllers.hasOwnProperty(n))continue;var s=o.controllers[n];if(s.storage!="disk")continue;if(!s.values)break;for(var l in s.values){if(s.values.hasOwnProperty(l)&&s.values[l].src)i=i.replace("bxacid:"+l,s.values[l].src+"&__bxacid="+l)}break}}if(a&&a.signature){r.synchro.Sync();var m=r.GetIframeDoc().getElementById(e.signatureNodeId);if(m){var d=document.createElement("div");d.appendChild(m.cloneNode(true));i+=d.innerHTML}}if(a&&a.quote&&!t.quoteNode.__folded)i+=t.quoteNode.innerHTML;r.SetContent(i,true);var f=/[&?]__bxacid=(n?\d+)/;var u={IMG:"src",A:"href"};for(var p in u){var c=r.GetIframeDoc().getElementsByTagName(p);for(var h=0;h<c.length;h++){var B=c[h].getAttribute(u[p])?c[h].getAttribute(u[p]).match(f):false;if(B&&o.arFiles["disk_file"+B[1]]){c[h].removeAttribute("id");c[h].setAttribute(u[p],c[h].getAttribute(u[p]).replace(f,""));r.SetBxTag(c[h],{tag:"disk_file",params:{value:B[1]}});o.monitoringSetStatus("disk_file",B[1],true);o.monitoringStart()}}}r.synchro.FullSyncFromIframe()};t.__types["files"].setValue=function(e,t){var i=e.form.postForm;i.controllerInit("show");for(var a in i.controllers){if(!i.controllers.hasOwnProperty(a))continue;var o=i.controllers[a];if(o.storage!="disk")continue;if(!o.handler)break;t=BX.clone(t);if(o.values){for(var r=0;r<t.length;r++){if(o.values[t[r].id])t.splice(r--,1)}}o.handler.selectFile({},{},t);break}};window.BXMainMailForm=e})();
//# sourceMappingURL=script.map.js