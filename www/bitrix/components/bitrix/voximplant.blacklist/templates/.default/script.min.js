BX.namespace("BX.Voximplant.Blacklist");BX.Voximplant.Blacklist={ajaxUrl:"",elements:{numbersContainer:null,numberInput:null,addButton:null,settingsForm:null,saveSettingsButton:null},init:function(e){var t=this;this.ajaxUrl=e.ajaxUrl;this.elements.numbersContainer=BX("bl-numbers-container");this.elements.numberInput=BX("bl-new-number");this.elements.addButton=BX("bl-add-number");this.elements.settingsForm=BX("bl-settings-form");this.elements.saveSettingsButton=BX("bl-save-settings");BX.bind(this.elements.addButton,"click",this.onAddButtonClick.bind(this));BX.bind(this.elements.numberInput,"keypress",this.onNumberInputKeyPress.bind(this));BX.bind(this.elements.saveSettingsButton,"click",this.saveSettings.bind(this));if(BX.type.isArray(e.numbers)){e.numbers.forEach(function(e){t.renderNumber(e)})}},saveSettings:function(){var e=this;var t=new FormData(this.elements.settingsForm);t.append("sessid",BX.bitrix_sessid());t.append("ACTION","saveSettings");BX.addClass(this.elements.saveSettingsButton,"webform-small-button-wait webform-small-button-active");BX.ajax({url:this.ajaxUrl+"?ACTION=saveSettings",method:"POST",dataType:"json",data:t,preparePost:false,onsuccess:function(t){BX.removeClass(e.elements.saveSettingsButton,"webform-small-button-wait webform-small-button-active")}})},renderNumber:function(e){var t=BX.create("div",{props:{className:"tel-bl-phone"},dataset:{id:e.ID,number:e.PHONE_NUMBER},children:[BX.create("span",{props:{className:"tel-bl-phone-text"},text:BX.util.htmlspecialchars(e.PHONE_NUMBER)}),BX.create("span",{props:{className:"tel-bl-phone-delete"},events:{click:this.deleteNumber.bind(this)}})]});this.elements.numbersContainer.appendChild(t)},onNumberInputKeyPress:function(e){if(e.key==="Enter"){var t=this.elements.numberInput.value;this.addNumber(t)}},onAddButtonClick:function(e){var t=this.elements.numberInput.value;this.addNumber(t)},addNumber:function(e){var t=this;BX.addClass(this.elements.addButton,"webform-small-button-wait webform-small-button-active");BX.ajax({url:this.ajaxUrl+"?ACTION=addNumber",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),ACTION:"addNumber",NUMBER:e},onsuccess:function(e){BX.removeClass(t.elements.addButton,"webform-small-button-wait webform-small-button-active");if(e.ERROR){if(e.ERROR=="WRONG_NUMBER"){BX.Voximplant.alert(BX.message("BLACKLIST_ERROR_TITLE"),BX.message("VI_BLACKLIST_NUMBER_ERROR"))}else if(e.ERROR=="NUMBER_ALREADY_EXISTS"){BX.Voximplant.alert(BX.message("BLACKLIST_ERROR_TITLE"),BX.message("VI_BLACKLIST_NUMBER_ALREADY_EXISTS"))}}else{t.renderNumber(e.number);t.elements.numberInput.value=""}}})},deleteNumber:function(e){var t=e.target.parentNode;var s=t.dataset.number;if(confirm(BX.message("BLACKLIST_DELETE_CONFIRM"))){BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),ACTION:"deleteNumber",NUMBER:s},onsuccess:function(e){if(e.success=="Y"){BX.remove(t)}else if(e.ERROR){BX.Voximplant.alert(BX.message("BLACKLIST_ERROR_TITLE"),BX.message("BLACKLIST_DELETE_ERROR"))}}})}}};