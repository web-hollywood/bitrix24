var domNode=BX.create("script",{attrs:{src:"/bitrix/js/main/webrtc/adapter.js",type:"text/javascript"}});document.head.insertBefore(domNode,document.head.firstChild);var Module,isModuleInitialized,isBxFaceIdInitialized;if(typeof Module==="undefined"){Module={}}Module.onRuntimeInitialized=function(){isModuleInitialized=true;_BXFaceIdStart()};function BXFaceIdStart(){isBxFaceIdInitialized=true;_BXFaceIdStart()}function _BXFaceIdStart(){if(!isModuleInitialized||!isBxFaceIdInitialized){return}var e=false;var a=false;var t=null;var r=null;var c=null;var n=null;var s=BX.localStorage.get("faceid-default-camera");var d=null;var o={cameraRatio:0,screenRatio:window.screen.width/window.screen.height,cameraSmallWidth:340,cameraSmallHeight:0,cameraFullWidth:0,cameraFullHeight:0,snapshotWidth:640,snapshotHeight:0,trackingSmallRatio:0,trackingFullRatio:0,cameraWidth:0,cameraHeight:0,trackingRatio:0};var l=null;var f=null;var u=[];var m={};var h=new Module.WebPhotoMakerM;h.setStopAfterBestShot(true);h.setMovementThreshold(.03);h.setBestShotScoreThreshold(.05);h.setRotationThreshold(50);h.setMinFaceScaleFactor(.15);h.setMaxNumberOfFramesWithoutDetection(8);var v=o.snapshotWidth*o.snapshotWidth*4;var p=Module._malloc(v);var g=new Uint8ClampedArray(Module.HEAPU8.buffer,p,v);var k=[-1,-1,-1,-1,-1,-1];var B=["","","","","",""];var X=null;var _=false;var b=false;function C(){navigator.mediaDevices.enumerateDevices().then(function(e){var a=document.getElementById("faceid-cameralist");var t="faceid-tracker-sidebar-photo-settings-checked";e.forEach(function(e){if(e.kind=="videoinput"){if(s==null){s=e.deviceId;BX.localStorage.set("faceid-default-camera",s,3600*24*360)}var i="faceid-tracker-sidebar-photo-settings-inner-list-item";var r=e.label.replace(/\(\w{4}:\w{4}\)/g,"");if(!r.length){r=BX.message("FACEID_TRACKERWD_CMP_JS_CAMERA_DEFAULT")}if(e.deviceId==s){i+=" "+t}var c=BX.create("div",{text:r,attrs:{"class":i,"data-camera-id":e.deviceId}});a.appendChild(c);BX.bind(c,"click",function(){if(BX.hasClass(BX(this),t)){return}var e,i=BX.findChildren(a);for(e in i){BX.removeClass(i[e],t)}BX.addClass(BX(this),t);s=this.getAttribute("data-camera-id");BX.localStorage.set("faceid-default-camera",s,3600*24*360);w();BX.toggle(BX("faceid-settings-container"))})}});S()}).catch(function(e){console.log(e.name+": "+e.message);I(BX.message("FACEID_TRACKERWD_CMP_JS_CAMERA_ERROR"))})}if(window.FACEID_AGREEMENT){C()}BX.bind(BX("faceid-settings-button"),"click",function(){BX.toggle(BX("faceid-settings-container"))});function w(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getMedia({video:{deviceId:{exact:s}},audio:false},function(e){if(navigator.mozGetUserMedia){t.mozSrcObject=e}else{var a=window.URL||window.webkitURL;t.src=a.createObjectURL(e)}t.play()},function(e){console.log("An error occured! "+e);BX.localStorage.remove("faceid-default-camera");var a;if(e.toString().indexOf("DevicesNotFound")>=0){a=BX.message("FACEID_TRACKERWD_CMP_JS_CAMERA_NOT_FOUND")}else{a=BX.message("FACEID_TRACKERWD_CMP_JS_CAMERA_NO_SUPPORT")}I(a)})}function S(){t=document.getElementById("faceid-video");r=document.getElementById("faceid-canvas");n=document.getElementById("faceid-startbutton");w();l=document.getElementById("faceid-overlay-face-border");f=l.getContext("2d");t.addEventListener("canplay",function(e){if(!a){{}o.cameraRatio=t.videoWidth/t.videoHeight;o.cameraSmallHeight=t.videoHeight/(t.videoWidth/o.cameraSmallWidth);if(o.screenRatio>=o.cameraRatio){o.cameraFullWidth=window.screen.width;o.cameraFullHeight=t.videoHeight/(t.videoWidth/o.cameraFullWidth)}else{o.cameraFullHeight=window.screen.height;o.cameraFullWidth=t.videoWidth/(t.videoHeight/o.cameraFullHeight)}o.snapshotHeight=t.videoHeight/(t.videoWidth/o.snapshotWidth);o.trackingSmallRatio=o.cameraSmallWidth/o.snapshotWidth;o.trackingFullRatio=o.cameraFullWidth/o.snapshotWidth;o.cameraWidth=o.cameraSmallWidth;o.cameraHeight=o.cameraSmallHeight;o.trackingRatio=o.trackingSmallRatio;t.setAttribute("width",o.cameraWidth);t.setAttribute("height",o.cameraHeight);r.setAttribute("width",o.snapshotWidth);r.setAttribute("height",o.snapshotHeight);l.setAttribute("width",o.cameraWidth);l.setAttribute("height",o.cameraHeight);a=true;A()}},false);n.addEventListener("click",function(e){e.preventDefault()},false);if(window.FACEID_LAST_VISITORS){for(i in window.FACEID_LAST_VISITORS){H(window.FACEID_LAST_VISITORS[i],false)}}}function I(e){BX("faceid-camera-error").innerHTML=e;BX.show(BX("faceid-camera-error"))}function A(){requestAnimationFrame(A);if(!BX("faceid-auto-identify").checked){return}if(e){return}if(u.length){}e=true;var a=r.getContext("2d");a.drawImage(t,0,0,o.snapshotWidth,o.snapshotHeight);var i=r.toDataURL("image/jpeg",1);var c=new Image;c.onload=function(){var a=E(r,true);if(a.length>0){var t=[];for(var i in a){if(!m[a[i].frameId]&&h.getBestShotFrameNumber(a[i].frameId)>=0&&h.getCurrentFrameNumber()>=h.getBestShotFrameNumber(a[i].frameId)){t.push(a[i])}}if(t.length){D(t,c)}}e=false};c.onerror=function(){e=false};c.src=i;requestAnimationFrame(A)}function R(e){for(var a=0;a<k.length;a++){var t=0;for(var i=0;i<e.length;i++){if(e[i]!=k[a])t++;else break}if(t==e.length){k[a]=-1;B[a]=""}}for(var i=0;i<e.length;i++){var r=true;for(var a=0;a<k.length;a++){if(e[i]==k[a]){r=false;break}}if(r){for(var a=0;a<k.length;a++){if(k[a]==-1){k[a]=e[i];break}}}}}function T(e,a,t,i,r){e.save();e.strokeStyle="rgba("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")";e.lineWidth=3;try{var c=a.x;var n=a.y;var s=a.x+a.width;var d=a.y+a.height;var l=t;var f=Math.PI/180;if(s-c-2*l<0){l=(s-c)/2}if(d-n-2*l<0){l=(d-n)/2}e.beginPath();e.moveTo(c+l,n);e.lineTo(s-l,n);e.arc(s-l,n+l,l,f*270,f*360,false);e.lineTo(s,d-l);e.arc(s-l,d-l,l,f*0,f*90,false);e.lineTo(c+l,d);e.arc(c+l,d-l,l,f*90,f*180,false);e.lineTo(c,n+l);e.arc(c+l,n+l,l,f*180,f*270,false);e.closePath();if(o.cameraWidth==o.cameraFullWidth){e.font="bold 24px opensans"}else{e.font="bold 11px opensans"}e.fillStyle="#91ff4f";var u="";if(m[r]){u=m[r].name}e.fillText(u.toUpperCase(),c,n-5);e.stroke();e.restore()}catch(h){console.log("BAD VALUE OF DETECTION");console.log(h)}}function x(e){if(!e){var a=r.getContext("2d");a.drawImage(t,0,0,o.snapshotWidth,o.snapshotHeight);e=r.toDataURL("image/jpeg",1)}var i=new Image;i.onload=function(){var e=true;if(e){var a=E(r);D(a,i)}else{W(i.getAttribute("src"))}};i.src=e}function E(e,a){var i=[];var r=[];var c=[];_=false;var n=e.getContext("2d");n.drawImage(t,0,0,o.snapshotWidth,o.snapshotHeight);var s=e;var d=s.getContext("2d");var l=d.getImageData(0,0,o.snapshotWidth,o.snapshotHeight);g.set(l.data,0);h.submitRawImage(p,o.snapshotWidth,o.snapshotHeight);h.update();var f=h.getIds();var v=JSON.parse(f);var k=v["ids"];R(k);if(k.length){for(var B=0;B<k.length;B++){var X=k[B];var C=h.getSmoothedFaceDetection(X);var w=h.faceDetectionIsPredicted(X);var S=[145,255,79,255];var I="";var A=h.isSlowMovement(X);if(!A)I="TOO FAST!!!";if(w)I="PREDICT";if(w||!A){S=[255,0,0,255]}var T=JSON.parse(JSON.stringify(C));T.x=C.x*o.trackingRatio;T.y=C.y*o.trackingRatio;T.width=C.width*o.trackingRatio;T.height=C.height*o.trackingRatio;i.push({frameId:X,width:C.width,height:C.height,positionX:C.x,positionY:C.y})}var x=true;for(var E in i){if(u.indexOf(i[E].frameId)>-1){r.push(i[E]);_=true;if(x){break}}if(m[i[E].frameId]){r.push(i[E]);_=true;if(x){break}}}if(!x||x&&r.length==0){for(var E in i){if(!m[i[E].frameId]&&h.getBestShotFrameNumber(i[E].frameId)>=0&&h.getCurrentFrameNumber()>=h.getBestShotFrameNumber(i[E].frameId)){c.push(i[E]);r.push(i[E]);if(x){break}}}}}y(r);if(!_&&b){F()}b=_;if(!a){M()}return c}function F(){BX.hide(BX("faceid-tracker-workday-started"));BX.hide(BX("faceid-tracker-workday-opened"));BX.hide(BX("faceid-tracker-workday-paused"));BX.hide(BX("faceid-tracker-workday-ended"));X=null}function y(e){f.clearRect(0,0,l.width,l.height);var a,t,i;for(var r in e){var c=e[r];var n={};i=h.faceDetectionIsPredicted(c.frameId);a=[145,255,79,255];t=h.isSlowMovement(c.frameId);if(i||!t){a=[255,0,0,255]}n.x=c.positionX*o.trackingRatio;n.y=c.positionY*o.trackingRatio;n.width=c.width*o.trackingRatio;n.height=c.height*o.trackingRatio;T(f,n,10,a,c.frameId)}}function M(){requestAnimationFrame(function(){requestAnimationFrame(function(){h.reset();f.clearRect(0,0,l.width,l.height)})})}function D(e,a){var t=false;if(e.length>0){for(i=0;i<e.length;i++){{var r=e[i];var c=document.createElement("canvas");c.setAttribute("width",100);c.setAttribute("height",100);var n=c.getContext("2d");var s=.6;var d=Math.max(0,r.positionX-r.width*s/2);var o=Math.max(0,r.positionY-r.height*s/2);var l=r.width+r.width*s;var f=r.height+r.height*s;var u=100;var m=100;var h=0;var v=0;n.drawImage(a,d,o,l,f,h,v,u,m);var p=c.toDataURL("image/jpeg");W(p,r.frameId);t=true}}}if(!t){W(a.src,false,true)}}function W(e,a,t){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var i=BX.create("div",{attrs:{"class":"faceid-tracker-main-user-item faceid-tracker-first-item"}});i.innerHTML='<div class="faceid-tracker-main-user-photo"> 					<div class="faceid-tracker-main-user-photo-platform"> 						<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> 					</div> 					<div class="faceid-tracker-main-user-photo-item"> 						<img width="100" height="100"> 					</div> 					<div class="faceid-tracker-main-user-photo-count"> 						<span class="faceid-tracker-main-user-photo-count-item">58%</span> 						<div class="faceid-tracker-main-user-photo-count-info"> 							<div class="faceid-tracker-main-user-photo-count-info-desc"></div> 							<div class="faceid-tracker-main-user-photo-item"></div> 						</div> 					</div> 				</div> 				<div class="faceid-tracker-main-user-info"> 					<div class="faceid-tracker-user-loader"> 						<div class="faceid-tracker-user-loader-item"> 							<div class="faceid-tracker-loader"> 								<svg class="faceid-tracker-circular" viewBox="25 25 50 50"> 									<circle class="faceid-tracker-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/> 								</svg> 							</div> 						</div> 					</div> 				</div>';BX.prepend(i,BX("faceid-tracker-main-user-container"));var r=20;var c=BX.findChildren(BX("faceid-tracker-main-user-container"),{"class":"faceid-tracker-main-user-item"});if(c.length>r){d=c[c.length-2].getAttribute("data-last-visit-ts");var n=c[c.length-1];n.remove()}var s=BX.findChild(i,{"class":"faceid-tracker-main-user-photo-item"},true);var o=BX.findChild(s,{tag:"img"});o.setAttribute("src",e);if(t){BX.addClass(i,"faceid-tracker-user-warning");var l=BX.findChild(i,{"class":"faceid-tracker-main-user-info"},true);l.innerHTML='<div class="faceid-tracker-main-user-info-name"> 				<div class="faceid-tracker-main-user-info-name-warning">'+BX.message("FACEID_TRACKERWD_CMP_JS_FACE_NOT_FOUND")+"</div> 			</div>"}else{var f=a>=0?a:"faceid-ajax-unique-"+Math.random();O(f);X={trackingFrameId:a};BX.ajax({url:"/bitrix/components/bitrix/faceid.timeman/ajax.php",method:"POST",data:{action:"identify",image:e,autoOpen:1},dataType:"json",processData:false,start:true,onsuccess:function(e){N(f);var t=false;var i=BX.message("FACEID_TRACKERWD_CMP_JS_FACE_NOT_FOUND");if(e.length&&X!==null&&X.trackingFrameId==a){var r=JSON.parse(e);if(r.visitor&&!K(r.visitor)){t=true;var c=r.visitor;X=c;if(r.action=="OPENED"){BX.show(BX("faceid-tracker-workday-started"))}else if(c.workday_status=="OPENED"){BX.show(BX("faceid-tracker-workday-opened"))}else if(c.workday_status=="PAUSED"){BX.show(BX("faceid-tracker-workday-paused"))}if(a>=0){m[a]={name:c.full_name}}}else if(r.error&&r.error.msg){if(a>=0&&r.error.code=="OK_UNKNOWN_PERSON"){m[a]={name:"UNKNOWN PERSON"}}i=r.error.msg}}if(!t){h.discardBestShot(a)}},onfailure:function(){N(f);h.discardBestShot(a)}})}}function O(e){u.push(e)}function N(e){var a=u.indexOf(e);if(a>-1){u.splice(a,1)}}function H(e,a){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var t=BX.create("div",{attrs:{"class":"faceid-tracker-main-user-item faceid-tracker-first-item"}});var i=j(t,e);BX.prepend(t,BX("faceid-tracker-main-user-container"));if(e.last_visit_ts<d||d==null){d=e.last_visit_ts}if(i){L(e,a)}}function P(e,a){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var t=BX.create("div",{attrs:{"class":"faceid-tracker-main-user-item faceid-tracker-first-item"}});var i=j(t,e);if(BX("faceid-tracker-main-user-more")){BX("faceid-tracker-main-user-container").insertBefore(t,BX("faceid-tracker-main-user-more"))}else{BX.append(t,BX("faceid-tracker-main-user-container"))}if(e.last_visit_ts<d||d==null){d=e.last_visit_ts}if(i){L(e,a)}}function L(e,a){a=typeof a!=="undefined"?a:true;BX("faceid-stats-current-count").innerText=parseInt(BX("faceid-stats-current-count").innerText)+1;if(a){if(e.visits_count<=1){BX("faceid-stats-new-count").innerText=parseInt(BX("faceid-stats-new-count").innerText)+1}else{BX("faceid-stats-old-count").innerText=parseInt(BX("faceid-stats-old-count").innerText)+1}BX("faceid-stats-total-count").innerText=parseInt(BX("faceid-stats-total-count").innerText)+1;if(e.crm_url.length){BX("faceid-stats-crm-count").innerText=parseInt(BX("faceid-stats-crm-count").innerText)+1}}}function j(e,a){var t=true;var i=typeof a=="string"?JSON.parse(a):a;e.setAttribute("data-visitor-id",i.visitor_id);var r=BX.findChildren(BX("faceid-tracker-main-user-container"),{attr:{"data-visitor-id":i.visitor_id}});if(r){var c;for(c in r){if(r[c]!=e){r[c].remove();t=false}}}if(i.confidence>0){BX.addClass(e,"faceid-tracker-photo")}if(i.crm_url.length>0){BX.addClass(e,"faceid-tracker-platform")}if(i.vk_id.length>0){BX.addClass(e,"faceid-tracker-social-state")}e.setAttribute("data-last-visit-ts",i.last_visit_ts);var n='<div class="faceid-tracker-main-user-photo"> 						<div class="faceid-tracker-main-user-photo-platform"> 							<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> 						</div> 						<div class="faceid-tracker-main-user-photo-item"> 							<img width="100" height="100"> 						</div> 						<div class="faceid-tracker-main-user-photo-count"> 							<span class="faceid-tracker-main-user-photo-count-item">'+i.confidence+'%</span> 							<div class="faceid-tracker-main-user-photo-count-info"> 								<div class="faceid-tracker-main-user-photo-count-info-desc">'+BX.message("FACEID_TRACKERWD_CMP_JS_FACE_ORIGINAL")+'</div> 								<div class="faceid-tracker-main-user-photo-item" style="background-image: url('+i.image_src+')"></div> 							</div> 						</div> 					</div> 					<div class="faceid-tracker-main-user-info"> 						<div class="faceid-tracker-main-user-info-description"> 							<span class="faceid-tracker-main-user-info-description-item">'+i.visit_info+'</span> 						</div> 						<div class="faceid-tracker-main-user-info-name">';if(i.crm_url.length)n+='<a href="'+i.crm_url+'" class="faceid-tracker-main-user-info-name-item">'+i.name+"</a>";else n+='<div class="faceid-tracker-main-user-info-name-item">'+i.name+"</div>";n+='						</div> 						<div class="faceid-tracker-main-user-info-control">';if(!i.crm_url.length)n+='							<div class="faceid-tracker-main-user-info-control-block'+(i.crm_url.length?" faceid-tracker-button-state":"")+'"> 								<div class="webform-small-button webform-small-button-blue faceid-tracker-main-user-info-control-button">'+BX.message("FACEID_TRACKERWD_CMP_JS_SAVE_CRM")+' 									<div class="faceid-tracker-user-loader"> 										<div class="faceid-tracker-user-loader-item"> 											<div class="faceid-tracker-loader"> 												<svg class="faceid-tracker-circular" viewBox="25 25 50 50"> 													<circle class="faceid-tracker-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/> 												</svg> 											</div> 										</div> 									</div> 								</div> 								<div class="webform-small-button webform-small-button-transparent faceid-tracker-main-user-info-control-button">'+BX.message("FACEID_TRACKERWD_CMP_JS_SAVE_CRM_DONE")+"</div> 							</div>";n+='							<div class="faceid-tracker-main-user-info-control-social"> 								<span class="faceid-tracker-main-user-info-control-social-name">'+BX.message("FACEID_TRACKERWD_CMP_JS_VK_LINK")+"</span>";if(i.vk_id.length)n+='									<a href="http://vk.com/'+BX.util.htmlspecialchars(i.vk_id)+'" class="faceid-tracker-main-user-info-control-social-item">'+"VK.com/"+BX.util.htmlspecialchars(i.vk_id)+"</a>";else n+='									<span class="faceid-tracker-main-user-info-control-social-item"><span>'+BX.message("FACEID_TRACKERWD_CMP_JS_VK_LINK_ACTION")+"</span></span>";n+="							</div> 						</div> 					</div>";e.innerHTML=n;var s=BX.findChild(e,{"class":"faceid-tracker-main-user-photo-item"},true);var d=BX.findChild(s,{tag:"img"});d.setAttribute("src",i.shot_src);if(!i.vk_id.length){var o=BX.clone(BX("faceid-tracker-profile-search-example"));o.id="";o.style.top=document.body.scrollTop+596+30+"px";var l=BX.findChild(e,{"class":"faceid-tracker-main-user-info-control-social-item"},true);var f=BX.findChild(o,{"class":"faceid-tracker-profile-search-header"},true);var u=0;var m=0;var h=function(e){var a=u-e.clientX;var t=m-e.clientY;o.style.left=parseInt(o.style.left)-a+"px";o.style.top=parseInt(o.style.top)-t+"px";u=e.clientX;m=e.clientY};var v=function(){BX.unbind(document,"mousemove",h);BX.unbind(document,"mouseup",v)};BX.bind(f,"mousedown",function(e){var a=BX.pos(o);o.style.left=a.left+"px";o.style.top=a.top+"px";u=e.clientX;m=e.clientY;o.style.transform="translate(0)";BX.bind(document,"mousemove",h);BX.bind(document,"mouseup",v)});document.body.appendChild(o);var p=BX.findChild(l,{tag:"span"});BX.bind(p,"click",function(){BX.show(o);if(o.getAttribute("data-in-progress")){return}o.setAttribute("data-in-progress","1");BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_vk.php",method:"POST",data:{action:"identify",image:i.shot_src,visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(a){var t=JSON.parse(a);var r=t.items;if(t.status&&t.status.balance>=0){BX("faceid-credits-balance").innerText=t.status.balance}if(r.length){var c,n="";n=J(r[0],true);var s=BX.findChild(o,{"class":"faceid-tracker-profile-search-main"},true);s.innerHTML=n+s.innerHTML;n="";r.splice(0,1);for(c in r){n+=J(r[c])}s=BX.findChild(o,{"class":"faceid-tracker-profile-search-found-container"},true);s.innerHTML=n;var d=BX.findChild(o,{"class":"faceid-tracker-profile-search-found-more-count"},true);d.innerHTML=r.length+" "+BX.message("FACEID_TRACKERWD_CMP_JS_VK_FOUND_PEOPLE");var f=BX.findChild(o,{"class":"faceid-tracker-profile-search-loading"},true);BX.addClass(f,"faceid-tracker-animate-hidden");var u=BX.findChildren(o,{"class":"faceid-tracker-main-user-info-control-button"},true);for(c in u){BX.bind(u[c],"click",function(){var a=BX(this).parentNode.parentNode;var t=BX.findChild(a,{"class":"faceid-tracker-main-user-social-link-item"},true).innerText;var r=l.parentNode;l.remove();r.innerHTML+='<a href="http://'+t+'" class="faceid-tracker-main-user-info-control-social-item">'+t.replace("vk.com","VK.com")+"</a>";BX.addClass(e,"faceid-tracker-social-state");BX.hide(o);BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_vk.php",method:"POST",data:{action:"save",vk_id:t.replace("vk.com/",""),visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(a){var t=JSON.parse(a);var r=BX.findChild(e,{"class":"faceid-tracker-main-user-info-name"},true);r.innerHTML='<a href="'+t.url+'" class="faceid-tracker-main-user-info-name-item">'+i.name+"</a>"}})})}}else if(t.error&&t.error.msg){var f=BX.findChild(o,{"class":"faceid-tracker-loader"},true);BX.hide(f);var m=BX.findChild(o,{"class":"faceid-tracker-profile-search-loading-desc"},true);BX.hide(m);var h=BX.findChild(o,{"class":"faceid-tracker-error"},true);h.innerHTML=t.error.msg;BX.show(h)}}})});var g=BX.findChild(o,{"class":"faceid-tracker-header-description-close-item"},true);BX.bind(g,"click",function(){BX.hide(o)})}var k=BX.findChild(e,{"class":"webform-small-button-blue"},true);BX.bind(k,"click",function(){var a=BX(this).parentNode;if(!BX.hasClass(a,"faceid-tracker-button-state")&&!BX.hasClass(a,"faceid-control-loader-state")){BX.addClass(a,"faceid-control-loader-state");BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_crm.php",method:"POST",data:{action:"addLead",lead_title:i.name,visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(t){var r=JSON.parse(t);var c=BX.findChild(e,{"class":"faceid-tracker-main-user-info-name"},true);c.innerHTML='<a href="'+r.url+'" class="faceid-tracker-main-user-info-name-item">'+i.name+"</a>";BX.removeClass(a,".faceid-control-loader-state");BX.addClass(a,"faceid-tracker-button-state")}})}});return t}function J(e,a){var t='<div class="faceid-tracker-main-user-item faceid-tracker-profile-search-found faceid-tracker-photo'+(a?" faceid-tracker-found-user":"")+'"> 					<div class="faceid-tracker-main-user-photo"> 						<div class="faceid-tracker-main-user-photo-platform"> 							<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> 						</div> 						<div class="faceid-tracker-main-user-photo-item" style="background-image: url('+BX.util.htmlspecialchars(e.photo)+')"></div> 						<div class="faceid-tracker-main-user-photo-count"> 							<span class="faceid-tracker-main-user-photo-count-item">'+Math.round(e.confidence*100)+'%</span> 						</div> 					</div> 					<div class="faceid-tracker-main-user-info"> 						<div class="faceid-tracker-main-user-info-name"> 							<div class="faceid-tracker-main-user-info-name-item">'+BX.util.htmlspecialchars(e.name)+'</div> 							<div class="faceid-tracker-main-user-date"> 								<span class="faceid-tracker-main-user-date-item">'+BX.util.htmlspecialchars(e.personal)+'</span> 							</div> 							<div class="faceid-tracker-main-user-social-link"> 								<a href="http://vk.com/'+BX.util.htmlspecialchars(e.id)+'" class="faceid-tracker-main-user-social-link-item">vk.com/'+BX.util.htmlspecialchars(e.id)+'</a> 							</div> 						</div> 						<div class="faceid-tracker-main-user-info-control"> 							<div class="webform-small-button webform-small-button-blue faceid-tracker-main-user-info-control-button '+(a?"":"faceid-tracker-search-button")+'">'+BX.message("FACEID_TRACKERWD_CMP_JS_VK_SELECT")+"</div> 						</div> 					</div> 				</div>";return t}BX.ready(function(){BX.bind(BX("faceid-tracker-main-user-more"),"click",function(){if(!d){return}BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_more.php",method:"POST",data:{last:d},dataType:"json",processData:false,start:true,onsuccess:function(e){var a,t=JSON.parse(e);if(t.items.length){for(a in t.items){P(t.items[a],false)}}if(t.more==0){BX("faceid-tracker-main-user-more").remove()}}})});BX.bind(BX("faceid-tracker-header-description-close"),"click",function(){BX.localStorage.set("faceid-description-read","1",3600*24*360);BX(this).parentNode.remove()});if(!BX.localStorage.get("faceid-description-read")){BX.show(BX("faceid-tracker-header-description-close").parentNode)}BX.bind(BX("faceid-auto-identify"),"change",function(){if(!BX(this).checked){M()}})});function K(e){if(e.hasOwnProperty("length"))return e.length==0;for(var a in e){if(e.hasOwnProperty(a))return false}return JSON.stringify(e)===JSON.stringify({})}BX.bind(BX("faceid-fullscreen-button"),"click",function(){var e=t;var a=BX.findParent(e,{"class":"faceid-tracker-wrapper"});var i=BX("faceid-video").parentNode;if(document.webkitFullscreenElement){document.webkitCancelFullScreen()}else{i.webkitRequestFullscreen()}});BX.bind(document,"webkitfullscreenchange",function(){var e=BX.findParent(t,{"class":"faceid-tracker-wrapper"});var a=BX("faceid-fullscreen-button");BX.toggleClass(e,"faceid-tracker-full-mode");BX.toggle(a);BX.bind(e,"contextmenu",function(e){e.preventDefault()});if(!document.webkitFullscreenElement){o.cameraWidth=o.cameraSmallWidth;o.cameraHeight=o.cameraSmallHeight;o.trackingRatio=o.trackingSmallRatio}else{o.cameraWidth=o.cameraFullWidth;o.cameraHeight=o.cameraFullHeight;o.trackingRatio=o.trackingFullRatio}t.setAttribute("width",o.cameraWidth);t.setAttribute("height",o.cameraHeight);l.setAttribute("width",o.cameraWidth);l.setAttribute("height",o.cameraHeight)});BX.bind(BX("faceid-tracker-workday-action-end"),"click",function(){var e=X.id;U(e)});function U(e){BX.hide(BX("faceid-tracker-workday-opened"));BX.ajax({url:"/bitrix/components/bitrix/faceid.timeman/ajax.php",method:"POST",data:{action:"close",id:e},dataType:"json",processData:false,start:true,onsuccess:function(a){if(X&&X.id==e){BX.show(BX("faceid-tracker-workday-ended"))}}})}}
//# sourceMappingURL=script.map.js