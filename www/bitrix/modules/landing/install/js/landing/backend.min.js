(function(){"use strict";BX.namespace("BX.Landing");var n=BX.Landing.Utils.isPlainObject;var a=BX.Landing.Utils.isString;BX.Landing.Backend=function(){this.ajaxController="/bitrix/tools/landing/ajax.php"};BX.Landing.Backend.instance=null;BX.Landing.Backend.getInstance=function(){if(!BX.Landing.Backend.instance){BX.Landing.Backend.instance=new BX.Landing.Backend}return BX.Landing.Backend.instance};BX.Landing.Backend.prototype={action:function(n,t,i,e){e=BX.type.isPlainObject(e)?e:{};i=BX.type.isPlainObject(i)?i:{};BX.Landing.Utils.assign(i,{site_id:this.getSiteId()});var o={};o.sessid=BX.bitrix_sessid();o.action=n.replace("Landing\\Block","Block");o.data=typeof t==="object"?t:{};o.data.lid=o.data.lid||BX.Landing.Main.getInstance().id;if("action"in e){o.action=e.action}if("block"in e){o.data.block=e.block}if("lid"in e){o.data.lid=e.lid}if("id"in e){o.data.id=e.id}var d=BX.util.add_url_param(this.ajaxController,BX.util.objectMerge({action:o.action},i));return new Promise(function(n,a){BX.ajax({method:"POST",dataType:"json",url:d,data:o,onsuccess:function(t){if(!!t&&t.type==="error"){a(t)}else{n(t.result)}},onfailure:function(n){a(n)}})}).then(function(n){if(o.action==="Block::updateNodes"||o.action==="Block::removeCard"||o.action==="Block::cloneCard"||o.action==="Block::addCard"){BX.Landing.UI.Panel.StatusPanel.getInstance().update()}return n}).catch(function(n){if(o.action!=="Block::getById"){n=a(n)?{type:"error"}:n;n.action=o.action;BX.Landing.ErrorManager.getInstance().add(n)}return Promise.reject()})},batch:function(n,t,i){i=BX.type.isPlainObject(i)?i:{};BX.Landing.Utils.assign(i,{site_id:t.siteId||this.getSiteId()});var e={};e.sessid=BX.bitrix_sessid();e.action=n.replace("Landing\\Block","Block");e.data={};e.batch=typeof t==="object"?t:{};e.data.lid=e.data.lid||BX.Landing.Main.getInstance().id;var o=BX.util.add_url_param(this.ajaxController,BX.util.objectMerge({action:e.action},i));return new Promise(function(n,a){BX.ajax({method:"POST",dataType:"json",url:o,data:e,onsuccess:function(t){if(!!t&&t.type==="error"){a(t)}else{n(t)}},onfailure:function(n){a(n)}})}).then(function(n){BX.Landing.UI.Panel.StatusPanel.getInstance().update();return n}).catch(function(n){if(e.action!=="Block::getById"){n=a(n)?{type:"error"}:n;n.action=e.action;BX.Landing.ErrorManager.getInstance().add(n)}return Promise.reject()})},getSiteId:function(){var n;try{n=BX.Landing.Main.getInstance().options.site_id}catch(a){n=-1}return n},upload:function(n,t){var i=new FormData;var e=t||{};var o="Block::uploadFile";i.append("sessid",BX.bitrix_sessid());i.append("action","Block::uploadFile");i.append("picture",n,n.name);if("block"in e){i.append("data[block]",e.block)}if("lid"in e){o="Landing::uploadFile";i.append("data[lid]",e.lid);i.set("action",o)}if("id"in e){o="Site::uploadFile";i.append("data[id]",e.id);i.set("action",o)}var d=BX.util.add_url_param(this.ajaxController,{action:o,site_id:this.getSiteId()});return new Promise(function(n,a){var t=BX.ajax({url:d,method:"POST",dataType:"json",data:i,start:false,preparePost:false,onsuccess:function(t){if(!!t&&t.type==="error"){a(t)}else{n(t.result)}},onfailure:function(n){a(n)}});t.send(i)}).catch(function(n){n=a(n)?{type:"error"}:n;n.action="Block::uploadFile";BX.Landing.ErrorManager.getInstance().add(n);return Promise.reject(n)})},uploadImage:function(t,i,e,o){if(!t){t=document.createElement("form")}o=n(o)?o:{};var d={};d.sessid=BX.bitrix_sessid();d.action="action"in o?o.action:"Utils::uploadFile";d.picture=i;d.data={};d.data.params=typeof e==="object"?e:{};if("block"in o){d.data.block=o.block}if("lid"in o){d.data.lid=o.lid}if("id"in o){d.data.id=o.id}var r=BX.util.add_url_param(this.ajaxController,{action:d.action,site_id:this.getSiteId()});return new Promise(function(n,a){BX.ajax.submitAjax(t,{url:r,method:"POST",dataType:"json",data:d,onsuccess:function(t){if(!!t&&t.type==="error"){a(t)}else{n(t.result)}},onfailure:function(n){a(n)}})}).catch(function(n){n=a(n)?{type:"error"}:n;n.action=d.action;BX.Landing.ErrorManager.getInstance().add(n);return Promise.reject()})}}})();
//# sourceMappingURL=backend.map.js