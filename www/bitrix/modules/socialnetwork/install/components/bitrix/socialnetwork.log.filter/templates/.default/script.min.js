__logOnDateChange=function(e){var t=false,i=false,n=false,o=false;if(e.value=="interval")t=i=n=true;else if(e.value=="before")i=true;else if(e.value=="after"||e.value=="exact")t=true;else if(e.value=="days")o=true;BX("flt_date_from_span").style.display=t?"":"none";BX("flt_date_to_span").style.display=i?"":"none";BX("flt_date_hellip_span").style.display=n?"":"none";BX("flt_date_day_span").style.display=o?"inline-block":"none";BX("flt_date_day_text_span").style.display=o?"inline-block":"none"};function __logOnReload(e){if(BX("menu-popup-lenta-sort-popup")){var t=BX.findChildren(BX("menu-popup-lenta-sort-popup"),{className:"lenta-sort-item"},true);if(!BX.hasClass(t[0],"lenta-sort-item-selected")){for(var i=0;i<t.length;i++){if(i==0)BX.addClass(t[i],"lenta-sort-item-selected");else if(i!=t.length-1)BX.removeClass(t[i],"lenta-sort-item-selected")}}}if(BX("lenta-sort-button")){var n=BX.findChild(BX("lenta-sort-button"),{className:"lenta-sort-button-text-internal"},true,false);if(n)n.innerHTML=BX.message("sonetLFAllMessages")}var o=BX("sonet_log_counter_preset",true);if(o){if(parseInt(e)>0){o.style.display="inline-block";o.innerHTML=e}else{o.innerHTML="";o.style.display="none"}}}BitrixLFFilter=function(){this.id=null;this.filterPopup=false;this.currentName=null;this.obInputName={};this.obSearchInput={};this.obInputContainerName={};this.obContainerInput={};this.popupMenu=null;this.menuItems=[];this.actualSearchString="";this.minSearchStringLength=2};BitrixLFFilter.prototype.initLentaMenu=function(e){if(typeof e.menuItems!="undefined"){this.menuItems=e.menuItems}};BitrixLFFilter.prototype.showLentaMenu=function(e){var t=typeof e.short!="undefined"&&e.short,i=typeof e.bindElement!="undefined"?BX(e.bindElement):null;if(!i){return false}if(typeof e.siteTemplateId=="undefined"||e.siteTemplateId!="bitrix24"){BX.addClass(i,"lenta-sort-button-active")}this.popupMenu=BX.PopupMenu.create("lenta-sort-popup",i,BX.util.array_merge(!t?BX.util.array_merge(this.menuItems.preset,this.menuItems.filter):[],this.menuItems.actions),{offsetTop:e.siteTemplateId=="bitrix24"?-5:2,offsetLeft:e.siteTemplateId=="bitrix24"?17:43,angle:true,events:{onPopupClose:function(){if(typeof e.siteTemplateId!="undefined"||e.siteTemplateId!="bitrix24"){BX.removeClass(i,"lenta-sort-button-active")}}}});this.popupMenu.show();return false};BitrixLFFilter.prototype.initFilter=function(e){var t=typeof e!="undefined"&&typeof e.version!="undefined"?parseInt(e.version):0;var i=typeof e!="undefined"&&typeof e.filterId!="undefined"?e.filterId:"LIVEFEED";this.id=i;if(t>=2){if(typeof e!="undefined"&&typeof e.minSearchStringLength!="undefined"&&parseInt(e.minSearchStringLength)>0){this.minSearchStringLength=parseInt(e.minSearchStringLength)}var n=BX.Main.filterManager.getById(i);if(n&&(n.getSearch().getSquares().length>0||n.getSearch().getSearchString().length>0)){var o=BX.findParent(BX(i+"_filter_container"),{className:"pagetitle-wrap"});if(o){BX.addClass(o,"pagetitle-wrap-filter-opened")}}BX.addCustomEvent("BX.Livefeed:refresh",BX.delegate(function(){var e=BX.Main.filterManager.getById(i);if(e){e.getPreset().resetPreset(true);e.getSearch().clearForm()}},this));BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate(function(e,t,n,o){if(e!=i||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:beforeApply",[t,o])},this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(function(e,t,n,o,a){if(e!=i||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:apply",[t,o,a])},this));BX.addCustomEvent("BX.Filter.Search:input",BX.delegate(function(e,t){if(e==i){this.actualSearchString=typeof t!="undefined"?BX.util.trim(t):"";if(this.actualSearchString.length>0&&this.actualSearchString.length>=this.minSearchStringLength){BX.onCustomEvent(window,"BX.Livefeed.Filter:searchInput",[t])}}},this));BX.addCustomEvent("BX.Main.Filter:blur",BX.delegate(function(e){if(e.getParam("FILTER_ID")==i&&e.getSearch().getSquares().length<=0&&e.getSearch().getSearchString().length<=0){var t=BX.findParent(BX(i+"_filter_container"),{className:"pagetitle-wrap"});if(t){BX.removeClass(t,"pagetitle-wrap-filter-opened")}}}));if(BX(this.id+"_filter_container")){var a=BX.delegate(function(e){var t=BX.findParent(e.target,{className:"pagetitle-wrap"});if(t&&!BX.hasClass(t,"pagetitle-wrap-filter-opened")){BX.addClass(t,"pagetitle-wrap-filter-opened")}},this);BX.bind(BX(this.id+"_search_container"),"click",a)}}else{__logOnDateChange(document.forms["log_filter"].flt_date_datesel);BX("flt_date_from_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_from"),bTime:false})};BX("flt_date_to_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_to"),bTime:false})}}};BitrixLFFilter.prototype.initDestination=function(e){this.obInputName[e.name]=e.inputName;this.obSearchInput[e.name]=BX(e.inputName);this.obInputContainerName[e.name]=e.inputContainerName;this.obContainerInput[e.name]=BX(e.inputContainerName);if(typeof e.items!="undefined"&&typeof e.items.department!="undefined"){if(typeof e.items.extranetRoot!="undefined"){for(var t in e.items.extranetRoot){if(e.items.extranetRoot.hasOwnProperty(t)){e.items.department[t]=e.items.extranetRoot[t]}}}if(!e.items.departmentRelation){e.items.departmentRelation=BX.SocNetLogDestination.buildDepartmentRelation(e.items.department)}}BX.SocNetLogDestination.init({name:e.name,pathToAjax:typeof e.pathToAjax!="undefined"?e.pathToAjax:false,searchInput:this.obSearchInput[e.name],extranetUser:!!e.extranetUser,departmentSelectDisable:!!e.departmentSelectDisable,bindMainPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,{name:e.name,containerInput:BX(e.inputContainerName),inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName),resultFieldName:e.resultFieldName}),unSelect:BX.proxy(this.onUnSelectDestination,{name:e.name,inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName)})},items:e.items,itemsLast:e.itemsLast,itemsSelected:e.itemsSelected,itemsSelectedUndeleted:typeof e.itemsSelectedUndeleted!="undefined"?e.itemsSelectedUndeleted:{},isCrmFeed:false,useClientDatabase:true,destSort:e.destSort,allowAddUser:false,allowSearchEmailUsers:!e.extranetUser,userNameTemplate:e.userNameTemplate});BX.bind(this.obSearchInput[e.name],"click",function(t){oLFFilter.currentName=e.name;BX.SocNetLogDestination.openDialog(e.name);return BX.PreventDefault(t)});BX.bind(this.obSearchInput[e.name],"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}));BX.bind(this.obSearchInput[e.name],"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}))};BitrixLFFilter.prototype.clearInput=function(){if(this.obContainerInput[this.currentName]){var e=BX.findChildren(this.obContainerInput[this.currentName],{className:"feed-add-post-destination"},false);for(var t=0;t<e.length;t++){BX.SocNetLogDestination.deleteItem(e[t].attributes["data-id"].value,e[t].attributes["data-type"].value,this.currentName)}}};BitrixLFFilter.prototype.onSelectDestination=function(e,t,i,n){oLFFilter.clearInput();BX.SocNetLogDestination.BXfpSelectCallback({formName:this.name,item:e,type:t,search:i,bUndeleted:n,containerInput:this.containerInput,valueInput:this.searchInput,varName:this.resultFieldName});this.searchInput.style.display="none";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="block"}BX.SocNetLogDestination.closeDialog();BX.SocNetLogDestination.closeSearch()};BitrixLFFilter.prototype.onUnSelectDestination=function(e){var t=BX.findChildren(BX(this.inputContainerName),{attribute:{"data-id":""+e.id+""}},true);if(t!==null){for(var i=0;i<t.length;i++){BX.remove(t[i])}}BX(this.inputName).value="";this.searchInput.style.display="inline-block";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="none"}};BitrixLFFilter.prototype.ShowFilterPopup=function(e){if(!oLFFilter.filterPopup){BX.ajax.get(BX.message("sonetLFAjaxPath"),function(t){BX.closeWait(e);oLFFilter.filterPopup=new BX.PopupWindow("bx_log_filter_popup",e,{closeIcon:false,offsetTop:5,autoHide:true,zIndex:-100,className:"sonet-log-filter-popup-window",events:{onPopupClose:function(){if(!BX.hasClass(this.bindElement,"pagetitle-menu-filter-set"))BX.removeClass(this.bindElement,"pagetitle-menu-filter-selected")},onPopupShow:function(){BX.addClass(this.bindElement,"pagetitle-menu-filter-selected")}}});var i=BX.create("DIV",{html:BX.util.trim(t)});oLFFilter.filterPopup.setContent(i.firstChild);oLFFilter.filterPopup.show()})}else{oLFFilter.filterPopup.show()}};BitrixLFFilter.prototype.__SLFShowInfoPopup=function(e){var t=[BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-success"},text:BX.message("sonetLFDialogRead"),events:{click:function(){BX.ajax({method:"POST",dataType:"json",url:BX.message("ajaxControllerURL"),data:{sessid:BX.bitrix_sessid(),popupType:e.type,closePopup:"Y"},onsuccess:function(t){if(typeof t!="undefined"&&typeof t.SUCCESS!="undefined"&&t.SUCCESS=="Y"){o.close();if(e.reload){top.location=top.location.href}}}})}}})];if(BX.type.isArray(e.buttonsAdd)){var i=0;for(var n=0;n<e.buttonsAdd.length;n++){i=e.buttonsAdd[n];t.push(BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-"+i.type},text:i.title,events:{click:i.click}}))}}var o=new BX.PopupWindow(e.name,e.bindObj,{closeByEsc:false,closeIcon:false,autoHide:false,overlay:true,events:{},buttons:[],zIndex:0,content:BX.create("DIV",{children:[BX.create("DIV",{props:{className:"bx-slf-popup-title"},text:e.title}),BX.create("DIV",{props:{className:"bx-slf-popup-content"},children:[BX.create("DIV",{props:{className:"bx-slf-popup-cont-title"},html:e.description1}),BX.create("DIV",{props:{className:"bx-slf-popup-descript"},children:[BX.type.isNotEmptyString(e.description2)?BX.create("DIV",{html:e.description2}):null,BX.type.isPlainObject(e.descriptionImage)&&BX.type.isNotEmptyString(e.descriptionImage.src)?BX.create("IMG",{props:{className:"bx-slf-popup-descript-img"},attrs:{src:e.descriptionImage.src,width:e.descriptionImage.width,height:e.descriptionImage.height}}):null]})]}),BX.create("DIV",{props:{className:"popup-window-buttons"},children:t})]})});o.show();return o};BitrixLFFilter.prototype.onClickMenuItem=function(e){if(typeof e.menuItem!="undefined"){BX.toggleClass(e.menuItem,"lenta-sort-item-selected")}this.popupMenu.close();if(typeof e.href!="undefined"){top.location.href=e.href}};BitrixLFFilter.prototype.closeHint=function(e){};BitrixLFFilterDestinationSelectorManager={controls:{},onSelect:function(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.name)||typeof e.item=="undefined"||!BX.type.isNotEmptyString(e.type)){return}var t=e.name,i=e.type,n=e.item;BX.SocNetLogDestination.obItemsSelected[t]={};BX.SocNetLogDestination.obItemsSelected[t][n.id]=i;var o=BitrixLFFilterDestinationSelectorManager.controls[t];if(o){o.setData(BX.util.htmlspecialcharsback(n.name),n.id);o.getLabelNode().value="";o.getLabelNode().blur();if(BX.SocNetLogDestination.popupWindow!=null){BX.SocNetLogDestination.popupWindow.close()}if(BX.SocNetLogDestination.popupSearchWindow!=null){BX.SocNetLogDestination.popupSearchWindow.close()}}},onDialogOpen:function(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.name)){return}var t=e.name;var i=BitrixLFFilterDestinationSelector.items[t];if(i){i.onDialogOpen()}},onDialogClose:function(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.name)){return}var t=e.name;var i=BitrixLFFilterDestinationSelector.items[t];if(i){i.onDialogClose()}}};BitrixLFFilterDestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BitrixLFFilterDestinationSelector.items={};BitrixLFFilterDestinationSelector.create=function(e,t){var i=new BitrixLFFilterDestinationSelector(e,t);i.initialize(e,t);this.items[e]=i;BX.onCustomEvent(window,"BX.Livefeed.Filter:create",[e]);return i};BitrixLFFilterDestinationSelector.prototype.getSetting=function(e,t){return this.settings.hasOwnProperty(e)?this.settings[e]:t};BitrixLFFilterDestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BitrixLFFilterDestinationSelector.prototype.initialize=function(e,t){this.id=e;this.settings=t?t:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var n={};n[this.fieldId]=i.itemId;n[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(n)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.Selector:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSwitchTabFocus",BX.delegate(this.onBeforeSwitchTabFocus,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.delegate(this.onBeforeSelectItemFocus,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BitrixLFFilterDestinationSelector.prototype.open=function(){var e=this.id;if(!this.inited){var t=this.getSearchInput();t.id=t.name;BX.addCustomEvent(window,"BX.Main.Selector:afterInitDialog",BX.delegate(function(e){if(typeof e.id!="undefined"||e.id!=this.id){return}this.opened=true},this));BX.onCustomEvent(window,"BX.Livefeed.Filter:openInit",[{id:this.id,inputId:t.id,containerId:t.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Livefeed.Filter:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BitrixLFFilterDestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManager.controls[this.id]!=="undefined"){BX.Main.selectorManager.controls[this.id].closeDialog()}};BitrixLFFilterDestinationSelector.prototype.onCustomEntitySelectorOpen=function(e){var t=e.getId();if(this.fieldId!==t){this.control=null}else{this.control=e;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BitrixLFFilterDestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BitrixLFFilterDestinationSelector.prototype.onCustomEntitySelectorClose=function(e){if(this.fieldId===e.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BitrixLFFilterDestinationSelector.prototype.onGetStopBlur=function(e,t){if(BX.findParent(e.target,{className:"bx-lm-box"})){t.stopBlur=true}};BitrixLFFilterDestinationSelector.prototype.onCustomEntityRemove=function(e){if(this.fieldId===e.getId()){if(typeof e.hiddenInput!="undefined"&&typeof e.hiddenInput.value!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id]!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id][e.hiddenInput.value]!="undefined"){delete BX.SocNetLogDestination.obItemsSelected[this.id][e.hiddenInput.value]}}};BitrixLFFilterDestinationSelector.prototype.onBeforeSwitchTabFocus=function(e){if(this.id===e.id){e.blockFocus=true}};BitrixLFFilterDestinationSelector.prototype.onBeforeSelectItemFocus=function(e){if(this.id===e.id){e.blockFocus=true}};BitrixLFFilterDestinationSelector.prototype.onBeforeInitDialog=function(e){if(typeof e.id=="undefined"||e.id!=this.id){return}this.inited=true;if(!this.control){e.blockInit=true}};BitrixLFFilterDestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BitrixLFFilterDestinationSelector.prototype.onDialogClose=function(){this.opened=false};oLFFilter=new BitrixLFFilter;window.oLFFilter=oLFFilter;