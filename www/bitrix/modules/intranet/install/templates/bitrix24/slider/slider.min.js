(function(){"use strict";BX.namespace("BX.Bitrix24");BX.Bitrix24.Slider={defaultOptions:{panelStylezIndex:3200,imBarStylezIndex:3200,headerStylezIndex:3200,typeLoader:"default-loader"},anchorRules:[],openPages:[],lastPage:null,whiteListLink:[/(http|https):\/\/helpdesk\.bitrix24\.([a-zA-Z]{2,3})\/open\/([a-zA-Z0-9_|]+)/gi],init:function(){if(this.inited){return}this.isOpen=false;this.hidden=false;this.inited=true;this.eventsBound=false;this.hacksApplied=false;BX.addCustomEvent("BX.Bitrix24.PageSlider:close",this.close.bind(this));BX.addCustomEvent("Bitrix24.Slider:close",this.close.bind(this));BX.addCustomEvent("Bitrix24.Slider:closeAll",this.close.bind(this));BX.addCustomEvent("Bitrix24.Slider:postMessage",this.onPostMessage.bind(this));BX.addCustomEvent("BX.Bitrix24.Map:onBeforeOpen",this.closeAll.bind(this,true))},open:function(e,t){if(!BX.type.isNotEmptyString(e)){return}e=BX.util.remove_url_param(e,["IFRAME","IFRAME_TYPE"]);var i=this.getCurrentPage();if(i&&i.isVisible()&&i.getUrl()===e){return}t=BX.type.isPlainObject(t)?t:{};this.options=BX.mergeEx({},this.defaultOptions,t);if(this.isHidden()){this.unhide()}if(!this.isOpen){this.init();this.applyHacks();this.bindEvents()}var n=this.getLastOpenPage();if(n&&n.getUrl()===e){if(i){i.hideCLoseBtn()}this.addPage(n);n.open();this.resetLastOpenPage()}else{var s=new BX.Bitrix24.SliderPage(e,t);s.setZindex(s.getZindex()+this.getOpenPagesCount()*3);var r=Math.min(this.getOpenPagesCount(),3)*63;s.setOffset(r);if(i){i.hideCLoseBtn()}this.addPage(s);s.open();this.resetLastOpenPage()}if(BX.type.isDomNode(document.activeElement)){document.activeElement.blur()}this.isOpen=true},close:function(e,t){var i=this.getCurrentPage();if(i){i.close(e,t)}},closeAll:function(e){var t=this.getOpenPages();for(var i=t.length-1;i>=0;i--){var n=t[i];n.close(e)}},hide:function(){if(this.hidden){return false}this.getOpenPages().forEach(function(e){e.hide()});this.hidden=true;this.resetHacks();this.unbindEvents();return true},unhide:function(){if(!this.hidden){return false}this.getOpenPages().forEach(function(e){e.unhide()});this.hidden=false;setTimeout(function(){this.applyHacks();this.bindEvents()}.bind(this),0);return true},destroy:function(e){if(!BX.type.isNotEmptyString(e)){return}e=BX.util.remove_url_param(e,["IFRAME","IFRAME_TYPE"]);var t=-1;for(var i=0;i<this.openPages.length;i++){var n=this.openPages[i];if(t===-1&&n.getUrl()===e){t=i}if(t>-1){n.destroy()}}if(t>-1){this.openPages.splice(t,this.openPages.length-t)}if(this.lastOpenPage&&(t>-1||this.lastOpenPage.getUrl()===e)){this.lastOpenPage.destroy();this.lastOpenPage=null}if(!this.getOpenPagesCount()){this.resetHacks();this.unbindEvents();this.isOpen=false}},isHidden:function(){return this.hidden},onPageClose:function(){var e=this.removeOpenPage();var t=this.getCurrentPage();if(t){t.showCloseBtn()}if(!this.getOpenPagesCount()){this.resetHacks();this.unbindEvents();this.isOpen=false}this.setLastOpenPage(e)},onPostMessage:function(e,t){var i=null;if(BX.type.isNotEmptyString(e)){i=e}else if(e&&e.location){var n=e.location;i=n.pathname+n.search+n.hash;i=BX.util.remove_url_param(i,["IFRAME","IFRAME_TYPE"])}if(!i){return}var s=this.getOpenPages();for(var r=s.length-1;r>=0;r--){var a=s[r];if(a.getUrl()===i){var o=s[r-1];(o&&o.getWindow()||window).BX.onCustomEvent("Bitrix24.Slider:onMessage",[a,t]);break}}},getCurrentPage:function(){var e=this.openPages.length;return this.openPages[e-1]?this.openPages[e-1]:null},setLastOpenPage:function(e){if(this.lastOpenPage!==e){if(this.lastOpenPage){this.lastOpenPage.destroy()}this.lastOpenPage=e}},resetLastOpenPage:function(){if(this.lastOpenPage&&this.getCurrentPage()!==this.lastOpenPage){this.lastOpenPage.destroy()}this.lastOpenPage=null},getLastOpenPage:function(){return this.lastOpenPage},getOpenPages:function(){return this.openPages},getOpenPagesCount:function(){return this.openPages.length},addPage:function(e){if(!e instanceof BX.Bitrix24.SliderPage){throw new Error("Page is not an instance of BX.Bitrix24.SliderPage")}e.setSlider(this);this.openPages.push(e)},removeOpenPage:function(){if(this.getOpenPagesCount()){var e=this.openPages.splice(this.openPages.length-1,1);return e[0]}},getLoaderId:function(e){var t=this.options.typeLoader;var i=this.getUrlRule(e);if(i&&BX.type.isNotEmptyString(i.loader)){t=i.loader}return t},getPanel:function(){return BX("bx-panel",true)},getHeader:function(){return BX("header",true)},getImBar:function(){return BX("bx-im-bar",true)},applyHacks:function(){if(this.hacksApplied){return false}this.hacksApplied=true;if(BX.MessengerWindow){BX.MessengerWindow.closePopup()}else{BXIM.closeMessenger()}var e=window.innerWidth-document.documentElement.clientWidth;document.body.style.paddingRight=e+"px";document.body.style.overflow="hidden";this.getHeader().style.paddingRight=e+"px";this.getHeader().style.marginRight="-"+e+"px";this.getHeader().style.zIndex=this.options.headerStylezIndex;if(this.getImBar()){this.getImBar().style.zIndex=this.options.imBarStylezIndex;this.getImBar().style.width=this.getImBar().offsetWidth+e-1+"px";var t=BX.pos(this.getImBar());this.getImBar().style.position="absolute";this.getImBar().originalTop=this.getImBar().style.top;this.getImBar().style.top=t.top+"px";this.getImBar().style.height=t.height+"px"}if(this.getPanel()){this.getPanel().style.zIndex=this.options.panelStylezIndex;this.getPanel().style.cssText+="margin-right: -"+e+"px !important";BX("bx-panel-userinfo").style.cssText+="padding-right:"+e+"px !important";BX("bx-panel-site-toolbar").style.cssText+="padding-right:"+e+"px !important"}return true},resetHacks:function(){if(!this.hacksApplied){return false}this.hacksApplied=false;document.body.style.cssText="";if(this.getPanel()){this.getPanel().style.removeProperty("z-index");this.getPanel().style.removeProperty("margin-right");BX("bx-panel-userinfo").style.removeProperty("padding-right");BX("bx-panel-site-toolbar").style.removeProperty("padding-right")}if(this.getImBar()){this.getImBar().style.removeProperty("z-index");this.getImBar().style.removeProperty("width");this.getImBar().style.removeProperty("height");this.getImBar().style.removeProperty("position");this.getImBar().style.top=this.getImBar().originalTop}this.getHeader().style.cssText="";return true},extractLinkFromEvent:function(e){e=e||window.event;var t=e.target;if(e.which!==1||!BX.type.isDomNode(t)||e.ctrlKey||e.metaKey){return null}var i=t;if(t.nodeName!=="A"){i=BX.findParent(t,{tag:"A"},1)}if(!BX.type.isDomNode(i)){return null}var n=i.getAttribute("href");if(n&&!BX.data(i,"slider-ignore-autobinding")&&(!BX.ajax.isCrossDomain(n)||this.checkLinkOnWhiteList(n))){return{url:n,anchor:i,target:i.getAttribute("target")}}return null},checkLinkOnWhiteList:function(e){var t=false;var i="";for(var n=0;n<this.whiteListLink.length;n++){i=this.whiteListLink[n];if(typeof i=="string"){if(e.indexOf(i)>-1){t=true;break}}else if(typeof i=="object"){if(e.match(i)){t=true;break}}}return t},handleClick:function(e){var t=this.extractLinkFromEvent(e);if(!t){return}var i=this.getUrlRule(t.url,t);if(!i){return}if(i.mobileFriendly!==true&&BX.browser.IsMobile()){return}var n=BX.type.isFunction(i.validate)?i.validate(t):this.isValidLink(t);if(!n){return}if(BX.type.isFunction(i.handler)){i.handler(e,t)}else{e.preventDefault();this.open(t.url)}},getUrlRule:function(e,t){if(!BX.type.isNotEmptyString(e)){return null}var i=this.anchorRules;var n=null;for(var s=0;s<i.length;s++){n=i[s];if(!BX.type.isArray(n.condition)){continue}for(var r=0;r<n.condition.length;r++){if(BX.type.isString(n.condition[r])){n.condition[r]=new RegExp(n.condition[r],"i")}var a=e.match(n.condition[r]);if(a&&!this.hasStopParams(e,n.stopParameters)){if(t){t.matches=a}return n}}}return null},isValidLink:function(e){return e.target!=="_blank"&&e.target!=="_top"},hasStopParams:function(e,t){if(!t||!BX.type.isArray(t)||!BX.type.isNotEmptyString(e)){return false}var i=e.indexOf("?");if(i===-1){return false}var n=e.substring(i);for(var s=0;s<t.length;s++){var r=t[s];if(n.match(new RegExp("[?&]"+r+"=","i"))){return true}}return false},bindAnchors:function(e){e=e||{};if(BX.type.isArray(e.rules)){this.anchorRules=this.anchorRules.concat(e.rules)}if(!this.anchorHandler){this.anchorHandler=this.handleClick.bind(this);window.document.addEventListener("click",this.anchorHandler,true)}},bindEvents:function(){if(this.eventsBound){return false}this.eventsBound=true;BX.bind(document,"keydown",BX.proxy(this.onDocumentKeyDown,this));BX.bind(window,"resize",BX.throttle(this.onWindowResize,300,this));BX.bind(window,"scroll",BX.proxy(this.adjustLayout,this));if(BX.browser.IsMobile()){BX.bind(document.body,"touchmove",BX.proxy(this.disableScroll,this))}BX.addCustomEvent("OnMessengerWindowShowPopup",BX.proxy(this.onMessengerOpen,this));this.getHeader().addEventListener("click",BX.proxy(this.onHeaderClick,this),true);if(this.getPanel()){this.getPanel().addEventListener("click",BX.proxy(this.onHeaderClick,this),true)}return true},unbindEvents:function(){if(!this.eventsBound){return false}this.eventsBound=false;BX.unbind(document,"keydown",BX.proxy(this.onDocumentKeyDown,this));BX.unbind(window,"resize",BX.proxy(this.onWindowResize,this));BX.unbind(window,"scroll",BX.proxy(this.adjustLayout,this));if(BX.browser.IsMobile()){BX.unbind(document.body,"touchmove",BX.proxy(this.disableScroll,this))}BX.removeCustomEvent("OnMessengerWindowShowPopup",BX.proxy(this.onMessengerOpen,this));this.getHeader().removeEventListener("click",BX.proxy(this.onHeaderClick,this),true);if(this.getPanel()){this.getPanel().removeEventListener("click",BX.proxy(this.onHeaderClick,this),true)}return true},adjustLayout:function(){this.getOpenPages().forEach(function(e){e.adjustLayout()})},onDocumentKeyDown:function(e){if(e.keyCode===27){e.preventDefault();if(this.isOnTop()){this.close()}}},isOnTop:function(){var e=document.documentElement.clientWidth/2;var t=document.documentElement.clientHeight/2;var i=document.elementFromPoint(e,t);return BX.hasClass(i,"slider-panel")||BX.findParent(i,{className:"slider-panel"})!==null},onWindowResize:function(){this.adjustLayout()},disableScroll:function(e){e.preventDefault()},onMessengerOpen:function(){if(this.isOpen){this.hide();BX.addCustomEvent("OnMessengerWindowClosePopup",BX.proxy(this.onMessengerClose,this))}},onMessengerClose:function(){this.unhide();BX.removeCustomEvent("OnMessengerWindowClosePopup",BX.proxy(this.onMessengerClose,this))},onHeaderClick:function(e){if(this.isOpen&&e.target.className.match(/help-/)){this.closeAll(true)}else{this.closeAll()}}};BX.Bitrix24.SliderPage=function(e,t){this.url=BX.util.remove_url_param(e,["IFRAME","IFRAME_TYPE"]);this.options=BX.type.isPlainObject(t)?t:{};this.slider=null;this.contentCallback=BX.type.isFunction(t.contentCallback)?t.contentCallback:null;this.contentCallbackInvoved=false;this.zIndex=3e3;this.offset=0;this.iframeSrc=null;this.isOpen=false;this.hidden=false;this.loader=null;this.overlay=null;this.container=null;this.closeBtn=null;this.content=null;this.animation=null;this.animationDuration=200;this.startParams={translateX:100,opacity:0};this.endParams={translateX:0,opacity:100};this.currentParams=null};BX.Bitrix24.SliderPage.prototype={setSlider:function(e){this.slider=e},getSlider:function(){return this.slider},getUrl:function(){return this.url},isVisible:function(){return this.isOpen},setZindex:function(e){if(BX.type.isNumber(e)){this.zIndex=e}},getZindex:function(){return this.zIndex},setOffset:function(e){if(BX.type.isNumber(e)){this.offset=e}},getOffset:function(){return this.offset},isContentPage:function(){return this.contentCallback!==null},getWindow:function(){return this.iframe?this.iframe.contentWindow:window},open:function(){this.createLayout();this.adjustLayout();if(this.isContentPage()){this.setContent()}else{this.setFrameSrc()}this.animateOpening();this.isOpen=true},close:function(e,t){if(!this.isOpen){if(this.animation){this.animation.stop(true)}return}this.isOpen=false;if(this.animation){this.animation.stop()}var i=this.getWindow();if(i.BX){i.BX.onCustomEvent("BX.Bitrix24.PageSlider:onClose",[this]);i.BX.onCustomEvent("Bitrix24.Slider:onClose",[this])}if(e===true||BX.browser.IsMobile()){this.currentParams=this.startParams;this.completeAnimation(t)}else{this.animation=new BX.easing({duration:this.animationDuration,start:this.currentParams,finish:this.startParams,transition:BX.easing.transitions.linear,step:BX.delegate(function(e){this.currentParams=e;this.animateStep(e)},this),complete:BX.delegate(function(){this.completeAnimation(t)},this)});this.animation.animate()}},hide:function(){this.hidden=true;this.container.style.display="none";this.overlay.style.display="none"},unhide:function(){this.hidden=false;this.container.style.removeProperty("display");this.overlay.style.removeProperty("display")},isHidden:function(){return this.hidden},createLayout:function(){if(this.container){return}this.overlay=BX.create("div",{props:{className:"slider-panel slider-panel-overlay"},events:{click:this.onOverlayClick.bind(this)},style:{zIndex:this.getZindex()}});this.container=BX.create("div",{props:{className:"slider-panel slider-panel-container"},style:{zIndex:this.getZindex()+1}});this.closeBtn=BX.create("span",{props:{className:"slider-panel-close"},children:[BX.create("span",{props:{className:"slider-panel-close-inner"}})],events:{click:this.onCloseBtnClick.bind(this)}});this.content=BX.create("div",{props:{className:"slider-panel-content-container"}});if(this.isContentPage()){this.content.style.overflow="auto"}else{this.iframe=BX.create("iframe",{attrs:{src:"about:blank",frameborder:"0"},props:{className:"slider-panel-iframe"},events:{load:this.onIframeLoad.bind(this)}});this.content.appendChild(this.iframe)}this.container.appendChild(this.content);this.container.appendChild(this.closeBtn);document.body.appendChild(this.overlay);document.body.appendChild(this.container)},destroy:function(){this.getWindow().BX.onCustomEvent("Bitrix24.Slider:onDestroy",[this]);BX.remove(this.overlay);BX.remove(this.container);this.container=null;this.overlay=null;this.content=null;this.iframe=null;this.closeBtn=null},animateOpening:function(){if(this.isOpen){return}BX.addClass(this.overlay,"slider-panel-overlay-open");BX.addClass(this.container,"slider-panel-container-open");if(this.animation){this.animation.stop()}if(BX.browser.IsMobile()){this.currentParams=this.endParams;this.animateStep(this.currentParams);return}this.animation=new BX.easing({duration:this.animationDuration,start:this.currentParams?this.currentParams:this.startParams,finish:this.endParams,transition:BX.easing.transitions.linear,step:BX.delegate(function(e){this.currentParams=e;this.animateStep(e)},this),complete:BX.delegate(function(){this.completeAnimation()},this)});this.animation.animate()},animateStep:function(e){this.container.style.transform="translateX("+e.translateX+"%)";this.overlay.style.opacity=e.opacity/100;this.closeBtn.style.opacity=e.opacity/100},completeAnimation:function(e){this.animation=null;if(this.isOpen){this.currentParams=this.endParams}else{this.currentParams=this.startParams;BX.removeClass(this.overlay,"slider-panel-overlay-open");BX.removeClass(this.container,"slider-panel-container-open");this.container.style.removeProperty("width");this.container.style.removeProperty("right");this.container.style.removeProperty("max-width");this.container.style.removeProperty("min-width");this.closeBtn.style.removeProperty("opacity");this.getSlider().onPageClose();if(BX.type.isFunction(e))e(this)}},adjustLayout:function(){var e=BX.pos(this.getSlider().getHeader());var t=window.pageYOffset||document.documentElement.scrollTop;var i=e.bottom-t;var n=BX.browser.IsMobile()?window.innerHeight:document.documentElement.clientHeight;var s=0;if(i<0){i=t;s=n}else{i=e.bottom;s=n-e.bottom+t}var r=0;var a=this.getSlider().getImBar();if(a){r=a.offsetWidth}var o=240;var l=a?a.offsetWidth:0;var h=document.documentElement.clientWidth;var d=window.innerWidth-h;var c=o+l+d;if(h<1160){c-=175}c=Math.max(c+this.getOffset(),144+this.getOffset());var u="calc(100% - "+c+"px)";this.overlay.style.height=s+"px";this.overlay.style.top=i+"px";this.container.style.width=u;this.container.style.height=s+"px";this.container.style.top=i+"px";this.container.style.right=r+"px"},setContent:function(){if(this.contentCallbackInvoved){return}this.contentCallbackInvoved=true;var e=this.getSlider().getLoaderId(this.getUrl());this.showLoader(e);var t=new BX.Promise;t.then(this.contentCallback).then(function(e){if(BX.type.isDomNode(e)){this.content.appendChild(e)}else if(BX.type.isNotEmptyString(e)){this.content.innerHTML=e}this.closeLoader()}.bind(this),function(e){this.destroy();console.log("error",e)});t.fulfill(this)},setFrameSrc:function(){if(this.iframeSrc!==this.getUrl()){this.iframeSrc=this.getUrl();this.iframe.src=BX.util.add_url_param(this.getUrl(),{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER"});var e=this.getSlider().getLoaderId(this.getUrl());this.showLoader(e)}},onIframeLoad:function(e){var t=this.iframe.contentWindow;var i=t.location;if(i.toString()==="about:blank"){return}this.closeLoader();t.addEventListener("keydown",this.onFrameKeyDown.bind(this));t.document.addEventListener("click",this.getSlider().handleClick.bind(this.getSlider()),true);if(BX.browser.IsMobile()){t.document.body.style.paddingBottom=window.innerHeight*2/3+"px"}if(t.BX){t.BX.onCustomEvent("BX.Bitrix24.PageSlider:onOpen",[this]);t.BX.onCustomEvent("Bitrix24.Slider:onOpen",[this])}if(this.options.events&&BX.type.isFunction(this.options.events.onOpen)){this.options.events.onOpen(this)}var n=i.pathname+i.search+i.hash;this.iframeSrc=BX.util.remove_url_param(n,["IFRAME","IFRAME_TYPE"]);this.url=this.iframeSrc},onFrameKeyDown:function(e){if(e.keyCode!==27){return}var t=BX.findChildren(this.getWindow().document.body,{className:"popup-window"},false);for(var i=0;i<t.length;i++){var n=t[i];if(n.style.display==="block"){return}}var s=this.getWindow().document.documentElement.clientWidth/2;var r=this.getWindow().document.documentElement.clientHeight/2;var a=this.getWindow().document.elementFromPoint(s,r);if(BX.hasClass(a,"bx-core-dialog-overlay")||BX.hasClass(a,"bx-core-window")){return}if(BX.findParent(a,{className:"bx-core-window"})){return}this.close()},createLoader:function(e){BX.remove(this.loader);e=BX.type.isNotEmptyString(e)?e:"default-loader";if(e==="default-loader"){this.loader=BX.create("div",{props:{className:"slider-panel-loader "+e},children:[BX.create("div",{props:{className:"b24-loader b24-loader-show"},children:[BX.create("div",{props:{className:"b24-loader-curtain"}})]})]})}else if(e==="crm-entity-details-loader"){this.loader=BX.create("div",{props:{className:"slider-panel-loader "+e},children:[BX.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"slider-panel-loader-mask top"}}),BX.create("div",{props:{className:"slider-panel-loader-bg left"},children:[BX.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"slider-panel-loader-mask left"}})]}),BX.create("div",{props:{className:"slider-panel-loader-bg right"},children:[BX.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"slider-panel-loader-mask right"}})]})]})}else{this.loader=BX.create("div",{props:{className:"slider-panel-loader "+e},children:[BX.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"slider-panel-loader-mask left"}}),BX.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"slider-panel-loader-mask right"}})]})}this.loader.dataset.loader=e;this.content.appendChild(this.loader)},showLoader:function(e){if(!this.loader||this.loader.dataset.loader!==e){this.createLoader(e)}this.loader.style.opacity=1;this.loader.style.display="block"},closeLoader:function(){this.loader.style.display="none";this.loader.style.opacity=0},showCloseBtn:function(){this.closeBtn.style.removeProperty("opacity")},hideCLoseBtn:function(){this.closeBtn.style.opacity=0},onOverlayClick:function(e){this.close();e.stopPropagation()},onCloseBtnClick:function(e){this.close();e.stopPropagation()}};BX.Bitrix24.PageSlider=BX.Bitrix24.Slider})();
//# sourceMappingURL=slider.map.js