(function(){"use strict";BX.namespace("BX.Bitrix24");BX.Bitrix24.SonetGroupFilter=function(){this.actualSearchString="";this.minSearchStringLength=2};BX.Bitrix24.SonetGroupFilter.prototype.init=function(t){var e=typeof t!="undefined"&&typeof t.filterId!="undefined"?t.filterId:"SONET_GROUP_LIST";if(typeof t!="undefined"&&typeof t.minSearchStringLength!="undefined"&&parseInt(t.minSearchStringLength)>0){this.minSearchStringLength=parseInt(t.minSearchStringLength)}BX.addCustomEvent("BX.SonetGroupList:refresh",BX.delegate(function(){BX.Main.filterManager.getById(e).getPreset().resetPreset(true);BX.Main.filterManager.getById(e).getSearch().clearForm()},this));BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate(function(t,i,n,o){if(t!=e||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.SonetGroupList.Filter:beforeApply",[i,o])},this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(function(t,i,n,o,r){if(t!=e||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.SonetGroupList.Filter:apply",[i,o,r])},this));BX.addCustomEvent("BX.Filter.Search:input",BX.delegate(function(t,i){if(t==e){this.actualSearchString=typeof i!="undefined"?BX.util.trim(i):"";if(this.actualSearchString.length>0&&this.actualSearchString.length>=this.minSearchStringLength){BX.onCustomEvent(window,"BX.SonetGroupList.Filter:searchInput",[i])}}},this));BX.addCustomEvent("BX.Main.Filter:blur",BX.delegate(function(t){if(t.getParam("FILTER_ID")==e&&t.getSearch().getSquares().length<=0&&t.getSearch().getSearchString().length<=0){var i=BX.findParent(BX(e+"_filter_container"),{className:"pagetitle-wrap"});if(i){BX.removeClass(i,"pagetitle-wrap-filter-opened")}}},this))}})();(function(){BitrixSGFilterDestinationSelectorManager={controls:{},onSelect:function(t,e,i,n,o,r){BX.SocNetLogDestination.obItemsSelected[o]={};BX.SocNetLogDestination.obItemsSelected[o][t.id]=e;var s=BitrixSGFilterDestinationSelectorManager.controls[o];if(s){s.setData(BX.util.htmlspecialcharsback(t.name),t.id);s.getLabelNode().value="";s.getLabelNode().blur();if(BX.SocNetLogDestination.popupWindow!=null){BX.SocNetLogDestination.popupWindow.close()}if(BX.SocNetLogDestination.popupSearchWindow!=null){BX.SocNetLogDestination.popupSearchWindow.close()}}}};BitrixSGFilterDestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BitrixSGFilterDestinationSelector.create=function(t,e){var i=new BitrixSGFilterDestinationSelector(t,e);i.initialize(t,e);BX.onCustomEvent(window,"BX.SonetGroupList.Filter:create",[t]);return i};BitrixSGFilterDestinationSelector.prototype.getSetting=function(t,e){return this.settings.hasOwnProperty(t)?this.settings[t]:e};BitrixSGFilterDestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BitrixSGFilterDestinationSelector.prototype.initialize=function(t,e){this.id=t;this.settings=e?e:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;this.closed=null;var i=this.getSetting("initialValue",false);if(!!i){var n={};n[this.fieldId]=i.itemId;n[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(n)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.Selector:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSwitchTabFocus",BX.delegate(this.onBeforeSwitchTabFocus,this));BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.delegate(this.onBeforeSelectItemFocus,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BitrixSGFilterDestinationSelector.prototype.open=function(){var t=this.id;if(!this.inited){var e=this.getSearchInput();e.id=e.name;BX.addCustomEvent(window,"BX.Main.Selector:afterInitDialog",BX.delegate(function(t){if(typeof t.id!="undefined"||t.id!=this.id){return}this.opened=true;this.closed=false},this));BX.onCustomEvent(window,"BX.SonetGroupList.Filter:openInit",[{id:this.id,inputId:e.id,containerId:e.id}]);this.inited=true}else{BX.onCustomEvent(window,"BX.SonetGroupList.Filter:open",[{id:this.id,bindNode:this.control.getField()}]);this.opened=true;this.closed=false}};BitrixSGFilterDestinationSelector.prototype.close=function(){BX.SocNetLogDestination.closeDialog();this.opened=false;this.closed=true};BitrixSGFilterDestinationSelector.prototype.onCustomEntitySelectorOpen=function(t){var e=t.getId();if(this.fieldId!==e){this.control=null}else{this.control=t;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BitrixSGFilterDestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BitrixSGFilterDestinationSelector.prototype.onCustomEntitySelectorClose=function(t){if(this.fieldId===t.getId()&&this.inited===true){this.control=null;this.close()}};BitrixSGFilterDestinationSelector.prototype.onGetStopBlur=function(t,e){if(BX.findParent(t.target,{className:"bx-lm-box"})){e.stopBlur=true}};BitrixSGFilterDestinationSelector.prototype.onCustomEntityRemove=function(t){if(this.fieldId===t.getId()){if(typeof t.hiddenInput!="undefined"&&typeof t.hiddenInput.value!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id]!="undefined"&&typeof BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]!="undefined"){delete BX.SocNetLogDestination.obItemsSelected[this.id][t.hiddenInput.value]}}};BitrixSGFilterDestinationSelector.prototype.onBeforeSwitchTabFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BitrixSGFilterDestinationSelector.prototype.onBeforeSelectItemFocus=function(t){if(this.id===t.id){t.blockFocus=true}};BitrixSGFilterDestinationSelector.prototype.onBeforeInitDialog=function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}if(this.closed){t.blockInit=true}}})();