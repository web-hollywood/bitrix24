(function(){"use strict";BX.namespace("BX.Intranet");if(!!BX.Intranet.UserFieldEmployee){return}var e={};var t={};BX.Intranet.UserFieldEmployee=function(t,i){this.id=t;this.param=i;this.inited=false;this.callback={select:BX.delegate(this.callbackSelect,this),unSelect:BX.delegate(this.callbackUnSelect,this)};this.value=this.param.multiple?[]:null;e[t]=this;BX.ready(BX.defer(this.init,this))};BX.Intranet.UserFieldEmployee.instance=function(t){return e[t]};BX.Intranet.UserFieldEmployee.getInitEvent=function(e){return"BX.UFEMP:"+e+":init"};BX.Intranet.UserFieldEmployee.getOpenEvent=function(e){return"BX.UFEMP:"+e+":open"};BX.Intranet.UserFieldEmployee.prototype.init=function(){if(!!BX.Main.selectorManager.controls[this.id]){BX.SocNetLogDestination.reInit(this.id)}BX.onCustomEvent(window,BX.Intranet.UserFieldEmployee.getInitEvent(this.id),[{id:this.id,openDialogWhenInit:false,single:!this.param.multiple}]);this.inited=true};BX.Intranet.UserFieldEmployee.prototype.open=function(e){BX.onCustomEvent(window,BX.Intranet.UserFieldEmployee.getOpenEvent(this.id),[{id:this.id,contId:e,bindId:e,tagId:this.id,bindNode:e}]);return false};BX.Intranet.UserFieldEmployee.prototype.close=function(){if(BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.popupWindow.close()}if(BX.SocNetLogDestination.popupSearchWindow){BX.SocNetLogDestination.popupSearchWindow.close()}if(BX.SocNetLogDestination.containerWindow){BX.SocNetLogDestination.containerWindow.close()}};BX.Intranet.UserFieldEmployee.prototype.storeUser=function(e){e.name=BX.util.htmlspecialcharsback(e.name);t[e.entityId]=e};BX.Intranet.UserFieldEmployee.prototype.setValue=function(e){this.value=e;this.updateValue()};BX.Intranet.UserFieldEmployee.prototype.callbackSelect=function(e){var t=e.entityId;this.storeUser(e);if(this.param.multiple){this.value.push(t)}else{this.value=t;this.close()}this.updateValue()};BX.Intranet.UserFieldEmployee.prototype.callbackUnSelect=function(e){var t=e.entityId;this.storeUser(e);if(this.param.multiple){var i=BX.util.array_search(t,this.value);if(i>=0){this.value.splice(i,1)}}else if(this.value===t){this.value=null;this.close()}this.updateValue()};BX.Intranet.UserFieldEmployee.prototype.updateValue=function(){if(this.inited){BX.SocNetLogDestination.obItemsSelected[this.id]={};if(this.param.multiple){this.value=BX.util.array_unique(this.value);for(var e=0;e<this.value.length;e++){BX.SocNetLogDestination.obItemsSelected[this.id]["U"+this.value[e]]="users"}}else{if(this.value!==null){BX.SocNetLogDestination.obItemsSelected[this.id]["U"+this.value]="users"}}}BX.onCustomEvent(this,"onUpdateValue",[this.value,t])};BX.Intranet.UserFieldEmployeeEntity=function(e){this.field=null;this.squareClass="main-ui-square";this.multiple=null;if(!!e){if(e.field){this.setField(e.field)}if(typeof e.multiple!=="undefined"){this.multiple=e.multiple}}};BX.Intranet.UserFieldEmployeeEntity.prototype={setField:function(e){if(this.field!==BX(e)){this.field=BX(e);this.reset();BX.bind(this.field,"click",BX.proxy(this._fieldClick,this))}},_fieldClick:function(e){e=e||window.event;if(BX.hasClass(e.target,"main-ui-square-delete")){this.remove(e.target.parentNode)}},remove:function(e){BX.remove(e);BX.onCustomEvent(this,"BX.Intranet.UserFieldEmployeeEntity:remove",[this.getCurrentValues()])},isMultiple:function(){return this.multiple},reset:function(){},getField:function(){return this.field},getSquares:function(){return i(this.getField(),this.squareClass,true)},removeSquares:function(){this.getSquares().forEach(BX.remove)},setSquare:function(e,t){var i=this.getField();var n={block:"main-ui-square",name:e,item:{_label:e,_value:t}};var s=BX.decl(n);var l=this.getSquares();if(!l.length){BX.prepend(s,i)}else{BX.insertAfter(s,l[l.length-1])}},getCurrentValues:function(){var e=this.getSquares();var t,i=[];try{for(var n=0;n<e.length;n++){t=JSON.parse(BX.data(e[n],"item"));i.push({label:t._label,value:t._value})}}catch(e){i=[{label:"",value:""}]}return i},setData:function(e,t){return this.isMultiple()?this.setMultipleData(e):this.setSingleData(e,t)},setSingleData:function(e,t){this.removeSquares();this.setSquare(e,t)},setMultipleData:function(e){var t=[];if(BX.type.isArray(e)){this.removeSquares();if(BX.type.isArray(e)){e.forEach(function(e){t.push(e.value);this.setSquare(e.label,e.value)},this)}}}};function i(e,t,i){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!i){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n}})();