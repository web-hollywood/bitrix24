var jsBXAC={VIEWS:{},VIEWS_ID:[],SETTINGS:{SITE_ID:"",NAME_TEMPLATE:"#NAME# #LAST_NAME#",SERVER_TIMEZONE_OFFSET:0,FIRST_DAY:1,DAY_START:8,DAY_FINISH:18,CONTROLS:{DATEPICKER:"on",TYPEFILTER:"on",SHOW_ALL:"on",DEPARTMENT:"on"}},FILTER:{SHORT_EVENTS:"Y",USERS_ALL:"N",DEPARTMENT:"",TYPE:{}},DATA:[],LOADER:"",CURRENT_VIEW:"",MONTHS:[],MONTHS_R:[],DAYS:[],DAYS_FULL:[],LAYOUT:null,MAIN_LAYOUT:null,CONTROLS:{VIEWSWITCHER:null,CALENDAR:null,TYPEFILTER:null,SHOW_ALL:null,DEPARTMENT:null,DATEPICKER:null},__last_date_params:{},__processing:false,__current_data_id:null,ERRORS:{ERR_NO_VIEWS_REGISTERED:"No calendar views registered",ERR_VIEW_NOT_REGISTERED:"View not registered",ERR_WRONG_LAYOUT:"Wrong layout",ERR_WRONG_HANDLER:"Wrong calendar view handler",ERR_RUNTIME_NO_VIEW:"Runtime error! Unable to initialize current view"},TYPES:{},TYPE_BGCOLORS:{},bInitFinished:false,onBeforeShow:null,onShow:null,Init:function(e){this.LOADER=e.LOADER;this.SETTINGS.SITE_ID=e.SITE_ID;this.SETTINGS.NAME_TEMPLATE=e.NAME_TEMPLATE!=""?e.NAME_TEMPLATE:this.SETTINGS.NAME_TEMPLATE;this.SETTINGS.SERVER_TIMEZONE_OFFSET=e.SERVER_TIMEZONE_OFFSET+(new Date).getTimezoneOffset()*60;this.SETTINGS.FIRST_DAY=null!=e.FIRST_DAY?e.FIRST_DAY:1;this.SETTINGS.DAY_START=null!=e.DAY_START?e.DAY_START:8;this.SETTINGS.DAY_FINISH=null!=e.DAY_FINISH?e.DAY_FINISH:18;this.SETTINGS.DAY_SHOW_NONWORK=null!=e.DAY_SHOW_NONWORK?e.DAY_SHOW_NONWORK:false;this.SETTINGS.DETAIL_URL_PERSONAL=e.DETAIL_URL_PERSONAL;this.SETTINGS.DETAIL_URL_DEPARTMENT=e.DETAIL_URL_DEPARTMENT;this.SETTINGS.PAGE_NUMBER=e.PAGE_NUMBER>0?e.PAGE_NUMBER:0;this.SETTINGS.IBLOCK_ID=e.IBLOCK_ID;this.SETTINGS.CALENDAR_IBLOCK_ID=e.CALENDAR_IBLOCK_ID;if(null!=e.CONTROLS)this.SETTINGS.CONTROLS=e.CONTROLS;this.MONTHS=e.MONTHS;this.MONTHS_R=e.MONTHS_R;this.DAYS=e.DAYS;this.DAYS_FULL=e.DAYS_FULL;this.TYPES=e.TYPES;this.TYPE_BGCOLORS=e.TYPE_BGCOLORS;this.MESSAGES=e.MESSAGES;this.ERRORS=e.ERRORS},Show:function(e,t){this.MAIN_LAYOUT=e;this.CURRENT_VIEW=t;if(null!=this.onBeforeShow)this.onBeforeShow();if(null==this.MAIN_LAYOUT)return this.__showError("ERR_WRONG_LAYOUT");for(var i=0,s=0,n=this.VIEWS_ID.length;i<n;i++)if(null!=this.VIEWS[this.VIEWS_ID[i]])s++;delete this.VIEWS_ID;if(s<=0)return this.__showError("ERR_NO_VIEWS_REGISTERED");if(null==this.VIEWS[this.CURRENT_VIEW])return this.__showError("ERR_VIEW_NOT_REGISTERED",this.CURRENT_VIEW);this.bInitFinished=true;this.ShowLayout();this.__loadPosition();this.SetView(this.CURRENT_VIEW);if(null!=this.onShow)this.onShow()},SetViewHandler:function(e){if(!this.bInitFinished)return false;if(null==e||null==e.ID)return this.__showError("ERR_WRONG_HANDLER");if(e.ID==this.CURRENT_VIEW){this.CURRENT_VIEW_HANDLER&&this.CURRENT_VIEW_HANDLER.Unload&&this.CURRENT_VIEW_HANDLER.Unload();delete this.CURRENT_VIEW_HANDLER;this.CONTROLS.CALENDAR.innerHTML="";this.CURRENT_VIEW_HANDLER=e;this.CURRENT_VIEW_HANDLER._parent=this;this.CURRENT_VIEW_HANDLER.SetSettings&&this.CURRENT_VIEW_HANDLER.SetSettings(this.SETTINGS);this.CURRENT_VIEW_HANDLER.Load&&this.CURRENT_VIEW_HANDLER.Load()}},SetDataFilter:function(e,t){if(null==t){delete this.FILTER[e]}else{this.FILTER[e]=t}if(null!=this.CURRENT_VIEW_HANDLER.Load)this.CURRENT_VIEW_HANDLER.Load()},GetDataFilter:function(){var e="";if(null!=this.FILTER.SHORT_EVENTS)e+="&SHORT_EVENTS="+this.FILTER.SHORT_EVENTS;if(null!=this.FILTER.USERS_ALL)e+="&USERS_ALL="+this.FILTER.USERS_ALL;if(null!=this.FILTER.DEPARTMENT)e+="&DEPARTMENT="+this.FILTER.DEPARTMENT;var t="";for(var i in this.FILTER.TYPE)if(this.FILTER.TYPE[i]===true)t+=(t.length>0?",":"")+i;if(t.length>0)e+="&TYPES="+t;else if(null!=i)e+="&TYPES=none";return e},LoadData:function(e,t){if(null==e)e=this.__last_date_params.TS_START;if(null==t)t=this.__last_date_params.TS_FINISH;if(!e||!t)return;document.getElementById("bx_goto_date").value=BX.calendar.ValueToString(e,false,false);BX.showWait(jsBXAC.LAYOUT);this.__last_date_params={TS_START:e,TS_FINISH:t};this.__current_data_id=parseInt(Math.random()*1e5);this.__savePosition();var i=this.LOADER+"?MODE=GET"+"&TS_START="+(parseInt(e.valueOf()/1e3)-this.SETTINGS.SERVER_TIMEZONE_OFFSET)+"&TS_FINISH="+(parseInt(t.valueOf()/1e3)-1-this.SETTINGS.SERVER_TIMEZONE_OFFSET)+this.GetDataFilter()+"&PAGE_NUMBER="+parseInt(this.SETTINGS.PAGE_NUMBER)+"&current_data_id="+this.__current_data_id+"&site_id="+this.SETTINGS.SITE_ID+"&iblock_id="+this.SETTINGS.IBLOCK_ID+"&calendar_iblock_id="+this.SETTINGS.CALENDAR_IBLOCK_ID+"&sessid="+BX.message("bitrix_sessid")+"&rnd="+Math.random();BX.loadScript(i)},SetData:function(e,t,i,s){if(t!=this.__current_data_id||this.__processing)return;BX.closeWait(this.LAYOUT);this.__processing=true;this.CURRENT_VIEW_HANDLER.UnloadData&&this.CURRENT_VIEW_HANDLER.UnloadData();for(var n=0;n<e.length;n++){if(null!=e[n].DATA){for(var a=0;a<e[n].DATA.length;a++){e[n].DATA[a].DATE_ACTIVE_FROM=BX.parseDate(e[n].DATA[a].DATE_FROM);e[n].DATA[a].DATE_ACTIVE_TO=BX.parseDate(e[n].DATA[a].DATE_TO);if(e[n].DATA[a].DATE_ACTIVE_FROM>e[n].DATA[a].DATE_ACTIVE_TO){var l=e[n].DATA[a].DATE_ACTIVE_FROM;e[n].DATA[a].DATE_ACTIVE_FROM=e[n].DATA[a].DATE_ACTIVE_TO;e[n].DATA[a].DATE_ACTIVE_TO=l}if(e[n].DATA[a].DATE_ACTIVE_TO.getHours()+e[n].DATA[a].DATE_ACTIVE_TO.getMinutes()+e[n].DATA[a].DATE_ACTIVE_TO.getSeconds()==0){e[n].DATA[a].DATE_ACTIVE_TO.setDate(e[n].DATA[a].DATE_ACTIVE_TO.getDate()+1);e[n].DATA[a].DATE_ACTIVE_TO.setSeconds(e[n].DATA[a].DATE_ACTIVE_TO.getSeconds()-1)}}}}this.DATA=e;if(i>=0&&this.SETTINGS.PAGE_NUMBER!=i)this.SETTINGS.PAGE_NUMBER=i;this.SETTINGS.PAGE_COUNT=s>0?s:0;this.CURRENT_VIEW_HANDLER.LoadData&&this.CURRENT_VIEW_HANDLER.LoadData(this.DATA);this.__processing=false},__createMainTable:function(){var e=document.createElement("TABLE");e.className="bx-calendar-layout-table";if(BX.browser.IsIE())e.style.borderCollapse="collapse";e.createTHead();e.appendChild(document.createElement("TBODY"));var t=e.tHead.insertRow(-1);var i=t.insertCell(-1);i.className="bx-table-head";i.innerHTML=this.MESSAGES.IAC_MAIN_TITLE;var t=e.tBodies[0].insertRow(-1);this.CONTROLS.DATEROW=t.insertCell(-1);this.CONTROLS.DATEROW.className="bx-table-datecontrol";this.CONTROLS.DATEROW.innerHTML="";var t=e.tBodies[0].insertRow(-1);this.LAYOUT=t.insertCell(-1);this.LAYOUT.className="bx-table-main";this.LAYOUT.id="bx_calendar_layout_inner";this.LAYOUT.innerHTML="";return e},ShowLayout:function(){var e=this;this.MAIN_LAYOUT.className="bx-calendar-layout";this.TOOLBAR=document.createElement("TABLE");this.TOOLBAR.appendChild(document.createElement("TBODY"));this.TOOLBAR.className="bx-calendar-toolbar";this.TOOLBAR.tBodies[0].insertRow(-1);this.MAIN_LAYOUT.appendChild(this.TOOLBAR);this.TOOLBAR.BXAddControl=function(e,t){var i=this.tBodies[0].rows[0];if(i.cells.length>0)i.insertCell(i.cells.length-1).className="bx-calendar-toolbar-delimiter";else i.insertCell(-1).className="bx-calendar-toolbar-last";var s=i.insertCell(i.cells.length-1);if(null!=e){t.id="filter_control_"+parseInt(Math.random()*1e4);s.appendChild(document.createElement("LABEL")).appendChild(document.createTextNode(e+": "));s.appendChild(t);s.firstChild.htmlFor=t.id}else{s.appendChild(t)}return s};this.__ShowViewSwitcher()&&this.MAIN_LAYOUT.appendChild(this.CONTROLS.VIEWSWITCHER);this.MAIN_TABLE=this.__createMainTable();this.MAIN_LAYOUT.appendChild(this.MAIN_TABLE);this.CONTROLS.CALENDAR=document.createElement("DIV");this.CONTROLS.CALENDAR.className="bx-absence-calendar";this.LAYOUT.appendChild(this.CONTROLS.CALENDAR);if(null!=this.SETTINGS.CONTROLS.DATEPICKER){var t=document.getElementById("bx_calendar_control_datepicker");if(null!=t){this.CONTROLS.DATEPICKER=document.createElement("DIV");this.TOOLBAR.BXAddControl(null,this.CONTROLS.DATEPICKER);var i=t.innerHTML;t.innerHTML="";this.CONTROLS.DATEPICKER.innerHTML=i}}if(null!=this.SETTINGS.CONTROLS.TYPEFILTER){this.CONTROLS.TYPEFILTER=document.createElement("SPAN");this.CONTROLS.TYPEFILTER.className="bx-indicator bx-indicator-off";this.CONTROLS.TYPEFILTER.innerHTML="&nbsp;&nbsp;&nbsp;";this.TOOLBAR.BXAddControl(this.MESSAGES.IAC_FILTER_TYPEFILTER,this.CONTROLS.TYPEFILTER);new JCCalendarFilter(function(t,i){e.SetDataFilter(t,i)},this.CONTROLS.TYPEFILTER,this.TYPES,this.MESSAGES,this.TYPE_BGCOLORS)}if(null!=this.SETTINGS.CONTROLS.SHOW_ALL){this.CONTROLS.SHOW_ALL=document.createElement("INPUT");this.CONTROLS.SHOW_ALL.type="checkbox";this.CONTROLS.SHOW_ALL.checked=true;this.CONTROLS.SHOW_ALL.defaultChecked=true;this.CONTROLS.SHOW_ALL.onclick=function(){e.SetDataFilter("USERS_ALL",this.checked?"N":"Y")};this.TOOLBAR.BXAddControl(this.MESSAGES.IAC_FILTER_SHOW_ALL,this.CONTROLS.SHOW_ALL)}if(null!=this.SETTINGS.CONTROLS.DEPARTMENT){var s=document.getElementById("bx_calendar_conrol_departments");if(null!=s){this.CONTROLS.DEPARTMENT=s.firstChild;while(this.CONTROLS.DEPARTMENT&&this.CONTROLS.DEPARTMENT.tagName!="SELECT")this.CONTROLS.DEPARTMENT=this.CONTROLS.DEPARTMENT.nextSibling;this.CONTROLS.DEPARTMENT.parentNode.removeChild(this.CONTROLS.DEPARTMENT);this.CONTROLS.DEPARTMENT.onchange=function(){e.SetDataFilter("DEPARTMENT",this.value)};this.TOOLBAR.BXAddControl(this.MESSAGES.IAC_FILTER_DEPARTMENT,this.CONTROLS.DEPARTMENT)}}},InsertDate:function(e){if(BX.type.isDate(e))e=e.valueOf();else e=parseInt(e);jsBXAC.SETTINGS.DATE_START=new Date(e);jsBXAC.SETTINGS.DATE_FINISH=new Date(e);jsBXAC.CURRENT_VIEW_HANDLER.SetSettings(jsBXAC.SETTINGS);jsBXAC.CURRENT_VIEW_HANDLER.Load()},__GetViewList:function(){var e=[],t=0;for(var i in this.VIEWS){if(this.VIEWS[i].ID)e[e.length]=this.VIEWS[i]}if((t=e.length)>1){for(var i=0;i<t-1;i++){for(var s=i+1;s<t;s++){if(e[i].SORT<e[s].SORT){var n=e[i];e[i]=e[s];e[s]=n}}}}return e},__ShowViewSwitcher:function(){var e=this.__GetViewList(),t=null,i=0;if((i=e.length)>1){var s=this;var n=function(){s.SetView(this.parentNode.BXVIEWID)};this.CONTROLS.VIEWSWITCHER=document.createElement("UL");this.CONTROLS.VIEWSWITCHER.className="bx-calendar-view-switcher";this.CONTROLS.VIEWSWITCHER.style.position="relative";this.CONTROLS.VIEWSWITCHER.style.top="2px";for(var a=0;a<i;a++){var l=this.CONTROLS.VIEWSWITCHER.appendChild(document.createElement("LI"));l.BXVIEWID=e[a].ID;var E=l.appendChild(document.createElement("A"));E.id="bx_view_switcher_"+l.BXVIEWID;E.href="javascript:void(0)";E.onclick=n;E.onfocus=function(){this.blur()};E.appendChild(document.createElement("SPAN")).className="bx-l";var r=E.appendChild(document.createElement("SPAN"));r.className="bx-c";r.innerHTML=e[a].NAME;E.appendChild(document.createElement("SPAN")).className="bx-r"}}return this.CONTROLS.VIEWSWITCHER},SetView:function(e){if(null==e)e=this.CURRENT_VIEW;if(null==e)return this.__showError("ERR_RUNTIME_NO_VIEW");if(null==this.VIEWS[e])return this.__showError("ERR_VIEW_NOT_REGISTERED",e);this.CURRENT_VIEW=e;if(null!=this.CURRENT_VIEW&&null!=this.CONTROLS.VIEWSWITCHER){var t=this.CONTROLS.VIEWSWITCHER.firstChild;do{if(t.BXVIEWID==this.CURRENT_VIEW)t.className="bx-absence-current-view";else t.className=""}while(t=t.nextSibling)}this.CURRENT_VIEW_HANDLER&&this.CURRENT_VIEW_HANDLER.BeforeUnload&&this.CURRENT_VIEW_HANDLER.BeforeUnload();BX.ajax.insertToNode(this.LOADER+"?MODE=VIEW&VIEW="+this.CURRENT_VIEW,this.CONTROLS.CALENDAR,false)},RegisterView:function(e){if(!this.bInitFinished&&null!=e.ID){if(null==e.SORT)e.SORT=1e3;this.VIEWS[e.ID]=e;this.VIEWS_ID[this.VIEWS_ID.length]=e.ID;return true}return false},isViewRegistered:function(e){return null!=this.VIEWS[e]},UnRegisterView:function(e){if(!this.bInitFinished){if(null!=this.VIEWS[e]){delete this.VIEWS[e];return true}}return false},__entry_onclick:function(e){this.INFO.Show(e)},RegisterEntry:function(e){var t=this;if(null!=e.VISUAL){if(null==this._INFO_CACHE)this._INFO_CACHE={};if(null==this._INFO_CACHE[e.ENTRY_TYPE+":"+e.ID])this._INFO_CACHE[e.ENTRY_TYPE+":"+e.ID]=new JCCalendarInfoWin(e.ID,e.ENTRY_TYPE,e.USER_ID,this.LOADER,this.TYPE_BGCOLORS);e.VISUAL.INFO=this._INFO_CACHE[e.ENTRY_TYPE+":"+e.ID];e.VISUAL.onclick=this.__entry_onclick;var i="";i+=e.DATE_FROM+" - "+e.DATE_TO+"<br />";var s=e.DETAIL_TEXT.length,n=350;if(s>0){if(s<n)i+="<br>"+e.DETAIL_TEXT;else i+="<br>"+e.DETAIL_TEXT.substr(0,n)+"..."}e.VISUAL.BXHINT=new BX.CHint({parent:e.VISUAL,title:BX.util.htmlspecialcharsback(e.NAME),hint:i})}},UnRegisterEntry:function(e){if(null!=e.VISUAL){if(null!=this._INFO_CACHE&&null!=this._INFO_CACHE[e.ENTRY_TYPE+":"+e.ID]){if(null!=e.VISUAL.INFO){e.VISUAL.INFO.Clear();e.VISUAL.INFO=null}this._INFO_CACHE[e.ENTRY_TYPE+":"+e.ID]=null}e.VISUAL.BXHINT.Destroy();e.VISUAL.BXHINT=null;e.VISUAL.onclick=null}},SetControlsListL:function(e){this.arControlsConfig=e},__showError:function(e,t){var i="["+e+"]";if(null!=this.ERRORS[e])i+=" "+this.ERRORS[e];if(null!=t)i+=": "+t;alert(i);return false},FormatName:function(e,t){var i=BX.util.trim(t["NAME"]);var s=BX.util.trim(t["LAST_NAME"]);var n=BX.util.trim(t["SECOND_NAME"]);var a=i?i.substring(0,1)+".":"";var l=s?s.substring(0,1)+".":"";var E=n?n.substring(0,1)+".":"";var r=e.replace("#NAME#",i).replace("#LAST_NAME#",s).replace("#SECOND_NAME#",n).replace("#NAME_SHORT#",a).replace("#LAST_NAME_SHORT#",l).replace("#SECOND_NAME_SHORT#",E).replace(/#NOBR#|#\/NOBR#/gi,"");var T="";if(e.indexOf("#NAME#")>=0||e.indexOf("#NAME_SHORT#")>=0)T+=t["NAME"];if(e.indexOf("#LAST_NAME#")>=0||e.indexOf("#LAST_NAME_SHORT#")>=0)T+=t["LAST_NAME"];if(e.indexOf("#SECOND_NAME#")>=0||e.indexOf("#SECOND_NAME_SHORT#")>=0)T+=t["SECOND_NAME"];T=BX.util.trim(T);if(T.length<=0)r=BX.util.htmlspecialchars(BX.util.trim(t["LOGIN"]));return r},getEditUrl:function(e,t){if(null!=window.jsBXCalendarAdmin){if(null==t)t=true;var i="/bitrix/admin/iblock_element_edit.php"+"?type="+jsBXCalendarAdmin.IBLOCK_TYPE+"&lang="+jsBXCalendarAdmin.LANG;if(null!=e){i+="&IBLOCK_ID="+e.IBLOCK_ID+"&ID="+e.ID}else{i+="&IBLOCK_ID="+jsBXCalendarAdmin.IBLOCK_ID}if(t)i+="&bxpublic=Y&from_module=iblock&return_url=reload_absence_calendar";return i}},__savePosition:function(){window.location.hash="AP:"+this.CURRENT_VIEW+"|"+this.__last_date_params.TS_START.valueOf()+"|"+this.__last_date_params.TS_FINISH.valueOf()},__loadPosition:function(){var e=window.location.hash;if(e.substring(0,1)=="#")e=e.substring(1);if(e!=""&&e!="#"&&e.substring(0,3)=="AP:"){e=e.substring(3);var t=e.split("|");if(this.isViewRegistered(t[0]))this.CURRENT_VIEW=t[0];var i=new Date(parseInt(t[1]));if(i.getYear()&&i.valueOf())this.SETTINGS.DATE_START=i;var s=new Date(parseInt(t[2]));if(i.getYear()&&i.valueOf())this.SETTINGS.DATE_FINISH=s}},__reloadCurrentView:function(){if(window.BX){var e=BX.WindowManager.Get();e.Close();BX.closeWait();this.LoadData()}else{jsPopup.AllowClose();jsPopup.CloseDialog();CloseWaitWindow();this.LoadData()}}};function JCCalendarFilter(e,t,i,s,n){var a=this;this.TIMER=null;this.TIMEOUT=300;this._parentNode=t;this.LAYOUT=document.body.appendChild(document.createElement("DIV"));this.LAYOUT.className="bx-calendar-filter";var l=BX.pos(t.parentNode.parentNode,true);this.LAYOUT.style.top=l.bottom-5+"px";this.LAYOUT.style.left=l.left+5+"px";this.LAYOUT.onclick=BX.PreventDefault;this.arTypes=i;this.arCurrentChecked={};this.LAYOUT.innerHTML='<div class="bx-filter-title">'+'<table cellspacing="0" style="width:100% !important; padding:0px !important; ">'+"	<tr>"+'		<td class="bx-filter-title-text" id="bx_filter_title_text">'+s.INTR_ABSC_TPL_FILTER_OFF+'</td><td width="0%"><a class="bx-filter-close" id="bx_filter_close"></a></td></tr>'+"</table>"+"</div>";var E=BX("bx_filter_close");var r=this.LAYOUT.appendChild(document.createElement("DIV"));r.className="bx-calendar-color-all";this.CHECK_ALL=r.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:"bx_abs_show_all_"+parseInt(Math.random()*1e5),defaultChecked:true,checked:true}}));var T=r.appendChild(document.createElement("LABEL"));T.innerHTML=s.IAC_FILTER_TYPEFILTER_ALL;T.htmlFor=this.CHECK_ALL.id;T.onclick=this.CHECK_ALL.onclick=function(e){if(null==e)e=window.event;e.cancelBubble=true;if(null!=a.TIMER)clearTimeout(a.TIMER);for(var t=0;t<a.arTypes.length;t++){a.arTypes[t].INPUT.checked=a.arCurrentChecked[a.arTypes[t].NAME]=this.checked}if(this.checked)a.Run();else a.TIMER=setTimeout(a.Run,a.TIMEOUT)};for(var _=0;_<this.arTypes.length;_++){if(typeof this.arTypes[_]!="undefined"){this.arCurrentChecked[this.arTypes[_].NAME]=true;r=this.LAYOUT.appendChild(document.createElement("DIV"));r.className="bx-calendar-color-"+this.arTypes[_].NAME;r.style.background=n[this.arTypes[_].NAME];this.arTypes[_].INPUT=r.appendChild(BX.create("INPUT",{props:{type:"checkbox",checked:true,defaultChecked:true,id:"filter_"+this.arTypes[_].NAME}}));this.arTypes[_].INPUT.BX_FILTER_ID=this.arTypes[_].NAME;var T=r.appendChild(document.createElement("LABEL"));T.htmlFor=this.arTypes[_].INPUT.id;T.innerHTML=this.arTypes[_].TITLE;T.onclick=this.arTypes[_].INPUT.onclick=function(e){if(null==e)e=window.event;e.cancelBubble=true;if(null!=a.TIMER)clearTimeout(a.TIMER);a.arCurrentChecked[this.BX_FILTER_ID]=this.checked;a.TIMER=setTimeout(a.Run,a.TIMEOUT)}}}this._parentNode.parentNode.appendChild(this.LAYOUT);var T=document.createElement("SPAN");T.className="bx-label";T.innerHTML=this._parentNode.previousSibling.innerHTML;this._parentNode.previousSibling.parentNode.insertBefore(T,this._parentNode.previousSibling);this._parentNode.previousSibling.parentNode.removeChild(this._parentNode.previousSibling);this._parentNode.onclick=this._parentNode.previousSibling.onclick=function(){if(a.LAYOUT.style.display=="block"){a.LAYOUT.style.display="none";BX.unbind(document,"click",a.CheckClick)}else{a.LAYOUT.style.display="block";setTimeout(function(){BX.bind(document,"click",a.CheckClick)},10)}};this.Run=function(){a.TIMER=null;a._parentNode.className="bx-indicator bx-indicator-off";document.getElementById("bx_filter_title_text").innerHTML=s.INTR_ABSC_TPL_FILTER_OFF;a.CHECK_ALL.checked=true;for(var t=0;t<a.arTypes.length;t++){if(!a.arCurrentChecked[a.arTypes[t].NAME]){a._parentNode.className="bx-indicator bx-indicator-on";document.getElementById("bx_filter_title_text").innerHTML=s.INTR_ABSC_TPL_FILTER_ON;a.CHECK_ALL.checked=false;break}}e("TYPE",a.arCurrentChecked)};this.CheckClick=function(e){if(!e)e=window.event;if(a.LAYOUT.style.display=="block"){a.LAYOUT.style.display="none";BX.unbind(document,"click",a.CheckClick)}return true};E.onclick=this.CheckClick}function JCCalendarInfoWin(entry_id,entry_type,user_id,loader,typeBgColors){this.ID=entry_id;this.TYPE=entry_type;this.USER_ID=user_id;var _this=this;this.LOADER=loader;this.INFO=null;this.height=315;this.width=500;this.DIV=null;this._Show=function(data){BX.closeWait(jsBXAC.LAYOUT);var windowSize=BX.GetWindowInnerSize();var windowScroll=BX.GetWindowScrollPos();if(null==_this.DIV){_this.DIV=document.body.appendChild(document.createElement("DIV"));_this.DIV.className="bx-calendar-info";_this.DIV.style.height=_this.height+"px";_this.DIV.style.width=_this.width+"px";_this.DIV.style.position="absolute";_this.DIV.style.zIndex="1000"}if(null!=data){eval("_this.INFO = "+data);var departments="";for(var i=0;i<_this.INFO.USER.UF_DEPARTMENT.length;i++){departments+=(departments.length>0?", ":"")+'<a href="'+jsBXAC.SETTINGS.DETAIL_URL_DEPARTMENT.replace(/#ID#/g,_this.INFO.USER.UF_DEPARTMENT[i].ID)+'">'+BX.util.htmlspecialchars(_this.INFO.USER.UF_DEPARTMENT[i].NAME)+"</a>"}var strAdmin="";if(_this.TYPE==1){if(null!=window.jsBXCalendarAdmin){strAdmin+='<div class="bx-calendar-info-admin">'+'<a href="javascript:void(0)" class="bx-calendar-delete" id="bx_calendar_entry_delete_'+_this.ID+'">'+window.jsBXCalendarAdmin.DELETE+"</a>"+'<a href="javascript:void(0)" onclick="'+GetAbsenceDialog(_this.ID)+'" class="bx-calendar-edit" id="bx_calendar_entry_edit_'+_this.ID+'">'+window.jsBXCalendarAdmin.EDIT+"</a>"+"</div>"}var strDate=_this.INFO.ENTRY.DATE_ACTIVE_FROM+" - "+_this.INFO.ENTRY.DATE_ACTIVE_TO}else{strAdmin+='<div class="bx-calendar-info-admin">'+'<a href="'+jsBXAC.SETTINGS.DETAIL_URL_PERSONAL.replace(/#USER_ID#/g,_this.USER_ID).replace(/#EVENT_ID#/g,_this.ID)+'" class="bx-calendar-personal">'+jsBXAC.MESSAGES.INTR_ABSC_TPL_PERSONAL_LINK_TITLE+"</a>"+"</div>";if("NONE"==_this.INFO.ENTRY.PROPERTY_PERIOD_TYPE_VALUE||""==_this.INFO.ENTRY.PROPERTY_PERIOD_TYPE_VALUE){var strDate=_this.INFO.ENTRY.DATE_ACTIVE_FROM+" - "+_this.INFO.ENTRY.DATE_ACTIVE_TO}else{var strDate=jsBXAC.MESSAGES.INTR_ABSC_TPL_REPEATING_EVENT+" ("+jsBXAC.MESSAGES["INTR_ABSC_TPL_REPEATING_EVENT_"+_this.INFO.ENTRY.PROPERTY_PERIOD_TYPE_VALUE]+")"}}if(!_this.INFO.ENTRY.PROPERTY_ABSENCE_TYPE_VALUE){for(var i=0;i<jsBXAC.TYPES.length;i++){if(jsBXAC.TYPES[i].NAME==_this.INFO.ENTRY.TYPE){_this.INFO.ENTRY.PROPERTY_ABSENCE_TYPE_VALUE=jsBXAC.TYPES[i].TITLE;break}}}_this.DIV.innerHTML='<div class="bx-calendar-info-header"><a class="bx-calendar-info-close" id="bx_top_close_'+_this.TYPE+"_"+_this.ID+'"></a></div>'+'<div class="bx-calendar-info-data">'+'<div class="bx-calendar-info-data-photo'+(_this.INFO.USER.PERSONAL_PHOTO?"":" no-photo")+'">'+(_this.INFO.USER.PERSONAL_PHOTO?_this.INFO.USER.PERSONAL_PHOTO:"")+"</div>"+'<div class="bx-calendar-info-data-cont">'+'<div class="bx-calendar-info-data-name">'+'<a href="'+_this.INFO.USER.DETAIL_URL.replace(/#USER_ID#/g,_this.USER_ID)+'">'+BX.util.htmlspecialchars(jsBXAC.FormatName(jsBXAC.SETTINGS.NAME_TEMPLATE,_this.INFO.USER))+"</a>"+"</div>"+'<div class="bx-calendar-info-data-info">'+departments+"<br />"+BX.util.htmlspecialchars(_this.INFO.USER.WORK_POSITION)+"</div>"+'<div class="bx-info-entry bx-calendar-color-'+_this.INFO.ENTRY.TYPE+'" style="background: '+typeBgColors[_this.INFO.ENTRY.TYPE]+'">'+BX.util.htmlspecialchars(_this.INFO.ENTRY.PROPERTY_ABSENCE_TYPE_VALUE)+"</div>"+'<div class="bx-calendar-info-data-date">'+strDate+"</div>"+'<div class="bx-calendar-info-data-title">'+BX.util.htmlspecialchars(_this.INFO.ENTRY.NAME)+"</div>"+'<div class="bx-calendar-info-data-detail">'+BX.util.htmlspecialchars(_this.INFO.ENTRY.DETAIL_TEXT?_this.INFO.ENTRY.DETAIL_TEXT:_this.INFO.ENTRY.PREVIEW_TEXT)+"</div>"+"</div>"+strAdmin+"</div>"+'<div class="bx-calendar-info-footer"><input type="button" value="'+jsBXAC.MESSAGES.INTR_ABSC_TPL_INFO_CLOSE+'" id="bx_bottom_close_'+_this.TYPE+"_"+_this.ID+'" /></div>';if(_this.TYPE==1){if(null!=window.jsBXCalendarAdmin){document.getElementById("bx_calendar_entry_delete_"+_this.ID).onclick=function(){return _this.deleteEntry()}}}}var left=parseInt(windowScroll.scrollLeft+windowSize.innerWidth/2-_this.width/2);var top=parseInt(windowScroll.scrollTop+windowSize.innerHeight/2-_this.height/2);_this.DIV.style.display="block";jsFloatDiv.Show(_this.DIV,left,top,5,true,false);document.getElementById("bx_top_close_"+_this.TYPE+"_"+_this.ID).onclick=document.getElementById("bx_bottom_close_"+_this.TYPE+"_"+_this.ID).onclick=function(){_this.Close()}}}JCCalendarInfoWin.prototype.Show=function(e){if(null==e)e=window.event;if(null==this.DIV){var t=this.LOADER+"?MODE=INFO&ID="+this.ID+"&TYPE="+this.TYPE+"&SITE_ID="+jsBXAC.SETTINGS.SITE_ID+"&IBLOCK="+(this.TYPE==2?jsBXAC.SETTINGS.CALENDAR_IBLOCK_ID:jsBXAC.SETTINGS.IBLOCK_ID)+"&sessid="+BX.message("bitrix_sessid");BX.showWait(jsBXAC.LAYOUT);BX.ajax.get(t,this._Show)}else{this._Show()}};JCCalendarInfoWin.prototype.Close=function(){if(null!=this.DIV){jsFloatDiv.Close(this.DIV);this.DIV.style.display="none"}};JCCalendarInfoWin.prototype.Clear=function(){if(null!=this.DIV){jsFloatDiv.Close(this.DIV);this.DIV.parentNode.removeChild(this.DIV)}};JCCalendarInfoWin.prototype.getEditUrl=function(){return jsBXAC.getEditUrl(this.INFO.ENTRY,false)};JCCalendarInfoWin.prototype.deleteEntry=function(){if(confirm(jsBXCalendarAdmin.DELETE_CONFIRM+' "'+BX.util.htmlspecialcharsback(this.INFO.ENTRY.NAME)+'"?')){BX.showWait();BX.ajax.get("/bitrix/tools/intranet_absence.php?action=delete"+"&sessid="+BX.message("bitrix_sessid")+"&absenceID="+this.INFO.ENTRY.ID+"&js=1",BX.delegate(function(){BX.closeWait();jsBXAC.LoadData()},this))}return false};BX.AbsenceCalendar={bInit:false,popup:null,arParams:{}};BX.AbsenceCalendar.Init=function(e){if(e)BX.AbsenceCalendar.arParams=e;if(BX.AbsenceCalendar.bInit)return;BX.message(e["MESS"]);BX.AbsenceCalendar.bInit=true;BX.ready(BX.delegate(function(){BX.AbsenceCalendar.popup=new BX.PopupWindow("BXAbsence",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("INTR_ABSENCE_TITLE"),closeIcon:{right:"12px",top:"10px"},buttons:[new BX.PopupWindowButton({className:"popup-window-button-accept",events:{click:function(){var e=BX("ABSENCE_FORM");handler=BX.delegate(function(e){if(e=="close"){BX.AbsenceCalendar.popup.close();jsBXAC.LoadData()}else if(/^error:/.test(e)){var t=BX.create("DIV",{html:'<div class="webform-round-corners webform-error-block" style="margin-top:5px" id="error">												<div class="webform-corners-top"><div class="webform-left-corner"></div><div class="webform-right-corner"></div></div>												<div class="webform-content">													<ul class="webform-error-list">'+e.substring(6,e.length)+'</ul>												</div>												<div class="webform-corners-bottom"><div class="webform-left-corner"></div><div class="webform-right-corner"></div></div>											</div>'});if(BX.findChild(BX.AbsenceCalendar.popup.contentContainer,{className:"webform-error-block"},true)){BX.AbsenceCalendar.popup.contentContainer.replaceChild(t,BX.AbsenceCalendar.popup.contentContainer.firstChild)}else{BX.AbsenceCalendar.popup.contentContainer.insertBefore(t,BX.AbsenceCalendar.popup.contentContainer.firstChild)}}else{BX.AbsenceCalendar.popup.setContent(e);jsBXAC.LoadData()}});if(e){if(!e.reload){BX.ajax.submit(e,handler)}else{BX.ajax.get(e.action,handler)}}}}}),new BX.PopupWindowButtonLink({text:BX.message("INTR_CLOSE_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],content:'<div style="width:450px;height:230px"></div>',events:{onAfterPopupShow:function(){this.setContent('<div style="width:450px;height:230px">'+BX.message("INTR_LOADING")+"</div>");BX.ajax.post("/bitrix/tools/intranet_absence.php",{lang:BX.message("LANGUAGE_ID"),site_id:BX.message("SITE_ID")||"",arParams:BX.AbsenceCalendar.arParams},BX.delegate(function(e){this.setContent(e)},this))}}})},this))};BX.AbsenceCalendar.ShowForm=function(e){BX.AbsenceCalendar.Init(e);BX.AbsenceCalendar.popup.params.zIndex=BX.WindowManager?BX.WindowManager.GetZIndex():0;BX.AbsenceCalendar.popup.show()};
//# sourceMappingURL=script.map.js