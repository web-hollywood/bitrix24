function TasksTask(e,a,t){this.name=e;this.multiple=a;this.arSelected=[];this.useLocalCache=t;this.arTasksData=[];this.ajaxParameters={}}TasksTask.arTasks={};TasksTask.arTasksData={};TasksTask.prototype.addAjaxParameter=function(e,a){if(typeof e!="undefined"&&e.toString().length>0)this.ajaxParameters[e.toString()]=a};TasksTask.prototype.setSelected=function(){throw new Exception("setSelected is not implemented")};TasksTask.prototype.getSelected=function(){return this.toObject(this.arSelected)};TasksTask.prototype.select=function(e){var a;var t=0;var s=e.target||e.srcElement;if(e.currentTarget){a=e.currentTarget}else{a=s;while(!BX.hasClass(a,"finder-box-item")){a=a.parentNode}}var i=BX.findChild(a,{tag:"input"});var n=BX.findChild(a,{tag:"DIV",className:"finder-box-item-text"},true);var r,l=null;if(typeof TasksTask.arTasksData[i.value]!="undefined"){r=TasksTask.arTasksData[i.value].sub;l=TasksTask.arTasksData[i.value].position}else if(typeof this.arTasksData[i.value]!="undefined"){r=this.arTasksData[i.value].sub;l=this.arTasksData[i.value].position}var c={id:i.value,name:BX.util.htmlspecialcharsback(n.innerHTML),sub:r,position:l};if(!this.multiple){var o=document.getElementsByName(this.name);for(var t=0;t<o.length;t++){if(o[t].value!=i.value){BX.removeClass(o[t].parentNode,"finder-box-item-selected")}else{BX.addClass(o[t].parentNode,"finder-box-item-selected")}}i.checked=true;BX.addClass(a,"finder-box-item-selected");this.searchInput.value=BX.util.htmlspecialcharsback(n.innerHTML);this.arSelected=[];this.arSelected[i.value]=c}else{var o=document.getElementsByName(this.name+"[]");for(var t=0;t<o.length;t++){if(o[t].value==i.value){o[t].checked=false;BX.toggleClass(o[t].parentNode,"finder-box-item-selected")}}if(BX.hasClass(i.parentNode,"finder-box-item-selected")){i.checked=true}if(i.checked){var d=BX.findChild(BX(this.name+"_selected_tasks"),{className:"finder-box-selected-items"});if(!BX(this.name+"_task_selected_"+i.value)){var h=BX.create("DIV");h.id=this.name+"_task_selected_"+i.value;h.className="finder-box-selected-item";h.innerHTML='<div class="finder-box-selected-item-icon" onclick="O_'+this.name+".unselect("+i.value+', this);" id="task-unselect-'+i.value+'"></div><a href="'+BX.message("TASKS_PATH_TO_TASK").replace("#task_id#",i.value).replace("#action#","view")+'" target="_blank" class="finder-box-selected-item-text">'+n.innerHTML+"</a>";d.appendChild(h);var u=BX(this.name+"_current_count");u.innerHTML=parseInt(u.innerHTML)+1;this.arSelected[i.value]=c}}else{BX.remove(BX(this.name+"_task_selected_"+i.value));var u=BX(this.name+"_current_count");u.innerHTML=parseInt(u.innerHTML)-1;this.arSelected[i.value]=null}}if(this.onSelect){this.onSelect(c)}BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};TasksTask.prototype.toObject=function(e){var a={};for(var t in e){t=parseInt(t);if(typeof t=="number"&&e[t]!==null){a[t]=BX.clone(e[t])}}return a};TasksTask.prototype.unselect=function(e,a){if(!this.arSelected[e]){return}var t=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var s=0;s<t.length;s++){if(t[s].value==e){t[s].checked=false;BX.removeClass(t[s].parentNode,"finder-box-item-selected")}}if(this.multiple){if(!a){a=BX("task-unselect-"+e)}if(a){BX.remove(a.parentNode)}var i=BX(this.name+"_current_count");i.innerHTML=parseInt(i.innerHTML)-1}this.arSelected[e]=null;BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};TasksTask.prototype.setFocus=function(){var e=BX(this.name+"_task_input");if(e){e.focus()}};TasksTask.prototype.search=function(e){if(!e)e=window.event;if(this.searchInput.value.length>1){this.displayTab("search");var a=(typeof this.ajaxUrl!="undefined"?this.ajaxUrl:TasksTask.ajaxUrl)+"&MODE=SEARCH&SEARCH_STRING="+encodeURIComponent(this.searchInput.value)+"&"+BX.ajax.prepareData(this.filter,"FILTER");BX.ajax({url:a,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:this.ajaxParameters,onsuccess:BX.proxy(function(e){this.showResults(e)},this)})}};TasksTask.prototype.showResults=function(e){var a=e;var t=BX(this.name+"_search");var s=t.getElementsByTagName("input");for(var i=0,n=s.length;i<n;i++){if(s[i].checked){BX(this.name+"_last").appendChild(s[i])}}if(t){t.innerHTML="";for(var i=0;i<a.length;i++){var r;var l=false;(this.useLocalCache?this:TasksTask).arTasksData[a[i].ID]={id:a[i].ID,name:a[i].TITLE,status:a[i].STATUS};var c=BX.create("input",{props:{className:"tasks-hidden-input"}});if(this.multiple){c.name=this.name+"[]";c.type="checkbox"}else{c.name=this.name;c.type="radio"}var s=document.getElementsByName(c.name);var o=0;while(!l&&o<s.length){if(s[o].value==a[i].ID&&s[o].checked){l=true}o++}c.value=a[i].ID;switch(parseInt(a[i].STATUS)){case-1:var d=" task-status-overdue";break;case-2:case 1:var d=" task-status-new";break;case 2:var d=" task-status-accepted";break;case 3:var d=" task-status-in-progress";break;case 4:var d=" task-status-waiting";break;case 5:var d=" task-status-completed";break;case 6:var d=" task-status-delayed";break;case 7:var d=" task-status-declined";break;default:var d=""}obTaskRow=BX.create("div",{props:{className:"finder-box-item"+d+(l?" finder-box-item-selected":"")},events:{click:BX.proxy(this.select,this)},children:[c,BX.create("div",{props:{className:"finder-box-item-text"},text:a[i].TITLE}),BX.create("div",{props:{className:"finder-box-item-icon"}})]});t.appendChild(obTaskRow)}}};TasksTask.prototype.displayTab=function(e){BX.removeClass(BX(this.name+"_last"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_search"),"finder-box-tab-content-selected");BX.addClass(BX(this.name+"_"+e),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_tab_last"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_search"),"finder-box-tab-selected");BX.addClass(BX(this.name+"_tab_"+e),"finder-box-tab-selected")};
//# sourceMappingURL=tasks.map.js